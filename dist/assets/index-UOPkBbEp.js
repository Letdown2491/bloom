var co=Object.defineProperty;var Us=s=>{throw TypeError(s)};var fo=(s,e,o)=>e in s?co(s,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[e]=o;var pt=(s,e,o)=>fo(s,typeof e!="symbol"?e+"":e,o),ys=(s,e,o)=>e.has(s)||Us("Cannot "+o);var mt=(s,e,o)=>(ys(s,e,"read from private field"),o?o.call(s):e.get(s)),Lt=(s,e,o)=>e.has(s)?Us("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,o),Ot=(s,e,o,a)=>(ys(s,e,"write to private field"),a?a.call(s,o):e.set(s,o),o),Ft=(s,e,o)=>(ys(s,e,"access private method"),o);var Dr=(s,e,o,a)=>({set _(c){Ot(s,e,c,o)},get _(){return mt(s,e,a)}});(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))a(c);new MutationObserver(c=>{for(const g of c)if(g.type==="childList")for(const b of g.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&a(b)}).observe(document,{childList:!0,subtree:!0});function o(c){const g={};return c.integrity&&(g.integrity=c.integrity),c.referrerPolicy&&(g.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?g.credentials="include":c.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function a(c){if(c.ep)return;c.ep=!0;const g=o(c);fetch(c.href,g)}})();var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var jsxRuntime={exports:{}},reactJsxRuntime_production_min={},react={exports:{}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l$1=Symbol.for("react.element"),n$1=Symbol.for("react.portal"),p$3=Symbol.for("react.fragment"),q$2=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),t=Symbol.for("react.provider"),u=Symbol.for("react.context"),v$1=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),x=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),z$1=Symbol.iterator;function A$2(s){return s===null||typeof s!="object"?null:(s=z$1&&s[z$1]||s["@@iterator"],typeof s=="function"?s:null)}var B$1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C$1=Object.assign,D$2={};function E$1(s,e,o){this.props=s,this.context=e,this.refs=D$2,this.updater=o||B$1}E$1.prototype.isReactComponent={};E$1.prototype.setState=function(s,e){if(typeof s!="object"&&typeof s!="function"&&s!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,s,e,"setState")};E$1.prototype.forceUpdate=function(s){this.updater.enqueueForceUpdate(this,s,"forceUpdate")};function F$1(){}F$1.prototype=E$1.prototype;function G$1(s,e,o){this.props=s,this.context=e,this.refs=D$2,this.updater=o||B$1}var H$2=G$1.prototype=new F$1;H$2.constructor=G$1;C$1(H$2,E$1.prototype);H$2.isPureReactComponent=!0;var I$1=Array.isArray,J=Object.prototype.hasOwnProperty,K$1={current:null},L$1={key:!0,ref:!0,__self:!0,__source:!0};function M$2(s,e,o){var a,c={},g=null,b=null;if(e!=null)for(a in e.ref!==void 0&&(b=e.ref),e.key!==void 0&&(g=""+e.key),e)J.call(e,a)&&!L$1.hasOwnProperty(a)&&(c[a]=e[a]);var _=arguments.length-2;if(_===1)c.children=o;else if(1<_){for(var j=Array(_),_e=0;_e<_;_e++)j[_e]=arguments[_e+2];c.children=j}if(s&&s.defaultProps)for(a in _=s.defaultProps,_)c[a]===void 0&&(c[a]=_[a]);return{$$typeof:l$1,type:s,key:g,ref:b,props:c,_owner:K$1.current}}function N$1(s,e){return{$$typeof:l$1,type:s.type,key:e,ref:s.ref,props:s.props,_owner:s._owner}}function O$2(s){return typeof s=="object"&&s!==null&&s.$$typeof===l$1}function escape(s){var e={"=":"=0",":":"=2"};return"$"+s.replace(/[=:]/g,function(o){return e[o]})}var P$1=/\/+/g;function Q$1(s,e){return typeof s=="object"&&s!==null&&s.key!=null?escape(""+s.key):e.toString(36)}function R$1(s,e,o,a,c){var g=typeof s;(g==="undefined"||g==="boolean")&&(s=null);var b=!1;if(s===null)b=!0;else switch(g){case"string":case"number":b=!0;break;case"object":switch(s.$$typeof){case l$1:case n$1:b=!0}}if(b)return b=s,c=c(b),s=a===""?"."+Q$1(b,0):a,I$1(c)?(o="",s!=null&&(o=s.replace(P$1,"$&/")+"/"),R$1(c,e,o,"",function(_e){return _e})):c!=null&&(O$2(c)&&(c=N$1(c,o+(!c.key||b&&b.key===c.key?"":(""+c.key).replace(P$1,"$&/")+"/")+s)),e.push(c)),1;if(b=0,a=a===""?".":a+":",I$1(s))for(var _=0;_<s.length;_++){g=s[_];var j=a+Q$1(g,_);b+=R$1(g,e,o,j,c)}else if(j=A$2(s),typeof j=="function")for(s=j.call(s),_=0;!(g=s.next()).done;)g=g.value,j=a+Q$1(g,_++),b+=R$1(g,e,o,j,c);else if(g==="object")throw e=String(s),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return b}function S$2(s,e,o){if(s==null)return s;var a=[],c=0;return R$1(s,a,"","",function(g){return e.call(o,g,c++)}),a}function T$1(s){if(s._status===-1){var e=s._result;e=e(),e.then(function(o){(s._status===0||s._status===-1)&&(s._status=1,s._result=o)},function(o){(s._status===0||s._status===-1)&&(s._status=2,s._result=o)}),s._status===-1&&(s._status=0,s._result=e)}if(s._status===1)return s._result.default;throw s._result}var U$1={current:null},V$1={transition:null},W$1={ReactCurrentDispatcher:U$1,ReactCurrentBatchConfig:V$1,ReactCurrentOwner:K$1};function X$1(){throw Error("act(...) is not supported in production builds of React.")}react_production_min.Children={map:S$2,forEach:function(s,e,o){S$2(s,function(){e.apply(this,arguments)},o)},count:function(s){var e=0;return S$2(s,function(){e++}),e},toArray:function(s){return S$2(s,function(e){return e})||[]},only:function(s){if(!O$2(s))throw Error("React.Children.only expected to receive a single React element child.");return s}};react_production_min.Component=E$1;react_production_min.Fragment=p$3;react_production_min.Profiler=r;react_production_min.PureComponent=G$1;react_production_min.StrictMode=q$2;react_production_min.Suspense=w;react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W$1;react_production_min.act=X$1;react_production_min.cloneElement=function(s,e,o){if(s==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+s+".");var a=C$1({},s.props),c=s.key,g=s.ref,b=s._owner;if(e!=null){if(e.ref!==void 0&&(g=e.ref,b=K$1.current),e.key!==void 0&&(c=""+e.key),s.type&&s.type.defaultProps)var _=s.type.defaultProps;for(j in e)J.call(e,j)&&!L$1.hasOwnProperty(j)&&(a[j]=e[j]===void 0&&_!==void 0?_[j]:e[j])}var j=arguments.length-2;if(j===1)a.children=o;else if(1<j){_=Array(j);for(var _e=0;_e<j;_e++)_[_e]=arguments[_e+2];a.children=_}return{$$typeof:l$1,type:s.type,key:c,ref:g,props:a,_owner:b}};react_production_min.createContext=function(s){return s={$$typeof:u,_currentValue:s,_currentValue2:s,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},s.Provider={$$typeof:t,_context:s},s.Consumer=s};react_production_min.createElement=M$2;react_production_min.createFactory=function(s){var e=M$2.bind(null,s);return e.type=s,e};react_production_min.createRef=function(){return{current:null}};react_production_min.forwardRef=function(s){return{$$typeof:v$1,render:s}};react_production_min.isValidElement=O$2;react_production_min.lazy=function(s){return{$$typeof:y,_payload:{_status:-1,_result:s},_init:T$1}};react_production_min.memo=function(s,e){return{$$typeof:x,type:s,compare:e===void 0?null:e}};react_production_min.startTransition=function(s){var e=V$1.transition;V$1.transition={};try{s()}finally{V$1.transition=e}};react_production_min.unstable_act=X$1;react_production_min.useCallback=function(s,e){return U$1.current.useCallback(s,e)};react_production_min.useContext=function(s){return U$1.current.useContext(s)};react_production_min.useDebugValue=function(){};react_production_min.useDeferredValue=function(s){return U$1.current.useDeferredValue(s)};react_production_min.useEffect=function(s,e){return U$1.current.useEffect(s,e)};react_production_min.useId=function(){return U$1.current.useId()};react_production_min.useImperativeHandle=function(s,e,o){return U$1.current.useImperativeHandle(s,e,o)};react_production_min.useInsertionEffect=function(s,e){return U$1.current.useInsertionEffect(s,e)};react_production_min.useLayoutEffect=function(s,e){return U$1.current.useLayoutEffect(s,e)};react_production_min.useMemo=function(s,e){return U$1.current.useMemo(s,e)};react_production_min.useReducer=function(s,e,o){return U$1.current.useReducer(s,e,o)};react_production_min.useRef=function(s){return U$1.current.useRef(s)};react_production_min.useState=function(s){return U$1.current.useState(s)};react_production_min.useSyncExternalStore=function(s,e,o){return U$1.current.useSyncExternalStore(s,e,o)};react_production_min.useTransition=function(){return U$1.current.useTransition()};react_production_min.version="18.3.1";react.exports=react_production_min;var reactExports=react.exports;const React=getDefaultExportFromCjs(reactExports);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f$1=reactExports,k=Symbol.for("react.element"),l=Symbol.for("react.fragment"),m$1=Object.prototype.hasOwnProperty,n=f$1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p$2={key:!0,ref:!0,__self:!0,__source:!0};function q$1(s,e,o){var a,c={},g=null,b=null;o!==void 0&&(g=""+o),e.key!==void 0&&(g=""+e.key),e.ref!==void 0&&(b=e.ref);for(a in e)m$1.call(e,a)&&!p$2.hasOwnProperty(a)&&(c[a]=e[a]);if(s&&s.defaultProps)for(a in e=s.defaultProps,e)c[a]===void 0&&(c[a]=e[a]);return{$$typeof:k,type:s,key:g,ref:b,props:c,_owner:n.current}}reactJsxRuntime_production_min.Fragment=l;reactJsxRuntime_production_min.jsx=q$1;reactJsxRuntime_production_min.jsxs=q$1;jsxRuntime.exports=reactJsxRuntime_production_min;var jsxRuntimeExports=jsxRuntime.exports,reactDom={exports:{}},reactDom_production_min={},scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(s){function e(wt,St){var gt=wt.length;wt.push(St);e:for(;0<gt;){var $t=gt-1>>>1,kt=wt[$t];if(0<c(kt,St))wt[$t]=St,wt[gt]=kt,gt=$t;else break e}}function o(wt){return wt.length===0?null:wt[0]}function a(wt){if(wt.length===0)return null;var St=wt[0],gt=wt.pop();if(gt!==St){wt[0]=gt;e:for(var $t=0,kt=wt.length,Pt=kt>>>1;$t<Pt;){var jt=2*($t+1)-1,Dt=wt[jt],Bt=jt+1,Mt=wt[Bt];if(0>c(Dt,gt))Bt<kt&&0>c(Mt,Dt)?(wt[$t]=Mt,wt[Bt]=gt,$t=Bt):(wt[$t]=Dt,wt[jt]=gt,$t=jt);else if(Bt<kt&&0>c(Mt,gt))wt[$t]=Mt,wt[Bt]=gt,$t=Bt;else break e}}return St}function c(wt,St){var gt=wt.sortIndex-St.sortIndex;return gt!==0?gt:wt.id-St.id}if(typeof performance=="object"&&typeof performance.now=="function"){var g=performance;s.unstable_now=function(){return g.now()}}else{var b=Date,_=b.now();s.unstable_now=function(){return b.now()-_}}var j=[],_e=[],tt=1,et=null,nt=3,rt=!1,it=!1,st=!1,lt=typeof setTimeout=="function"?setTimeout:null,at=typeof clearTimeout=="function"?clearTimeout:null,ct=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ft(wt){for(var St=o(_e);St!==null;){if(St.callback===null)a(_e);else if(St.startTime<=wt)a(_e),St.sortIndex=St.expirationTime,e(j,St);else break;St=o(_e)}}function vt(wt){if(st=!1,ft(wt),!it)if(o(j)!==null)it=!0,dt(Rt);else{var St=o(_e);St!==null&&bt(vt,St.startTime-wt)}}function Rt(wt,St){it=!1,st&&(st=!1,at(Ct),Ct=-1),rt=!0;var gt=nt;try{for(ft(St),et=o(j);et!==null&&(!(et.expirationTime>St)||wt&&!yt());){var $t=et.callback;if(typeof $t=="function"){et.callback=null,nt=et.priorityLevel;var kt=$t(et.expirationTime<=St);St=s.unstable_now(),typeof kt=="function"?et.callback=kt:et===o(j)&&a(j),ft(St)}else a(j);et=o(j)}if(et!==null)var Pt=!0;else{var jt=o(_e);jt!==null&&bt(vt,jt.startTime-St),Pt=!1}return Pt}finally{et=null,nt=gt,rt=!1}}var _t=!1,Tt=null,Ct=-1,Nt=5,At=-1;function yt(){return!(s.unstable_now()-At<Nt)}function xt(){if(Tt!==null){var wt=s.unstable_now();At=wt;var St=!0;try{St=Tt(!0,wt)}finally{St?ht():(_t=!1,Tt=null)}}else _t=!1}var ht;if(typeof ct=="function")ht=function(){ct(xt)};else if(typeof MessageChannel<"u"){var Et=new MessageChannel,ot=Et.port2;Et.port1.onmessage=xt,ht=function(){ot.postMessage(null)}}else ht=function(){lt(xt,0)};function dt(wt){Tt=wt,_t||(_t=!0,ht())}function bt(wt,St){Ct=lt(function(){wt(s.unstable_now())},St)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(wt){wt.callback=null},s.unstable_continueExecution=function(){it||rt||(it=!0,dt(Rt))},s.unstable_forceFrameRate=function(wt){0>wt||125<wt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Nt=0<wt?Math.floor(1e3/wt):5},s.unstable_getCurrentPriorityLevel=function(){return nt},s.unstable_getFirstCallbackNode=function(){return o(j)},s.unstable_next=function(wt){switch(nt){case 1:case 2:case 3:var St=3;break;default:St=nt}var gt=nt;nt=St;try{return wt()}finally{nt=gt}},s.unstable_pauseExecution=function(){},s.unstable_requestPaint=function(){},s.unstable_runWithPriority=function(wt,St){switch(wt){case 1:case 2:case 3:case 4:case 5:break;default:wt=3}var gt=nt;nt=wt;try{return St()}finally{nt=gt}},s.unstable_scheduleCallback=function(wt,St,gt){var $t=s.unstable_now();switch(typeof gt=="object"&&gt!==null?(gt=gt.delay,gt=typeof gt=="number"&&0<gt?$t+gt:$t):gt=$t,wt){case 1:var kt=-1;break;case 2:kt=250;break;case 5:kt=1073741823;break;case 4:kt=1e4;break;default:kt=5e3}return kt=gt+kt,wt={id:tt++,callback:St,priorityLevel:wt,startTime:gt,expirationTime:kt,sortIndex:-1},gt>$t?(wt.sortIndex=gt,e(_e,wt),o(j)===null&&wt===o(_e)&&(st?(at(Ct),Ct=-1):st=!0,bt(vt,gt-$t))):(wt.sortIndex=kt,e(j,wt),it||rt||(it=!0,dt(Rt))),wt},s.unstable_shouldYield=yt,s.unstable_wrapCallback=function(wt){var St=nt;return function(){var gt=nt;nt=St;try{return wt.apply(this,arguments)}finally{nt=gt}}}})(scheduler_production_min);scheduler.exports=scheduler_production_min;var schedulerExports=scheduler.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa=reactExports,ca=schedulerExports;function p$1(s){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+s,o=1;o<arguments.length;o++)e+="&args[]="+encodeURIComponent(arguments[o]);return"Minified React error #"+s+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da=new Set,ea={};function fa(s,e){ha(s,e),ha(s+"Capture",e)}function ha(s,e){for(ea[s]=e,s=0;s<e.length;s++)da.add(e[s])}var ia=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ja=Object.prototype.hasOwnProperty,ka=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la={},ma={};function oa(s){return ja.call(ma,s)?!0:ja.call(la,s)?!1:ka.test(s)?ma[s]=!0:(la[s]=!0,!1)}function pa(s,e,o,a){if(o!==null&&o.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return a?!1:o!==null?!o.acceptsBooleans:(s=s.toLowerCase().slice(0,5),s!=="data-"&&s!=="aria-");default:return!1}}function qa(s,e,o,a){if(e===null||typeof e>"u"||pa(s,e,o,a))return!0;if(a)return!1;if(o!==null)switch(o.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function v(s,e,o,a,c,g,b){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=a,this.attributeNamespace=c,this.mustUseProperty=o,this.propertyName=s,this.type=e,this.sanitizeURL=g,this.removeEmptyString=b}var z={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(s){z[s]=new v(s,0,!1,s,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(s){var e=s[0];z[e]=new v(e,1,!1,s[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(s){z[s]=new v(s,2,!1,s.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(s){z[s]=new v(s,2,!1,s,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(s){z[s]=new v(s,3,!1,s.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(s){z[s]=new v(s,3,!0,s,null,!1,!1)});["capture","download"].forEach(function(s){z[s]=new v(s,4,!1,s,null,!1,!1)});["cols","rows","size","span"].forEach(function(s){z[s]=new v(s,6,!1,s,null,!1,!1)});["rowSpan","start"].forEach(function(s){z[s]=new v(s,5,!1,s.toLowerCase(),null,!1,!1)});var ra=/[\-:]([a-z])/g;function sa(s){return s[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(s){var e=s.replace(ra,sa);z[e]=new v(e,1,!1,s,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(s){var e=s.replace(ra,sa);z[e]=new v(e,1,!1,s,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(s){var e=s.replace(ra,sa);z[e]=new v(e,1,!1,s,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(s){z[s]=new v(s,1,!1,s.toLowerCase(),null,!1,!1)});z.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(s){z[s]=new v(s,1,!1,s.toLowerCase(),null,!0,!0)});function ta(s,e,o,a){var c=z.hasOwnProperty(e)?z[e]:null;(c!==null?c.type!==0:a||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(qa(e,o,c,a)&&(o=null),a||c===null?oa(e)&&(o===null?s.removeAttribute(e):s.setAttribute(e,""+o)):c.mustUseProperty?s[c.propertyName]=o===null?c.type===3?!1:"":o:(e=c.attributeName,a=c.attributeNamespace,o===null?s.removeAttribute(e):(c=c.type,o=c===3||c===4&&o===!0?"":""+o,a?s.setAttributeNS(a,e,o):s.setAttribute(e,o))))}var ua=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va=Symbol.for("react.element"),wa=Symbol.for("react.portal"),ya=Symbol.for("react.fragment"),za=Symbol.for("react.strict_mode"),Aa=Symbol.for("react.profiler"),Ba=Symbol.for("react.provider"),Ca=Symbol.for("react.context"),Da=Symbol.for("react.forward_ref"),Ea=Symbol.for("react.suspense"),Fa=Symbol.for("react.suspense_list"),Ga=Symbol.for("react.memo"),Ha=Symbol.for("react.lazy"),Ia=Symbol.for("react.offscreen"),Ja=Symbol.iterator;function Ka(s){return s===null||typeof s!="object"?null:(s=Ja&&s[Ja]||s["@@iterator"],typeof s=="function"?s:null)}var A$1=Object.assign,La;function Ma(s){if(La===void 0)try{throw Error()}catch(o){var e=o.stack.trim().match(/\n( *(at )?)/);La=e&&e[1]||""}return`
`+La+s}var Na=!1;function Oa(s,e){if(!s||Na)return"";Na=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(_e){var a=_e}Reflect.construct(s,[],e)}else{try{e.call()}catch(_e){a=_e}s.call(e.prototype)}else{try{throw Error()}catch(_e){a=_e}s()}}catch(_e){if(_e&&a&&typeof _e.stack=="string"){for(var c=_e.stack.split(`
`),g=a.stack.split(`
`),b=c.length-1,_=g.length-1;1<=b&&0<=_&&c[b]!==g[_];)_--;for(;1<=b&&0<=_;b--,_--)if(c[b]!==g[_]){if(b!==1||_!==1)do if(b--,_--,0>_||c[b]!==g[_]){var j=`
`+c[b].replace(" at new "," at ");return s.displayName&&j.includes("<anonymous>")&&(j=j.replace("<anonymous>",s.displayName)),j}while(1<=b&&0<=_);break}}}finally{Na=!1,Error.prepareStackTrace=o}return(s=s?s.displayName||s.name:"")?Ma(s):""}function Pa(s){switch(s.tag){case 5:return Ma(s.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return s=Oa(s.type,!1),s;case 11:return s=Oa(s.type.render,!1),s;case 1:return s=Oa(s.type,!0),s;default:return""}}function Qa(s){if(s==null)return null;if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case ya:return"Fragment";case wa:return"Portal";case Aa:return"Profiler";case za:return"StrictMode";case Ea:return"Suspense";case Fa:return"SuspenseList"}if(typeof s=="object")switch(s.$$typeof){case Ca:return(s.displayName||"Context")+".Consumer";case Ba:return(s._context.displayName||"Context")+".Provider";case Da:var e=s.render;return s=s.displayName,s||(s=e.displayName||e.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case Ga:return e=s.displayName||null,e!==null?e:Qa(s.type)||"Memo";case Ha:e=s._payload,s=s._init;try{return Qa(s(e))}catch{}}return null}function Ra(s){var e=s.type;switch(s.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return s=e.render,s=s.displayName||s.name||"",e.displayName||(s!==""?"ForwardRef("+s+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa(e);case 8:return e===za?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Sa(s){switch(typeof s){case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function Ta(s){var e=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Ua(s){var e=Ta(s)?"checked":"value",o=Object.getOwnPropertyDescriptor(s.constructor.prototype,e),a=""+s[e];if(!s.hasOwnProperty(e)&&typeof o<"u"&&typeof o.get=="function"&&typeof o.set=="function"){var c=o.get,g=o.set;return Object.defineProperty(s,e,{configurable:!0,get:function(){return c.call(this)},set:function(b){a=""+b,g.call(this,b)}}),Object.defineProperty(s,e,{enumerable:o.enumerable}),{getValue:function(){return a},setValue:function(b){a=""+b},stopTracking:function(){s._valueTracker=null,delete s[e]}}}}function Va(s){s._valueTracker||(s._valueTracker=Ua(s))}function Wa(s){if(!s)return!1;var e=s._valueTracker;if(!e)return!0;var o=e.getValue(),a="";return s&&(a=Ta(s)?s.checked?"true":"false":s.value),s=a,s!==o?(e.setValue(s),!0):!1}function Xa(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}function Ya(s,e){var o=e.checked;return A$1({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:o??s._wrapperState.initialChecked})}function Za(s,e){var o=e.defaultValue==null?"":e.defaultValue,a=e.checked!=null?e.checked:e.defaultChecked;o=Sa(e.value!=null?e.value:o),s._wrapperState={initialChecked:a,initialValue:o,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function ab(s,e){e=e.checked,e!=null&&ta(s,"checked",e,!1)}function bb(s,e){ab(s,e);var o=Sa(e.value),a=e.type;if(o!=null)a==="number"?(o===0&&s.value===""||s.value!=o)&&(s.value=""+o):s.value!==""+o&&(s.value=""+o);else if(a==="submit"||a==="reset"){s.removeAttribute("value");return}e.hasOwnProperty("value")?cb(s,e.type,o):e.hasOwnProperty("defaultValue")&&cb(s,e.type,Sa(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(s.defaultChecked=!!e.defaultChecked)}function db(s,e,o){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var a=e.type;if(!(a!=="submit"&&a!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+s._wrapperState.initialValue,o||e===s.value||(s.value=e),s.defaultValue=e}o=s.name,o!==""&&(s.name=""),s.defaultChecked=!!s._wrapperState.initialChecked,o!==""&&(s.name=o)}function cb(s,e,o){(e!=="number"||Xa(s.ownerDocument)!==s)&&(o==null?s.defaultValue=""+s._wrapperState.initialValue:s.defaultValue!==""+o&&(s.defaultValue=""+o))}var eb=Array.isArray;function fb(s,e,o,a){if(s=s.options,e){e={};for(var c=0;c<o.length;c++)e["$"+o[c]]=!0;for(o=0;o<s.length;o++)c=e.hasOwnProperty("$"+s[o].value),s[o].selected!==c&&(s[o].selected=c),c&&a&&(s[o].defaultSelected=!0)}else{for(o=""+Sa(o),e=null,c=0;c<s.length;c++){if(s[c].value===o){s[c].selected=!0,a&&(s[c].defaultSelected=!0);return}e!==null||s[c].disabled||(e=s[c])}e!==null&&(e.selected=!0)}}function gb(s,e){if(e.dangerouslySetInnerHTML!=null)throw Error(p$1(91));return A$1({},e,{value:void 0,defaultValue:void 0,children:""+s._wrapperState.initialValue})}function hb(s,e){var o=e.value;if(o==null){if(o=e.children,e=e.defaultValue,o!=null){if(e!=null)throw Error(p$1(92));if(eb(o)){if(1<o.length)throw Error(p$1(93));o=o[0]}e=o}e==null&&(e=""),o=e}s._wrapperState={initialValue:Sa(o)}}function ib(s,e){var o=Sa(e.value),a=Sa(e.defaultValue);o!=null&&(o=""+o,o!==s.value&&(s.value=o),e.defaultValue==null&&s.defaultValue!==o&&(s.defaultValue=o)),a!=null&&(s.defaultValue=""+a)}function jb(s){var e=s.textContent;e===s._wrapperState.initialValue&&e!==""&&e!==null&&(s.value=e)}function kb(s){switch(s){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb(s,e){return s==null||s==="http://www.w3.org/1999/xhtml"?kb(e):s==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":s}var mb,nb=function(s){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,o,a,c){MSApp.execUnsafeLocalFunction(function(){return s(e,o,a,c)})}:s}(function(s,e){if(s.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in s)s.innerHTML=e;else{for(mb=mb||document.createElement("div"),mb.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=mb.firstChild;s.firstChild;)s.removeChild(s.firstChild);for(;e.firstChild;)s.appendChild(e.firstChild)}});function ob(s,e){if(e){var o=s.firstChild;if(o&&o===s.lastChild&&o.nodeType===3){o.nodeValue=e;return}}s.textContent=e}var pb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb=["Webkit","ms","Moz","O"];Object.keys(pb).forEach(function(s){qb.forEach(function(e){e=e+s.charAt(0).toUpperCase()+s.substring(1),pb[e]=pb[s]})});function rb(s,e,o){return e==null||typeof e=="boolean"||e===""?"":o||typeof e!="number"||e===0||pb.hasOwnProperty(s)&&pb[s]?(""+e).trim():e+"px"}function sb(s,e){s=s.style;for(var o in e)if(e.hasOwnProperty(o)){var a=o.indexOf("--")===0,c=rb(o,e[o],a);o==="float"&&(o="cssFloat"),a?s.setProperty(o,c):s[o]=c}}var tb=A$1({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub(s,e){if(e){if(tb[s]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(p$1(137,s));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(p$1(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(p$1(61))}if(e.style!=null&&typeof e.style!="object")throw Error(p$1(62))}}function vb(s,e){if(s.indexOf("-")===-1)return typeof e.is=="string";switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb=null;function xb(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var yb=null,zb=null,Ab=null;function Bb(s){if(s=Cb(s)){if(typeof yb!="function")throw Error(p$1(280));var e=s.stateNode;e&&(e=Db(e),yb(s.stateNode,s.type,e))}}function Eb(s){zb?Ab?Ab.push(s):Ab=[s]:zb=s}function Fb(){if(zb){var s=zb,e=Ab;if(Ab=zb=null,Bb(s),e)for(s=0;s<e.length;s++)Bb(e[s])}}function Gb(s,e){return s(e)}function Hb(){}var Ib=!1;function Jb(s,e,o){if(Ib)return s(e,o);Ib=!0;try{return Gb(s,e,o)}finally{Ib=!1,(zb!==null||Ab!==null)&&(Hb(),Fb())}}function Kb(s,e){var o=s.stateNode;if(o===null)return null;var a=Db(o);if(a===null)return null;o=a[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(a=!a.disabled)||(s=s.type,a=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!a;break e;default:s=!1}if(s)return null;if(o&&typeof o!="function")throw Error(p$1(231,e,typeof o));return o}var Lb=!1;if(ia)try{var Mb={};Object.defineProperty(Mb,"passive",{get:function(){Lb=!0}}),window.addEventListener("test",Mb,Mb),window.removeEventListener("test",Mb,Mb)}catch{Lb=!1}function Nb(s,e,o,a,c,g,b,_,j){var _e=Array.prototype.slice.call(arguments,3);try{e.apply(o,_e)}catch(tt){this.onError(tt)}}var Ob=!1,Pb=null,Qb=!1,Rb=null,Sb={onError:function(s){Ob=!0,Pb=s}};function Tb(s,e,o,a,c,g,b,_,j){Ob=!1,Pb=null,Nb.apply(Sb,arguments)}function Ub(s,e,o,a,c,g,b,_,j){if(Tb.apply(this,arguments),Ob){if(Ob){var _e=Pb;Ob=!1,Pb=null}else throw Error(p$1(198));Qb||(Qb=!0,Rb=_e)}}function Vb(s){var e=s,o=s;if(s.alternate)for(;e.return;)e=e.return;else{s=e;do e=s,e.flags&4098&&(o=e.return),s=e.return;while(s)}return e.tag===3?o:null}function Wb(s){if(s.tag===13){var e=s.memoizedState;if(e===null&&(s=s.alternate,s!==null&&(e=s.memoizedState)),e!==null)return e.dehydrated}return null}function Xb(s){if(Vb(s)!==s)throw Error(p$1(188))}function Yb(s){var e=s.alternate;if(!e){if(e=Vb(s),e===null)throw Error(p$1(188));return e!==s?null:s}for(var o=s,a=e;;){var c=o.return;if(c===null)break;var g=c.alternate;if(g===null){if(a=c.return,a!==null){o=a;continue}break}if(c.child===g.child){for(g=c.child;g;){if(g===o)return Xb(c),s;if(g===a)return Xb(c),e;g=g.sibling}throw Error(p$1(188))}if(o.return!==a.return)o=c,a=g;else{for(var b=!1,_=c.child;_;){if(_===o){b=!0,o=c,a=g;break}if(_===a){b=!0,a=c,o=g;break}_=_.sibling}if(!b){for(_=g.child;_;){if(_===o){b=!0,o=g,a=c;break}if(_===a){b=!0,a=g,o=c;break}_=_.sibling}if(!b)throw Error(p$1(189))}}if(o.alternate!==a)throw Error(p$1(190))}if(o.tag!==3)throw Error(p$1(188));return o.stateNode.current===o?s:e}function Zb(s){return s=Yb(s),s!==null?$b(s):null}function $b(s){if(s.tag===5||s.tag===6)return s;for(s=s.child;s!==null;){var e=$b(s);if(e!==null)return e;s=s.sibling}return null}var ac=ca.unstable_scheduleCallback,bc=ca.unstable_cancelCallback,cc=ca.unstable_shouldYield,dc=ca.unstable_requestPaint,B=ca.unstable_now,ec=ca.unstable_getCurrentPriorityLevel,fc=ca.unstable_ImmediatePriority,gc=ca.unstable_UserBlockingPriority,hc=ca.unstable_NormalPriority,ic=ca.unstable_LowPriority,jc=ca.unstable_IdlePriority,kc=null,lc=null;function mc(s){if(lc&&typeof lc.onCommitFiberRoot=="function")try{lc.onCommitFiberRoot(kc,s,void 0,(s.current.flags&128)===128)}catch{}}var oc=Math.clz32?Math.clz32:nc,pc=Math.log,qc=Math.LN2;function nc(s){return s>>>=0,s===0?32:31-(pc(s)/qc|0)|0}var rc=64,sc=4194304;function tc(s){switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return s&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return s}}function uc(s,e){var o=s.pendingLanes;if(o===0)return 0;var a=0,c=s.suspendedLanes,g=s.pingedLanes,b=o&268435455;if(b!==0){var _=b&~c;_!==0?a=tc(_):(g&=b,g!==0&&(a=tc(g)))}else b=o&~c,b!==0?a=tc(b):g!==0&&(a=tc(g));if(a===0)return 0;if(e!==0&&e!==a&&!(e&c)&&(c=a&-a,g=e&-e,c>=g||c===16&&(g&4194240)!==0))return e;if(a&4&&(a|=o&16),e=s.entangledLanes,e!==0)for(s=s.entanglements,e&=a;0<e;)o=31-oc(e),c=1<<o,a|=s[o],e&=~c;return a}function vc(s,e){switch(s){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wc(s,e){for(var o=s.suspendedLanes,a=s.pingedLanes,c=s.expirationTimes,g=s.pendingLanes;0<g;){var b=31-oc(g),_=1<<b,j=c[b];j===-1?(!(_&o)||_&a)&&(c[b]=vc(_,e)):j<=e&&(s.expiredLanes|=_),g&=~_}}function xc(s){return s=s.pendingLanes&-1073741825,s!==0?s:s&1073741824?1073741824:0}function yc(){var s=rc;return rc<<=1,!(rc&4194240)&&(rc=64),s}function zc(s){for(var e=[],o=0;31>o;o++)e.push(s);return e}function Ac(s,e,o){s.pendingLanes|=e,e!==536870912&&(s.suspendedLanes=0,s.pingedLanes=0),s=s.eventTimes,e=31-oc(e),s[e]=o}function Bc(s,e){var o=s.pendingLanes&~e;s.pendingLanes=e,s.suspendedLanes=0,s.pingedLanes=0,s.expiredLanes&=e,s.mutableReadLanes&=e,s.entangledLanes&=e,e=s.entanglements;var a=s.eventTimes;for(s=s.expirationTimes;0<o;){var c=31-oc(o),g=1<<c;e[c]=0,a[c]=-1,s[c]=-1,o&=~g}}function Cc(s,e){var o=s.entangledLanes|=e;for(s=s.entanglements;o;){var a=31-oc(o),c=1<<a;c&e|s[a]&e&&(s[a]|=e),o&=~c}}var C=0;function Dc(s){return s&=-s,1<s?4<s?s&268435455?16:536870912:4:1}var Ec,Fc,Gc,Hc,Ic,Jc=!1,Kc=[],Lc=null,Mc=null,Nc=null,Oc=new Map,Pc=new Map,Qc=[],Rc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc(s,e){switch(s){case"focusin":case"focusout":Lc=null;break;case"dragenter":case"dragleave":Mc=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":Oc.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc.delete(e.pointerId)}}function Tc(s,e,o,a,c,g){return s===null||s.nativeEvent!==g?(s={blockedOn:e,domEventName:o,eventSystemFlags:a,nativeEvent:g,targetContainers:[c]},e!==null&&(e=Cb(e),e!==null&&Fc(e)),s):(s.eventSystemFlags|=a,e=s.targetContainers,c!==null&&e.indexOf(c)===-1&&e.push(c),s)}function Uc(s,e,o,a,c){switch(e){case"focusin":return Lc=Tc(Lc,s,e,o,a,c),!0;case"dragenter":return Mc=Tc(Mc,s,e,o,a,c),!0;case"mouseover":return Nc=Tc(Nc,s,e,o,a,c),!0;case"pointerover":var g=c.pointerId;return Oc.set(g,Tc(Oc.get(g)||null,s,e,o,a,c)),!0;case"gotpointercapture":return g=c.pointerId,Pc.set(g,Tc(Pc.get(g)||null,s,e,o,a,c)),!0}return!1}function Vc(s){var e=Wc(s.target);if(e!==null){var o=Vb(e);if(o!==null){if(e=o.tag,e===13){if(e=Wb(o),e!==null){s.blockedOn=e,Ic(s.priority,function(){Gc(o)});return}}else if(e===3&&o.stateNode.current.memoizedState.isDehydrated){s.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}s.blockedOn=null}function Xc(s){if(s.blockedOn!==null)return!1;for(var e=s.targetContainers;0<e.length;){var o=Yc(s.domEventName,s.eventSystemFlags,e[0],s.nativeEvent);if(o===null){o=s.nativeEvent;var a=new o.constructor(o.type,o);wb=a,o.target.dispatchEvent(a),wb=null}else return e=Cb(o),e!==null&&Fc(e),s.blockedOn=o,!1;e.shift()}return!0}function Zc(s,e,o){Xc(s)&&o.delete(e)}function $c(){Jc=!1,Lc!==null&&Xc(Lc)&&(Lc=null),Mc!==null&&Xc(Mc)&&(Mc=null),Nc!==null&&Xc(Nc)&&(Nc=null),Oc.forEach(Zc),Pc.forEach(Zc)}function ad(s,e){s.blockedOn===e&&(s.blockedOn=null,Jc||(Jc=!0,ca.unstable_scheduleCallback(ca.unstable_NormalPriority,$c)))}function bd(s){function e(c){return ad(c,s)}if(0<Kc.length){ad(Kc[0],s);for(var o=1;o<Kc.length;o++){var a=Kc[o];a.blockedOn===s&&(a.blockedOn=null)}}for(Lc!==null&&ad(Lc,s),Mc!==null&&ad(Mc,s),Nc!==null&&ad(Nc,s),Oc.forEach(e),Pc.forEach(e),o=0;o<Qc.length;o++)a=Qc[o],a.blockedOn===s&&(a.blockedOn=null);for(;0<Qc.length&&(o=Qc[0],o.blockedOn===null);)Vc(o),o.blockedOn===null&&Qc.shift()}var cd=ua.ReactCurrentBatchConfig,dd=!0;function ed(s,e,o,a){var c=C,g=cd.transition;cd.transition=null;try{C=1,fd(s,e,o,a)}finally{C=c,cd.transition=g}}function gd(s,e,o,a){var c=C,g=cd.transition;cd.transition=null;try{C=4,fd(s,e,o,a)}finally{C=c,cd.transition=g}}function fd(s,e,o,a){if(dd){var c=Yc(s,e,o,a);if(c===null)hd(s,e,a,id,o),Sc(s,a);else if(Uc(c,s,e,o,a))a.stopPropagation();else if(Sc(s,a),e&4&&-1<Rc.indexOf(s)){for(;c!==null;){var g=Cb(c);if(g!==null&&Ec(g),g=Yc(s,e,o,a),g===null&&hd(s,e,a,id,o),g===c)break;c=g}c!==null&&a.stopPropagation()}else hd(s,e,a,null,o)}}var id=null;function Yc(s,e,o,a){if(id=null,s=xb(a),s=Wc(s),s!==null)if(e=Vb(s),e===null)s=null;else if(o=e.tag,o===13){if(s=Wb(e),s!==null)return s;s=null}else if(o===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;s=null}else e!==s&&(s=null);return id=s,null}function jd(s){switch(s){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec()){case fc:return 1;case gc:return 4;case hc:case ic:return 16;case jc:return 536870912;default:return 16}default:return 16}}var kd=null,ld=null,md=null;function nd(){if(md)return md;var s,e=ld,o=e.length,a,c="value"in kd?kd.value:kd.textContent,g=c.length;for(s=0;s<o&&e[s]===c[s];s++);var b=o-s;for(a=1;a<=b&&e[o-a]===c[g-a];a++);return md=c.slice(s,1<a?1-a:void 0)}function od(s){var e=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&e===13&&(s=13)):s=e,s===10&&(s=13),32<=s||s===13?s:0}function pd(){return!0}function qd(){return!1}function rd(s){function e(o,a,c,g,b){this._reactName=o,this._targetInst=c,this.type=a,this.nativeEvent=g,this.target=b,this.currentTarget=null;for(var _ in s)s.hasOwnProperty(_)&&(o=s[_],this[_]=o?o(g):g[_]);return this.isDefaultPrevented=(g.defaultPrevented!=null?g.defaultPrevented:g.returnValue===!1)?pd:qd,this.isPropagationStopped=qd,this}return A$1(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=pd)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=pd)},persist:function(){},isPersistent:pd}),e}var sd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td=rd(sd),ud=A$1({},sd,{view:0,detail:0}),vd=rd(ud),wd,xd,yd,Ad=A$1({},ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==yd&&(yd&&s.type==="mousemove"?(wd=s.screenX-yd.screenX,xd=s.screenY-yd.screenY):xd=wd=0,yd=s),wd)},movementY:function(s){return"movementY"in s?s.movementY:xd}}),Bd=rd(Ad),Cd=A$1({},Ad,{dataTransfer:0}),Dd=rd(Cd),Ed=A$1({},ud,{relatedTarget:0}),Fd=rd(Ed),Gd=A$1({},sd,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd=rd(Gd),Id=A$1({},sd,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),Jd=rd(Id),Kd=A$1({},sd,{data:0}),Ld=rd(Kd),Md={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd(s){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(s):(s=Od[s])?!!e[s]:!1}function zd(){return Pd}var Qd=A$1({},ud,{key:function(s){if(s.key){var e=Md[s.key]||s.key;if(e!=="Unidentified")return e}return s.type==="keypress"?(s=od(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?Nd[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd,charCode:function(s){return s.type==="keypress"?od(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?od(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),Rd=rd(Qd),Sd=A$1({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td=rd(Sd),Ud=A$1({},ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd}),Vd=rd(Ud),Wd=A$1({},sd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd=rd(Wd),Yd=A$1({},Ad,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd=rd(Yd),$d=[9,13,27,32],ae=ia&&"CompositionEvent"in window,be=null;ia&&"documentMode"in document&&(be=document.documentMode);var ce=ia&&"TextEvent"in window&&!be,de=ia&&(!ae||be&&8<be&&11>=be),ee$1=" ",fe$1=!1;function ge$1(s,e){switch(s){case"keyup":return $d.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var ie=!1;function je(s,e){switch(s){case"compositionend":return he(e);case"keypress":return e.which!==32?null:(fe$1=!0,ee$1);case"textInput":return s=e.data,s===ee$1&&fe$1?null:s;default:return null}}function ke(s,e){if(ie)return s==="compositionend"||!ae&&ge$1(s,e)?(s=nd(),md=ld=kd=null,ie=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return de&&e.locale!=="ko"?null:e.data;default:return null}}var le={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me(s){var e=s&&s.nodeName&&s.nodeName.toLowerCase();return e==="input"?!!le[s.type]:e==="textarea"}function ne(s,e,o,a){Eb(a),e=oe(e,"onChange"),0<e.length&&(o=new td("onChange","change",null,o,a),s.push({event:o,listeners:e}))}var pe=null,qe=null;function re(s){se(s,0)}function te(s){var e=ue(s);if(Wa(e))return s}function ve(s,e){if(s==="change")return e}var we=!1;if(ia){var xe;if(ia){var ye="oninput"in document;if(!ye){var ze=document.createElement("div");ze.setAttribute("oninput","return;"),ye=typeof ze.oninput=="function"}xe=ye}else xe=!1;we=xe&&(!document.documentMode||9<document.documentMode)}function Ae(){pe&&(pe.detachEvent("onpropertychange",Be),qe=pe=null)}function Be(s){if(s.propertyName==="value"&&te(qe)){var e=[];ne(e,qe,s,xb(s)),Jb(re,e)}}function Ce(s,e,o){s==="focusin"?(Ae(),pe=e,qe=o,pe.attachEvent("onpropertychange",Be)):s==="focusout"&&Ae()}function De(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return te(qe)}function Ee(s,e){if(s==="click")return te(e)}function Fe(s,e){if(s==="input"||s==="change")return te(e)}function Ge(s,e){return s===e&&(s!==0||1/s===1/e)||s!==s&&e!==e}var He=typeof Object.is=="function"?Object.is:Ge;function Ie(s,e){if(He(s,e))return!0;if(typeof s!="object"||s===null||typeof e!="object"||e===null)return!1;var o=Object.keys(s),a=Object.keys(e);if(o.length!==a.length)return!1;for(a=0;a<o.length;a++){var c=o[a];if(!ja.call(e,c)||!He(s[c],e[c]))return!1}return!0}function Je(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function Ke(s,e){var o=Je(s);s=0;for(var a;o;){if(o.nodeType===3){if(a=s+o.textContent.length,s<=e&&a>=e)return{node:o,offset:e-s};s=a}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=Je(o)}}function Le(s,e){return s&&e?s===e?!0:s&&s.nodeType===3?!1:e&&e.nodeType===3?Le(s,e.parentNode):"contains"in s?s.contains(e):s.compareDocumentPosition?!!(s.compareDocumentPosition(e)&16):!1:!1}function Me(){for(var s=window,e=Xa();e instanceof s.HTMLIFrameElement;){try{var o=typeof e.contentWindow.location.href=="string"}catch{o=!1}if(o)s=e.contentWindow;else break;e=Xa(s.document)}return e}function Ne(s){var e=s&&s.nodeName&&s.nodeName.toLowerCase();return e&&(e==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||e==="textarea"||s.contentEditable==="true")}function Oe(s){var e=Me(),o=s.focusedElem,a=s.selectionRange;if(e!==o&&o&&o.ownerDocument&&Le(o.ownerDocument.documentElement,o)){if(a!==null&&Ne(o)){if(e=a.start,s=a.end,s===void 0&&(s=e),"selectionStart"in o)o.selectionStart=e,o.selectionEnd=Math.min(s,o.value.length);else if(s=(e=o.ownerDocument||document)&&e.defaultView||window,s.getSelection){s=s.getSelection();var c=o.textContent.length,g=Math.min(a.start,c);a=a.end===void 0?g:Math.min(a.end,c),!s.extend&&g>a&&(c=a,a=g,g=c),c=Ke(o,g);var b=Ke(o,a);c&&b&&(s.rangeCount!==1||s.anchorNode!==c.node||s.anchorOffset!==c.offset||s.focusNode!==b.node||s.focusOffset!==b.offset)&&(e=e.createRange(),e.setStart(c.node,c.offset),s.removeAllRanges(),g>a?(s.addRange(e),s.extend(b.node,b.offset)):(e.setEnd(b.node,b.offset),s.addRange(e)))}}for(e=[],s=o;s=s.parentNode;)s.nodeType===1&&e.push({element:s,left:s.scrollLeft,top:s.scrollTop});for(typeof o.focus=="function"&&o.focus(),o=0;o<e.length;o++)s=e[o],s.element.scrollLeft=s.left,s.element.scrollTop=s.top}}var Pe=ia&&"documentMode"in document&&11>=document.documentMode,Qe=null,Re=null,Se=null,Te=!1;function Ue(s,e,o){var a=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;Te||Qe==null||Qe!==Xa(a)||(a=Qe,"selectionStart"in a&&Ne(a)?a={start:a.selectionStart,end:a.selectionEnd}:(a=(a.ownerDocument&&a.ownerDocument.defaultView||window).getSelection(),a={anchorNode:a.anchorNode,anchorOffset:a.anchorOffset,focusNode:a.focusNode,focusOffset:a.focusOffset}),Se&&Ie(Se,a)||(Se=a,a=oe(Re,"onSelect"),0<a.length&&(e=new td("onSelect","select",null,e,o),s.push({event:e,listeners:a}),e.target=Qe)))}function Ve(s,e){var o={};return o[s.toLowerCase()]=e.toLowerCase(),o["Webkit"+s]="webkit"+e,o["Moz"+s]="moz"+e,o}var We={animationend:Ve("Animation","AnimationEnd"),animationiteration:Ve("Animation","AnimationIteration"),animationstart:Ve("Animation","AnimationStart"),transitionend:Ve("Transition","TransitionEnd")},Xe={},Ye={};ia&&(Ye=document.createElement("div").style,"AnimationEvent"in window||(delete We.animationend.animation,delete We.animationiteration.animation,delete We.animationstart.animation),"TransitionEvent"in window||delete We.transitionend.transition);function Ze(s){if(Xe[s])return Xe[s];if(!We[s])return s;var e=We[s],o;for(o in e)if(e.hasOwnProperty(o)&&o in Ye)return Xe[s]=e[o];return s}var $e=Ze("animationend"),af=Ze("animationiteration"),bf=Ze("animationstart"),cf=Ze("transitionend"),df=new Map,ef="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff(s,e){df.set(s,e),fa(e,[s])}for(var gf=0;gf<ef.length;gf++){var hf=ef[gf],jf=hf.toLowerCase(),kf=hf[0].toUpperCase()+hf.slice(1);ff(jf,"on"+kf)}ff($e,"onAnimationEnd");ff(af,"onAnimationIteration");ff(bf,"onAnimationStart");ff("dblclick","onDoubleClick");ff("focusin","onFocus");ff("focusout","onBlur");ff(cf,"onTransitionEnd");ha("onMouseEnter",["mouseout","mouseover"]);ha("onMouseLeave",["mouseout","mouseover"]);ha("onPointerEnter",["pointerout","pointerover"]);ha("onPointerLeave",["pointerout","pointerover"]);fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fa("onBeforeInput",["compositionend","keypress","textInput","paste"]);fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf));function nf(s,e,o){var a=s.type||"unknown-event";s.currentTarget=o,Ub(a,e,void 0,s),s.currentTarget=null}function se(s,e){e=(e&4)!==0;for(var o=0;o<s.length;o++){var a=s[o],c=a.event;a=a.listeners;e:{var g=void 0;if(e)for(var b=a.length-1;0<=b;b--){var _=a[b],j=_.instance,_e=_.currentTarget;if(_=_.listener,j!==g&&c.isPropagationStopped())break e;nf(c,_,_e),g=j}else for(b=0;b<a.length;b++){if(_=a[b],j=_.instance,_e=_.currentTarget,_=_.listener,j!==g&&c.isPropagationStopped())break e;nf(c,_,_e),g=j}}}if(Qb)throw s=Rb,Qb=!1,Rb=null,s}function D$1(s,e){var o=e[of];o===void 0&&(o=e[of]=new Set);var a=s+"__bubble";o.has(a)||(pf(e,s,2,!1),o.add(a))}function qf(s,e,o){var a=0;e&&(a|=4),pf(o,s,a,e)}var rf="_reactListening"+Math.random().toString(36).slice(2);function sf(s){if(!s[rf]){s[rf]=!0,da.forEach(function(o){o!=="selectionchange"&&(mf.has(o)||qf(o,!1,s),qf(o,!0,s))});var e=s.nodeType===9?s:s.ownerDocument;e===null||e[rf]||(e[rf]=!0,qf("selectionchange",!1,e))}}function pf(s,e,o,a){switch(jd(e)){case 1:var c=ed;break;case 4:c=gd;break;default:c=fd}o=c.bind(null,e,o,s),c=void 0,!Lb||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(c=!0),a?c!==void 0?s.addEventListener(e,o,{capture:!0,passive:c}):s.addEventListener(e,o,!0):c!==void 0?s.addEventListener(e,o,{passive:c}):s.addEventListener(e,o,!1)}function hd(s,e,o,a,c){var g=a;if(!(e&1)&&!(e&2)&&a!==null)e:for(;;){if(a===null)return;var b=a.tag;if(b===3||b===4){var _=a.stateNode.containerInfo;if(_===c||_.nodeType===8&&_.parentNode===c)break;if(b===4)for(b=a.return;b!==null;){var j=b.tag;if((j===3||j===4)&&(j=b.stateNode.containerInfo,j===c||j.nodeType===8&&j.parentNode===c))return;b=b.return}for(;_!==null;){if(b=Wc(_),b===null)return;if(j=b.tag,j===5||j===6){a=g=b;continue e}_=_.parentNode}}a=a.return}Jb(function(){var _e=g,tt=xb(o),et=[];e:{var nt=df.get(s);if(nt!==void 0){var rt=td,it=s;switch(s){case"keypress":if(od(o)===0)break e;case"keydown":case"keyup":rt=Rd;break;case"focusin":it="focus",rt=Fd;break;case"focusout":it="blur",rt=Fd;break;case"beforeblur":case"afterblur":rt=Fd;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":rt=Bd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":rt=Dd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":rt=Vd;break;case $e:case af:case bf:rt=Hd;break;case cf:rt=Xd;break;case"scroll":rt=vd;break;case"wheel":rt=Zd;break;case"copy":case"cut":case"paste":rt=Jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":rt=Td}var st=(e&4)!==0,lt=!st&&s==="scroll",at=st?nt!==null?nt+"Capture":null:nt;st=[];for(var ct=_e,ft;ct!==null;){ft=ct;var vt=ft.stateNode;if(ft.tag===5&&vt!==null&&(ft=vt,at!==null&&(vt=Kb(ct,at),vt!=null&&st.push(tf(ct,vt,ft)))),lt)break;ct=ct.return}0<st.length&&(nt=new rt(nt,it,null,o,tt),et.push({event:nt,listeners:st}))}}if(!(e&7)){e:{if(nt=s==="mouseover"||s==="pointerover",rt=s==="mouseout"||s==="pointerout",nt&&o!==wb&&(it=o.relatedTarget||o.fromElement)&&(Wc(it)||it[uf]))break e;if((rt||nt)&&(nt=tt.window===tt?tt:(nt=tt.ownerDocument)?nt.defaultView||nt.parentWindow:window,rt?(it=o.relatedTarget||o.toElement,rt=_e,it=it?Wc(it):null,it!==null&&(lt=Vb(it),it!==lt||it.tag!==5&&it.tag!==6)&&(it=null)):(rt=null,it=_e),rt!==it)){if(st=Bd,vt="onMouseLeave",at="onMouseEnter",ct="mouse",(s==="pointerout"||s==="pointerover")&&(st=Td,vt="onPointerLeave",at="onPointerEnter",ct="pointer"),lt=rt==null?nt:ue(rt),ft=it==null?nt:ue(it),nt=new st(vt,ct+"leave",rt,o,tt),nt.target=lt,nt.relatedTarget=ft,vt=null,Wc(tt)===_e&&(st=new st(at,ct+"enter",it,o,tt),st.target=ft,st.relatedTarget=lt,vt=st),lt=vt,rt&&it)t:{for(st=rt,at=it,ct=0,ft=st;ft;ft=vf(ft))ct++;for(ft=0,vt=at;vt;vt=vf(vt))ft++;for(;0<ct-ft;)st=vf(st),ct--;for(;0<ft-ct;)at=vf(at),ft--;for(;ct--;){if(st===at||at!==null&&st===at.alternate)break t;st=vf(st),at=vf(at)}st=null}else st=null;rt!==null&&wf(et,nt,rt,st,!1),it!==null&&lt!==null&&wf(et,lt,it,st,!0)}}e:{if(nt=_e?ue(_e):window,rt=nt.nodeName&&nt.nodeName.toLowerCase(),rt==="select"||rt==="input"&&nt.type==="file")var Rt=ve;else if(me(nt))if(we)Rt=Fe;else{Rt=De;var _t=Ce}else(rt=nt.nodeName)&&rt.toLowerCase()==="input"&&(nt.type==="checkbox"||nt.type==="radio")&&(Rt=Ee);if(Rt&&(Rt=Rt(s,_e))){ne(et,Rt,o,tt);break e}_t&&_t(s,nt,_e),s==="focusout"&&(_t=nt._wrapperState)&&_t.controlled&&nt.type==="number"&&cb(nt,"number",nt.value)}switch(_t=_e?ue(_e):window,s){case"focusin":(me(_t)||_t.contentEditable==="true")&&(Qe=_t,Re=_e,Se=null);break;case"focusout":Se=Re=Qe=null;break;case"mousedown":Te=!0;break;case"contextmenu":case"mouseup":case"dragend":Te=!1,Ue(et,o,tt);break;case"selectionchange":if(Pe)break;case"keydown":case"keyup":Ue(et,o,tt)}var Tt;if(ae)e:{switch(s){case"compositionstart":var Ct="onCompositionStart";break e;case"compositionend":Ct="onCompositionEnd";break e;case"compositionupdate":Ct="onCompositionUpdate";break e}Ct=void 0}else ie?ge$1(s,o)&&(Ct="onCompositionEnd"):s==="keydown"&&o.keyCode===229&&(Ct="onCompositionStart");Ct&&(de&&o.locale!=="ko"&&(ie||Ct!=="onCompositionStart"?Ct==="onCompositionEnd"&&ie&&(Tt=nd()):(kd=tt,ld="value"in kd?kd.value:kd.textContent,ie=!0)),_t=oe(_e,Ct),0<_t.length&&(Ct=new Ld(Ct,s,null,o,tt),et.push({event:Ct,listeners:_t}),Tt?Ct.data=Tt:(Tt=he(o),Tt!==null&&(Ct.data=Tt)))),(Tt=ce?je(s,o):ke(s,o))&&(_e=oe(_e,"onBeforeInput"),0<_e.length&&(tt=new Ld("onBeforeInput","beforeinput",null,o,tt),et.push({event:tt,listeners:_e}),tt.data=Tt))}se(et,e)})}function tf(s,e,o){return{instance:s,listener:e,currentTarget:o}}function oe(s,e){for(var o=e+"Capture",a=[];s!==null;){var c=s,g=c.stateNode;c.tag===5&&g!==null&&(c=g,g=Kb(s,o),g!=null&&a.unshift(tf(s,g,c)),g=Kb(s,e),g!=null&&a.push(tf(s,g,c))),s=s.return}return a}function vf(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5);return s||null}function wf(s,e,o,a,c){for(var g=e._reactName,b=[];o!==null&&o!==a;){var _=o,j=_.alternate,_e=_.stateNode;if(j!==null&&j===a)break;_.tag===5&&_e!==null&&(_=_e,c?(j=Kb(o,g),j!=null&&b.unshift(tf(o,j,_))):c||(j=Kb(o,g),j!=null&&b.push(tf(o,j,_)))),o=o.return}b.length!==0&&s.push({event:e,listeners:b})}var xf=/\r\n?/g,yf=/\u0000|\uFFFD/g;function zf(s){return(typeof s=="string"?s:""+s).replace(xf,`
`).replace(yf,"")}function Af(s,e,o){if(e=zf(e),zf(s)!==e&&o)throw Error(p$1(425))}function Bf(){}var Cf=null,Df=null;function Ef(s,e){return s==="textarea"||s==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Ff=typeof setTimeout=="function"?setTimeout:void 0,Gf=typeof clearTimeout=="function"?clearTimeout:void 0,Hf=typeof Promise=="function"?Promise:void 0,Jf=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf<"u"?function(s){return Hf.resolve(null).then(s).catch(If)}:Ff;function If(s){setTimeout(function(){throw s})}function Kf(s,e){var o=e,a=0;do{var c=o.nextSibling;if(s.removeChild(o),c&&c.nodeType===8)if(o=c.data,o==="/$"){if(a===0){s.removeChild(c),bd(e);return}a--}else o!=="$"&&o!=="$?"&&o!=="$!"||a++;o=c}while(o);bd(e)}function Lf(s){for(;s!=null;s=s.nextSibling){var e=s.nodeType;if(e===1||e===3)break;if(e===8){if(e=s.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return s}function Mf(s){s=s.previousSibling;for(var e=0;s;){if(s.nodeType===8){var o=s.data;if(o==="$"||o==="$!"||o==="$?"){if(e===0)return s;e--}else o==="/$"&&e++}s=s.previousSibling}return null}var Nf=Math.random().toString(36).slice(2),Of="__reactFiber$"+Nf,Pf="__reactProps$"+Nf,uf="__reactContainer$"+Nf,of="__reactEvents$"+Nf,Qf="__reactListeners$"+Nf,Rf="__reactHandles$"+Nf;function Wc(s){var e=s[Of];if(e)return e;for(var o=s.parentNode;o;){if(e=o[uf]||o[Of]){if(o=e.alternate,e.child!==null||o!==null&&o.child!==null)for(s=Mf(s);s!==null;){if(o=s[Of])return o;s=Mf(s)}return e}s=o,o=s.parentNode}return null}function Cb(s){return s=s[Of]||s[uf],!s||s.tag!==5&&s.tag!==6&&s.tag!==13&&s.tag!==3?null:s}function ue(s){if(s.tag===5||s.tag===6)return s.stateNode;throw Error(p$1(33))}function Db(s){return s[Pf]||null}var Sf=[],Tf=-1;function Uf(s){return{current:s}}function E(s){0>Tf||(s.current=Sf[Tf],Sf[Tf]=null,Tf--)}function G(s,e){Tf++,Sf[Tf]=s.current,s.current=e}var Vf={},H$1=Uf(Vf),Wf=Uf(!1),Xf=Vf;function Yf(s,e){var o=s.type.contextTypes;if(!o)return Vf;var a=s.stateNode;if(a&&a.__reactInternalMemoizedUnmaskedChildContext===e)return a.__reactInternalMemoizedMaskedChildContext;var c={},g;for(g in o)c[g]=e[g];return a&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=e,s.__reactInternalMemoizedMaskedChildContext=c),c}function Zf(s){return s=s.childContextTypes,s!=null}function $f(){E(Wf),E(H$1)}function ag(s,e,o){if(H$1.current!==Vf)throw Error(p$1(168));G(H$1,e),G(Wf,o)}function bg(s,e,o){var a=s.stateNode;if(e=e.childContextTypes,typeof a.getChildContext!="function")return o;a=a.getChildContext();for(var c in a)if(!(c in e))throw Error(p$1(108,Ra(s)||"Unknown",c));return A$1({},o,a)}function cg(s){return s=(s=s.stateNode)&&s.__reactInternalMemoizedMergedChildContext||Vf,Xf=H$1.current,G(H$1,s),G(Wf,Wf.current),!0}function dg(s,e,o){var a=s.stateNode;if(!a)throw Error(p$1(169));o?(s=bg(s,e,Xf),a.__reactInternalMemoizedMergedChildContext=s,E(Wf),E(H$1),G(H$1,s)):E(Wf),G(Wf,o)}var eg=null,fg=!1,gg=!1;function hg(s){eg===null?eg=[s]:eg.push(s)}function ig(s){fg=!0,hg(s)}function jg(){if(!gg&&eg!==null){gg=!0;var s=0,e=C;try{var o=eg;for(C=1;s<o.length;s++){var a=o[s];do a=a(!0);while(a!==null)}eg=null,fg=!1}catch(c){throw eg!==null&&(eg=eg.slice(s+1)),ac(fc,jg),c}finally{C=e,gg=!1}}return null}var kg=[],lg=0,mg=null,ng=0,og=[],pg=0,qg=null,rg=1,sg="";function tg(s,e){kg[lg++]=ng,kg[lg++]=mg,mg=s,ng=e}function ug(s,e,o){og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,qg=s;var a=rg;s=sg;var c=32-oc(a)-1;a&=~(1<<c),o+=1;var g=32-oc(e)+c;if(30<g){var b=c-c%5;g=(a&(1<<b)-1).toString(32),a>>=b,c-=b,rg=1<<32-oc(e)+c|o<<c|a,sg=g+s}else rg=1<<g|o<<c|a,sg=s}function vg(s){s.return!==null&&(tg(s,1),ug(s,1,0))}function wg(s){for(;s===mg;)mg=kg[--lg],kg[lg]=null,ng=kg[--lg],kg[lg]=null;for(;s===qg;)qg=og[--pg],og[pg]=null,sg=og[--pg],og[pg]=null,rg=og[--pg],og[pg]=null}var xg=null,yg=null,I=!1,zg=null;function Ag(s,e){var o=Bg(5,null,null,0);o.elementType="DELETED",o.stateNode=e,o.return=s,e=s.deletions,e===null?(s.deletions=[o],s.flags|=16):e.push(o)}function Cg(s,e){switch(s.tag){case 5:var o=s.type;return e=e.nodeType!==1||o.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(s.stateNode=e,xg=s,yg=Lf(e.firstChild),!0):!1;case 6:return e=s.pendingProps===""||e.nodeType!==3?null:e,e!==null?(s.stateNode=e,xg=s,yg=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(o=qg!==null?{id:rg,overflow:sg}:null,s.memoizedState={dehydrated:e,treeContext:o,retryLane:1073741824},o=Bg(18,null,null,0),o.stateNode=e,o.return=s,s.child=o,xg=s,yg=null,!0):!1;default:return!1}}function Dg(s){return(s.mode&1)!==0&&(s.flags&128)===0}function Eg(s){if(I){var e=yg;if(e){var o=e;if(!Cg(s,e)){if(Dg(s))throw Error(p$1(418));e=Lf(o.nextSibling);var a=xg;e&&Cg(s,e)?Ag(a,o):(s.flags=s.flags&-4097|2,I=!1,xg=s)}}else{if(Dg(s))throw Error(p$1(418));s.flags=s.flags&-4097|2,I=!1,xg=s}}}function Fg(s){for(s=s.return;s!==null&&s.tag!==5&&s.tag!==3&&s.tag!==13;)s=s.return;xg=s}function Gg(s){if(s!==xg)return!1;if(!I)return Fg(s),I=!0,!1;var e;if((e=s.tag!==3)&&!(e=s.tag!==5)&&(e=s.type,e=e!=="head"&&e!=="body"&&!Ef(s.type,s.memoizedProps)),e&&(e=yg)){if(Dg(s))throw Hg(),Error(p$1(418));for(;e;)Ag(s,e),e=Lf(e.nextSibling)}if(Fg(s),s.tag===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(p$1(317));e:{for(s=s.nextSibling,e=0;s;){if(s.nodeType===8){var o=s.data;if(o==="/$"){if(e===0){yg=Lf(s.nextSibling);break e}e--}else o!=="$"&&o!=="$!"&&o!=="$?"||e++}s=s.nextSibling}yg=null}}else yg=xg?Lf(s.stateNode.nextSibling):null;return!0}function Hg(){for(var s=yg;s;)s=Lf(s.nextSibling)}function Ig(){yg=xg=null,I=!1}function Jg(s){zg===null?zg=[s]:zg.push(s)}var Kg=ua.ReactCurrentBatchConfig;function Lg(s,e,o){if(s=o.ref,s!==null&&typeof s!="function"&&typeof s!="object"){if(o._owner){if(o=o._owner,o){if(o.tag!==1)throw Error(p$1(309));var a=o.stateNode}if(!a)throw Error(p$1(147,s));var c=a,g=""+s;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===g?e.ref:(e=function(b){var _=c.refs;b===null?delete _[g]:_[g]=b},e._stringRef=g,e)}if(typeof s!="string")throw Error(p$1(284));if(!o._owner)throw Error(p$1(290,s))}return s}function Mg(s,e){throw s=Object.prototype.toString.call(e),Error(p$1(31,s==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":s))}function Ng(s){var e=s._init;return e(s._payload)}function Og(s){function e(at,ct){if(s){var ft=at.deletions;ft===null?(at.deletions=[ct],at.flags|=16):ft.push(ct)}}function o(at,ct){if(!s)return null;for(;ct!==null;)e(at,ct),ct=ct.sibling;return null}function a(at,ct){for(at=new Map;ct!==null;)ct.key!==null?at.set(ct.key,ct):at.set(ct.index,ct),ct=ct.sibling;return at}function c(at,ct){return at=Pg(at,ct),at.index=0,at.sibling=null,at}function g(at,ct,ft){return at.index=ft,s?(ft=at.alternate,ft!==null?(ft=ft.index,ft<ct?(at.flags|=2,ct):ft):(at.flags|=2,ct)):(at.flags|=1048576,ct)}function b(at){return s&&at.alternate===null&&(at.flags|=2),at}function _(at,ct,ft,vt){return ct===null||ct.tag!==6?(ct=Qg(ft,at.mode,vt),ct.return=at,ct):(ct=c(ct,ft),ct.return=at,ct)}function j(at,ct,ft,vt){var Rt=ft.type;return Rt===ya?tt(at,ct,ft.props.children,vt,ft.key):ct!==null&&(ct.elementType===Rt||typeof Rt=="object"&&Rt!==null&&Rt.$$typeof===Ha&&Ng(Rt)===ct.type)?(vt=c(ct,ft.props),vt.ref=Lg(at,ct,ft),vt.return=at,vt):(vt=Rg(ft.type,ft.key,ft.props,null,at.mode,vt),vt.ref=Lg(at,ct,ft),vt.return=at,vt)}function _e(at,ct,ft,vt){return ct===null||ct.tag!==4||ct.stateNode.containerInfo!==ft.containerInfo||ct.stateNode.implementation!==ft.implementation?(ct=Sg(ft,at.mode,vt),ct.return=at,ct):(ct=c(ct,ft.children||[]),ct.return=at,ct)}function tt(at,ct,ft,vt,Rt){return ct===null||ct.tag!==7?(ct=Tg(ft,at.mode,vt,Rt),ct.return=at,ct):(ct=c(ct,ft),ct.return=at,ct)}function et(at,ct,ft){if(typeof ct=="string"&&ct!==""||typeof ct=="number")return ct=Qg(""+ct,at.mode,ft),ct.return=at,ct;if(typeof ct=="object"&&ct!==null){switch(ct.$$typeof){case va:return ft=Rg(ct.type,ct.key,ct.props,null,at.mode,ft),ft.ref=Lg(at,null,ct),ft.return=at,ft;case wa:return ct=Sg(ct,at.mode,ft),ct.return=at,ct;case Ha:var vt=ct._init;return et(at,vt(ct._payload),ft)}if(eb(ct)||Ka(ct))return ct=Tg(ct,at.mode,ft,null),ct.return=at,ct;Mg(at,ct)}return null}function nt(at,ct,ft,vt){var Rt=ct!==null?ct.key:null;if(typeof ft=="string"&&ft!==""||typeof ft=="number")return Rt!==null?null:_(at,ct,""+ft,vt);if(typeof ft=="object"&&ft!==null){switch(ft.$$typeof){case va:return ft.key===Rt?j(at,ct,ft,vt):null;case wa:return ft.key===Rt?_e(at,ct,ft,vt):null;case Ha:return Rt=ft._init,nt(at,ct,Rt(ft._payload),vt)}if(eb(ft)||Ka(ft))return Rt!==null?null:tt(at,ct,ft,vt,null);Mg(at,ft)}return null}function rt(at,ct,ft,vt,Rt){if(typeof vt=="string"&&vt!==""||typeof vt=="number")return at=at.get(ft)||null,_(ct,at,""+vt,Rt);if(typeof vt=="object"&&vt!==null){switch(vt.$$typeof){case va:return at=at.get(vt.key===null?ft:vt.key)||null,j(ct,at,vt,Rt);case wa:return at=at.get(vt.key===null?ft:vt.key)||null,_e(ct,at,vt,Rt);case Ha:var _t=vt._init;return rt(at,ct,ft,_t(vt._payload),Rt)}if(eb(vt)||Ka(vt))return at=at.get(ft)||null,tt(ct,at,vt,Rt,null);Mg(ct,vt)}return null}function it(at,ct,ft,vt){for(var Rt=null,_t=null,Tt=ct,Ct=ct=0,Nt=null;Tt!==null&&Ct<ft.length;Ct++){Tt.index>Ct?(Nt=Tt,Tt=null):Nt=Tt.sibling;var At=nt(at,Tt,ft[Ct],vt);if(At===null){Tt===null&&(Tt=Nt);break}s&&Tt&&At.alternate===null&&e(at,Tt),ct=g(At,ct,Ct),_t===null?Rt=At:_t.sibling=At,_t=At,Tt=Nt}if(Ct===ft.length)return o(at,Tt),I&&tg(at,Ct),Rt;if(Tt===null){for(;Ct<ft.length;Ct++)Tt=et(at,ft[Ct],vt),Tt!==null&&(ct=g(Tt,ct,Ct),_t===null?Rt=Tt:_t.sibling=Tt,_t=Tt);return I&&tg(at,Ct),Rt}for(Tt=a(at,Tt);Ct<ft.length;Ct++)Nt=rt(Tt,at,Ct,ft[Ct],vt),Nt!==null&&(s&&Nt.alternate!==null&&Tt.delete(Nt.key===null?Ct:Nt.key),ct=g(Nt,ct,Ct),_t===null?Rt=Nt:_t.sibling=Nt,_t=Nt);return s&&Tt.forEach(function(yt){return e(at,yt)}),I&&tg(at,Ct),Rt}function st(at,ct,ft,vt){var Rt=Ka(ft);if(typeof Rt!="function")throw Error(p$1(150));if(ft=Rt.call(ft),ft==null)throw Error(p$1(151));for(var _t=Rt=null,Tt=ct,Ct=ct=0,Nt=null,At=ft.next();Tt!==null&&!At.done;Ct++,At=ft.next()){Tt.index>Ct?(Nt=Tt,Tt=null):Nt=Tt.sibling;var yt=nt(at,Tt,At.value,vt);if(yt===null){Tt===null&&(Tt=Nt);break}s&&Tt&&yt.alternate===null&&e(at,Tt),ct=g(yt,ct,Ct),_t===null?Rt=yt:_t.sibling=yt,_t=yt,Tt=Nt}if(At.done)return o(at,Tt),I&&tg(at,Ct),Rt;if(Tt===null){for(;!At.done;Ct++,At=ft.next())At=et(at,At.value,vt),At!==null&&(ct=g(At,ct,Ct),_t===null?Rt=At:_t.sibling=At,_t=At);return I&&tg(at,Ct),Rt}for(Tt=a(at,Tt);!At.done;Ct++,At=ft.next())At=rt(Tt,at,Ct,At.value,vt),At!==null&&(s&&At.alternate!==null&&Tt.delete(At.key===null?Ct:At.key),ct=g(At,ct,Ct),_t===null?Rt=At:_t.sibling=At,_t=At);return s&&Tt.forEach(function(xt){return e(at,xt)}),I&&tg(at,Ct),Rt}function lt(at,ct,ft,vt){if(typeof ft=="object"&&ft!==null&&ft.type===ya&&ft.key===null&&(ft=ft.props.children),typeof ft=="object"&&ft!==null){switch(ft.$$typeof){case va:e:{for(var Rt=ft.key,_t=ct;_t!==null;){if(_t.key===Rt){if(Rt=ft.type,Rt===ya){if(_t.tag===7){o(at,_t.sibling),ct=c(_t,ft.props.children),ct.return=at,at=ct;break e}}else if(_t.elementType===Rt||typeof Rt=="object"&&Rt!==null&&Rt.$$typeof===Ha&&Ng(Rt)===_t.type){o(at,_t.sibling),ct=c(_t,ft.props),ct.ref=Lg(at,_t,ft),ct.return=at,at=ct;break e}o(at,_t);break}else e(at,_t);_t=_t.sibling}ft.type===ya?(ct=Tg(ft.props.children,at.mode,vt,ft.key),ct.return=at,at=ct):(vt=Rg(ft.type,ft.key,ft.props,null,at.mode,vt),vt.ref=Lg(at,ct,ft),vt.return=at,at=vt)}return b(at);case wa:e:{for(_t=ft.key;ct!==null;){if(ct.key===_t)if(ct.tag===4&&ct.stateNode.containerInfo===ft.containerInfo&&ct.stateNode.implementation===ft.implementation){o(at,ct.sibling),ct=c(ct,ft.children||[]),ct.return=at,at=ct;break e}else{o(at,ct);break}else e(at,ct);ct=ct.sibling}ct=Sg(ft,at.mode,vt),ct.return=at,at=ct}return b(at);case Ha:return _t=ft._init,lt(at,ct,_t(ft._payload),vt)}if(eb(ft))return it(at,ct,ft,vt);if(Ka(ft))return st(at,ct,ft,vt);Mg(at,ft)}return typeof ft=="string"&&ft!==""||typeof ft=="number"?(ft=""+ft,ct!==null&&ct.tag===6?(o(at,ct.sibling),ct=c(ct,ft),ct.return=at,at=ct):(o(at,ct),ct=Qg(ft,at.mode,vt),ct.return=at,at=ct),b(at)):o(at,ct)}return lt}var Ug=Og(!0),Vg=Og(!1),Wg=Uf(null),Xg=null,Yg=null,Zg=null;function $g(){Zg=Yg=Xg=null}function ah(s){var e=Wg.current;E(Wg),s._currentValue=e}function bh(s,e,o){for(;s!==null;){var a=s.alternate;if((s.childLanes&e)!==e?(s.childLanes|=e,a!==null&&(a.childLanes|=e)):a!==null&&(a.childLanes&e)!==e&&(a.childLanes|=e),s===o)break;s=s.return}}function ch(s,e){Xg=s,Zg=Yg=null,s=s.dependencies,s!==null&&s.firstContext!==null&&(s.lanes&e&&(dh=!0),s.firstContext=null)}function eh(s){var e=s._currentValue;if(Zg!==s)if(s={context:s,memoizedValue:e,next:null},Yg===null){if(Xg===null)throw Error(p$1(308));Yg=s,Xg.dependencies={lanes:0,firstContext:s}}else Yg=Yg.next=s;return e}var fh=null;function gh(s){fh===null?fh=[s]:fh.push(s)}function hh(s,e,o,a){var c=e.interleaved;return c===null?(o.next=o,gh(e)):(o.next=c.next,c.next=o),e.interleaved=o,ih(s,a)}function ih(s,e){s.lanes|=e;var o=s.alternate;for(o!==null&&(o.lanes|=e),o=s,s=s.return;s!==null;)s.childLanes|=e,o=s.alternate,o!==null&&(o.childLanes|=e),o=s,s=s.return;return o.tag===3?o.stateNode:null}var jh=!1;function kh(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lh(s,e){s=s.updateQueue,e.updateQueue===s&&(e.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,effects:s.effects})}function mh(s,e){return{eventTime:s,lane:e,tag:0,payload:null,callback:null,next:null}}function nh(s,e,o){var a=s.updateQueue;if(a===null)return null;if(a=a.shared,K&2){var c=a.pending;return c===null?e.next=e:(e.next=c.next,c.next=e),a.pending=e,ih(s,o)}return c=a.interleaved,c===null?(e.next=e,gh(a)):(e.next=c.next,c.next=e),a.interleaved=e,ih(s,o)}function oh(s,e,o){if(e=e.updateQueue,e!==null&&(e=e.shared,(o&4194240)!==0)){var a=e.lanes;a&=s.pendingLanes,o|=a,e.lanes=o,Cc(s,o)}}function ph(s,e){var o=s.updateQueue,a=s.alternate;if(a!==null&&(a=a.updateQueue,o===a)){var c=null,g=null;if(o=o.firstBaseUpdate,o!==null){do{var b={eventTime:o.eventTime,lane:o.lane,tag:o.tag,payload:o.payload,callback:o.callback,next:null};g===null?c=g=b:g=g.next=b,o=o.next}while(o!==null);g===null?c=g=e:g=g.next=e}else c=g=e;o={baseState:a.baseState,firstBaseUpdate:c,lastBaseUpdate:g,shared:a.shared,effects:a.effects},s.updateQueue=o;return}s=o.lastBaseUpdate,s===null?o.firstBaseUpdate=e:s.next=e,o.lastBaseUpdate=e}function qh(s,e,o,a){var c=s.updateQueue;jh=!1;var g=c.firstBaseUpdate,b=c.lastBaseUpdate,_=c.shared.pending;if(_!==null){c.shared.pending=null;var j=_,_e=j.next;j.next=null,b===null?g=_e:b.next=_e,b=j;var tt=s.alternate;tt!==null&&(tt=tt.updateQueue,_=tt.lastBaseUpdate,_!==b&&(_===null?tt.firstBaseUpdate=_e:_.next=_e,tt.lastBaseUpdate=j))}if(g!==null){var et=c.baseState;b=0,tt=_e=j=null,_=g;do{var nt=_.lane,rt=_.eventTime;if((a&nt)===nt){tt!==null&&(tt=tt.next={eventTime:rt,lane:0,tag:_.tag,payload:_.payload,callback:_.callback,next:null});e:{var it=s,st=_;switch(nt=e,rt=o,st.tag){case 1:if(it=st.payload,typeof it=="function"){et=it.call(rt,et,nt);break e}et=it;break e;case 3:it.flags=it.flags&-65537|128;case 0:if(it=st.payload,nt=typeof it=="function"?it.call(rt,et,nt):it,nt==null)break e;et=A$1({},et,nt);break e;case 2:jh=!0}}_.callback!==null&&_.lane!==0&&(s.flags|=64,nt=c.effects,nt===null?c.effects=[_]:nt.push(_))}else rt={eventTime:rt,lane:nt,tag:_.tag,payload:_.payload,callback:_.callback,next:null},tt===null?(_e=tt=rt,j=et):tt=tt.next=rt,b|=nt;if(_=_.next,_===null){if(_=c.shared.pending,_===null)break;nt=_,_=nt.next,nt.next=null,c.lastBaseUpdate=nt,c.shared.pending=null}}while(!0);if(tt===null&&(j=et),c.baseState=j,c.firstBaseUpdate=_e,c.lastBaseUpdate=tt,e=c.shared.interleaved,e!==null){c=e;do b|=c.lane,c=c.next;while(c!==e)}else g===null&&(c.shared.lanes=0);rh|=b,s.lanes=b,s.memoizedState=et}}function sh(s,e,o){if(s=e.effects,e.effects=null,s!==null)for(e=0;e<s.length;e++){var a=s[e],c=a.callback;if(c!==null){if(a.callback=null,a=o,typeof c!="function")throw Error(p$1(191,c));c.call(a)}}}var th={},uh=Uf(th),vh=Uf(th),wh=Uf(th);function xh(s){if(s===th)throw Error(p$1(174));return s}function yh(s,e){switch(G(wh,e),G(vh,s),G(uh,th),s=e.nodeType,s){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:lb(null,"");break;default:s=s===8?e.parentNode:e,e=s.namespaceURI||null,s=s.tagName,e=lb(e,s)}E(uh),G(uh,e)}function zh(){E(uh),E(vh),E(wh)}function Ah(s){xh(wh.current);var e=xh(uh.current),o=lb(e,s.type);e!==o&&(G(vh,s),G(uh,o))}function Bh(s){vh.current===s&&(E(uh),E(vh))}var L=Uf(0);function Ch(s){for(var e=s;e!==null;){if(e.tag===13){var o=e.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||o.data==="$?"||o.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===s)break;for(;e.sibling===null;){if(e.return===null||e.return===s)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Dh=[];function Eh(){for(var s=0;s<Dh.length;s++)Dh[s]._workInProgressVersionPrimary=null;Dh.length=0}var Fh=ua.ReactCurrentDispatcher,Gh=ua.ReactCurrentBatchConfig,Hh=0,M$1=null,N=null,O$1=null,Ih=!1,Jh=!1,Kh=0,Lh=0;function P(){throw Error(p$1(321))}function Mh(s,e){if(e===null)return!1;for(var o=0;o<e.length&&o<s.length;o++)if(!He(s[o],e[o]))return!1;return!0}function Nh(s,e,o,a,c,g){if(Hh=g,M$1=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Fh.current=s===null||s.memoizedState===null?Oh:Ph,s=o(a,c),Jh){g=0;do{if(Jh=!1,Kh=0,25<=g)throw Error(p$1(301));g+=1,O$1=N=null,e.updateQueue=null,Fh.current=Qh,s=o(a,c)}while(Jh)}if(Fh.current=Rh,e=N!==null&&N.next!==null,Hh=0,O$1=N=M$1=null,Ih=!1,e)throw Error(p$1(300));return s}function Sh(){var s=Kh!==0;return Kh=0,s}function Th(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return O$1===null?M$1.memoizedState=O$1=s:O$1=O$1.next=s,O$1}function Uh(){if(N===null){var s=M$1.alternate;s=s!==null?s.memoizedState:null}else s=N.next;var e=O$1===null?M$1.memoizedState:O$1.next;if(e!==null)O$1=e,N=s;else{if(s===null)throw Error(p$1(310));N=s,s={memoizedState:N.memoizedState,baseState:N.baseState,baseQueue:N.baseQueue,queue:N.queue,next:null},O$1===null?M$1.memoizedState=O$1=s:O$1=O$1.next=s}return O$1}function Vh(s,e){return typeof e=="function"?e(s):e}function Wh(s){var e=Uh(),o=e.queue;if(o===null)throw Error(p$1(311));o.lastRenderedReducer=s;var a=N,c=a.baseQueue,g=o.pending;if(g!==null){if(c!==null){var b=c.next;c.next=g.next,g.next=b}a.baseQueue=c=g,o.pending=null}if(c!==null){g=c.next,a=a.baseState;var _=b=null,j=null,_e=g;do{var tt=_e.lane;if((Hh&tt)===tt)j!==null&&(j=j.next={lane:0,action:_e.action,hasEagerState:_e.hasEagerState,eagerState:_e.eagerState,next:null}),a=_e.hasEagerState?_e.eagerState:s(a,_e.action);else{var et={lane:tt,action:_e.action,hasEagerState:_e.hasEagerState,eagerState:_e.eagerState,next:null};j===null?(_=j=et,b=a):j=j.next=et,M$1.lanes|=tt,rh|=tt}_e=_e.next}while(_e!==null&&_e!==g);j===null?b=a:j.next=_,He(a,e.memoizedState)||(dh=!0),e.memoizedState=a,e.baseState=b,e.baseQueue=j,o.lastRenderedState=a}if(s=o.interleaved,s!==null){c=s;do g=c.lane,M$1.lanes|=g,rh|=g,c=c.next;while(c!==s)}else c===null&&(o.lanes=0);return[e.memoizedState,o.dispatch]}function Xh(s){var e=Uh(),o=e.queue;if(o===null)throw Error(p$1(311));o.lastRenderedReducer=s;var a=o.dispatch,c=o.pending,g=e.memoizedState;if(c!==null){o.pending=null;var b=c=c.next;do g=s(g,b.action),b=b.next;while(b!==c);He(g,e.memoizedState)||(dh=!0),e.memoizedState=g,e.baseQueue===null&&(e.baseState=g),o.lastRenderedState=g}return[g,a]}function Yh(){}function Zh(s,e){var o=M$1,a=Uh(),c=e(),g=!He(a.memoizedState,c);if(g&&(a.memoizedState=c,dh=!0),a=a.queue,$h(ai.bind(null,o,a,s),[s]),a.getSnapshot!==e||g||O$1!==null&&O$1.memoizedState.tag&1){if(o.flags|=2048,bi(9,ci.bind(null,o,a,c,e),void 0,null),Q===null)throw Error(p$1(349));Hh&30||di(o,e,c)}return c}function di(s,e,o){s.flags|=16384,s={getSnapshot:e,value:o},e=M$1.updateQueue,e===null?(e={lastEffect:null,stores:null},M$1.updateQueue=e,e.stores=[s]):(o=e.stores,o===null?e.stores=[s]:o.push(s))}function ci(s,e,o,a){e.value=o,e.getSnapshot=a,ei(e)&&fi(s)}function ai(s,e,o){return o(function(){ei(e)&&fi(s)})}function ei(s){var e=s.getSnapshot;s=s.value;try{var o=e();return!He(s,o)}catch{return!0}}function fi(s){var e=ih(s,1);e!==null&&gi(e,s,1,-1)}function hi(s){var e=Th();return typeof s=="function"&&(s=s()),e.memoizedState=e.baseState=s,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vh,lastRenderedState:s},e.queue=s,s=s.dispatch=ii.bind(null,M$1,s),[e.memoizedState,s]}function bi(s,e,o,a){return s={tag:s,create:e,destroy:o,deps:a,next:null},e=M$1.updateQueue,e===null?(e={lastEffect:null,stores:null},M$1.updateQueue=e,e.lastEffect=s.next=s):(o=e.lastEffect,o===null?e.lastEffect=s.next=s:(a=o.next,o.next=s,s.next=a,e.lastEffect=s)),s}function ji(){return Uh().memoizedState}function ki(s,e,o,a){var c=Th();M$1.flags|=s,c.memoizedState=bi(1|e,o,void 0,a===void 0?null:a)}function li(s,e,o,a){var c=Uh();a=a===void 0?null:a;var g=void 0;if(N!==null){var b=N.memoizedState;if(g=b.destroy,a!==null&&Mh(a,b.deps)){c.memoizedState=bi(e,o,g,a);return}}M$1.flags|=s,c.memoizedState=bi(1|e,o,g,a)}function mi(s,e){return ki(8390656,8,s,e)}function $h(s,e){return li(2048,8,s,e)}function ni(s,e){return li(4,2,s,e)}function oi(s,e){return li(4,4,s,e)}function pi(s,e){if(typeof e=="function")return s=s(),e(s),function(){e(null)};if(e!=null)return s=s(),e.current=s,function(){e.current=null}}function qi(s,e,o){return o=o!=null?o.concat([s]):null,li(4,4,pi.bind(null,e,s),o)}function ri(){}function si(s,e){var o=Uh();e=e===void 0?null:e;var a=o.memoizedState;return a!==null&&e!==null&&Mh(e,a[1])?a[0]:(o.memoizedState=[s,e],s)}function ti(s,e){var o=Uh();e=e===void 0?null:e;var a=o.memoizedState;return a!==null&&e!==null&&Mh(e,a[1])?a[0]:(s=s(),o.memoizedState=[s,e],s)}function ui(s,e,o){return Hh&21?(He(o,e)||(o=yc(),M$1.lanes|=o,rh|=o,s.baseState=!0),e):(s.baseState&&(s.baseState=!1,dh=!0),s.memoizedState=o)}function vi(s,e){var o=C;C=o!==0&&4>o?o:4,s(!0);var a=Gh.transition;Gh.transition={};try{s(!1),e()}finally{C=o,Gh.transition=a}}function wi(){return Uh().memoizedState}function xi(s,e,o){var a=yi(s);if(o={lane:a,action:o,hasEagerState:!1,eagerState:null,next:null},zi(s))Ai(e,o);else if(o=hh(s,e,o,a),o!==null){var c=R();gi(o,s,a,c),Bi(o,e,a)}}function ii(s,e,o){var a=yi(s),c={lane:a,action:o,hasEagerState:!1,eagerState:null,next:null};if(zi(s))Ai(e,c);else{var g=s.alternate;if(s.lanes===0&&(g===null||g.lanes===0)&&(g=e.lastRenderedReducer,g!==null))try{var b=e.lastRenderedState,_=g(b,o);if(c.hasEagerState=!0,c.eagerState=_,He(_,b)){var j=e.interleaved;j===null?(c.next=c,gh(e)):(c.next=j.next,j.next=c),e.interleaved=c;return}}catch{}finally{}o=hh(s,e,c,a),o!==null&&(c=R(),gi(o,s,a,c),Bi(o,e,a))}}function zi(s){var e=s.alternate;return s===M$1||e!==null&&e===M$1}function Ai(s,e){Jh=Ih=!0;var o=s.pending;o===null?e.next=e:(e.next=o.next,o.next=e),s.pending=e}function Bi(s,e,o){if(o&4194240){var a=e.lanes;a&=s.pendingLanes,o|=a,e.lanes=o,Cc(s,o)}}var Rh={readContext:eh,useCallback:P,useContext:P,useEffect:P,useImperativeHandle:P,useInsertionEffect:P,useLayoutEffect:P,useMemo:P,useReducer:P,useRef:P,useState:P,useDebugValue:P,useDeferredValue:P,useTransition:P,useMutableSource:P,useSyncExternalStore:P,useId:P,unstable_isNewReconciler:!1},Oh={readContext:eh,useCallback:function(s,e){return Th().memoizedState=[s,e===void 0?null:e],s},useContext:eh,useEffect:mi,useImperativeHandle:function(s,e,o){return o=o!=null?o.concat([s]):null,ki(4194308,4,pi.bind(null,e,s),o)},useLayoutEffect:function(s,e){return ki(4194308,4,s,e)},useInsertionEffect:function(s,e){return ki(4,2,s,e)},useMemo:function(s,e){var o=Th();return e=e===void 0?null:e,s=s(),o.memoizedState=[s,e],s},useReducer:function(s,e,o){var a=Th();return e=o!==void 0?o(e):e,a.memoizedState=a.baseState=e,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:e},a.queue=s,s=s.dispatch=xi.bind(null,M$1,s),[a.memoizedState,s]},useRef:function(s){var e=Th();return s={current:s},e.memoizedState=s},useState:hi,useDebugValue:ri,useDeferredValue:function(s){return Th().memoizedState=s},useTransition:function(){var s=hi(!1),e=s[0];return s=vi.bind(null,s[1]),Th().memoizedState=s,[e,s]},useMutableSource:function(){},useSyncExternalStore:function(s,e,o){var a=M$1,c=Th();if(I){if(o===void 0)throw Error(p$1(407));o=o()}else{if(o=e(),Q===null)throw Error(p$1(349));Hh&30||di(a,e,o)}c.memoizedState=o;var g={value:o,getSnapshot:e};return c.queue=g,mi(ai.bind(null,a,g,s),[s]),a.flags|=2048,bi(9,ci.bind(null,a,g,o,e),void 0,null),o},useId:function(){var s=Th(),e=Q.identifierPrefix;if(I){var o=sg,a=rg;o=(a&~(1<<32-oc(a)-1)).toString(32)+o,e=":"+e+"R"+o,o=Kh++,0<o&&(e+="H"+o.toString(32)),e+=":"}else o=Lh++,e=":"+e+"r"+o.toString(32)+":";return s.memoizedState=e},unstable_isNewReconciler:!1},Ph={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Wh,useRef:ji,useState:function(){return Wh(Vh)},useDebugValue:ri,useDeferredValue:function(s){var e=Uh();return ui(e,N.memoizedState,s)},useTransition:function(){var s=Wh(Vh)[0],e=Uh().memoizedState;return[s,e]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1},Qh={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Xh,useRef:ji,useState:function(){return Xh(Vh)},useDebugValue:ri,useDeferredValue:function(s){var e=Uh();return N===null?e.memoizedState=s:ui(e,N.memoizedState,s)},useTransition:function(){var s=Xh(Vh)[0],e=Uh().memoizedState;return[s,e]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1};function Ci(s,e){if(s&&s.defaultProps){e=A$1({},e),s=s.defaultProps;for(var o in s)e[o]===void 0&&(e[o]=s[o]);return e}return e}function Di(s,e,o,a){e=s.memoizedState,o=o(a,e),o=o==null?e:A$1({},e,o),s.memoizedState=o,s.lanes===0&&(s.updateQueue.baseState=o)}var Ei={isMounted:function(s){return(s=s._reactInternals)?Vb(s)===s:!1},enqueueSetState:function(s,e,o){s=s._reactInternals;var a=R(),c=yi(s),g=mh(a,c);g.payload=e,o!=null&&(g.callback=o),e=nh(s,g,c),e!==null&&(gi(e,s,c,a),oh(e,s,c))},enqueueReplaceState:function(s,e,o){s=s._reactInternals;var a=R(),c=yi(s),g=mh(a,c);g.tag=1,g.payload=e,o!=null&&(g.callback=o),e=nh(s,g,c),e!==null&&(gi(e,s,c,a),oh(e,s,c))},enqueueForceUpdate:function(s,e){s=s._reactInternals;var o=R(),a=yi(s),c=mh(o,a);c.tag=2,e!=null&&(c.callback=e),e=nh(s,c,a),e!==null&&(gi(e,s,a,o),oh(e,s,a))}};function Fi(s,e,o,a,c,g,b){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(a,g,b):e.prototype&&e.prototype.isPureReactComponent?!Ie(o,a)||!Ie(c,g):!0}function Gi(s,e,o){var a=!1,c=Vf,g=e.contextType;return typeof g=="object"&&g!==null?g=eh(g):(c=Zf(e)?Xf:H$1.current,a=e.contextTypes,g=(a=a!=null)?Yf(s,c):Vf),e=new e(o,g),s.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Ei,s.stateNode=e,e._reactInternals=s,a&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=c,s.__reactInternalMemoizedMaskedChildContext=g),e}function Hi(s,e,o,a){s=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(o,a),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(o,a),e.state!==s&&Ei.enqueueReplaceState(e,e.state,null)}function Ii(s,e,o,a){var c=s.stateNode;c.props=o,c.state=s.memoizedState,c.refs={},kh(s);var g=e.contextType;typeof g=="object"&&g!==null?c.context=eh(g):(g=Zf(e)?Xf:H$1.current,c.context=Yf(s,g)),c.state=s.memoizedState,g=e.getDerivedStateFromProps,typeof g=="function"&&(Di(s,e,g,o),c.state=s.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof c.getSnapshotBeforeUpdate=="function"||typeof c.UNSAFE_componentWillMount!="function"&&typeof c.componentWillMount!="function"||(e=c.state,typeof c.componentWillMount=="function"&&c.componentWillMount(),typeof c.UNSAFE_componentWillMount=="function"&&c.UNSAFE_componentWillMount(),e!==c.state&&Ei.enqueueReplaceState(c,c.state,null),qh(s,o,c,a),c.state=s.memoizedState),typeof c.componentDidMount=="function"&&(s.flags|=4194308)}function Ji(s,e){try{var o="",a=e;do o+=Pa(a),a=a.return;while(a);var c=o}catch(g){c=`
Error generating stack: `+g.message+`
`+g.stack}return{value:s,source:e,stack:c,digest:null}}function Ki(s,e,o){return{value:s,source:null,stack:o??null,digest:e??null}}function Li(s,e){try{console.error(e.value)}catch(o){setTimeout(function(){throw o})}}var Mi=typeof WeakMap=="function"?WeakMap:Map;function Ni(s,e,o){o=mh(-1,o),o.tag=3,o.payload={element:null};var a=e.value;return o.callback=function(){Oi||(Oi=!0,Pi=a),Li(s,e)},o}function Qi(s,e,o){o=mh(-1,o),o.tag=3;var a=s.type.getDerivedStateFromError;if(typeof a=="function"){var c=e.value;o.payload=function(){return a(c)},o.callback=function(){Li(s,e)}}var g=s.stateNode;return g!==null&&typeof g.componentDidCatch=="function"&&(o.callback=function(){Li(s,e),typeof a!="function"&&(Ri===null?Ri=new Set([this]):Ri.add(this));var b=e.stack;this.componentDidCatch(e.value,{componentStack:b!==null?b:""})}),o}function Si(s,e,o){var a=s.pingCache;if(a===null){a=s.pingCache=new Mi;var c=new Set;a.set(e,c)}else c=a.get(e),c===void 0&&(c=new Set,a.set(e,c));c.has(o)||(c.add(o),s=Ti.bind(null,s,e,o),e.then(s,s))}function Ui(s){do{var e;if((e=s.tag===13)&&(e=s.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return s;s=s.return}while(s!==null);return null}function Vi(s,e,o,a,c){return s.mode&1?(s.flags|=65536,s.lanes=c,s):(s===e?s.flags|=65536:(s.flags|=128,o.flags|=131072,o.flags&=-52805,o.tag===1&&(o.alternate===null?o.tag=17:(e=mh(-1,1),e.tag=2,nh(o,e,1))),o.lanes|=1),s)}var Wi=ua.ReactCurrentOwner,dh=!1;function Xi(s,e,o,a){e.child=s===null?Vg(e,null,o,a):Ug(e,s.child,o,a)}function Yi(s,e,o,a,c){o=o.render;var g=e.ref;return ch(e,c),a=Nh(s,e,o,a,g,c),o=Sh(),s!==null&&!dh?(e.updateQueue=s.updateQueue,e.flags&=-2053,s.lanes&=~c,Zi(s,e,c)):(I&&o&&vg(e),e.flags|=1,Xi(s,e,a,c),e.child)}function $i(s,e,o,a,c){if(s===null){var g=o.type;return typeof g=="function"&&!aj(g)&&g.defaultProps===void 0&&o.compare===null&&o.defaultProps===void 0?(e.tag=15,e.type=g,bj(s,e,g,a,c)):(s=Rg(o.type,null,a,e,e.mode,c),s.ref=e.ref,s.return=e,e.child=s)}if(g=s.child,!(s.lanes&c)){var b=g.memoizedProps;if(o=o.compare,o=o!==null?o:Ie,o(b,a)&&s.ref===e.ref)return Zi(s,e,c)}return e.flags|=1,s=Pg(g,a),s.ref=e.ref,s.return=e,e.child=s}function bj(s,e,o,a,c){if(s!==null){var g=s.memoizedProps;if(Ie(g,a)&&s.ref===e.ref)if(dh=!1,e.pendingProps=a=g,(s.lanes&c)!==0)s.flags&131072&&(dh=!0);else return e.lanes=s.lanes,Zi(s,e,c)}return cj(s,e,o,a,c)}function dj(s,e,o){var a=e.pendingProps,c=a.children,g=s!==null?s.memoizedState:null;if(a.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},G(ej,fj),fj|=o;else{if(!(o&1073741824))return s=g!==null?g.baseLanes|o:o,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:s,cachePool:null,transitions:null},e.updateQueue=null,G(ej,fj),fj|=s,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},a=g!==null?g.baseLanes:o,G(ej,fj),fj|=a}else g!==null?(a=g.baseLanes|o,e.memoizedState=null):a=o,G(ej,fj),fj|=a;return Xi(s,e,c,o),e.child}function gj(s,e){var o=e.ref;(s===null&&o!==null||s!==null&&s.ref!==o)&&(e.flags|=512,e.flags|=2097152)}function cj(s,e,o,a,c){var g=Zf(o)?Xf:H$1.current;return g=Yf(e,g),ch(e,c),o=Nh(s,e,o,a,g,c),a=Sh(),s!==null&&!dh?(e.updateQueue=s.updateQueue,e.flags&=-2053,s.lanes&=~c,Zi(s,e,c)):(I&&a&&vg(e),e.flags|=1,Xi(s,e,o,c),e.child)}function hj(s,e,o,a,c){if(Zf(o)){var g=!0;cg(e)}else g=!1;if(ch(e,c),e.stateNode===null)ij(s,e),Gi(e,o,a),Ii(e,o,a,c),a=!0;else if(s===null){var b=e.stateNode,_=e.memoizedProps;b.props=_;var j=b.context,_e=o.contextType;typeof _e=="object"&&_e!==null?_e=eh(_e):(_e=Zf(o)?Xf:H$1.current,_e=Yf(e,_e));var tt=o.getDerivedStateFromProps,et=typeof tt=="function"||typeof b.getSnapshotBeforeUpdate=="function";et||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(_!==a||j!==_e)&&Hi(e,b,a,_e),jh=!1;var nt=e.memoizedState;b.state=nt,qh(e,a,b,c),j=e.memoizedState,_!==a||nt!==j||Wf.current||jh?(typeof tt=="function"&&(Di(e,o,tt,a),j=e.memoizedState),(_=jh||Fi(e,o,_,a,nt,j,_e))?(et||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount()),typeof b.componentDidMount=="function"&&(e.flags|=4194308)):(typeof b.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=a,e.memoizedState=j),b.props=a,b.state=j,b.context=_e,a=_):(typeof b.componentDidMount=="function"&&(e.flags|=4194308),a=!1)}else{b=e.stateNode,lh(s,e),_=e.memoizedProps,_e=e.type===e.elementType?_:Ci(e.type,_),b.props=_e,et=e.pendingProps,nt=b.context,j=o.contextType,typeof j=="object"&&j!==null?j=eh(j):(j=Zf(o)?Xf:H$1.current,j=Yf(e,j));var rt=o.getDerivedStateFromProps;(tt=typeof rt=="function"||typeof b.getSnapshotBeforeUpdate=="function")||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(_!==et||nt!==j)&&Hi(e,b,a,j),jh=!1,nt=e.memoizedState,b.state=nt,qh(e,a,b,c);var it=e.memoizedState;_!==et||nt!==it||Wf.current||jh?(typeof rt=="function"&&(Di(e,o,rt,a),it=e.memoizedState),(_e=jh||Fi(e,o,_e,a,nt,it,j)||!1)?(tt||typeof b.UNSAFE_componentWillUpdate!="function"&&typeof b.componentWillUpdate!="function"||(typeof b.componentWillUpdate=="function"&&b.componentWillUpdate(a,it,j),typeof b.UNSAFE_componentWillUpdate=="function"&&b.UNSAFE_componentWillUpdate(a,it,j)),typeof b.componentDidUpdate=="function"&&(e.flags|=4),typeof b.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof b.componentDidUpdate!="function"||_===s.memoizedProps&&nt===s.memoizedState||(e.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||_===s.memoizedProps&&nt===s.memoizedState||(e.flags|=1024),e.memoizedProps=a,e.memoizedState=it),b.props=a,b.state=it,b.context=j,a=_e):(typeof b.componentDidUpdate!="function"||_===s.memoizedProps&&nt===s.memoizedState||(e.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||_===s.memoizedProps&&nt===s.memoizedState||(e.flags|=1024),a=!1)}return jj(s,e,o,a,g,c)}function jj(s,e,o,a,c,g){gj(s,e);var b=(e.flags&128)!==0;if(!a&&!b)return c&&dg(e,o,!1),Zi(s,e,g);a=e.stateNode,Wi.current=e;var _=b&&typeof o.getDerivedStateFromError!="function"?null:a.render();return e.flags|=1,s!==null&&b?(e.child=Ug(e,s.child,null,g),e.child=Ug(e,null,_,g)):Xi(s,e,_,g),e.memoizedState=a.state,c&&dg(e,o,!0),e.child}function kj(s){var e=s.stateNode;e.pendingContext?ag(s,e.pendingContext,e.pendingContext!==e.context):e.context&&ag(s,e.context,!1),yh(s,e.containerInfo)}function lj(s,e,o,a,c){return Ig(),Jg(c),e.flags|=256,Xi(s,e,o,a),e.child}var mj={dehydrated:null,treeContext:null,retryLane:0};function nj(s){return{baseLanes:s,cachePool:null,transitions:null}}function oj(s,e,o){var a=e.pendingProps,c=L.current,g=!1,b=(e.flags&128)!==0,_;if((_=b)||(_=s!==null&&s.memoizedState===null?!1:(c&2)!==0),_?(g=!0,e.flags&=-129):(s===null||s.memoizedState!==null)&&(c|=1),G(L,c&1),s===null)return Eg(e),s=e.memoizedState,s!==null&&(s=s.dehydrated,s!==null)?(e.mode&1?s.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(b=a.children,s=a.fallback,g?(a=e.mode,g=e.child,b={mode:"hidden",children:b},!(a&1)&&g!==null?(g.childLanes=0,g.pendingProps=b):g=pj(b,a,0,null),s=Tg(s,a,o,null),g.return=e,s.return=e,g.sibling=s,e.child=g,e.child.memoizedState=nj(o),e.memoizedState=mj,s):qj(e,b));if(c=s.memoizedState,c!==null&&(_=c.dehydrated,_!==null))return rj(s,e,b,a,_,c,o);if(g){g=a.fallback,b=e.mode,c=s.child,_=c.sibling;var j={mode:"hidden",children:a.children};return!(b&1)&&e.child!==c?(a=e.child,a.childLanes=0,a.pendingProps=j,e.deletions=null):(a=Pg(c,j),a.subtreeFlags=c.subtreeFlags&14680064),_!==null?g=Pg(_,g):(g=Tg(g,b,o,null),g.flags|=2),g.return=e,a.return=e,a.sibling=g,e.child=a,a=g,g=e.child,b=s.child.memoizedState,b=b===null?nj(o):{baseLanes:b.baseLanes|o,cachePool:null,transitions:b.transitions},g.memoizedState=b,g.childLanes=s.childLanes&~o,e.memoizedState=mj,a}return g=s.child,s=g.sibling,a=Pg(g,{mode:"visible",children:a.children}),!(e.mode&1)&&(a.lanes=o),a.return=e,a.sibling=null,s!==null&&(o=e.deletions,o===null?(e.deletions=[s],e.flags|=16):o.push(s)),e.child=a,e.memoizedState=null,a}function qj(s,e){return e=pj({mode:"visible",children:e},s.mode,0,null),e.return=s,s.child=e}function sj(s,e,o,a){return a!==null&&Jg(a),Ug(e,s.child,null,o),s=qj(e,e.pendingProps.children),s.flags|=2,e.memoizedState=null,s}function rj(s,e,o,a,c,g,b){if(o)return e.flags&256?(e.flags&=-257,a=Ki(Error(p$1(422))),sj(s,e,b,a)):e.memoizedState!==null?(e.child=s.child,e.flags|=128,null):(g=a.fallback,c=e.mode,a=pj({mode:"visible",children:a.children},c,0,null),g=Tg(g,c,b,null),g.flags|=2,a.return=e,g.return=e,a.sibling=g,e.child=a,e.mode&1&&Ug(e,s.child,null,b),e.child.memoizedState=nj(b),e.memoizedState=mj,g);if(!(e.mode&1))return sj(s,e,b,null);if(c.data==="$!"){if(a=c.nextSibling&&c.nextSibling.dataset,a)var _=a.dgst;return a=_,g=Error(p$1(419)),a=Ki(g,a,void 0),sj(s,e,b,a)}if(_=(b&s.childLanes)!==0,dh||_){if(a=Q,a!==null){switch(b&-b){case 4:c=2;break;case 16:c=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:c=32;break;case 536870912:c=268435456;break;default:c=0}c=c&(a.suspendedLanes|b)?0:c,c!==0&&c!==g.retryLane&&(g.retryLane=c,ih(s,c),gi(a,s,c,-1))}return tj(),a=Ki(Error(p$1(421))),sj(s,e,b,a)}return c.data==="$?"?(e.flags|=128,e.child=s.child,e=uj.bind(null,s),c._reactRetry=e,null):(s=g.treeContext,yg=Lf(c.nextSibling),xg=e,I=!0,zg=null,s!==null&&(og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,rg=s.id,sg=s.overflow,qg=e),e=qj(e,a.children),e.flags|=4096,e)}function vj(s,e,o){s.lanes|=e;var a=s.alternate;a!==null&&(a.lanes|=e),bh(s.return,e,o)}function wj(s,e,o,a,c){var g=s.memoizedState;g===null?s.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:a,tail:o,tailMode:c}:(g.isBackwards=e,g.rendering=null,g.renderingStartTime=0,g.last=a,g.tail=o,g.tailMode=c)}function xj(s,e,o){var a=e.pendingProps,c=a.revealOrder,g=a.tail;if(Xi(s,e,a.children,o),a=L.current,a&2)a=a&1|2,e.flags|=128;else{if(s!==null&&s.flags&128)e:for(s=e.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&vj(s,o,e);else if(s.tag===19)vj(s,o,e);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===e)break e;for(;s.sibling===null;){if(s.return===null||s.return===e)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}a&=1}if(G(L,a),!(e.mode&1))e.memoizedState=null;else switch(c){case"forwards":for(o=e.child,c=null;o!==null;)s=o.alternate,s!==null&&Ch(s)===null&&(c=o),o=o.sibling;o=c,o===null?(c=e.child,e.child=null):(c=o.sibling,o.sibling=null),wj(e,!1,c,o,g);break;case"backwards":for(o=null,c=e.child,e.child=null;c!==null;){if(s=c.alternate,s!==null&&Ch(s)===null){e.child=c;break}s=c.sibling,c.sibling=o,o=c,c=s}wj(e,!0,o,null,g);break;case"together":wj(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function ij(s,e){!(e.mode&1)&&s!==null&&(s.alternate=null,e.alternate=null,e.flags|=2)}function Zi(s,e,o){if(s!==null&&(e.dependencies=s.dependencies),rh|=e.lanes,!(o&e.childLanes))return null;if(s!==null&&e.child!==s.child)throw Error(p$1(153));if(e.child!==null){for(s=e.child,o=Pg(s,s.pendingProps),e.child=o,o.return=e;s.sibling!==null;)s=s.sibling,o=o.sibling=Pg(s,s.pendingProps),o.return=e;o.sibling=null}return e.child}function yj(s,e,o){switch(e.tag){case 3:kj(e),Ig();break;case 5:Ah(e);break;case 1:Zf(e.type)&&cg(e);break;case 4:yh(e,e.stateNode.containerInfo);break;case 10:var a=e.type._context,c=e.memoizedProps.value;G(Wg,a._currentValue),a._currentValue=c;break;case 13:if(a=e.memoizedState,a!==null)return a.dehydrated!==null?(G(L,L.current&1),e.flags|=128,null):o&e.child.childLanes?oj(s,e,o):(G(L,L.current&1),s=Zi(s,e,o),s!==null?s.sibling:null);G(L,L.current&1);break;case 19:if(a=(o&e.childLanes)!==0,s.flags&128){if(a)return xj(s,e,o);e.flags|=128}if(c=e.memoizedState,c!==null&&(c.rendering=null,c.tail=null,c.lastEffect=null),G(L,L.current),a)break;return null;case 22:case 23:return e.lanes=0,dj(s,e,o)}return Zi(s,e,o)}var zj,Aj,Bj,Cj;zj=function(s,e){for(var o=e.child;o!==null;){if(o.tag===5||o.tag===6)s.appendChild(o.stateNode);else if(o.tag!==4&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===e)break;for(;o.sibling===null;){if(o.return===null||o.return===e)return;o=o.return}o.sibling.return=o.return,o=o.sibling}};Aj=function(){};Bj=function(s,e,o,a){var c=s.memoizedProps;if(c!==a){s=e.stateNode,xh(uh.current);var g=null;switch(o){case"input":c=Ya(s,c),a=Ya(s,a),g=[];break;case"select":c=A$1({},c,{value:void 0}),a=A$1({},a,{value:void 0}),g=[];break;case"textarea":c=gb(s,c),a=gb(s,a),g=[];break;default:typeof c.onClick!="function"&&typeof a.onClick=="function"&&(s.onclick=Bf)}ub(o,a);var b;o=null;for(_e in c)if(!a.hasOwnProperty(_e)&&c.hasOwnProperty(_e)&&c[_e]!=null)if(_e==="style"){var _=c[_e];for(b in _)_.hasOwnProperty(b)&&(o||(o={}),o[b]="")}else _e!=="dangerouslySetInnerHTML"&&_e!=="children"&&_e!=="suppressContentEditableWarning"&&_e!=="suppressHydrationWarning"&&_e!=="autoFocus"&&(ea.hasOwnProperty(_e)?g||(g=[]):(g=g||[]).push(_e,null));for(_e in a){var j=a[_e];if(_=c!=null?c[_e]:void 0,a.hasOwnProperty(_e)&&j!==_&&(j!=null||_!=null))if(_e==="style")if(_){for(b in _)!_.hasOwnProperty(b)||j&&j.hasOwnProperty(b)||(o||(o={}),o[b]="");for(b in j)j.hasOwnProperty(b)&&_[b]!==j[b]&&(o||(o={}),o[b]=j[b])}else o||(g||(g=[]),g.push(_e,o)),o=j;else _e==="dangerouslySetInnerHTML"?(j=j?j.__html:void 0,_=_?_.__html:void 0,j!=null&&_!==j&&(g=g||[]).push(_e,j)):_e==="children"?typeof j!="string"&&typeof j!="number"||(g=g||[]).push(_e,""+j):_e!=="suppressContentEditableWarning"&&_e!=="suppressHydrationWarning"&&(ea.hasOwnProperty(_e)?(j!=null&&_e==="onScroll"&&D$1("scroll",s),g||_===j||(g=[])):(g=g||[]).push(_e,j))}o&&(g=g||[]).push("style",o);var _e=g;(e.updateQueue=_e)&&(e.flags|=4)}};Cj=function(s,e,o,a){o!==a&&(e.flags|=4)};function Dj(s,e){if(!I)switch(s.tailMode){case"hidden":e=s.tail;for(var o=null;e!==null;)e.alternate!==null&&(o=e),e=e.sibling;o===null?s.tail=null:o.sibling=null;break;case"collapsed":o=s.tail;for(var a=null;o!==null;)o.alternate!==null&&(a=o),o=o.sibling;a===null?e||s.tail===null?s.tail=null:s.tail.sibling=null:a.sibling=null}}function S$1(s){var e=s.alternate!==null&&s.alternate.child===s.child,o=0,a=0;if(e)for(var c=s.child;c!==null;)o|=c.lanes|c.childLanes,a|=c.subtreeFlags&14680064,a|=c.flags&14680064,c.return=s,c=c.sibling;else for(c=s.child;c!==null;)o|=c.lanes|c.childLanes,a|=c.subtreeFlags,a|=c.flags,c.return=s,c=c.sibling;return s.subtreeFlags|=a,s.childLanes=o,e}function Ej(s,e,o){var a=e.pendingProps;switch(wg(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S$1(e),null;case 1:return Zf(e.type)&&$f(),S$1(e),null;case 3:return a=e.stateNode,zh(),E(Wf),E(H$1),Eh(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(s===null||s.child===null)&&(Gg(e)?e.flags|=4:s===null||s.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,zg!==null&&(Fj(zg),zg=null))),Aj(s,e),S$1(e),null;case 5:Bh(e);var c=xh(wh.current);if(o=e.type,s!==null&&e.stateNode!=null)Bj(s,e,o,a,c),s.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!a){if(e.stateNode===null)throw Error(p$1(166));return S$1(e),null}if(s=xh(uh.current),Gg(e)){a=e.stateNode,o=e.type;var g=e.memoizedProps;switch(a[Of]=e,a[Pf]=g,s=(e.mode&1)!==0,o){case"dialog":D$1("cancel",a),D$1("close",a);break;case"iframe":case"object":case"embed":D$1("load",a);break;case"video":case"audio":for(c=0;c<lf.length;c++)D$1(lf[c],a);break;case"source":D$1("error",a);break;case"img":case"image":case"link":D$1("error",a),D$1("load",a);break;case"details":D$1("toggle",a);break;case"input":Za(a,g),D$1("invalid",a);break;case"select":a._wrapperState={wasMultiple:!!g.multiple},D$1("invalid",a);break;case"textarea":hb(a,g),D$1("invalid",a)}ub(o,g),c=null;for(var b in g)if(g.hasOwnProperty(b)){var _=g[b];b==="children"?typeof _=="string"?a.textContent!==_&&(g.suppressHydrationWarning!==!0&&Af(a.textContent,_,s),c=["children",_]):typeof _=="number"&&a.textContent!==""+_&&(g.suppressHydrationWarning!==!0&&Af(a.textContent,_,s),c=["children",""+_]):ea.hasOwnProperty(b)&&_!=null&&b==="onScroll"&&D$1("scroll",a)}switch(o){case"input":Va(a),db(a,g,!0);break;case"textarea":Va(a),jb(a);break;case"select":case"option":break;default:typeof g.onClick=="function"&&(a.onclick=Bf)}a=c,e.updateQueue=a,a!==null&&(e.flags|=4)}else{b=c.nodeType===9?c:c.ownerDocument,s==="http://www.w3.org/1999/xhtml"&&(s=kb(o)),s==="http://www.w3.org/1999/xhtml"?o==="script"?(s=b.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild)):typeof a.is=="string"?s=b.createElement(o,{is:a.is}):(s=b.createElement(o),o==="select"&&(b=s,a.multiple?b.multiple=!0:a.size&&(b.size=a.size))):s=b.createElementNS(s,o),s[Of]=e,s[Pf]=a,zj(s,e,!1,!1),e.stateNode=s;e:{switch(b=vb(o,a),o){case"dialog":D$1("cancel",s),D$1("close",s),c=a;break;case"iframe":case"object":case"embed":D$1("load",s),c=a;break;case"video":case"audio":for(c=0;c<lf.length;c++)D$1(lf[c],s);c=a;break;case"source":D$1("error",s),c=a;break;case"img":case"image":case"link":D$1("error",s),D$1("load",s),c=a;break;case"details":D$1("toggle",s),c=a;break;case"input":Za(s,a),c=Ya(s,a),D$1("invalid",s);break;case"option":c=a;break;case"select":s._wrapperState={wasMultiple:!!a.multiple},c=A$1({},a,{value:void 0}),D$1("invalid",s);break;case"textarea":hb(s,a),c=gb(s,a),D$1("invalid",s);break;default:c=a}ub(o,c),_=c;for(g in _)if(_.hasOwnProperty(g)){var j=_[g];g==="style"?sb(s,j):g==="dangerouslySetInnerHTML"?(j=j?j.__html:void 0,j!=null&&nb(s,j)):g==="children"?typeof j=="string"?(o!=="textarea"||j!=="")&&ob(s,j):typeof j=="number"&&ob(s,""+j):g!=="suppressContentEditableWarning"&&g!=="suppressHydrationWarning"&&g!=="autoFocus"&&(ea.hasOwnProperty(g)?j!=null&&g==="onScroll"&&D$1("scroll",s):j!=null&&ta(s,g,j,b))}switch(o){case"input":Va(s),db(s,a,!1);break;case"textarea":Va(s),jb(s);break;case"option":a.value!=null&&s.setAttribute("value",""+Sa(a.value));break;case"select":s.multiple=!!a.multiple,g=a.value,g!=null?fb(s,!!a.multiple,g,!1):a.defaultValue!=null&&fb(s,!!a.multiple,a.defaultValue,!0);break;default:typeof c.onClick=="function"&&(s.onclick=Bf)}switch(o){case"button":case"input":case"select":case"textarea":a=!!a.autoFocus;break e;case"img":a=!0;break e;default:a=!1}}a&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return S$1(e),null;case 6:if(s&&e.stateNode!=null)Cj(s,e,s.memoizedProps,a);else{if(typeof a!="string"&&e.stateNode===null)throw Error(p$1(166));if(o=xh(wh.current),xh(uh.current),Gg(e)){if(a=e.stateNode,o=e.memoizedProps,a[Of]=e,(g=a.nodeValue!==o)&&(s=xg,s!==null))switch(s.tag){case 3:Af(a.nodeValue,o,(s.mode&1)!==0);break;case 5:s.memoizedProps.suppressHydrationWarning!==!0&&Af(a.nodeValue,o,(s.mode&1)!==0)}g&&(e.flags|=4)}else a=(o.nodeType===9?o:o.ownerDocument).createTextNode(a),a[Of]=e,e.stateNode=a}return S$1(e),null;case 13:if(E(L),a=e.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(I&&yg!==null&&e.mode&1&&!(e.flags&128))Hg(),Ig(),e.flags|=98560,g=!1;else if(g=Gg(e),a!==null&&a.dehydrated!==null){if(s===null){if(!g)throw Error(p$1(318));if(g=e.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(p$1(317));g[Of]=e}else Ig(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;S$1(e),g=!1}else zg!==null&&(Fj(zg),zg=null),g=!0;if(!g)return e.flags&65536?e:null}return e.flags&128?(e.lanes=o,e):(a=a!==null,a!==(s!==null&&s.memoizedState!==null)&&a&&(e.child.flags|=8192,e.mode&1&&(s===null||L.current&1?T===0&&(T=3):tj())),e.updateQueue!==null&&(e.flags|=4),S$1(e),null);case 4:return zh(),Aj(s,e),s===null&&sf(e.stateNode.containerInfo),S$1(e),null;case 10:return ah(e.type._context),S$1(e),null;case 17:return Zf(e.type)&&$f(),S$1(e),null;case 19:if(E(L),g=e.memoizedState,g===null)return S$1(e),null;if(a=(e.flags&128)!==0,b=g.rendering,b===null)if(a)Dj(g,!1);else{if(T!==0||s!==null&&s.flags&128)for(s=e.child;s!==null;){if(b=Ch(s),b!==null){for(e.flags|=128,Dj(g,!1),a=b.updateQueue,a!==null&&(e.updateQueue=a,e.flags|=4),e.subtreeFlags=0,a=o,o=e.child;o!==null;)g=o,s=a,g.flags&=14680066,b=g.alternate,b===null?(g.childLanes=0,g.lanes=s,g.child=null,g.subtreeFlags=0,g.memoizedProps=null,g.memoizedState=null,g.updateQueue=null,g.dependencies=null,g.stateNode=null):(g.childLanes=b.childLanes,g.lanes=b.lanes,g.child=b.child,g.subtreeFlags=0,g.deletions=null,g.memoizedProps=b.memoizedProps,g.memoizedState=b.memoizedState,g.updateQueue=b.updateQueue,g.type=b.type,s=b.dependencies,g.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),o=o.sibling;return G(L,L.current&1|2),e.child}s=s.sibling}g.tail!==null&&B()>Gj&&(e.flags|=128,a=!0,Dj(g,!1),e.lanes=4194304)}else{if(!a)if(s=Ch(b),s!==null){if(e.flags|=128,a=!0,o=s.updateQueue,o!==null&&(e.updateQueue=o,e.flags|=4),Dj(g,!0),g.tail===null&&g.tailMode==="hidden"&&!b.alternate&&!I)return S$1(e),null}else 2*B()-g.renderingStartTime>Gj&&o!==1073741824&&(e.flags|=128,a=!0,Dj(g,!1),e.lanes=4194304);g.isBackwards?(b.sibling=e.child,e.child=b):(o=g.last,o!==null?o.sibling=b:e.child=b,g.last=b)}return g.tail!==null?(e=g.tail,g.rendering=e,g.tail=e.sibling,g.renderingStartTime=B(),e.sibling=null,o=L.current,G(L,a?o&1|2:o&1),e):(S$1(e),null);case 22:case 23:return Hj(),a=e.memoizedState!==null,s!==null&&s.memoizedState!==null!==a&&(e.flags|=8192),a&&e.mode&1?fj&1073741824&&(S$1(e),e.subtreeFlags&6&&(e.flags|=8192)):S$1(e),null;case 24:return null;case 25:return null}throw Error(p$1(156,e.tag))}function Ij(s,e){switch(wg(e),e.tag){case 1:return Zf(e.type)&&$f(),s=e.flags,s&65536?(e.flags=s&-65537|128,e):null;case 3:return zh(),E(Wf),E(H$1),Eh(),s=e.flags,s&65536&&!(s&128)?(e.flags=s&-65537|128,e):null;case 5:return Bh(e),null;case 13:if(E(L),s=e.memoizedState,s!==null&&s.dehydrated!==null){if(e.alternate===null)throw Error(p$1(340));Ig()}return s=e.flags,s&65536?(e.flags=s&-65537|128,e):null;case 19:return E(L),null;case 4:return zh(),null;case 10:return ah(e.type._context),null;case 22:case 23:return Hj(),null;case 24:return null;default:return null}}var Jj=!1,U=!1,Kj=typeof WeakSet=="function"?WeakSet:Set,V=null;function Lj(s,e){var o=s.ref;if(o!==null)if(typeof o=="function")try{o(null)}catch(a){W(s,e,a)}else o.current=null}function Mj(s,e,o){try{o()}catch(a){W(s,e,a)}}var Nj=!1;function Oj(s,e){if(Cf=dd,s=Me(),Ne(s)){if("selectionStart"in s)var o={start:s.selectionStart,end:s.selectionEnd};else e:{o=(o=s.ownerDocument)&&o.defaultView||window;var a=o.getSelection&&o.getSelection();if(a&&a.rangeCount!==0){o=a.anchorNode;var c=a.anchorOffset,g=a.focusNode;a=a.focusOffset;try{o.nodeType,g.nodeType}catch{o=null;break e}var b=0,_=-1,j=-1,_e=0,tt=0,et=s,nt=null;t:for(;;){for(var rt;et!==o||c!==0&&et.nodeType!==3||(_=b+c),et!==g||a!==0&&et.nodeType!==3||(j=b+a),et.nodeType===3&&(b+=et.nodeValue.length),(rt=et.firstChild)!==null;)nt=et,et=rt;for(;;){if(et===s)break t;if(nt===o&&++_e===c&&(_=b),nt===g&&++tt===a&&(j=b),(rt=et.nextSibling)!==null)break;et=nt,nt=et.parentNode}et=rt}o=_===-1||j===-1?null:{start:_,end:j}}else o=null}o=o||{start:0,end:0}}else o=null;for(Df={focusedElem:s,selectionRange:o},dd=!1,V=e;V!==null;)if(e=V,s=e.child,(e.subtreeFlags&1028)!==0&&s!==null)s.return=e,V=s;else for(;V!==null;){e=V;try{var it=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(it!==null){var st=it.memoizedProps,lt=it.memoizedState,at=e.stateNode,ct=at.getSnapshotBeforeUpdate(e.elementType===e.type?st:Ci(e.type,st),lt);at.__reactInternalSnapshotBeforeUpdate=ct}break;case 3:var ft=e.stateNode.containerInfo;ft.nodeType===1?ft.textContent="":ft.nodeType===9&&ft.documentElement&&ft.removeChild(ft.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(p$1(163))}}catch(vt){W(e,e.return,vt)}if(s=e.sibling,s!==null){s.return=e.return,V=s;break}V=e.return}return it=Nj,Nj=!1,it}function Pj(s,e,o){var a=e.updateQueue;if(a=a!==null?a.lastEffect:null,a!==null){var c=a=a.next;do{if((c.tag&s)===s){var g=c.destroy;c.destroy=void 0,g!==void 0&&Mj(e,o,g)}c=c.next}while(c!==a)}}function Qj(s,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var o=e=e.next;do{if((o.tag&s)===s){var a=o.create;o.destroy=a()}o=o.next}while(o!==e)}}function Rj(s){var e=s.ref;if(e!==null){var o=s.stateNode;switch(s.tag){case 5:s=o;break;default:s=o}typeof e=="function"?e(s):e.current=s}}function Sj(s){var e=s.alternate;e!==null&&(s.alternate=null,Sj(e)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(e=s.stateNode,e!==null&&(delete e[Of],delete e[Pf],delete e[of],delete e[Qf],delete e[Rf])),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}function Tj(s){return s.tag===5||s.tag===3||s.tag===4}function Uj(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||Tj(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Vj(s,e,o){var a=s.tag;if(a===5||a===6)s=s.stateNode,e?o.nodeType===8?o.parentNode.insertBefore(s,e):o.insertBefore(s,e):(o.nodeType===8?(e=o.parentNode,e.insertBefore(s,o)):(e=o,e.appendChild(s)),o=o._reactRootContainer,o!=null||e.onclick!==null||(e.onclick=Bf));else if(a!==4&&(s=s.child,s!==null))for(Vj(s,e,o),s=s.sibling;s!==null;)Vj(s,e,o),s=s.sibling}function Wj(s,e,o){var a=s.tag;if(a===5||a===6)s=s.stateNode,e?o.insertBefore(s,e):o.appendChild(s);else if(a!==4&&(s=s.child,s!==null))for(Wj(s,e,o),s=s.sibling;s!==null;)Wj(s,e,o),s=s.sibling}var X=null,Xj=!1;function Yj(s,e,o){for(o=o.child;o!==null;)Zj(s,e,o),o=o.sibling}function Zj(s,e,o){if(lc&&typeof lc.onCommitFiberUnmount=="function")try{lc.onCommitFiberUnmount(kc,o)}catch{}switch(o.tag){case 5:U||Lj(o,e);case 6:var a=X,c=Xj;X=null,Yj(s,e,o),X=a,Xj=c,X!==null&&(Xj?(s=X,o=o.stateNode,s.nodeType===8?s.parentNode.removeChild(o):s.removeChild(o)):X.removeChild(o.stateNode));break;case 18:X!==null&&(Xj?(s=X,o=o.stateNode,s.nodeType===8?Kf(s.parentNode,o):s.nodeType===1&&Kf(s,o),bd(s)):Kf(X,o.stateNode));break;case 4:a=X,c=Xj,X=o.stateNode.containerInfo,Xj=!0,Yj(s,e,o),X=a,Xj=c;break;case 0:case 11:case 14:case 15:if(!U&&(a=o.updateQueue,a!==null&&(a=a.lastEffect,a!==null))){c=a=a.next;do{var g=c,b=g.destroy;g=g.tag,b!==void 0&&(g&2||g&4)&&Mj(o,e,b),c=c.next}while(c!==a)}Yj(s,e,o);break;case 1:if(!U&&(Lj(o,e),a=o.stateNode,typeof a.componentWillUnmount=="function"))try{a.props=o.memoizedProps,a.state=o.memoizedState,a.componentWillUnmount()}catch(_){W(o,e,_)}Yj(s,e,o);break;case 21:Yj(s,e,o);break;case 22:o.mode&1?(U=(a=U)||o.memoizedState!==null,Yj(s,e,o),U=a):Yj(s,e,o);break;default:Yj(s,e,o)}}function ak(s){var e=s.updateQueue;if(e!==null){s.updateQueue=null;var o=s.stateNode;o===null&&(o=s.stateNode=new Kj),e.forEach(function(a){var c=bk.bind(null,s,a);o.has(a)||(o.add(a),a.then(c,c))})}}function ck(s,e){var o=e.deletions;if(o!==null)for(var a=0;a<o.length;a++){var c=o[a];try{var g=s,b=e,_=b;e:for(;_!==null;){switch(_.tag){case 5:X=_.stateNode,Xj=!1;break e;case 3:X=_.stateNode.containerInfo,Xj=!0;break e;case 4:X=_.stateNode.containerInfo,Xj=!0;break e}_=_.return}if(X===null)throw Error(p$1(160));Zj(g,b,c),X=null,Xj=!1;var j=c.alternate;j!==null&&(j.return=null),c.return=null}catch(_e){W(c,e,_e)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)dk(e,s),e=e.sibling}function dk(s,e){var o=s.alternate,a=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:if(ck(e,s),ek(s),a&4){try{Pj(3,s,s.return),Qj(3,s)}catch(st){W(s,s.return,st)}try{Pj(5,s,s.return)}catch(st){W(s,s.return,st)}}break;case 1:ck(e,s),ek(s),a&512&&o!==null&&Lj(o,o.return);break;case 5:if(ck(e,s),ek(s),a&512&&o!==null&&Lj(o,o.return),s.flags&32){var c=s.stateNode;try{ob(c,"")}catch(st){W(s,s.return,st)}}if(a&4&&(c=s.stateNode,c!=null)){var g=s.memoizedProps,b=o!==null?o.memoizedProps:g,_=s.type,j=s.updateQueue;if(s.updateQueue=null,j!==null)try{_==="input"&&g.type==="radio"&&g.name!=null&&ab(c,g),vb(_,b);var _e=vb(_,g);for(b=0;b<j.length;b+=2){var tt=j[b],et=j[b+1];tt==="style"?sb(c,et):tt==="dangerouslySetInnerHTML"?nb(c,et):tt==="children"?ob(c,et):ta(c,tt,et,_e)}switch(_){case"input":bb(c,g);break;case"textarea":ib(c,g);break;case"select":var nt=c._wrapperState.wasMultiple;c._wrapperState.wasMultiple=!!g.multiple;var rt=g.value;rt!=null?fb(c,!!g.multiple,rt,!1):nt!==!!g.multiple&&(g.defaultValue!=null?fb(c,!!g.multiple,g.defaultValue,!0):fb(c,!!g.multiple,g.multiple?[]:"",!1))}c[Pf]=g}catch(st){W(s,s.return,st)}}break;case 6:if(ck(e,s),ek(s),a&4){if(s.stateNode===null)throw Error(p$1(162));c=s.stateNode,g=s.memoizedProps;try{c.nodeValue=g}catch(st){W(s,s.return,st)}}break;case 3:if(ck(e,s),ek(s),a&4&&o!==null&&o.memoizedState.isDehydrated)try{bd(e.containerInfo)}catch(st){W(s,s.return,st)}break;case 4:ck(e,s),ek(s);break;case 13:ck(e,s),ek(s),c=s.child,c.flags&8192&&(g=c.memoizedState!==null,c.stateNode.isHidden=g,!g||c.alternate!==null&&c.alternate.memoizedState!==null||(fk=B())),a&4&&ak(s);break;case 22:if(tt=o!==null&&o.memoizedState!==null,s.mode&1?(U=(_e=U)||tt,ck(e,s),U=_e):ck(e,s),ek(s),a&8192){if(_e=s.memoizedState!==null,(s.stateNode.isHidden=_e)&&!tt&&s.mode&1)for(V=s,tt=s.child;tt!==null;){for(et=V=tt;V!==null;){switch(nt=V,rt=nt.child,nt.tag){case 0:case 11:case 14:case 15:Pj(4,nt,nt.return);break;case 1:Lj(nt,nt.return);var it=nt.stateNode;if(typeof it.componentWillUnmount=="function"){a=nt,o=nt.return;try{e=a,it.props=e.memoizedProps,it.state=e.memoizedState,it.componentWillUnmount()}catch(st){W(a,o,st)}}break;case 5:Lj(nt,nt.return);break;case 22:if(nt.memoizedState!==null){gk(et);continue}}rt!==null?(rt.return=nt,V=rt):gk(et)}tt=tt.sibling}e:for(tt=null,et=s;;){if(et.tag===5){if(tt===null){tt=et;try{c=et.stateNode,_e?(g=c.style,typeof g.setProperty=="function"?g.setProperty("display","none","important"):g.display="none"):(_=et.stateNode,j=et.memoizedProps.style,b=j!=null&&j.hasOwnProperty("display")?j.display:null,_.style.display=rb("display",b))}catch(st){W(s,s.return,st)}}}else if(et.tag===6){if(tt===null)try{et.stateNode.nodeValue=_e?"":et.memoizedProps}catch(st){W(s,s.return,st)}}else if((et.tag!==22&&et.tag!==23||et.memoizedState===null||et===s)&&et.child!==null){et.child.return=et,et=et.child;continue}if(et===s)break e;for(;et.sibling===null;){if(et.return===null||et.return===s)break e;tt===et&&(tt=null),et=et.return}tt===et&&(tt=null),et.sibling.return=et.return,et=et.sibling}}break;case 19:ck(e,s),ek(s),a&4&&ak(s);break;case 21:break;default:ck(e,s),ek(s)}}function ek(s){var e=s.flags;if(e&2){try{e:{for(var o=s.return;o!==null;){if(Tj(o)){var a=o;break e}o=o.return}throw Error(p$1(160))}switch(a.tag){case 5:var c=a.stateNode;a.flags&32&&(ob(c,""),a.flags&=-33);var g=Uj(s);Wj(s,g,c);break;case 3:case 4:var b=a.stateNode.containerInfo,_=Uj(s);Vj(s,_,b);break;default:throw Error(p$1(161))}}catch(j){W(s,s.return,j)}s.flags&=-3}e&4096&&(s.flags&=-4097)}function hk(s,e,o){V=s,ik(s)}function ik(s,e,o){for(var a=(s.mode&1)!==0;V!==null;){var c=V,g=c.child;if(c.tag===22&&a){var b=c.memoizedState!==null||Jj;if(!b){var _=c.alternate,j=_!==null&&_.memoizedState!==null||U;_=Jj;var _e=U;if(Jj=b,(U=j)&&!_e)for(V=c;V!==null;)b=V,j=b.child,b.tag===22&&b.memoizedState!==null?jk(c):j!==null?(j.return=b,V=j):jk(c);for(;g!==null;)V=g,ik(g),g=g.sibling;V=c,Jj=_,U=_e}kk(s)}else c.subtreeFlags&8772&&g!==null?(g.return=c,V=g):kk(s)}}function kk(s){for(;V!==null;){var e=V;if(e.flags&8772){var o=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:U||Qj(5,e);break;case 1:var a=e.stateNode;if(e.flags&4&&!U)if(o===null)a.componentDidMount();else{var c=e.elementType===e.type?o.memoizedProps:Ci(e.type,o.memoizedProps);a.componentDidUpdate(c,o.memoizedState,a.__reactInternalSnapshotBeforeUpdate)}var g=e.updateQueue;g!==null&&sh(e,g,a);break;case 3:var b=e.updateQueue;if(b!==null){if(o=null,e.child!==null)switch(e.child.tag){case 5:o=e.child.stateNode;break;case 1:o=e.child.stateNode}sh(e,b,o)}break;case 5:var _=e.stateNode;if(o===null&&e.flags&4){o=_;var j=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":j.autoFocus&&o.focus();break;case"img":j.src&&(o.src=j.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var _e=e.alternate;if(_e!==null){var tt=_e.memoizedState;if(tt!==null){var et=tt.dehydrated;et!==null&&bd(et)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(p$1(163))}U||e.flags&512&&Rj(e)}catch(nt){W(e,e.return,nt)}}if(e===s){V=null;break}if(o=e.sibling,o!==null){o.return=e.return,V=o;break}V=e.return}}function gk(s){for(;V!==null;){var e=V;if(e===s){V=null;break}var o=e.sibling;if(o!==null){o.return=e.return,V=o;break}V=e.return}}function jk(s){for(;V!==null;){var e=V;try{switch(e.tag){case 0:case 11:case 15:var o=e.return;try{Qj(4,e)}catch(j){W(e,o,j)}break;case 1:var a=e.stateNode;if(typeof a.componentDidMount=="function"){var c=e.return;try{a.componentDidMount()}catch(j){W(e,c,j)}}var g=e.return;try{Rj(e)}catch(j){W(e,g,j)}break;case 5:var b=e.return;try{Rj(e)}catch(j){W(e,b,j)}}}catch(j){W(e,e.return,j)}if(e===s){V=null;break}var _=e.sibling;if(_!==null){_.return=e.return,V=_;break}V=e.return}}var lk=Math.ceil,mk=ua.ReactCurrentDispatcher,nk=ua.ReactCurrentOwner,ok=ua.ReactCurrentBatchConfig,K=0,Q=null,Y=null,Z=0,fj=0,ej=Uf(0),T=0,pk=null,rh=0,qk=0,rk=0,sk=null,tk=null,fk=0,Gj=1/0,uk=null,Oi=!1,Pi=null,Ri=null,vk=!1,wk=null,xk=0,yk=0,zk=null,Ak=-1,Bk=0;function R(){return K&6?B():Ak!==-1?Ak:Ak=B()}function yi(s){return s.mode&1?K&2&&Z!==0?Z&-Z:Kg.transition!==null?(Bk===0&&(Bk=yc()),Bk):(s=C,s!==0||(s=window.event,s=s===void 0?16:jd(s.type)),s):1}function gi(s,e,o,a){if(50<yk)throw yk=0,zk=null,Error(p$1(185));Ac(s,o,a),(!(K&2)||s!==Q)&&(s===Q&&(!(K&2)&&(qk|=o),T===4&&Ck(s,Z)),Dk(s,a),o===1&&K===0&&!(e.mode&1)&&(Gj=B()+500,fg&&jg()))}function Dk(s,e){var o=s.callbackNode;wc(s,e);var a=uc(s,s===Q?Z:0);if(a===0)o!==null&&bc(o),s.callbackNode=null,s.callbackPriority=0;else if(e=a&-a,s.callbackPriority!==e){if(o!=null&&bc(o),e===1)s.tag===0?ig(Ek.bind(null,s)):hg(Ek.bind(null,s)),Jf(function(){!(K&6)&&jg()}),o=null;else{switch(Dc(a)){case 1:o=fc;break;case 4:o=gc;break;case 16:o=hc;break;case 536870912:o=jc;break;default:o=hc}o=Fk(o,Gk.bind(null,s))}s.callbackPriority=e,s.callbackNode=o}}function Gk(s,e){if(Ak=-1,Bk=0,K&6)throw Error(p$1(327));var o=s.callbackNode;if(Hk()&&s.callbackNode!==o)return null;var a=uc(s,s===Q?Z:0);if(a===0)return null;if(a&30||a&s.expiredLanes||e)e=Ik(s,a);else{e=a;var c=K;K|=2;var g=Jk();(Q!==s||Z!==e)&&(uk=null,Gj=B()+500,Kk(s,e));do try{Lk();break}catch(_){Mk(s,_)}while(!0);$g(),mk.current=g,K=c,Y!==null?e=0:(Q=null,Z=0,e=T)}if(e!==0){if(e===2&&(c=xc(s),c!==0&&(a=c,e=Nk(s,c))),e===1)throw o=pk,Kk(s,0),Ck(s,a),Dk(s,B()),o;if(e===6)Ck(s,a);else{if(c=s.current.alternate,!(a&30)&&!Ok(c)&&(e=Ik(s,a),e===2&&(g=xc(s),g!==0&&(a=g,e=Nk(s,g))),e===1))throw o=pk,Kk(s,0),Ck(s,a),Dk(s,B()),o;switch(s.finishedWork=c,s.finishedLanes=a,e){case 0:case 1:throw Error(p$1(345));case 2:Pk(s,tk,uk);break;case 3:if(Ck(s,a),(a&130023424)===a&&(e=fk+500-B(),10<e)){if(uc(s,0)!==0)break;if(c=s.suspendedLanes,(c&a)!==a){R(),s.pingedLanes|=s.suspendedLanes&c;break}s.timeoutHandle=Ff(Pk.bind(null,s,tk,uk),e);break}Pk(s,tk,uk);break;case 4:if(Ck(s,a),(a&4194240)===a)break;for(e=s.eventTimes,c=-1;0<a;){var b=31-oc(a);g=1<<b,b=e[b],b>c&&(c=b),a&=~g}if(a=c,a=B()-a,a=(120>a?120:480>a?480:1080>a?1080:1920>a?1920:3e3>a?3e3:4320>a?4320:1960*lk(a/1960))-a,10<a){s.timeoutHandle=Ff(Pk.bind(null,s,tk,uk),a);break}Pk(s,tk,uk);break;case 5:Pk(s,tk,uk);break;default:throw Error(p$1(329))}}}return Dk(s,B()),s.callbackNode===o?Gk.bind(null,s):null}function Nk(s,e){var o=sk;return s.current.memoizedState.isDehydrated&&(Kk(s,e).flags|=256),s=Ik(s,e),s!==2&&(e=tk,tk=o,e!==null&&Fj(e)),s}function Fj(s){tk===null?tk=s:tk.push.apply(tk,s)}function Ok(s){for(var e=s;;){if(e.flags&16384){var o=e.updateQueue;if(o!==null&&(o=o.stores,o!==null))for(var a=0;a<o.length;a++){var c=o[a],g=c.getSnapshot;c=c.value;try{if(!He(g(),c))return!1}catch{return!1}}}if(o=e.child,e.subtreeFlags&16384&&o!==null)o.return=e,e=o;else{if(e===s)break;for(;e.sibling===null;){if(e.return===null||e.return===s)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Ck(s,e){for(e&=~rk,e&=~qk,s.suspendedLanes|=e,s.pingedLanes&=~e,s=s.expirationTimes;0<e;){var o=31-oc(e),a=1<<o;s[o]=-1,e&=~a}}function Ek(s){if(K&6)throw Error(p$1(327));Hk();var e=uc(s,0);if(!(e&1))return Dk(s,B()),null;var o=Ik(s,e);if(s.tag!==0&&o===2){var a=xc(s);a!==0&&(e=a,o=Nk(s,a))}if(o===1)throw o=pk,Kk(s,0),Ck(s,e),Dk(s,B()),o;if(o===6)throw Error(p$1(345));return s.finishedWork=s.current.alternate,s.finishedLanes=e,Pk(s,tk,uk),Dk(s,B()),null}function Qk(s,e){var o=K;K|=1;try{return s(e)}finally{K=o,K===0&&(Gj=B()+500,fg&&jg())}}function Rk(s){wk!==null&&wk.tag===0&&!(K&6)&&Hk();var e=K;K|=1;var o=ok.transition,a=C;try{if(ok.transition=null,C=1,s)return s()}finally{C=a,ok.transition=o,K=e,!(K&6)&&jg()}}function Hj(){fj=ej.current,E(ej)}function Kk(s,e){s.finishedWork=null,s.finishedLanes=0;var o=s.timeoutHandle;if(o!==-1&&(s.timeoutHandle=-1,Gf(o)),Y!==null)for(o=Y.return;o!==null;){var a=o;switch(wg(a),a.tag){case 1:a=a.type.childContextTypes,a!=null&&$f();break;case 3:zh(),E(Wf),E(H$1),Eh();break;case 5:Bh(a);break;case 4:zh();break;case 13:E(L);break;case 19:E(L);break;case 10:ah(a.type._context);break;case 22:case 23:Hj()}o=o.return}if(Q=s,Y=s=Pg(s.current,null),Z=fj=e,T=0,pk=null,rk=qk=rh=0,tk=sk=null,fh!==null){for(e=0;e<fh.length;e++)if(o=fh[e],a=o.interleaved,a!==null){o.interleaved=null;var c=a.next,g=o.pending;if(g!==null){var b=g.next;g.next=c,a.next=b}o.pending=a}fh=null}return s}function Mk(s,e){do{var o=Y;try{if($g(),Fh.current=Rh,Ih){for(var a=M$1.memoizedState;a!==null;){var c=a.queue;c!==null&&(c.pending=null),a=a.next}Ih=!1}if(Hh=0,O$1=N=M$1=null,Jh=!1,Kh=0,nk.current=null,o===null||o.return===null){T=1,pk=e,Y=null;break}e:{var g=s,b=o.return,_=o,j=e;if(e=Z,_.flags|=32768,j!==null&&typeof j=="object"&&typeof j.then=="function"){var _e=j,tt=_,et=tt.tag;if(!(tt.mode&1)&&(et===0||et===11||et===15)){var nt=tt.alternate;nt?(tt.updateQueue=nt.updateQueue,tt.memoizedState=nt.memoizedState,tt.lanes=nt.lanes):(tt.updateQueue=null,tt.memoizedState=null)}var rt=Ui(b);if(rt!==null){rt.flags&=-257,Vi(rt,b,_,g,e),rt.mode&1&&Si(g,_e,e),e=rt,j=_e;var it=e.updateQueue;if(it===null){var st=new Set;st.add(j),e.updateQueue=st}else it.add(j);break e}else{if(!(e&1)){Si(g,_e,e),tj();break e}j=Error(p$1(426))}}else if(I&&_.mode&1){var lt=Ui(b);if(lt!==null){!(lt.flags&65536)&&(lt.flags|=256),Vi(lt,b,_,g,e),Jg(Ji(j,_));break e}}g=j=Ji(j,_),T!==4&&(T=2),sk===null?sk=[g]:sk.push(g),g=b;do{switch(g.tag){case 3:g.flags|=65536,e&=-e,g.lanes|=e;var at=Ni(g,j,e);ph(g,at);break e;case 1:_=j;var ct=g.type,ft=g.stateNode;if(!(g.flags&128)&&(typeof ct.getDerivedStateFromError=="function"||ft!==null&&typeof ft.componentDidCatch=="function"&&(Ri===null||!Ri.has(ft)))){g.flags|=65536,e&=-e,g.lanes|=e;var vt=Qi(g,_,e);ph(g,vt);break e}}g=g.return}while(g!==null)}Sk(o)}catch(Rt){e=Rt,Y===o&&o!==null&&(Y=o=o.return);continue}break}while(!0)}function Jk(){var s=mk.current;return mk.current=Rh,s===null?Rh:s}function tj(){(T===0||T===3||T===2)&&(T=4),Q===null||!(rh&268435455)&&!(qk&268435455)||Ck(Q,Z)}function Ik(s,e){var o=K;K|=2;var a=Jk();(Q!==s||Z!==e)&&(uk=null,Kk(s,e));do try{Tk();break}catch(c){Mk(s,c)}while(!0);if($g(),K=o,mk.current=a,Y!==null)throw Error(p$1(261));return Q=null,Z=0,T}function Tk(){for(;Y!==null;)Uk(Y)}function Lk(){for(;Y!==null&&!cc();)Uk(Y)}function Uk(s){var e=Vk(s.alternate,s,fj);s.memoizedProps=s.pendingProps,e===null?Sk(s):Y=e,nk.current=null}function Sk(s){var e=s;do{var o=e.alternate;if(s=e.return,e.flags&32768){if(o=Ij(o,e),o!==null){o.flags&=32767,Y=o;return}if(s!==null)s.flags|=32768,s.subtreeFlags=0,s.deletions=null;else{T=6,Y=null;return}}else if(o=Ej(o,e,fj),o!==null){Y=o;return}if(e=e.sibling,e!==null){Y=e;return}Y=e=s}while(e!==null);T===0&&(T=5)}function Pk(s,e,o){var a=C,c=ok.transition;try{ok.transition=null,C=1,Wk(s,e,o,a)}finally{ok.transition=c,C=a}return null}function Wk(s,e,o,a){do Hk();while(wk!==null);if(K&6)throw Error(p$1(327));o=s.finishedWork;var c=s.finishedLanes;if(o===null)return null;if(s.finishedWork=null,s.finishedLanes=0,o===s.current)throw Error(p$1(177));s.callbackNode=null,s.callbackPriority=0;var g=o.lanes|o.childLanes;if(Bc(s,g),s===Q&&(Y=Q=null,Z=0),!(o.subtreeFlags&2064)&&!(o.flags&2064)||vk||(vk=!0,Fk(hc,function(){return Hk(),null})),g=(o.flags&15990)!==0,o.subtreeFlags&15990||g){g=ok.transition,ok.transition=null;var b=C;C=1;var _=K;K|=4,nk.current=null,Oj(s,o),dk(o,s),Oe(Df),dd=!!Cf,Df=Cf=null,s.current=o,hk(o),dc(),K=_,C=b,ok.transition=g}else s.current=o;if(vk&&(vk=!1,wk=s,xk=c),g=s.pendingLanes,g===0&&(Ri=null),mc(o.stateNode),Dk(s,B()),e!==null)for(a=s.onRecoverableError,o=0;o<e.length;o++)c=e[o],a(c.value,{componentStack:c.stack,digest:c.digest});if(Oi)throw Oi=!1,s=Pi,Pi=null,s;return xk&1&&s.tag!==0&&Hk(),g=s.pendingLanes,g&1?s===zk?yk++:(yk=0,zk=s):yk=0,jg(),null}function Hk(){if(wk!==null){var s=Dc(xk),e=ok.transition,o=C;try{if(ok.transition=null,C=16>s?16:s,wk===null)var a=!1;else{if(s=wk,wk=null,xk=0,K&6)throw Error(p$1(331));var c=K;for(K|=4,V=s.current;V!==null;){var g=V,b=g.child;if(V.flags&16){var _=g.deletions;if(_!==null){for(var j=0;j<_.length;j++){var _e=_[j];for(V=_e;V!==null;){var tt=V;switch(tt.tag){case 0:case 11:case 15:Pj(8,tt,g)}var et=tt.child;if(et!==null)et.return=tt,V=et;else for(;V!==null;){tt=V;var nt=tt.sibling,rt=tt.return;if(Sj(tt),tt===_e){V=null;break}if(nt!==null){nt.return=rt,V=nt;break}V=rt}}}var it=g.alternate;if(it!==null){var st=it.child;if(st!==null){it.child=null;do{var lt=st.sibling;st.sibling=null,st=lt}while(st!==null)}}V=g}}if(g.subtreeFlags&2064&&b!==null)b.return=g,V=b;else e:for(;V!==null;){if(g=V,g.flags&2048)switch(g.tag){case 0:case 11:case 15:Pj(9,g,g.return)}var at=g.sibling;if(at!==null){at.return=g.return,V=at;break e}V=g.return}}var ct=s.current;for(V=ct;V!==null;){b=V;var ft=b.child;if(b.subtreeFlags&2064&&ft!==null)ft.return=b,V=ft;else e:for(b=ct;V!==null;){if(_=V,_.flags&2048)try{switch(_.tag){case 0:case 11:case 15:Qj(9,_)}}catch(Rt){W(_,_.return,Rt)}if(_===b){V=null;break e}var vt=_.sibling;if(vt!==null){vt.return=_.return,V=vt;break e}V=_.return}}if(K=c,jg(),lc&&typeof lc.onPostCommitFiberRoot=="function")try{lc.onPostCommitFiberRoot(kc,s)}catch{}a=!0}return a}finally{C=o,ok.transition=e}}return!1}function Xk(s,e,o){e=Ji(o,e),e=Ni(s,e,1),s=nh(s,e,1),e=R(),s!==null&&(Ac(s,1,e),Dk(s,e))}function W(s,e,o){if(s.tag===3)Xk(s,s,o);else for(;e!==null;){if(e.tag===3){Xk(e,s,o);break}else if(e.tag===1){var a=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof a.componentDidCatch=="function"&&(Ri===null||!Ri.has(a))){s=Ji(o,s),s=Qi(e,s,1),e=nh(e,s,1),s=R(),e!==null&&(Ac(e,1,s),Dk(e,s));break}}e=e.return}}function Ti(s,e,o){var a=s.pingCache;a!==null&&a.delete(e),e=R(),s.pingedLanes|=s.suspendedLanes&o,Q===s&&(Z&o)===o&&(T===4||T===3&&(Z&130023424)===Z&&500>B()-fk?Kk(s,0):rk|=o),Dk(s,e)}function Yk(s,e){e===0&&(s.mode&1?(e=sc,sc<<=1,!(sc&130023424)&&(sc=4194304)):e=1);var o=R();s=ih(s,e),s!==null&&(Ac(s,e,o),Dk(s,o))}function uj(s){var e=s.memoizedState,o=0;e!==null&&(o=e.retryLane),Yk(s,o)}function bk(s,e){var o=0;switch(s.tag){case 13:var a=s.stateNode,c=s.memoizedState;c!==null&&(o=c.retryLane);break;case 19:a=s.stateNode;break;default:throw Error(p$1(314))}a!==null&&a.delete(e),Yk(s,o)}var Vk;Vk=function(s,e,o){if(s!==null)if(s.memoizedProps!==e.pendingProps||Wf.current)dh=!0;else{if(!(s.lanes&o)&&!(e.flags&128))return dh=!1,yj(s,e,o);dh=!!(s.flags&131072)}else dh=!1,I&&e.flags&1048576&&ug(e,ng,e.index);switch(e.lanes=0,e.tag){case 2:var a=e.type;ij(s,e),s=e.pendingProps;var c=Yf(e,H$1.current);ch(e,o),c=Nh(null,e,a,s,c,o);var g=Sh();return e.flags|=1,typeof c=="object"&&c!==null&&typeof c.render=="function"&&c.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Zf(a)?(g=!0,cg(e)):g=!1,e.memoizedState=c.state!==null&&c.state!==void 0?c.state:null,kh(e),c.updater=Ei,e.stateNode=c,c._reactInternals=e,Ii(e,a,s,o),e=jj(null,e,a,!0,g,o)):(e.tag=0,I&&g&&vg(e),Xi(null,e,c,o),e=e.child),e;case 16:a=e.elementType;e:{switch(ij(s,e),s=e.pendingProps,c=a._init,a=c(a._payload),e.type=a,c=e.tag=Zk(a),s=Ci(a,s),c){case 0:e=cj(null,e,a,s,o);break e;case 1:e=hj(null,e,a,s,o);break e;case 11:e=Yi(null,e,a,s,o);break e;case 14:e=$i(null,e,a,Ci(a.type,s),o);break e}throw Error(p$1(306,a,""))}return e;case 0:return a=e.type,c=e.pendingProps,c=e.elementType===a?c:Ci(a,c),cj(s,e,a,c,o);case 1:return a=e.type,c=e.pendingProps,c=e.elementType===a?c:Ci(a,c),hj(s,e,a,c,o);case 3:e:{if(kj(e),s===null)throw Error(p$1(387));a=e.pendingProps,g=e.memoizedState,c=g.element,lh(s,e),qh(e,a,null,o);var b=e.memoizedState;if(a=b.element,g.isDehydrated)if(g={element:a,isDehydrated:!1,cache:b.cache,pendingSuspenseBoundaries:b.pendingSuspenseBoundaries,transitions:b.transitions},e.updateQueue.baseState=g,e.memoizedState=g,e.flags&256){c=Ji(Error(p$1(423)),e),e=lj(s,e,a,o,c);break e}else if(a!==c){c=Ji(Error(p$1(424)),e),e=lj(s,e,a,o,c);break e}else for(yg=Lf(e.stateNode.containerInfo.firstChild),xg=e,I=!0,zg=null,o=Vg(e,null,a,o),e.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling;else{if(Ig(),a===c){e=Zi(s,e,o);break e}Xi(s,e,a,o)}e=e.child}return e;case 5:return Ah(e),s===null&&Eg(e),a=e.type,c=e.pendingProps,g=s!==null?s.memoizedProps:null,b=c.children,Ef(a,c)?b=null:g!==null&&Ef(a,g)&&(e.flags|=32),gj(s,e),Xi(s,e,b,o),e.child;case 6:return s===null&&Eg(e),null;case 13:return oj(s,e,o);case 4:return yh(e,e.stateNode.containerInfo),a=e.pendingProps,s===null?e.child=Ug(e,null,a,o):Xi(s,e,a,o),e.child;case 11:return a=e.type,c=e.pendingProps,c=e.elementType===a?c:Ci(a,c),Yi(s,e,a,c,o);case 7:return Xi(s,e,e.pendingProps,o),e.child;case 8:return Xi(s,e,e.pendingProps.children,o),e.child;case 12:return Xi(s,e,e.pendingProps.children,o),e.child;case 10:e:{if(a=e.type._context,c=e.pendingProps,g=e.memoizedProps,b=c.value,G(Wg,a._currentValue),a._currentValue=b,g!==null)if(He(g.value,b)){if(g.children===c.children&&!Wf.current){e=Zi(s,e,o);break e}}else for(g=e.child,g!==null&&(g.return=e);g!==null;){var _=g.dependencies;if(_!==null){b=g.child;for(var j=_.firstContext;j!==null;){if(j.context===a){if(g.tag===1){j=mh(-1,o&-o),j.tag=2;var _e=g.updateQueue;if(_e!==null){_e=_e.shared;var tt=_e.pending;tt===null?j.next=j:(j.next=tt.next,tt.next=j),_e.pending=j}}g.lanes|=o,j=g.alternate,j!==null&&(j.lanes|=o),bh(g.return,o,e),_.lanes|=o;break}j=j.next}}else if(g.tag===10)b=g.type===e.type?null:g.child;else if(g.tag===18){if(b=g.return,b===null)throw Error(p$1(341));b.lanes|=o,_=b.alternate,_!==null&&(_.lanes|=o),bh(b,o,e),b=g.sibling}else b=g.child;if(b!==null)b.return=g;else for(b=g;b!==null;){if(b===e){b=null;break}if(g=b.sibling,g!==null){g.return=b.return,b=g;break}b=b.return}g=b}Xi(s,e,c.children,o),e=e.child}return e;case 9:return c=e.type,a=e.pendingProps.children,ch(e,o),c=eh(c),a=a(c),e.flags|=1,Xi(s,e,a,o),e.child;case 14:return a=e.type,c=Ci(a,e.pendingProps),c=Ci(a.type,c),$i(s,e,a,c,o);case 15:return bj(s,e,e.type,e.pendingProps,o);case 17:return a=e.type,c=e.pendingProps,c=e.elementType===a?c:Ci(a,c),ij(s,e),e.tag=1,Zf(a)?(s=!0,cg(e)):s=!1,ch(e,o),Gi(e,a,c),Ii(e,a,c,o),jj(null,e,a,!0,s,o);case 19:return xj(s,e,o);case 22:return dj(s,e,o)}throw Error(p$1(156,e.tag))};function Fk(s,e){return ac(s,e)}function $k(s,e,o,a){this.tag=s,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=a,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg(s,e,o,a){return new $k(s,e,o,a)}function aj(s){return s=s.prototype,!(!s||!s.isReactComponent)}function Zk(s){if(typeof s=="function")return aj(s)?1:0;if(s!=null){if(s=s.$$typeof,s===Da)return 11;if(s===Ga)return 14}return 2}function Pg(s,e){var o=s.alternate;return o===null?(o=Bg(s.tag,e,s.key,s.mode),o.elementType=s.elementType,o.type=s.type,o.stateNode=s.stateNode,o.alternate=s,s.alternate=o):(o.pendingProps=e,o.type=s.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=s.flags&14680064,o.childLanes=s.childLanes,o.lanes=s.lanes,o.child=s.child,o.memoizedProps=s.memoizedProps,o.memoizedState=s.memoizedState,o.updateQueue=s.updateQueue,e=s.dependencies,o.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},o.sibling=s.sibling,o.index=s.index,o.ref=s.ref,o}function Rg(s,e,o,a,c,g){var b=2;if(a=s,typeof s=="function")aj(s)&&(b=1);else if(typeof s=="string")b=5;else e:switch(s){case ya:return Tg(o.children,c,g,e);case za:b=8,c|=8;break;case Aa:return s=Bg(12,o,e,c|2),s.elementType=Aa,s.lanes=g,s;case Ea:return s=Bg(13,o,e,c),s.elementType=Ea,s.lanes=g,s;case Fa:return s=Bg(19,o,e,c),s.elementType=Fa,s.lanes=g,s;case Ia:return pj(o,c,g,e);default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case Ba:b=10;break e;case Ca:b=9;break e;case Da:b=11;break e;case Ga:b=14;break e;case Ha:b=16,a=null;break e}throw Error(p$1(130,s==null?s:typeof s,""))}return e=Bg(b,o,e,c),e.elementType=s,e.type=a,e.lanes=g,e}function Tg(s,e,o,a){return s=Bg(7,s,a,e),s.lanes=o,s}function pj(s,e,o,a){return s=Bg(22,s,a,e),s.elementType=Ia,s.lanes=o,s.stateNode={isHidden:!1},s}function Qg(s,e,o){return s=Bg(6,s,null,e),s.lanes=o,s}function Sg(s,e,o){return e=Bg(4,s.children!==null?s.children:[],s.key,e),e.lanes=o,e.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},e}function al(s,e,o,a,c){this.tag=e,this.containerInfo=s,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc(0),this.expirationTimes=zc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc(0),this.identifierPrefix=a,this.onRecoverableError=c,this.mutableSourceEagerHydrationData=null}function bl(s,e,o,a,c,g,b,_,j){return s=new al(s,e,o,_,j),e===1?(e=1,g===!0&&(e|=8)):e=0,g=Bg(3,null,null,e),s.current=g,g.stateNode=s,g.memoizedState={element:a,isDehydrated:o,cache:null,transitions:null,pendingSuspenseBoundaries:null},kh(g),s}function cl(s,e,o){var a=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa,key:a==null?null:""+a,children:s,containerInfo:e,implementation:o}}function dl(s){if(!s)return Vf;s=s._reactInternals;e:{if(Vb(s)!==s||s.tag!==1)throw Error(p$1(170));var e=s;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Zf(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(p$1(171))}if(s.tag===1){var o=s.type;if(Zf(o))return bg(s,o,e)}return e}function el$1(s,e,o,a,c,g,b,_,j){return s=bl(o,a,!0,s,c,g,b,_,j),s.context=dl(null),o=s.current,a=R(),c=yi(o),g=mh(a,c),g.callback=e??null,nh(o,g,c),s.current.lanes=c,Ac(s,c,a),Dk(s,a),s}function fl(s,e,o,a){var c=e.current,g=R(),b=yi(c);return o=dl(o),e.context===null?e.context=o:e.pendingContext=o,e=mh(g,b),e.payload={element:s},a=a===void 0?null:a,a!==null&&(e.callback=a),s=nh(c,e,b),s!==null&&(gi(s,c,b,g),oh(s,c,b)),b}function gl(s){if(s=s.current,!s.child)return null;switch(s.child.tag){case 5:return s.child.stateNode;default:return s.child.stateNode}}function hl(s,e){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var o=s.retryLane;s.retryLane=o!==0&&o<e?o:e}}function il(s,e){hl(s,e),(s=s.alternate)&&hl(s,e)}function jl(){return null}var kl=typeof reportError=="function"?reportError:function(s){console.error(s)};function ll(s){this._internalRoot=s}ml.prototype.render=ll.prototype.render=function(s){var e=this._internalRoot;if(e===null)throw Error(p$1(409));fl(s,e,null,null)};ml.prototype.unmount=ll.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var e=s.containerInfo;Rk(function(){fl(null,s,null,null)}),e[uf]=null}};function ml(s){this._internalRoot=s}ml.prototype.unstable_scheduleHydration=function(s){if(s){var e=Hc();s={blockedOn:null,target:s,priority:e};for(var o=0;o<Qc.length&&e!==0&&e<Qc[o].priority;o++);Qc.splice(o,0,s),o===0&&Vc(s)}};function nl(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function ol(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11&&(s.nodeType!==8||s.nodeValue!==" react-mount-point-unstable "))}function pl(){}function ql(s,e,o,a,c){if(c){if(typeof a=="function"){var g=a;a=function(){var _e=gl(b);g.call(_e)}}var b=el$1(e,a,s,0,null,!1,!1,"",pl);return s._reactRootContainer=b,s[uf]=b.current,sf(s.nodeType===8?s.parentNode:s),Rk(),b}for(;c=s.lastChild;)s.removeChild(c);if(typeof a=="function"){var _=a;a=function(){var _e=gl(j);_.call(_e)}}var j=bl(s,0,!1,null,null,!1,!1,"",pl);return s._reactRootContainer=j,s[uf]=j.current,sf(s.nodeType===8?s.parentNode:s),Rk(function(){fl(e,j,o,a)}),j}function rl(s,e,o,a,c){var g=o._reactRootContainer;if(g){var b=g;if(typeof c=="function"){var _=c;c=function(){var j=gl(b);_.call(j)}}fl(e,b,s,c)}else b=ql(o,e,s,c,a);return gl(b)}Ec=function(s){switch(s.tag){case 3:var e=s.stateNode;if(e.current.memoizedState.isDehydrated){var o=tc(e.pendingLanes);o!==0&&(Cc(e,o|1),Dk(e,B()),!(K&6)&&(Gj=B()+500,jg()))}break;case 13:Rk(function(){var a=ih(s,1);if(a!==null){var c=R();gi(a,s,1,c)}}),il(s,1)}};Fc=function(s){if(s.tag===13){var e=ih(s,134217728);if(e!==null){var o=R();gi(e,s,134217728,o)}il(s,134217728)}};Gc=function(s){if(s.tag===13){var e=yi(s),o=ih(s,e);if(o!==null){var a=R();gi(o,s,e,a)}il(s,e)}};Hc=function(){return C};Ic=function(s,e){var o=C;try{return C=s,e()}finally{C=o}};yb=function(s,e,o){switch(e){case"input":if(bb(s,o),e=o.name,o.type==="radio"&&e!=null){for(o=s;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<o.length;e++){var a=o[e];if(a!==s&&a.form===s.form){var c=Db(a);if(!c)throw Error(p$1(90));Wa(a),bb(a,c)}}}break;case"textarea":ib(s,o);break;case"select":e=o.value,e!=null&&fb(s,!!o.multiple,e,!1)}};Gb=Qk;Hb=Rk;var sl={usingClientEntryPoint:!1,Events:[Cb,ue,Db,Eb,Fb,Qk]},tl={findFiberByHostInstance:Wc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ul={bundleType:tl.bundleType,version:tl.version,rendererPackageName:tl.rendererPackageName,rendererConfig:tl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua.ReactCurrentDispatcher,findHostInstanceByFiber:function(s){return s=Zb(s),s===null?null:s.stateNode},findFiberByHostInstance:tl.findFiberByHostInstance||jl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vl.isDisabled&&vl.supportsFiber)try{kc=vl.inject(ul),lc=vl}catch{}}reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sl;reactDom_production_min.createPortal=function(s,e){var o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!nl(e))throw Error(p$1(200));return cl(s,e,null,o)};reactDom_production_min.createRoot=function(s,e){if(!nl(s))throw Error(p$1(299));var o=!1,a="",c=kl;return e!=null&&(e.unstable_strictMode===!0&&(o=!0),e.identifierPrefix!==void 0&&(a=e.identifierPrefix),e.onRecoverableError!==void 0&&(c=e.onRecoverableError)),e=bl(s,1,!1,null,null,o,!1,a,c),s[uf]=e.current,sf(s.nodeType===8?s.parentNode:s),new ll(e)};reactDom_production_min.findDOMNode=function(s){if(s==null)return null;if(s.nodeType===1)return s;var e=s._reactInternals;if(e===void 0)throw typeof s.render=="function"?Error(p$1(188)):(s=Object.keys(s).join(","),Error(p$1(268,s)));return s=Zb(e),s=s===null?null:s.stateNode,s};reactDom_production_min.flushSync=function(s){return Rk(s)};reactDom_production_min.hydrate=function(s,e,o){if(!ol(e))throw Error(p$1(200));return rl(null,s,e,!0,o)};reactDom_production_min.hydrateRoot=function(s,e,o){if(!nl(s))throw Error(p$1(405));var a=o!=null&&o.hydratedSources||null,c=!1,g="",b=kl;if(o!=null&&(o.unstable_strictMode===!0&&(c=!0),o.identifierPrefix!==void 0&&(g=o.identifierPrefix),o.onRecoverableError!==void 0&&(b=o.onRecoverableError)),e=el$1(e,null,s,1,o??null,c,!1,g,b),s[uf]=e.current,sf(s),a)for(s=0;s<a.length;s++)o=a[s],c=o._getVersion,c=c(o._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[o,c]:e.mutableSourceEagerHydrationData.push(o,c);return new ml(e)};reactDom_production_min.render=function(s,e,o){if(!ol(e))throw Error(p$1(200));return rl(null,s,e,!1,o)};reactDom_production_min.unmountComponentAtNode=function(s){if(!ol(s))throw Error(p$1(40));return s._reactRootContainer?(Rk(function(){rl(null,null,s,!1,function(){s._reactRootContainer=null,s[uf]=null})}),!0):!1};reactDom_production_min.unstable_batchedUpdates=Qk;reactDom_production_min.unstable_renderSubtreeIntoContainer=function(s,e,o,a){if(!ol(o))throw Error(p$1(200));if(s==null||s._reactInternals===void 0)throw Error(p$1(38));return rl(s,e,o,!1,a)};reactDom_production_min.version="18.3.1-next-f1338f8080-20240426";function checkDCE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch(s){console.error(s)}}checkDCE(),reactDom.exports=reactDom_production_min;var reactDomExports=reactDom.exports,createRoot,m=reactDomExports;createRoot=m.createRoot,m.hydrateRoot;var lib$1={},types={};Object.defineProperty(types,"__esModule",{value:!0});var ee={},taskCollection$1={},taskCollection={},utils$3={};Object.defineProperty(utils$3,"__esModule",{value:!0});utils$3._fast_remove_single=void 0;function _fast_remove_single(s,e){e!==-1&&(e===0?s.shift():e===s.length-1?s.length=s.length-1:s.splice(e,1))}utils$3._fast_remove_single=_fast_remove_single;var bakeCollection={};(function(exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.bakeCollectionVariadic=exports.bakeCollectionAwait=exports.bakeCollection=exports.BAKED_EMPTY_FUNC=void 0,exports.BAKED_EMPTY_FUNC=function(){};var FORLOOP_FALLBACK=1500;function generateArgsDefCode(s){var e="";if(s===0)return e;for(var o=0;o<s-1;++o)e+="arg"+String(o)+", ";return e+="arg"+String(s-1),e}function generateBodyPartsCode(s,e){for(var o="",a="",c=0;c<e;++c)o+="var f".concat(c," = collection[").concat(c,`];
`),a+="f".concat(c,"(").concat(s,`)
`);return{funcDefCode:o,funcCallCode:a}}function generateBodyPartsVariadicCode(s){for(var e="",o="",a=0;a<s;++a)e+="var f".concat(a," = collection[").concat(a,`];
`),o+="f".concat(a,`.apply(undefined, arguments)
`);return{funcDefCode:e,funcCallCode:o}}function bakeCollection(collection,fixedArgsNum){if(collection.length===0)return exports.BAKED_EMPTY_FUNC;if(collection.length===1)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var argsDefCode=generateArgsDefCode(fixedArgsNum),_a=generateBodyPartsCode(argsDefCode,collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode=`(function(collection) {
            `.concat(funcDefCode,`
            collection = undefined;
            return (function(`).concat(argsDefCode,`) {
                `).concat(funcCallCode,`
            });
        })`)}else{var argsDefCode=generateArgsDefCode(fixedArgsNum);collection.length%10===0?funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; i += 10) {
                        collection[i](`).concat(argsDefCode,`);
                        collection[i+1](`).concat(argsDefCode,`);
                        collection[i+2](`).concat(argsDefCode,`);
                        collection[i+3](`).concat(argsDefCode,`);
                        collection[i+4](`).concat(argsDefCode,`);
                        collection[i+5](`).concat(argsDefCode,`);
                        collection[i+6](`).concat(argsDefCode,`);
                        collection[i+7](`).concat(argsDefCode,`);
                        collection[i+8](`).concat(argsDefCode,`);
                        collection[i+9](`).concat(argsDefCode,`);
                    }
                });
            })`):collection.length%4===0?funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; i += 4) {
                        collection[i](`).concat(argsDefCode,`);
                        collection[i+1](`).concat(argsDefCode,`);
                        collection[i+2](`).concat(argsDefCode,`);
                        collection[i+3](`).concat(argsDefCode,`);
                    }
                });
            })`):collection.length%3===0?funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; i += 3) {
                        collection[i](`).concat(argsDefCode,`);
                        collection[i+1](`).concat(argsDefCode,`);
                        collection[i+2](`).concat(argsDefCode,`);
                    }
                });
            })`):funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; ++i) {
                        collection[i](`).concat(argsDefCode,`);
                    }
                });
            })`)}{var funcFactory=eval(funcFactoryCode);return funcFactory(collection)}}exports.bakeCollection=bakeCollection;function bakeCollectionAwait(collection,fixedArgsNum){if(collection.length===0)return exports.BAKED_EMPTY_FUNC;if(collection.length===1)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var argsDefCode=generateArgsDefCode(fixedArgsNum),_a=generateBodyPartsCode(argsDefCode,collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode=`(function(collection) {
            `.concat(funcDefCode,`
            collection = undefined;
            return (function(`).concat(argsDefCode,`) {
                return Promise.all([ `).concat(funcCallCode,` ]);
            });
        })`)}else{var argsDefCode=generateArgsDefCode(fixedArgsNum);funcFactoryCode=`(function(collection) {
            return (function(`.concat(argsDefCode,`) {
                var promises = Array(collection.length);
                for (var i = 0; i < collection.length; ++i) {
                    promises[i] = collection[i](`).concat(argsDefCode,`);
                }
                return Promise.all(promises);
            });
        })`)}{var funcFactory=eval(funcFactoryCode);return funcFactory(collection)}}exports.bakeCollectionAwait=bakeCollectionAwait;function bakeCollectionVariadic(collection){if(collection.length===0)return exports.BAKED_EMPTY_FUNC;if(collection.length===1)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var _a=generateBodyPartsVariadicCode(collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode=`(function(collection) {
            `.concat(funcDefCode,`
            collection = undefined;
            return (function() {
                `).concat(funcCallCode,`
            });
        })`)}else funcFactoryCode=`(function(collection) {
            return (function() {
                for (var i = 0; i < collection.length; ++i) {
                    collection[i].apply(undefined, arguments);
                }
            });
        })`;{var funcFactory=eval(funcFactoryCode);return funcFactory(collection)}}exports.bakeCollectionVariadic=bakeCollectionVariadic})(bakeCollection);var __spreadArray$1=commonjsGlobal&&commonjsGlobal.__spreadArray||function(s,e,o){if(o||arguments.length===2)for(var a=0,c=e.length,g;a<c;a++)(g||!(a in e))&&(g||(g=Array.prototype.slice.call(e,0,a)),g[a]=e[a]);return s.concat(g||Array.prototype.slice.call(e))};Object.defineProperty(taskCollection,"__esModule",{value:!0});taskCollection.TaskCollection=void 0;var utils_1$1=utils$3,bake_collection_1=bakeCollection;function push_norebuild(s,e){var o=this.length;if(o>1)if(e){var a;(a=this._tasks).push.apply(a,arguments),this.length+=arguments.length}else this._tasks.push(s),this.length++;else if(e){if(o===1){var c=Array(1+arguments.length);c.push(c),c.push.apply(c,arguments),this._tasks=c}else{var c=Array(arguments.length);c.push.apply(c,arguments),this._tasks=c}this.length+=arguments.length}else o===1?this._tasks=[this._tasks,s]:this._tasks=s,this.length++}function push_rebuild(s,e){var o=this.length;if(o>1)if(e){var a;(a=this._tasks).push.apply(a,arguments),this.length+=arguments.length}else this._tasks.push(s),this.length++;else if(e){if(o===1){var c=Array(1+arguments.length);c.push(c),c.push.apply(c,arguments),this._tasks=c}else{var c=Array(arguments.length);c.push.apply(c,arguments),this._tasks=c}this.length+=arguments.length}else o===1?this._tasks=[this._tasks,s]:this._tasks=s,this.length++;this.firstEmitBuildStrategy?this.call=rebuild_on_first_call:this.rebuild()}function removeLast_norebuild(s){this.length!==0&&(this.length===1?this._tasks===s&&(this.length=0):((0,utils_1$1._fast_remove_single)(this._tasks,this._tasks.lastIndexOf(s)),this._tasks.length===1?(this._tasks=this._tasks[0],this.length=1):this.length=this._tasks.length))}function removeLast_rebuild(s){if(this.length!==0){if(this.length===1)if(this._tasks===s&&(this.length=0),this.firstEmitBuildStrategy){this.call=bake_collection_1.BAKED_EMPTY_FUNC;return}else{this.rebuild();return}else(0,utils_1$1._fast_remove_single)(this._tasks,this._tasks.lastIndexOf(s)),this._tasks.length===1?(this._tasks=this._tasks[0],this.length=1):this.length=this._tasks.length;this.firstEmitBuildStrategy?this.call=rebuild_on_first_call:this.rebuild()}}function insert_norebuild(s){for(var e,o=[],a=1;a<arguments.length;a++)o[a-1]=arguments[a];this.length===0?(this._tasks=o,this.length=1):this.length===1?(o.unshift(this._tasks),this._tasks=o,this.length=this._tasks.length):((e=this._tasks).splice.apply(e,__spreadArray$1([s,0],o,!1)),this.length=this._tasks.length)}function insert_rebuild(s){for(var e,o=[],a=1;a<arguments.length;a++)o[a-1]=arguments[a];this.length===0?(this._tasks=o,this.length=1):this.length===1?(o.unshift(this._tasks),this._tasks=o,this.length=this._tasks.length):((e=this._tasks).splice.apply(e,__spreadArray$1([s,0],o,!1)),this.length=this._tasks.length),this.firstEmitBuildStrategy?this.call=rebuild_on_first_call:this.rebuild()}function rebuild_noawait(){this.length===0?this.call=bake_collection_1.BAKED_EMPTY_FUNC:this.length===1?this.call=this._tasks:this.call=(0,bake_collection_1.bakeCollection)(this._tasks,this.argsNum)}function rebuild_await(){this.length===0?this.call=bake_collection_1.BAKED_EMPTY_FUNC:this.length===1?this.call=this._tasks:this.call=(0,bake_collection_1.bakeCollectionAwait)(this._tasks,this.argsNum)}function rebuild_on_first_call(){this.rebuild(),this.call.apply(void 0,arguments)}var TaskCollection=function(){function s(e,o,a,c){o===void 0&&(o=!0),a===void 0&&(a=null),c===void 0&&(c=!1),this.awaitTasks=c,this.call=bake_collection_1.BAKED_EMPTY_FUNC,this.argsNum=e,this.firstEmitBuildStrategy=!0,c?this.rebuild=rebuild_await.bind(this):this.rebuild=rebuild_noawait.bind(this),this.setAutoRebuild(o),a?typeof a=="function"?(this._tasks=a,this.length=1):(this._tasks=a,this.length=a.length):(this._tasks=null,this.length=0),o&&this.rebuild()}return s}();taskCollection.TaskCollection=TaskCollection;function fastClear(){this._tasks=null,this.length=0,this.call=bake_collection_1.BAKED_EMPTY_FUNC}function clear(){this._tasks=null,this.length=0,this.call=bake_collection_1.BAKED_EMPTY_FUNC}function growArgsNum(s){this.argsNum<s&&(this.argsNum=s,this.firstEmitBuildStrategy?this.call=rebuild_on_first_call:this.rebuild())}function setAutoRebuild(s){s?(this.push=push_rebuild.bind(this),this.insert=insert_rebuild.bind(this),this.removeLast=removeLast_rebuild.bind(this)):(this.push=push_norebuild.bind(this),this.insert=insert_norebuild.bind(this),this.removeLast=removeLast_norebuild.bind(this))}function tasksAsArray(){return this.length===0?[]:this.length===1?[this._tasks]:this._tasks}function setTasks(s){s.length===0?(this.length=0,this.call=bake_collection_1.BAKED_EMPTY_FUNC):s.length===1?(this.length=1,this.call=s[0],this._tasks=s[0]):(this.length=s.length,this._tasks=s,this.firstEmitBuildStrategy?this.call=rebuild_on_first_call:this.rebuild())}TaskCollection.prototype.fastClear=fastClear;TaskCollection.prototype.clear=clear;TaskCollection.prototype.growArgsNum=growArgsNum;TaskCollection.prototype.setAutoRebuild=setAutoRebuild;TaskCollection.prototype.tasksAsArray=tasksAsArray;TaskCollection.prototype.setTasks=setTasks;(function(s){var e=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(a,c,g,b){b===void 0&&(b=g);var _=Object.getOwnPropertyDescriptor(c,g);(!_||("get"in _?!c.__esModule:_.writable||_.configurable))&&(_={enumerable:!0,get:function(){return c[g]}}),Object.defineProperty(a,b,_)}:function(a,c,g,b){b===void 0&&(b=g),a[b]=c[g]}),o=commonjsGlobal&&commonjsGlobal.__exportStar||function(a,c){for(var g in a)g!=="default"&&!Object.prototype.hasOwnProperty.call(c,g)&&e(c,a,g)};Object.defineProperty(s,"__esModule",{value:!0}),o(taskCollection,s)})(taskCollection$1);var utils$2={};Object.defineProperty(utils$2,"__esModule",{value:!0});utils$2.nullObj=void 0;function nullObj(){var s={};return s.__proto__=null,s}utils$2.nullObj=nullObj;var __spreadArray=commonjsGlobal&&commonjsGlobal.__spreadArray||function(s,e,o){if(o||arguments.length===2)for(var a=0,c=e.length,g;a<c;a++)(g||!(a in e))&&(g||(g=Array.prototype.slice.call(e,0,a)),g[a]=e[a]);return s.concat(g||Array.prototype.slice.call(e))};Object.defineProperty(ee,"__esModule",{value:!0});ee.EventEmitter=void 0;var task_collection_1=taskCollection$1,utils_1=utils$3,utils_2=utils$2;function emit(s,e,o,a,c,g){var b=this.events[s];if(b){if(b.length===0)return!1;if(b.argsNum<6)b.call(e,o,a,c,g);else{for(var _=new Array(b.argsNum),j=0,_e=_.length;j<_e;++j)_[j]=arguments[j+1];b.call.apply(void 0,_)}return!0}return!1}function emitHasOnce(s,e,o,a,c,g){var b=this.events[s],_;if(b!==void 0){if(b.length===0)return!1;if(b.argsNum<6)b.call(e,o,a,c,g);else{_=new Array(b.argsNum);for(var j=0,_e=_.length;j<_e;++j)_[j]=arguments[j+1];b.call.apply(void 0,_)}}var tt=this.onceEvents[s];if(tt){if(typeof tt=="function")if(this.onceEvents[s]=void 0,arguments.length<6)tt(e,o,a,c,g);else{if(_===void 0){_=new Array(arguments.length-1);for(var j=0,_e=_.length;j<_e;++j)_[j]=arguments[j+1]}tt.apply(void 0,_)}else{var et=tt;if(this.onceEvents[s]=void 0,arguments.length<6)for(var j=0;j<et.length;++j)et[j](e,o,a,c,g);else{if(_===void 0){_=new Array(arguments.length-1);for(var j=0,_e=_.length;j<_e;++j)_[j]=arguments[j+1]}for(var j=0;j<et.length;++j)et[j].apply(void 0,_)}}return!0}return b!==void 0}var EventEmitter=function(){function s(){this.events=(0,utils_2.nullObj)(),this.onceEvents=(0,utils_2.nullObj)(),this._symbolKeys=new Set,this.maxListeners=1/0}return Object.defineProperty(s.prototype,"_eventsCount",{get:function(){return this.eventNames().length},enumerable:!1,configurable:!0}),s}();ee.EventEmitter=EventEmitter;function once(s,e){switch(this.emit===emit&&(this.emit=emitHasOnce),typeof this.onceEvents[s]){case"undefined":this.onceEvents[s]=e,typeof s=="symbol"&&this._symbolKeys.add(s);break;case"function":this.onceEvents[s]=[this.onceEvents[s],e];break;case"object":this.onceEvents[s].push(e)}return this}function addListener(s,e,o){if(o===void 0&&(o=e.length),typeof e!="function")throw new TypeError("The listener must be a function");var a=this.events[s];return a?(a.push(e),a.growArgsNum(o),this.maxListeners!==1/0&&this.maxListeners<=a.length&&console.warn('Maximum event listeners for "'.concat(String(s),'" event!'))):(this.events[s]=new task_collection_1.TaskCollection(o,!0,e,!1),typeof s=="symbol"&&this._symbolKeys.add(s)),this}function removeListener(s,e){var o=this.events[s];o&&o.removeLast(e);var a=this.onceEvents[s];return a&&(typeof a=="function"?this.onceEvents[s]=void 0:typeof a=="object"&&(a.length===1&&a[0]===e?this.onceEvents[s]=void 0:(0,utils_1._fast_remove_single)(a,a.lastIndexOf(e)))),this}function addListenerBound(s,e,o,a){o===void 0&&(o=this),a===void 0&&(a=e.length),this.boundFuncs||(this.boundFuncs=new Map);var c=e.bind(o);return this.boundFuncs.set(e,c),this.addListener(s,c,a)}function removeListenerBound(s,e){var o,a,c=(o=this.boundFuncs)===null||o===void 0?void 0:o.get(e);return(a=this.boundFuncs)===null||a===void 0||a.delete(e),this.removeListener(s,c)}function hasListeners(s){return this.events[s]&&!!this.events[s].length}function prependListener(s,e,o){if(o===void 0&&(o=e.length),typeof e!="function")throw new TypeError("The listener must be a function");var a=this.events[s];return!a||!(a instanceof task_collection_1.TaskCollection)?(a=this.events[s]=new task_collection_1.TaskCollection(o,!0,e,!1),typeof s=="symbol"&&this._symbolKeys.add(s)):(a.insert(0,e),a.growArgsNum(o),this.maxListeners!==1/0&&this.maxListeners<=a.length&&console.warn('Maximum event listeners for "'.concat(String(s),'" event!'))),this}function prependOnceListener(s,e){this.emit===emit&&(this.emit=emitHasOnce);var o=this.onceEvents[s];return o?typeof o!="object"?(this.onceEvents[s]=[e,o],typeof s=="symbol"&&this._symbolKeys.add(s)):(o.unshift(e),this.maxListeners!==1/0&&this.maxListeners<=o.length&&console.warn('Maximum event listeners for "'.concat(String(s),'" once event!'))):(this.onceEvents[s]=[e],typeof s=="symbol"&&this._symbolKeys.add(s)),this}function removeAllListeners(s){return s===void 0?(this.events=(0,utils_2.nullObj)(),this.onceEvents=(0,utils_2.nullObj)(),this._symbolKeys=new Set):(this.events[s]=void 0,this.onceEvents[s]=void 0,typeof s=="symbol"&&this._symbolKeys.delete(s)),this}function setMaxListeners(s){return this.maxListeners=s,this}function getMaxListeners(){return this.maxListeners}function listeners(s){return this.emit===emit?this.events[s]?this.events[s].tasksAsArray().slice():[]:this.events[s]&&this.onceEvents[s]?__spreadArray(__spreadArray([],this.events[s].tasksAsArray(),!0),typeof this.onceEvents[s]=="function"?[this.onceEvents[s]]:this.onceEvents[s],!0):this.events[s]?this.events[s].tasksAsArray():this.onceEvents[s]?typeof this.onceEvents[s]=="function"?[this.onceEvents[s]]:this.onceEvents[s]:[]}function eventNames(){var s=this;if(this.emit===emit){var e=Object.keys(this.events);return __spreadArray(__spreadArray([],e,!0),Array.from(this._symbolKeys),!0).filter(function(a){return a in s.events&&s.events[a]&&s.events[a].length})}else{var e=Object.keys(this.events).filter(function(c){return s.events[c]&&s.events[c].length}),o=Object.keys(this.onceEvents).filter(function(c){return s.onceEvents[c]&&s.onceEvents[c].length});return __spreadArray(__spreadArray(__spreadArray([],e,!0),o,!0),Array.from(this._symbolKeys).filter(function(c){return c in s.events&&s.events[c]&&s.events[c].length||c in s.onceEvents&&s.onceEvents[c]&&s.onceEvents[c].length}),!0)}}function listenerCount(s){return this.emit===emit?this.events[s]&&this.events[s].length||0:(this.events[s]&&this.events[s].length||0)+(this.onceEvents[s]&&this.onceEvents[s].length||0)}EventEmitter.prototype.emit=emit;EventEmitter.prototype.on=addListener;EventEmitter.prototype.once=once;EventEmitter.prototype.addListener=addListener;EventEmitter.prototype.removeListener=removeListener;EventEmitter.prototype.addListenerBound=addListenerBound;EventEmitter.prototype.removeListenerBound=removeListenerBound;EventEmitter.prototype.hasListeners=hasListeners;EventEmitter.prototype.prependListener=prependListener;EventEmitter.prototype.prependOnceListener=prependOnceListener;EventEmitter.prototype.off=removeListener;EventEmitter.prototype.removeAllListeners=removeAllListeners;EventEmitter.prototype.setMaxListeners=setMaxListeners;EventEmitter.prototype.getMaxListeners=getMaxListeners;EventEmitter.prototype.listeners=listeners;EventEmitter.prototype.eventNames=eventNames;EventEmitter.prototype.listenerCount=listenerCount;(function(s){var e=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(a,c,g,b){b===void 0&&(b=g);var _=Object.getOwnPropertyDescriptor(c,g);(!_||("get"in _?!c.__esModule:_.writable||_.configurable))&&(_={enumerable:!0,get:function(){return c[g]}}),Object.defineProperty(a,b,_)}:function(a,c,g,b){b===void 0&&(b=g),a[b]=c[g]}),o=commonjsGlobal&&commonjsGlobal.__exportStar||function(a,c){for(var g in a)g!=="default"&&!Object.prototype.hasOwnProperty.call(c,g)&&e(c,a,g)};Object.defineProperty(s,"__esModule",{value:!0}),o(types,s),o(ee,s)})(lib$1);var browser={exports:{}},ms,hasRequiredMs;function requireMs(){if(hasRequiredMs)return ms;hasRequiredMs=1;var s=1e3,e=s*60,o=e*60,a=o*24,c=a*7,g=a*365.25;ms=function(tt,et){et=et||{};var nt=typeof tt;if(nt==="string"&&tt.length>0)return b(tt);if(nt==="number"&&isFinite(tt))return et.long?j(tt):_(tt);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(tt))};function b(tt){if(tt=String(tt),!(tt.length>100)){var et=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(tt);if(et){var nt=parseFloat(et[1]),rt=(et[2]||"ms").toLowerCase();switch(rt){case"years":case"year":case"yrs":case"yr":case"y":return nt*g;case"weeks":case"week":case"w":return nt*c;case"days":case"day":case"d":return nt*a;case"hours":case"hour":case"hrs":case"hr":case"h":return nt*o;case"minutes":case"minute":case"mins":case"min":case"m":return nt*e;case"seconds":case"second":case"secs":case"sec":case"s":return nt*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return nt;default:return}}}}function _(tt){var et=Math.abs(tt);return et>=a?Math.round(tt/a)+"d":et>=o?Math.round(tt/o)+"h":et>=e?Math.round(tt/e)+"m":et>=s?Math.round(tt/s)+"s":tt+"ms"}function j(tt){var et=Math.abs(tt);return et>=a?_e(tt,et,a,"day"):et>=o?_e(tt,et,o,"hour"):et>=e?_e(tt,et,e,"minute"):et>=s?_e(tt,et,s,"second"):tt+" ms"}function _e(tt,et,nt,rt){var it=et>=nt*1.5;return Math.round(tt/nt)+" "+rt+(it?"s":"")}return ms}function setup(s){o.debug=o,o.default=o,o.coerce=j,o.disable=b,o.enable=c,o.enabled=_,o.humanize=requireMs(),o.destroy=_e,Object.keys(s).forEach(tt=>{o[tt]=s[tt]}),o.names=[],o.skips=[],o.formatters={};function e(tt){let et=0;for(let nt=0;nt<tt.length;nt++)et=(et<<5)-et+tt.charCodeAt(nt),et|=0;return o.colors[Math.abs(et)%o.colors.length]}o.selectColor=e;function o(tt){let et,nt=null,rt,it;function st(...lt){if(!st.enabled)return;const at=st,ct=Number(new Date),ft=ct-(et||ct);at.diff=ft,at.prev=et,at.curr=ct,et=ct,lt[0]=o.coerce(lt[0]),typeof lt[0]!="string"&&lt.unshift("%O");let vt=0;lt[0]=lt[0].replace(/%([a-zA-Z%])/g,(_t,Tt)=>{if(_t==="%%")return"%";vt++;const Ct=o.formatters[Tt];if(typeof Ct=="function"){const Nt=lt[vt];_t=Ct.call(at,Nt),lt.splice(vt,1),vt--}return _t}),o.formatArgs.call(at,lt),(at.log||o.log).apply(at,lt)}return st.namespace=tt,st.useColors=o.useColors(),st.color=o.selectColor(tt),st.extend=a,st.destroy=o.destroy,Object.defineProperty(st,"enabled",{enumerable:!0,configurable:!1,get:()=>nt!==null?nt:(rt!==o.namespaces&&(rt=o.namespaces,it=o.enabled(tt)),it),set:lt=>{nt=lt}}),typeof o.init=="function"&&o.init(st),st}function a(tt,et){const nt=o(this.namespace+(typeof et>"u"?":":et)+tt);return nt.log=this.log,nt}function c(tt){o.save(tt),o.namespaces=tt,o.names=[],o.skips=[];const et=(typeof tt=="string"?tt:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const nt of et)nt[0]==="-"?o.skips.push(nt.slice(1)):o.names.push(nt)}function g(tt,et){let nt=0,rt=0,it=-1,st=0;for(;nt<tt.length;)if(rt<et.length&&(et[rt]===tt[nt]||et[rt]==="*"))et[rt]==="*"?(it=rt,st=nt,rt++):(nt++,rt++);else if(it!==-1)rt=it+1,st++,nt=st;else return!1;for(;rt<et.length&&et[rt]==="*";)rt++;return rt===et.length}function b(){const tt=[...o.names,...o.skips.map(et=>"-"+et)].join(",");return o.enable(""),tt}function _(tt){for(const et of o.skips)if(g(tt,et))return!1;for(const et of o.names)if(g(tt,et))return!0;return!1}function j(tt){return tt instanceof Error?tt.stack||tt.message:tt}function _e(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return o.enable(o.load()),o}var common=setup;(function(s,e){var o={};e.formatArgs=c,e.save=g,e.load=b,e.useColors=a,e.storage=_(),e.destroy=(()=>{let _e=!1;return()=>{_e||(_e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function a(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let _e;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(_e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(_e[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function c(_e){if(_e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+_e[0]+(this.useColors?"%c ":" ")+"+"+s.exports.humanize(this.diff),!this.useColors)return;const tt="color: "+this.color;_e.splice(1,0,tt,"color: inherit");let et=0,nt=0;_e[0].replace(/%[a-zA-Z%]/g,rt=>{rt!=="%%"&&(et++,rt==="%c"&&(nt=et))}),_e.splice(nt,0,tt)}e.log=console.debug||console.log||(()=>{});function g(_e){try{_e?e.storage.setItem("debug",_e):e.storage.removeItem("debug")}catch{}}function b(){let _e;try{_e=e.storage.getItem("debug")||e.storage.getItem("DEBUG")}catch{}return!_e&&typeof process<"u"&&"env"in process&&(_e=o.DEBUG),_e}function _(){try{return localStorage}catch{}}s.exports=common(e);const{formatters:j}=s.exports;j.j=function(_e){try{return JSON.stringify(_e)}catch(tt){return"[UnexpectedJSONParseError]: "+tt.message}}})(browser,browser.exports);var browserExports=browser.exports;const createDebug5=getDefaultExportFromCjs(browserExports);function number$2(s){if(!Number.isSafeInteger(s)||s<0)throw new Error(`Wrong positive integer: ${s}`)}function bytes$2(s,...e){if(!(s instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(s.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${s.length}`)}function hash$1(s){if(typeof s!="function"||typeof s.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");number$2(s.outputLen),number$2(s.blockLen)}function exists$1(s,e=!0){if(s.destroyed)throw new Error("Hash instance has been destroyed");if(e&&s.finished)throw new Error("Hash#digest() has already been called")}function output$1(s,e){bytes$2(s);const o=e.outputLen;if(s.length<o)throw new Error(`digestInto() expects output buffer of length at least ${o}`)}const crypto$2=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const u8a$2=s=>s instanceof Uint8Array,createView$2=s=>new DataView(s.buffer,s.byteOffset,s.byteLength),rotr$2=(s,e)=>s<<32-e|s>>>e,isLE$2=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE$2)throw new Error("Non little-endian hardware is not supported");function utf8ToBytes$3(s){if(typeof s!="string")throw new Error(`utf8ToBytes expected string, got ${typeof s}`);return new Uint8Array(new TextEncoder().encode(s))}function toBytes$2(s){if(typeof s=="string"&&(s=utf8ToBytes$3(s)),!u8a$2(s))throw new Error(`expected Uint8Array, got ${typeof s}`);return s}function concatBytes$3(...s){const e=new Uint8Array(s.reduce((a,c)=>a+c.length,0));let o=0;return s.forEach(a=>{if(!u8a$2(a))throw new Error("Uint8Array expected");e.set(a,o),o+=a.length}),e}let Hash$2=class{clone(){return this._cloneInto()}};function wrapConstructor$1(s){const e=a=>s().update(toBytes$2(a)).digest(),o=s();return e.outputLen=o.outputLen,e.blockLen=o.blockLen,e.create=()=>s(),e}function randomBytes$2(s=32){if(crypto$2&&typeof crypto$2.getRandomValues=="function")return crypto$2.getRandomValues(new Uint8Array(s));throw new Error("crypto.getRandomValues must be defined")}function setBigUint64$2(s,e,o,a){if(typeof s.setBigUint64=="function")return s.setBigUint64(e,o,a);const c=BigInt(32),g=BigInt(4294967295),b=Number(o>>c&g),_=Number(o&g),j=a?4:0,_e=a?0:4;s.setUint32(e+j,b,a),s.setUint32(e+_e,_,a)}let SHA2$1=class extends Hash$2{constructor(e,o,a,c){super(),this.blockLen=e,this.outputLen=o,this.padOffset=a,this.isLE=c,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=createView$2(this.buffer)}update(e){exists$1(this);const{view:o,buffer:a,blockLen:c}=this;e=toBytes$2(e);const g=e.length;for(let b=0;b<g;){const _=Math.min(c-this.pos,g-b);if(_===c){const j=createView$2(e);for(;c<=g-b;b+=c)this.process(j,b);continue}a.set(e.subarray(b,b+_),this.pos),this.pos+=_,b+=_,this.pos===c&&(this.process(o,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){exists$1(this),output$1(e,this),this.finished=!0;const{buffer:o,view:a,blockLen:c,isLE:g}=this;let{pos:b}=this;o[b++]=128,this.buffer.subarray(b).fill(0),this.padOffset>c-b&&(this.process(a,0),b=0);for(let et=b;et<c;et++)o[et]=0;setBigUint64$2(a,c-8,BigInt(this.length*8),g),this.process(a,0);const _=createView$2(e),j=this.outputLen;if(j%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const _e=j/4,tt=this.get();if(_e>tt.length)throw new Error("_sha2: outputLen bigger than state");for(let et=0;et<_e;et++)_.setUint32(4*et,tt[et],g)}digest(){const{buffer:e,outputLen:o}=this;this.digestInto(e);const a=e.slice(0,o);return this.destroy(),a}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:o,buffer:a,length:c,finished:g,destroyed:b,pos:_}=this;return e.length=c,e.pos=_,e.finished=g,e.destroyed=b,c%o&&e.buffer.set(a),e}};const Chi$2=(s,e,o)=>s&e^~s&o,Maj$2=(s,e,o)=>s&e^s&o^e&o,SHA256_K$2=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),IV$1=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_W$2=new Uint32Array(64);let SHA256$2=class extends SHA2$1{constructor(){super(64,32,8,!1),this.A=IV$1[0]|0,this.B=IV$1[1]|0,this.C=IV$1[2]|0,this.D=IV$1[3]|0,this.E=IV$1[4]|0,this.F=IV$1[5]|0,this.G=IV$1[6]|0,this.H=IV$1[7]|0}get(){const{A:e,B:o,C:a,D:c,E:g,F:b,G:_,H:j}=this;return[e,o,a,c,g,b,_,j]}set(e,o,a,c,g,b,_,j){this.A=e|0,this.B=o|0,this.C=a|0,this.D=c|0,this.E=g|0,this.F=b|0,this.G=_|0,this.H=j|0}process(e,o){for(let et=0;et<16;et++,o+=4)SHA256_W$2[et]=e.getUint32(o,!1);for(let et=16;et<64;et++){const nt=SHA256_W$2[et-15],rt=SHA256_W$2[et-2],it=rotr$2(nt,7)^rotr$2(nt,18)^nt>>>3,st=rotr$2(rt,17)^rotr$2(rt,19)^rt>>>10;SHA256_W$2[et]=st+SHA256_W$2[et-7]+it+SHA256_W$2[et-16]|0}let{A:a,B:c,C:g,D:b,E:_,F:j,G:_e,H:tt}=this;for(let et=0;et<64;et++){const nt=rotr$2(_,6)^rotr$2(_,11)^rotr$2(_,25),rt=tt+nt+Chi$2(_,j,_e)+SHA256_K$2[et]+SHA256_W$2[et]|0,st=(rotr$2(a,2)^rotr$2(a,13)^rotr$2(a,22))+Maj$2(a,c,g)|0;tt=_e,_e=j,j=_,_=b+rt|0,b=g,g=c,c=a,a=rt+st|0}a=a+this.A|0,c=c+this.B|0,g=g+this.C|0,b=b+this.D|0,_=_+this.E|0,j=j+this.F|0,_e=_e+this.G|0,tt=tt+this.H|0,this.set(a,c,g,b,_,j,_e,tt)}roundClean(){SHA256_W$2.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const sha256$3=wrapConstructor$1(()=>new SHA256$2);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$9=BigInt(0),_1n$9=BigInt(1),_2n$5=BigInt(2),u8a$1=s=>s instanceof Uint8Array,hexes$2=Array.from({length:256},(s,e)=>e.toString(16).padStart(2,"0"));function bytesToHex$2(s){if(!u8a$1(s))throw new Error("Uint8Array expected");let e="";for(let o=0;o<s.length;o++)e+=hexes$2[s[o]];return e}function numberToHexUnpadded$1(s){const e=s.toString(16);return e.length&1?`0${e}`:e}function hexToNumber$1(s){if(typeof s!="string")throw new Error("hex string expected, got "+typeof s);return BigInt(s===""?"0":`0x${s}`)}function hexToBytes$2(s){if(typeof s!="string")throw new Error("hex string expected, got "+typeof s);const e=s.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const o=new Uint8Array(e/2);for(let a=0;a<o.length;a++){const c=a*2,g=s.slice(c,c+2),b=Number.parseInt(g,16);if(Number.isNaN(b)||b<0)throw new Error("Invalid byte sequence");o[a]=b}return o}function bytesToNumberBE$1(s){return hexToNumber$1(bytesToHex$2(s))}function bytesToNumberLE$1(s){if(!u8a$1(s))throw new Error("Uint8Array expected");return hexToNumber$1(bytesToHex$2(Uint8Array.from(s).reverse()))}function numberToBytesBE$1(s,e){return hexToBytes$2(s.toString(16).padStart(e*2,"0"))}function numberToBytesLE$1(s,e){return numberToBytesBE$1(s,e).reverse()}function numberToVarBytesBE(s){return hexToBytes$2(numberToHexUnpadded$1(s))}function ensureBytes$1(s,e,o){let a;if(typeof e=="string")try{a=hexToBytes$2(e)}catch(g){throw new Error(`${s} must be valid hex string, got "${e}". Cause: ${g}`)}else if(u8a$1(e))a=Uint8Array.from(e);else throw new Error(`${s} must be hex string or Uint8Array`);const c=a.length;if(typeof o=="number"&&c!==o)throw new Error(`${s} expected ${o} bytes, got ${c}`);return a}function concatBytes$2(...s){const e=new Uint8Array(s.reduce((a,c)=>a+c.length,0));let o=0;return s.forEach(a=>{if(!u8a$1(a))throw new Error("Uint8Array expected");e.set(a,o),o+=a.length}),e}function equalBytes$1(s,e){if(s.length!==e.length)return!1;for(let o=0;o<s.length;o++)if(s[o]!==e[o])return!1;return!0}function utf8ToBytes$2(s){if(typeof s!="string")throw new Error(`utf8ToBytes expected string, got ${typeof s}`);return new Uint8Array(new TextEncoder().encode(s))}function bitLen$1(s){let e;for(e=0;s>_0n$9;s>>=_1n$9,e+=1);return e}function bitGet(s,e){return s>>BigInt(e)&_1n$9}const bitSet=(s,e,o)=>s|(o?_1n$9:_0n$9)<<BigInt(e),bitMask$1=s=>(_2n$5<<BigInt(s-1))-_1n$9,u8n=s=>new Uint8Array(s),u8fr=s=>Uint8Array.from(s);function createHmacDrbg$1(s,e,o){if(typeof s!="number"||s<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof o!="function")throw new Error("hmacFn must be a function");let a=u8n(s),c=u8n(s),g=0;const b=()=>{a.fill(1),c.fill(0),g=0},_=(...et)=>o(c,a,...et),j=(et=u8n())=>{c=_(u8fr([0]),et),a=_(),et.length!==0&&(c=_(u8fr([1]),et),a=_())},_e=()=>{if(g++>=1e3)throw new Error("drbg: tried 1000 values");let et=0;const nt=[];for(;et<e;){a=_();const rt=a.slice();nt.push(rt),et+=a.length}return concatBytes$2(...nt)};return(et,nt)=>{b(),j(et);let rt;for(;!(rt=nt(_e()));)j();return b(),rt}}const validatorFns={bigint:s=>typeof s=="bigint",function:s=>typeof s=="function",boolean:s=>typeof s=="boolean",string:s=>typeof s=="string",stringOrUint8Array:s=>typeof s=="string"||s instanceof Uint8Array,isSafeInteger:s=>Number.isSafeInteger(s),array:s=>Array.isArray(s),field:(s,e)=>e.Fp.isValid(s),hash:s=>typeof s=="function"&&Number.isSafeInteger(s.outputLen)};function validateObject(s,e,o={}){const a=(c,g,b)=>{const _=validatorFns[g];if(typeof _!="function")throw new Error(`Invalid validator "${g}", expected function`);const j=s[c];if(!(b&&j===void 0)&&!_(j,s))throw new Error(`Invalid param ${String(c)}=${j} (${typeof j}), expected ${g}`)};for(const[c,g]of Object.entries(e))a(c,g,!1);for(const[c,g]of Object.entries(o))a(c,g,!0);return s}const ut=Object.freeze(Object.defineProperty({__proto__:null,bitGet,bitLen:bitLen$1,bitMask:bitMask$1,bitSet,bytesToHex:bytesToHex$2,bytesToNumberBE:bytesToNumberBE$1,bytesToNumberLE:bytesToNumberLE$1,concatBytes:concatBytes$2,createHmacDrbg:createHmacDrbg$1,ensureBytes:ensureBytes$1,equalBytes:equalBytes$1,hexToBytes:hexToBytes$2,hexToNumber:hexToNumber$1,numberToBytesBE:numberToBytesBE$1,numberToBytesLE:numberToBytesLE$1,numberToHexUnpadded:numberToHexUnpadded$1,numberToVarBytesBE,utf8ToBytes:utf8ToBytes$2,validateObject},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$8=BigInt(0),_1n$8=BigInt(1),_2n$4=BigInt(2),_3n$3=BigInt(3),_4n$2=BigInt(4),_5n$1=BigInt(5),_8n$1=BigInt(8);BigInt(9);BigInt(16);function mod$1(s,e){const o=s%e;return o>=_0n$8?o:e+o}function pow(s,e,o){if(o<=_0n$8||e<_0n$8)throw new Error("Expected power/modulo > 0");if(o===_1n$8)return _0n$8;let a=_1n$8;for(;e>_0n$8;)e&_1n$8&&(a=a*s%o),s=s*s%o,e>>=_1n$8;return a}function pow2$1(s,e,o){let a=s;for(;e-- >_0n$8;)a*=a,a%=o;return a}function invert$1(s,e){if(s===_0n$8||e<=_0n$8)throw new Error(`invert: expected positive integers, got n=${s} mod=${e}`);let o=mod$1(s,e),a=e,c=_0n$8,g=_1n$8;for(;o!==_0n$8;){const _=a/o,j=a%o,_e=c-g*_;a=o,o=j,c=g,g=_e}if(a!==_1n$8)throw new Error("invert: does not exist");return mod$1(c,e)}function tonelliShanks$1(s){const e=(s-_1n$8)/_2n$4;let o,a,c;for(o=s-_1n$8,a=0;o%_2n$4===_0n$8;o/=_2n$4,a++);for(c=_2n$4;c<s&&pow(c,e,s)!==s-_1n$8;c++);if(a===1){const b=(s+_1n$8)/_4n$2;return function(j,_e){const tt=j.pow(_e,b);if(!j.eql(j.sqr(tt),_e))throw new Error("Cannot find square root");return tt}}const g=(o+_1n$8)/_2n$4;return function(_,j){if(_.pow(j,e)===_.neg(_.ONE))throw new Error("Cannot find square root");let _e=a,tt=_.pow(_.mul(_.ONE,c),o),et=_.pow(j,g),nt=_.pow(j,o);for(;!_.eql(nt,_.ONE);){if(_.eql(nt,_.ZERO))return _.ZERO;let rt=1;for(let st=_.sqr(nt);rt<_e&&!_.eql(st,_.ONE);rt++)st=_.sqr(st);const it=_.pow(tt,_1n$8<<BigInt(_e-rt-1));tt=_.sqr(it),et=_.mul(et,it),nt=_.mul(nt,tt),_e=rt}return et}}function FpSqrt$1(s){if(s%_4n$2===_3n$3){const e=(s+_1n$8)/_4n$2;return function(a,c){const g=a.pow(c,e);if(!a.eql(a.sqr(g),c))throw new Error("Cannot find square root");return g}}if(s%_8n$1===_5n$1){const e=(s-_5n$1)/_8n$1;return function(a,c){const g=a.mul(c,_2n$4),b=a.pow(g,e),_=a.mul(c,b),j=a.mul(a.mul(_,_2n$4),b),_e=a.mul(_,a.sub(j,a.ONE));if(!a.eql(a.sqr(_e),c))throw new Error("Cannot find square root");return _e}}return tonelliShanks$1(s)}const FIELD_FIELDS$1=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function validateField$1(s){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},o=FIELD_FIELDS$1.reduce((a,c)=>(a[c]="function",a),e);return validateObject(s,o)}function FpPow$1(s,e,o){if(o<_0n$8)throw new Error("Expected power > 0");if(o===_0n$8)return s.ONE;if(o===_1n$8)return e;let a=s.ONE,c=e;for(;o>_0n$8;)o&_1n$8&&(a=s.mul(a,c)),c=s.sqr(c),o>>=_1n$8;return a}function FpInvertBatch$1(s,e){const o=new Array(e.length),a=e.reduce((g,b,_)=>s.is0(b)?g:(o[_]=g,s.mul(g,b)),s.ONE),c=s.inv(a);return e.reduceRight((g,b,_)=>s.is0(b)?g:(o[_]=s.mul(g,o[_]),s.mul(g,b)),c),o}function nLength$1(s,e){const o=e!==void 0?e:s.toString(2).length,a=Math.ceil(o/8);return{nBitLength:o,nByteLength:a}}function Field$1(s,e,o=!1,a={}){if(s<=_0n$8)throw new Error(`Expected Field ORDER > 0, got ${s}`);const{nBitLength:c,nByteLength:g}=nLength$1(s,e);if(g>2048)throw new Error("Field lengths over 2048 bytes are not supported");const b=FpSqrt$1(s),_=Object.freeze({ORDER:s,BITS:c,BYTES:g,MASK:bitMask$1(c),ZERO:_0n$8,ONE:_1n$8,create:j=>mod$1(j,s),isValid:j=>{if(typeof j!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof j}`);return _0n$8<=j&&j<s},is0:j=>j===_0n$8,isOdd:j=>(j&_1n$8)===_1n$8,neg:j=>mod$1(-j,s),eql:(j,_e)=>j===_e,sqr:j=>mod$1(j*j,s),add:(j,_e)=>mod$1(j+_e,s),sub:(j,_e)=>mod$1(j-_e,s),mul:(j,_e)=>mod$1(j*_e,s),pow:(j,_e)=>FpPow$1(_,j,_e),div:(j,_e)=>mod$1(j*invert$1(_e,s),s),sqrN:j=>j*j,addN:(j,_e)=>j+_e,subN:(j,_e)=>j-_e,mulN:(j,_e)=>j*_e,inv:j=>invert$1(j,s),sqrt:a.sqrt||(j=>b(_,j)),invertBatch:j=>FpInvertBatch$1(_,j),cmov:(j,_e,tt)=>tt?_e:j,toBytes:j=>o?numberToBytesLE$1(j,g):numberToBytesBE$1(j,g),fromBytes:j=>{if(j.length!==g)throw new Error(`Fp.fromBytes: expected ${g}, got ${j.length}`);return o?bytesToNumberLE$1(j):bytesToNumberBE$1(j)}});return Object.freeze(_)}function getFieldBytesLength$1(s){if(typeof s!="bigint")throw new Error("field order must be bigint");const e=s.toString(2).length;return Math.ceil(e/8)}function getMinHashLength$1(s){const e=getFieldBytesLength$1(s);return e+Math.ceil(e/2)}function mapHashToField$1(s,e,o=!1){const a=s.length,c=getFieldBytesLength$1(e),g=getMinHashLength$1(e);if(a<16||a<g||a>1024)throw new Error(`expected ${g}-1024 bytes of input, got ${a}`);const b=o?bytesToNumberBE$1(s):bytesToNumberLE$1(s),_=mod$1(b,e-_1n$8)+_1n$8;return o?numberToBytesLE$1(_,c):numberToBytesBE$1(_,c)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$7=BigInt(0),_1n$7=BigInt(1);function wNAF$1(s,e){const o=(c,g)=>{const b=g.negate();return c?b:g},a=c=>{const g=Math.ceil(e/c)+1,b=2**(c-1);return{windows:g,windowSize:b}};return{constTimeNegate:o,unsafeLadder(c,g){let b=s.ZERO,_=c;for(;g>_0n$7;)g&_1n$7&&(b=b.add(_)),_=_.double(),g>>=_1n$7;return b},precomputeWindow(c,g){const{windows:b,windowSize:_}=a(g),j=[];let _e=c,tt=_e;for(let et=0;et<b;et++){tt=_e,j.push(tt);for(let nt=1;nt<_;nt++)tt=tt.add(_e),j.push(tt);_e=tt.double()}return j},wNAF(c,g,b){const{windows:_,windowSize:j}=a(c);let _e=s.ZERO,tt=s.BASE;const et=BigInt(2**c-1),nt=2**c,rt=BigInt(c);for(let it=0;it<_;it++){const st=it*j;let lt=Number(b&et);b>>=rt,lt>j&&(lt-=nt,b+=_1n$7);const at=st,ct=st+Math.abs(lt)-1,ft=it%2!==0,vt=lt<0;lt===0?tt=tt.add(o(ft,g[at])):_e=_e.add(o(vt,g[ct]))}return{p:_e,f:tt}},wNAFCached(c,g,b,_){const j=c._WINDOW_SIZE||1;let _e=g.get(c);return _e||(_e=this.precomputeWindow(c,j),j!==1&&g.set(c,_(_e))),this.wNAF(j,_e,b)}}}function validateBasic(s){return validateField$1(s.Fp),validateObject(s,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...nLength$1(s.n,s.nBitLength),...s,p:s.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function validatePointOpts(s){const e=validateBasic(s);validateObject(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:o,Fp:a,a:c}=e;if(o){if(!a.eql(c,a.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof o!="object"||typeof o.beta!="bigint"||typeof o.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:b2n,hexToBytes:h2b}=ut,DER$1={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(s){const{Err:e}=DER$1;if(s.length<2||s[0]!==2)throw new e("Invalid signature integer tag");const o=s[1],a=s.subarray(2,o+2);if(!o||a.length!==o)throw new e("Invalid signature integer: wrong length");if(a[0]&128)throw new e("Invalid signature integer: negative");if(a[0]===0&&!(a[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:b2n(a),l:s.subarray(o+2)}},toSig(s){const{Err:e}=DER$1,o=typeof s=="string"?h2b(s):s;if(!(o instanceof Uint8Array))throw new Error("ui8a expected");let a=o.length;if(a<2||o[0]!=48)throw new e("Invalid signature tag");if(o[1]!==a-2)throw new e("Invalid signature: incorrect length");const{d:c,l:g}=DER$1._parseInt(o.subarray(2)),{d:b,l:_}=DER$1._parseInt(g);if(_.length)throw new e("Invalid signature: left bytes after parsing");return{r:c,s:b}},hexFromSig(s){const e=_e=>Number.parseInt(_e[0],16)&8?"00"+_e:_e,o=_e=>{const tt=_e.toString(16);return tt.length&1?`0${tt}`:tt},a=e(o(s.s)),c=e(o(s.r)),g=a.length/2,b=c.length/2,_=o(g),j=o(b);return`30${o(b+g+4)}02${j}${c}02${_}${a}`}},_0n$6=BigInt(0),_1n$6=BigInt(1);BigInt(2);const _3n$2=BigInt(3);BigInt(4);function weierstrassPoints(s){const e=validatePointOpts(s),{Fp:o}=e,a=e.toBytes||((it,st,lt)=>{const at=st.toAffine();return concatBytes$2(Uint8Array.from([4]),o.toBytes(at.x),o.toBytes(at.y))}),c=e.fromBytes||(it=>{const st=it.subarray(1),lt=o.fromBytes(st.subarray(0,o.BYTES)),at=o.fromBytes(st.subarray(o.BYTES,2*o.BYTES));return{x:lt,y:at}});function g(it){const{a:st,b:lt}=e,at=o.sqr(it),ct=o.mul(at,it);return o.add(o.add(ct,o.mul(it,st)),lt)}if(!o.eql(o.sqr(e.Gy),g(e.Gx)))throw new Error("bad generator point: equation left != right");function b(it){return typeof it=="bigint"&&_0n$6<it&&it<e.n}function _(it){if(!b(it))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function j(it){const{allowedPrivateKeyLengths:st,nByteLength:lt,wrapPrivateKey:at,n:ct}=e;if(st&&typeof it!="bigint"){if(it instanceof Uint8Array&&(it=bytesToHex$2(it)),typeof it!="string"||!st.includes(it.length))throw new Error("Invalid key");it=it.padStart(lt*2,"0")}let ft;try{ft=typeof it=="bigint"?it:bytesToNumberBE$1(ensureBytes$1("private key",it,lt))}catch{throw new Error(`private key must be ${lt} bytes, hex or bigint, not ${typeof it}`)}return at&&(ft=mod$1(ft,ct)),_(ft),ft}const _e=new Map;function tt(it){if(!(it instanceof et))throw new Error("ProjectivePoint expected")}class et{constructor(st,lt,at){if(this.px=st,this.py=lt,this.pz=at,st==null||!o.isValid(st))throw new Error("x required");if(lt==null||!o.isValid(lt))throw new Error("y required");if(at==null||!o.isValid(at))throw new Error("z required")}static fromAffine(st){const{x:lt,y:at}=st||{};if(!st||!o.isValid(lt)||!o.isValid(at))throw new Error("invalid affine point");if(st instanceof et)throw new Error("projective point not allowed");const ct=ft=>o.eql(ft,o.ZERO);return ct(lt)&&ct(at)?et.ZERO:new et(lt,at,o.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(st){const lt=o.invertBatch(st.map(at=>at.pz));return st.map((at,ct)=>at.toAffine(lt[ct])).map(et.fromAffine)}static fromHex(st){const lt=et.fromAffine(c(ensureBytes$1("pointHex",st)));return lt.assertValidity(),lt}static fromPrivateKey(st){return et.BASE.multiply(j(st))}_setWindowSize(st){this._WINDOW_SIZE=st,_e.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!o.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:st,y:lt}=this.toAffine();if(!o.isValid(st)||!o.isValid(lt))throw new Error("bad point: x or y not FE");const at=o.sqr(lt),ct=g(st);if(!o.eql(at,ct))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:st}=this.toAffine();if(o.isOdd)return!o.isOdd(st);throw new Error("Field doesn't support isOdd")}equals(st){tt(st);const{px:lt,py:at,pz:ct}=this,{px:ft,py:vt,pz:Rt}=st,_t=o.eql(o.mul(lt,Rt),o.mul(ft,ct)),Tt=o.eql(o.mul(at,Rt),o.mul(vt,ct));return _t&&Tt}negate(){return new et(this.px,o.neg(this.py),this.pz)}double(){const{a:st,b:lt}=e,at=o.mul(lt,_3n$2),{px:ct,py:ft,pz:vt}=this;let Rt=o.ZERO,_t=o.ZERO,Tt=o.ZERO,Ct=o.mul(ct,ct),Nt=o.mul(ft,ft),At=o.mul(vt,vt),yt=o.mul(ct,ft);return yt=o.add(yt,yt),Tt=o.mul(ct,vt),Tt=o.add(Tt,Tt),Rt=o.mul(st,Tt),_t=o.mul(at,At),_t=o.add(Rt,_t),Rt=o.sub(Nt,_t),_t=o.add(Nt,_t),_t=o.mul(Rt,_t),Rt=o.mul(yt,Rt),Tt=o.mul(at,Tt),At=o.mul(st,At),yt=o.sub(Ct,At),yt=o.mul(st,yt),yt=o.add(yt,Tt),Tt=o.add(Ct,Ct),Ct=o.add(Tt,Ct),Ct=o.add(Ct,At),Ct=o.mul(Ct,yt),_t=o.add(_t,Ct),At=o.mul(ft,vt),At=o.add(At,At),Ct=o.mul(At,yt),Rt=o.sub(Rt,Ct),Tt=o.mul(At,Nt),Tt=o.add(Tt,Tt),Tt=o.add(Tt,Tt),new et(Rt,_t,Tt)}add(st){tt(st);const{px:lt,py:at,pz:ct}=this,{px:ft,py:vt,pz:Rt}=st;let _t=o.ZERO,Tt=o.ZERO,Ct=o.ZERO;const Nt=e.a,At=o.mul(e.b,_3n$2);let yt=o.mul(lt,ft),xt=o.mul(at,vt),ht=o.mul(ct,Rt),Et=o.add(lt,at),ot=o.add(ft,vt);Et=o.mul(Et,ot),ot=o.add(yt,xt),Et=o.sub(Et,ot),ot=o.add(lt,ct);let dt=o.add(ft,Rt);return ot=o.mul(ot,dt),dt=o.add(yt,ht),ot=o.sub(ot,dt),dt=o.add(at,ct),_t=o.add(vt,Rt),dt=o.mul(dt,_t),_t=o.add(xt,ht),dt=o.sub(dt,_t),Ct=o.mul(Nt,ot),_t=o.mul(At,ht),Ct=o.add(_t,Ct),_t=o.sub(xt,Ct),Ct=o.add(xt,Ct),Tt=o.mul(_t,Ct),xt=o.add(yt,yt),xt=o.add(xt,yt),ht=o.mul(Nt,ht),ot=o.mul(At,ot),xt=o.add(xt,ht),ht=o.sub(yt,ht),ht=o.mul(Nt,ht),ot=o.add(ot,ht),yt=o.mul(xt,ot),Tt=o.add(Tt,yt),yt=o.mul(dt,ot),_t=o.mul(Et,_t),_t=o.sub(_t,yt),yt=o.mul(Et,xt),Ct=o.mul(dt,Ct),Ct=o.add(Ct,yt),new et(_t,Tt,Ct)}subtract(st){return this.add(st.negate())}is0(){return this.equals(et.ZERO)}wNAF(st){return rt.wNAFCached(this,_e,st,lt=>{const at=o.invertBatch(lt.map(ct=>ct.pz));return lt.map((ct,ft)=>ct.toAffine(at[ft])).map(et.fromAffine)})}multiplyUnsafe(st){const lt=et.ZERO;if(st===_0n$6)return lt;if(_(st),st===_1n$6)return this;const{endo:at}=e;if(!at)return rt.unsafeLadder(this,st);let{k1neg:ct,k1:ft,k2neg:vt,k2:Rt}=at.splitScalar(st),_t=lt,Tt=lt,Ct=this;for(;ft>_0n$6||Rt>_0n$6;)ft&_1n$6&&(_t=_t.add(Ct)),Rt&_1n$6&&(Tt=Tt.add(Ct)),Ct=Ct.double(),ft>>=_1n$6,Rt>>=_1n$6;return ct&&(_t=_t.negate()),vt&&(Tt=Tt.negate()),Tt=new et(o.mul(Tt.px,at.beta),Tt.py,Tt.pz),_t.add(Tt)}multiply(st){_(st);let lt=st,at,ct;const{endo:ft}=e;if(ft){const{k1neg:vt,k1:Rt,k2neg:_t,k2:Tt}=ft.splitScalar(lt);let{p:Ct,f:Nt}=this.wNAF(Rt),{p:At,f:yt}=this.wNAF(Tt);Ct=rt.constTimeNegate(vt,Ct),At=rt.constTimeNegate(_t,At),At=new et(o.mul(At.px,ft.beta),At.py,At.pz),at=Ct.add(At),ct=Nt.add(yt)}else{const{p:vt,f:Rt}=this.wNAF(lt);at=vt,ct=Rt}return et.normalizeZ([at,ct])[0]}multiplyAndAddUnsafe(st,lt,at){const ct=et.BASE,ft=(Rt,_t)=>_t===_0n$6||_t===_1n$6||!Rt.equals(ct)?Rt.multiplyUnsafe(_t):Rt.multiply(_t),vt=ft(this,lt).add(ft(st,at));return vt.is0()?void 0:vt}toAffine(st){const{px:lt,py:at,pz:ct}=this,ft=this.is0();st==null&&(st=ft?o.ONE:o.inv(ct));const vt=o.mul(lt,st),Rt=o.mul(at,st),_t=o.mul(ct,st);if(ft)return{x:o.ZERO,y:o.ZERO};if(!o.eql(_t,o.ONE))throw new Error("invZ was invalid");return{x:vt,y:Rt}}isTorsionFree(){const{h:st,isTorsionFree:lt}=e;if(st===_1n$6)return!0;if(lt)return lt(et,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:st,clearCofactor:lt}=e;return st===_1n$6?this:lt?lt(et,this):this.multiplyUnsafe(e.h)}toRawBytes(st=!0){return this.assertValidity(),a(et,this,st)}toHex(st=!0){return bytesToHex$2(this.toRawBytes(st))}}et.BASE=new et(e.Gx,e.Gy,o.ONE),et.ZERO=new et(o.ZERO,o.ONE,o.ZERO);const nt=e.nBitLength,rt=wNAF$1(et,e.endo?Math.ceil(nt/2):nt);return{CURVE:e,ProjectivePoint:et,normPrivateKeyToScalar:j,weierstrassEquation:g,isWithinCurveOrder:b}}function validateOpts(s){const e=validateBasic(s);return validateObject(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function weierstrass$1(s){const e=validateOpts(s),{Fp:o,n:a}=e,c=o.BYTES+1,g=2*o.BYTES+1;function b(ot){return _0n$6<ot&&ot<o.ORDER}function _(ot){return mod$1(ot,a)}function j(ot){return invert$1(ot,a)}const{ProjectivePoint:_e,normPrivateKeyToScalar:tt,weierstrassEquation:et,isWithinCurveOrder:nt}=weierstrassPoints({...e,toBytes(ot,dt,bt){const wt=dt.toAffine(),St=o.toBytes(wt.x),gt=concatBytes$2;return bt?gt(Uint8Array.from([dt.hasEvenY()?2:3]),St):gt(Uint8Array.from([4]),St,o.toBytes(wt.y))},fromBytes(ot){const dt=ot.length,bt=ot[0],wt=ot.subarray(1);if(dt===c&&(bt===2||bt===3)){const St=bytesToNumberBE$1(wt);if(!b(St))throw new Error("Point is not on curve");const gt=et(St);let $t=o.sqrt(gt);const kt=($t&_1n$6)===_1n$6;return(bt&1)===1!==kt&&($t=o.neg($t)),{x:St,y:$t}}else if(dt===g&&bt===4){const St=o.fromBytes(wt.subarray(0,o.BYTES)),gt=o.fromBytes(wt.subarray(o.BYTES,2*o.BYTES));return{x:St,y:gt}}else throw new Error(`Point of length ${dt} was invalid. Expected ${c} compressed bytes or ${g} uncompressed bytes`)}}),rt=ot=>bytesToHex$2(numberToBytesBE$1(ot,e.nByteLength));function it(ot){const dt=a>>_1n$6;return ot>dt}function st(ot){return it(ot)?_(-ot):ot}const lt=(ot,dt,bt)=>bytesToNumberBE$1(ot.slice(dt,bt));class at{constructor(dt,bt,wt){this.r=dt,this.s=bt,this.recovery=wt,this.assertValidity()}static fromCompact(dt){const bt=e.nByteLength;return dt=ensureBytes$1("compactSignature",dt,bt*2),new at(lt(dt,0,bt),lt(dt,bt,2*bt))}static fromDER(dt){const{r:bt,s:wt}=DER$1.toSig(ensureBytes$1("DER",dt));return new at(bt,wt)}assertValidity(){if(!nt(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!nt(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(dt){return new at(this.r,this.s,dt)}recoverPublicKey(dt){const{r:bt,s:wt,recovery:St}=this,gt=Tt(ensureBytes$1("msgHash",dt));if(St==null||![0,1,2,3].includes(St))throw new Error("recovery id invalid");const $t=St===2||St===3?bt+e.n:bt;if($t>=o.ORDER)throw new Error("recovery id 2 or 3 invalid");const kt=St&1?"03":"02",Pt=_e.fromHex(kt+rt($t)),jt=j($t),Dt=_(-gt*jt),Bt=_(wt*jt),Mt=_e.BASE.multiplyAndAddUnsafe(Pt,Dt,Bt);if(!Mt)throw new Error("point at infinify");return Mt.assertValidity(),Mt}hasHighS(){return it(this.s)}normalizeS(){return this.hasHighS()?new at(this.r,_(-this.s),this.recovery):this}toDERRawBytes(){return hexToBytes$2(this.toDERHex())}toDERHex(){return DER$1.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return hexToBytes$2(this.toCompactHex())}toCompactHex(){return rt(this.r)+rt(this.s)}}const ct={isValidPrivateKey(ot){try{return tt(ot),!0}catch{return!1}},normPrivateKeyToScalar:tt,randomPrivateKey:()=>{const ot=getMinHashLength$1(e.n);return mapHashToField$1(e.randomBytes(ot),e.n)},precompute(ot=8,dt=_e.BASE){return dt._setWindowSize(ot),dt.multiply(BigInt(3)),dt}};function ft(ot,dt=!0){return _e.fromPrivateKey(ot).toRawBytes(dt)}function vt(ot){const dt=ot instanceof Uint8Array,bt=typeof ot=="string",wt=(dt||bt)&&ot.length;return dt?wt===c||wt===g:bt?wt===2*c||wt===2*g:ot instanceof _e}function Rt(ot,dt,bt=!0){if(vt(ot))throw new Error("first arg must be private key");if(!vt(dt))throw new Error("second arg must be public key");return _e.fromHex(dt).multiply(tt(ot)).toRawBytes(bt)}const _t=e.bits2int||function(ot){const dt=bytesToNumberBE$1(ot),bt=ot.length*8-e.nBitLength;return bt>0?dt>>BigInt(bt):dt},Tt=e.bits2int_modN||function(ot){return _(_t(ot))},Ct=bitMask$1(e.nBitLength);function Nt(ot){if(typeof ot!="bigint")throw new Error("bigint expected");if(!(_0n$6<=ot&&ot<Ct))throw new Error(`bigint expected < 2^${e.nBitLength}`);return numberToBytesBE$1(ot,e.nByteLength)}function At(ot,dt,bt=yt){if(["recovered","canonical"].some(Kt=>Kt in bt))throw new Error("sign() legacy options not supported");const{hash:wt,randomBytes:St}=e;let{lowS:gt,prehash:$t,extraEntropy:kt}=bt;gt==null&&(gt=!0),ot=ensureBytes$1("msgHash",ot),$t&&(ot=ensureBytes$1("prehashed msgHash",wt(ot)));const Pt=Tt(ot),jt=tt(dt),Dt=[Nt(jt),Nt(Pt)];if(kt!=null){const Kt=kt===!0?St(o.BYTES):kt;Dt.push(ensureBytes$1("extraEntropy",Kt))}const Bt=concatBytes$2(...Dt),Mt=Pt;function Wt(Kt){const Qt=_t(Kt);if(!nt(Qt))return;const Zt=j(Qt),cn=_e.BASE.multiply(Qt).toAffine(),nn=_(cn.x);if(nn===_0n$6)return;const xn=_(Zt*_(Mt+nn*jt));if(xn===_0n$6)return;let gr=(cn.x===nn?0:2)|Number(cn.y&_1n$6),Mn=xn;return gt&&it(xn)&&(Mn=st(xn),gr^=1),new at(nn,Mn,gr)}return{seed:Bt,k2sig:Wt}}const yt={lowS:e.lowS,prehash:!1},xt={lowS:e.lowS,prehash:!1};function ht(ot,dt,bt=yt){const{seed:wt,k2sig:St}=At(ot,dt,bt),gt=e;return createHmacDrbg$1(gt.hash.outputLen,gt.nByteLength,gt.hmac)(wt,St)}_e.BASE._setWindowSize(8);function Et(ot,dt,bt,wt=xt){var cn;const St=ot;if(dt=ensureBytes$1("msgHash",dt),bt=ensureBytes$1("publicKey",bt),"strict"in wt)throw new Error("options.strict was renamed to lowS");const{lowS:gt,prehash:$t}=wt;let kt,Pt;try{if(typeof St=="string"||St instanceof Uint8Array)try{kt=at.fromDER(St)}catch(nn){if(!(nn instanceof DER$1.Err))throw nn;kt=at.fromCompact(St)}else if(typeof St=="object"&&typeof St.r=="bigint"&&typeof St.s=="bigint"){const{r:nn,s:xn}=St;kt=new at(nn,xn)}else throw new Error("PARSE");Pt=_e.fromHex(bt)}catch(nn){if(nn.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(gt&&kt.hasHighS())return!1;$t&&(dt=e.hash(dt));const{r:jt,s:Dt}=kt,Bt=Tt(dt),Mt=j(Dt),Wt=_(Bt*Mt),Kt=_(jt*Mt),Qt=(cn=_e.BASE.multiplyAndAddUnsafe(Pt,Wt,Kt))==null?void 0:cn.toAffine();return Qt?_(Qt.x)===jt:!1}return{CURVE:e,getPublicKey:ft,getSharedSecret:Rt,sign:ht,verify:Et,ProjectivePoint:_e,Signature:at,utils:ct}}let HMAC$2=class extends Hash$2{constructor(e,o){super(),this.finished=!1,this.destroyed=!1,hash$1(e);const a=toBytes$2(o);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const c=this.blockLen,g=new Uint8Array(c);g.set(a.length>c?e.create().update(a).digest():a);for(let b=0;b<g.length;b++)g[b]^=54;this.iHash.update(g),this.oHash=e.create();for(let b=0;b<g.length;b++)g[b]^=106;this.oHash.update(g),g.fill(0)}update(e){return exists$1(this),this.iHash.update(e),this}digestInto(e){exists$1(this),bytes$2(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:o,iHash:a,finished:c,destroyed:g,blockLen:b,outputLen:_}=this;return e=e,e.finished=c,e.destroyed=g,e.blockLen=b,e.outputLen=_,e.oHash=o._cloneInto(e.oHash),e.iHash=a._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const hmac$2=(s,e,o)=>new HMAC$2(s,e).update(o).digest();hmac$2.create=(s,e)=>new HMAC$2(s,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function getHash(s){return{hash:s,hmac:(e,...o)=>hmac$2(s,e,concatBytes$3(...o)),randomBytes:randomBytes$2}}function createCurve$1(s,e){const o=a=>weierstrass$1({...s,...getHash(a)});return Object.freeze({...o(e),create:o})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const secp256k1P=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),secp256k1N=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),_1n$5=BigInt(1),_2n$3=BigInt(2),divNearest$1=(s,e)=>(s+e/_2n$3)/e;function sqrtMod$1(s){const e=secp256k1P,o=BigInt(3),a=BigInt(6),c=BigInt(11),g=BigInt(22),b=BigInt(23),_=BigInt(44),j=BigInt(88),_e=s*s*s%e,tt=_e*_e*s%e,et=pow2$1(tt,o,e)*tt%e,nt=pow2$1(et,o,e)*tt%e,rt=pow2$1(nt,_2n$3,e)*_e%e,it=pow2$1(rt,c,e)*rt%e,st=pow2$1(it,g,e)*it%e,lt=pow2$1(st,_,e)*st%e,at=pow2$1(lt,j,e)*lt%e,ct=pow2$1(at,_,e)*st%e,ft=pow2$1(ct,o,e)*tt%e,vt=pow2$1(ft,b,e)*it%e,Rt=pow2$1(vt,a,e)*_e%e,_t=pow2$1(Rt,_2n$3,e);if(!Fp.eql(Fp.sqr(_t),s))throw new Error("Cannot find square root");return _t}const Fp=Field$1(secp256k1P,void 0,void 0,{sqrt:sqrtMod$1}),secp256k1$1=createCurve$1({a:BigInt(0),b:BigInt(7),Fp,n:secp256k1N,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:s=>{const e=secp256k1N,o=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),a=-_1n$5*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),c=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),g=o,b=BigInt("0x100000000000000000000000000000000"),_=divNearest$1(g*s,e),j=divNearest$1(-a*s,e);let _e=mod$1(s-_*o-j*c,e),tt=mod$1(-_*a-j*g,e);const et=_e>b,nt=tt>b;if(et&&(_e=e-_e),nt&&(tt=e-tt),_e>b||tt>b)throw new Error("splitScalar: Endomorphism failed, k="+s);return{k1neg:et,k1:_e,k2neg:nt,k2:tt}}}},sha256$3),_0n$5=BigInt(0),fe=s=>typeof s=="bigint"&&_0n$5<s&&s<secp256k1P,ge=s=>typeof s=="bigint"&&_0n$5<s&&s<secp256k1N,TAGGED_HASH_PREFIXES$1={};function taggedHash$1(s,...e){let o=TAGGED_HASH_PREFIXES$1[s];if(o===void 0){const a=sha256$3(Uint8Array.from(s,c=>c.charCodeAt(0)));o=concatBytes$2(a,a),TAGGED_HASH_PREFIXES$1[s]=o}return sha256$3(concatBytes$2(o,...e))}const pointToBytes$1=s=>s.toRawBytes(!0).slice(1),numTo32b=s=>numberToBytesBE$1(s,32),modP=s=>mod$1(s,secp256k1P),modN=s=>mod$1(s,secp256k1N),Point=secp256k1$1.ProjectivePoint,GmulAdd=(s,e,o)=>Point.BASE.multiplyAndAddUnsafe(s,e,o);function schnorrGetExtPubKey$1(s){let e=secp256k1$1.utils.normPrivateKeyToScalar(s),o=Point.fromPrivateKey(e);return{scalar:o.hasEvenY()?e:modN(-e),bytes:pointToBytes$1(o)}}function lift_x$1(s){if(!fe(s))throw new Error("bad x: need 0 < x < p");const e=modP(s*s),o=modP(e*s+BigInt(7));let a=sqrtMod$1(o);a%_2n$3!==_0n$5&&(a=modP(-a));const c=new Point(s,a,_1n$5);return c.assertValidity(),c}function challenge$1(...s){return modN(bytesToNumberBE$1(taggedHash$1("BIP0340/challenge",...s)))}function schnorrGetPublicKey$1(s){return schnorrGetExtPubKey$1(s).bytes}function schnorrSign$1(s,e,o=randomBytes$2(32)){const a=ensureBytes$1("message",s),{bytes:c,scalar:g}=schnorrGetExtPubKey$1(e),b=ensureBytes$1("auxRand",o,32),_=numTo32b(g^bytesToNumberBE$1(taggedHash$1("BIP0340/aux",b))),j=taggedHash$1("BIP0340/nonce",_,c,a),_e=modN(bytesToNumberBE$1(j));if(_e===_0n$5)throw new Error("sign failed: k is zero");const{bytes:tt,scalar:et}=schnorrGetExtPubKey$1(_e),nt=challenge$1(tt,c,a),rt=new Uint8Array(64);if(rt.set(tt,0),rt.set(numTo32b(modN(et+nt*g)),32),!schnorrVerify$1(rt,a,c))throw new Error("sign: Invalid signature produced");return rt}function schnorrVerify$1(s,e,o){const a=ensureBytes$1("signature",s,64),c=ensureBytes$1("message",e),g=ensureBytes$1("publicKey",o,32);try{const b=lift_x$1(bytesToNumberBE$1(g)),_=bytesToNumberBE$1(a.subarray(0,32));if(!fe(_))return!1;const j=bytesToNumberBE$1(a.subarray(32,64));if(!ge(j))return!1;const _e=challenge$1(numTo32b(_),pointToBytes$1(b),c),tt=GmulAdd(b,j,modN(-_e));return!(!tt||!tt.hasEvenY()||tt.toAffine().x!==_)}catch{return!1}}const schnorr$1={getPublicKey:schnorrGetPublicKey$1,sign:schnorrSign$1,verify:schnorrVerify$1,utils:{randomPrivateKey:secp256k1$1.utils.randomPrivateKey,lift_x:lift_x$1,pointToBytes:pointToBytes$1,numberToBytesBE:numberToBytesBE$1,bytesToNumberBE:bytesToNumberBE$1,taggedHash:taggedHash$1,mod:mod$1}},crypto$1=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const u8a=s=>s instanceof Uint8Array,createView$1=s=>new DataView(s.buffer,s.byteOffset,s.byteLength),rotr$1=(s,e)=>s<<32-e|s>>>e,isLE$1=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE$1)throw new Error("Non little-endian hardware is not supported");const hexes$1=Array.from({length:256},(s,e)=>e.toString(16).padStart(2,"0"));function bytesToHex$1(s){if(!u8a(s))throw new Error("Uint8Array expected");let e="";for(let o=0;o<s.length;o++)e+=hexes$1[s[o]];return e}function hexToBytes$1(s){if(typeof s!="string")throw new Error("hex string expected, got "+typeof s);const e=s.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const o=new Uint8Array(e/2);for(let a=0;a<o.length;a++){const c=a*2,g=s.slice(c,c+2),b=Number.parseInt(g,16);if(Number.isNaN(b)||b<0)throw new Error("Invalid byte sequence");o[a]=b}return o}function utf8ToBytes$1(s){if(typeof s!="string")throw new Error(`utf8ToBytes expected string, got ${typeof s}`);return new Uint8Array(new TextEncoder().encode(s))}function toBytes$1(s){if(typeof s=="string"&&(s=utf8ToBytes$1(s)),!u8a(s))throw new Error(`expected Uint8Array, got ${typeof s}`);return s}function concatBytes$1(...s){const e=new Uint8Array(s.reduce((a,c)=>a+c.length,0));let o=0;return s.forEach(a=>{if(!u8a(a))throw new Error("Uint8Array expected");e.set(a,o),o+=a.length}),e}let Hash$1=class{clone(){return this._cloneInto()}};function wrapConstructor(s){const e=a=>s().update(toBytes$1(a)).digest(),o=s();return e.outputLen=o.outputLen,e.blockLen=o.blockLen,e.create=()=>s(),e}function randomBytes$1(s=32){if(crypto$1&&typeof crypto$1.getRandomValues=="function")return crypto$1.getRandomValues(new Uint8Array(s));throw new Error("crypto.getRandomValues must be defined")}function number$1(s){if(!Number.isSafeInteger(s)||s<0)throw new Error(`Wrong positive integer: ${s}`)}function bool$1(s){if(typeof s!="boolean")throw new Error(`Expected boolean, not ${s}`)}function bytes$1(s,...e){if(!(s instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(s.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${s.length}`)}function hash(s){if(typeof s!="function"||typeof s.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");number$1(s.outputLen),number$1(s.blockLen)}function exists(s,e=!0){if(s.destroyed)throw new Error("Hash instance has been destroyed");if(e&&s.finished)throw new Error("Hash#digest() has already been called")}function output(s,e){bytes$1(s);const o=e.outputLen;if(s.length<o)throw new Error(`digestInto() expects output buffer of length at least ${o}`)}const assert={number:number$1,bool:bool$1,bytes:bytes$1,hash,exists,output};function setBigUint64$1(s,e,o,a){if(typeof s.setBigUint64=="function")return s.setBigUint64(e,o,a);const c=BigInt(32),g=BigInt(4294967295),b=Number(o>>c&g),_=Number(o&g),j=a?4:0,_e=a?0:4;s.setUint32(e+j,b,a),s.setUint32(e+_e,_,a)}class SHA2 extends Hash$1{constructor(e,o,a,c){super(),this.blockLen=e,this.outputLen=o,this.padOffset=a,this.isLE=c,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=createView$1(this.buffer)}update(e){assert.exists(this);const{view:o,buffer:a,blockLen:c}=this;e=toBytes$1(e);const g=e.length;for(let b=0;b<g;){const _=Math.min(c-this.pos,g-b);if(_===c){const j=createView$1(e);for(;c<=g-b;b+=c)this.process(j,b);continue}a.set(e.subarray(b,b+_),this.pos),this.pos+=_,b+=_,this.pos===c&&(this.process(o,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){assert.exists(this),assert.output(e,this),this.finished=!0;const{buffer:o,view:a,blockLen:c,isLE:g}=this;let{pos:b}=this;o[b++]=128,this.buffer.subarray(b).fill(0),this.padOffset>c-b&&(this.process(a,0),b=0);for(let et=b;et<c;et++)o[et]=0;setBigUint64$1(a,c-8,BigInt(this.length*8),g),this.process(a,0);const _=createView$1(e),j=this.outputLen;if(j%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const _e=j/4,tt=this.get();if(_e>tt.length)throw new Error("_sha2: outputLen bigger than state");for(let et=0;et<_e;et++)_.setUint32(4*et,tt[et],g)}digest(){const{buffer:e,outputLen:o}=this;this.digestInto(e);const a=e.slice(0,o);return this.destroy(),a}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:o,buffer:a,length:c,finished:g,destroyed:b,pos:_}=this;return e.length=c,e.pos=_,e.finished=g,e.destroyed=b,c%o&&e.buffer.set(a),e}}const Chi$1=(s,e,o)=>s&e^~s&o,Maj$1=(s,e,o)=>s&e^s&o^e&o,SHA256_K$1=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),IV=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_W$1=new Uint32Array(64);let SHA256$1=class extends SHA2{constructor(){super(64,32,8,!1),this.A=IV[0]|0,this.B=IV[1]|0,this.C=IV[2]|0,this.D=IV[3]|0,this.E=IV[4]|0,this.F=IV[5]|0,this.G=IV[6]|0,this.H=IV[7]|0}get(){const{A:e,B:o,C:a,D:c,E:g,F:b,G:_,H:j}=this;return[e,o,a,c,g,b,_,j]}set(e,o,a,c,g,b,_,j){this.A=e|0,this.B=o|0,this.C=a|0,this.D=c|0,this.E=g|0,this.F=b|0,this.G=_|0,this.H=j|0}process(e,o){for(let et=0;et<16;et++,o+=4)SHA256_W$1[et]=e.getUint32(o,!1);for(let et=16;et<64;et++){const nt=SHA256_W$1[et-15],rt=SHA256_W$1[et-2],it=rotr$1(nt,7)^rotr$1(nt,18)^nt>>>3,st=rotr$1(rt,17)^rotr$1(rt,19)^rt>>>10;SHA256_W$1[et]=st+SHA256_W$1[et-7]+it+SHA256_W$1[et-16]|0}let{A:a,B:c,C:g,D:b,E:_,F:j,G:_e,H:tt}=this;for(let et=0;et<64;et++){const nt=rotr$1(_,6)^rotr$1(_,11)^rotr$1(_,25),rt=tt+nt+Chi$1(_,j,_e)+SHA256_K$1[et]+SHA256_W$1[et]|0,st=(rotr$1(a,2)^rotr$1(a,13)^rotr$1(a,22))+Maj$1(a,c,g)|0;tt=_e,_e=j,j=_,_=b+rt|0,b=g,g=c,c=a,a=rt+st|0}a=a+this.A|0,c=c+this.B|0,g=g+this.C|0,b=b+this.D|0,_=_+this.E|0,j=j+this.F|0,_e=_e+this.G|0,tt=tt+this.H|0,this.set(a,c,g,b,_,j,_e,tt)}roundClean(){SHA256_W$1.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};class SHA224 extends SHA256$1{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const sha256$2=wrapConstructor(()=>new SHA256$1);wrapConstructor(()=>new SHA224);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function assertNumber(s){if(!Number.isSafeInteger(s))throw new Error(`Wrong integer: ${s}`)}function chain(...s){const e=(c,g)=>b=>c(g(b)),o=Array.from(s).reverse().reduce((c,g)=>c?e(c,g.encode):g.encode,void 0),a=s.reduce((c,g)=>c?e(c,g.decode):g.decode,void 0);return{encode:o,decode:a}}function alphabet(s){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map(o=>{if(assertNumber(o),o<0||o>=s.length)throw new Error(`Digit index outside alphabet: ${o} (alphabet: ${s.length})`);return s[o]})},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map(o=>{if(typeof o!="string")throw new Error(`alphabet.decode: not string element=${o}`);const a=s.indexOf(o);if(a===-1)throw new Error(`Unknown letter: "${o}". Allowed: ${s}`);return a})}}}function join(s=""){if(typeof s!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let o of e)if(typeof o!="string")throw new Error(`join.encode: non-string input=${o}`);return e.join(s)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split(s)}}}function padding(s,e="="){if(assertNumber(s),typeof e!="string")throw new Error("padding chr should be string");return{encode(o){if(!Array.isArray(o)||o.length&&typeof o[0]!="string")throw new Error("padding.encode input should be array of strings");for(let a of o)if(typeof a!="string")throw new Error(`padding.encode: non-string input=${a}`);for(;o.length*s%8;)o.push(e);return o},decode(o){if(!Array.isArray(o)||o.length&&typeof o[0]!="string")throw new Error("padding.encode input should be array of strings");for(let c of o)if(typeof c!="string")throw new Error(`padding.decode: non-string input=${c}`);let a=o.length;if(a*s%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;a>0&&o[a-1]===e;a--)if(!((a-1)*s%8))throw new Error("Invalid padding: string has too much padding");return o.slice(0,a)}}}function normalize$1(s){if(typeof s!="function")throw new Error("normalize fn should be function");return{encode:e=>e,decode:e=>s(e)}}function convertRadix(s,e,o){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(o<2)throw new Error(`convertRadix: wrong to=${o}, base cannot be less than 2`);if(!Array.isArray(s))throw new Error("convertRadix: data should be array");if(!s.length)return[];let a=0;const c=[],g=Array.from(s);for(g.forEach(b=>{if(assertNumber(b),b<0||b>=e)throw new Error(`Wrong integer: ${b}`)});;){let b=0,_=!0;for(let j=a;j<g.length;j++){const _e=g[j],tt=e*b+_e;if(!Number.isSafeInteger(tt)||e*b/e!==b||tt-_e!==e*b)throw new Error("convertRadix: carry overflow");if(b=tt%o,g[j]=Math.floor(tt/o),!Number.isSafeInteger(g[j])||g[j]*o+b!==tt)throw new Error("convertRadix: carry overflow");if(_)g[j]?_=!1:a=j;else continue}if(c.push(b),_)break}for(let b=0;b<s.length-1&&s[b]===0;b++)c.push(0);return c.reverse()}const gcd=(s,e)=>e?gcd(e,s%e):s,radix2carry=(s,e)=>s+(e-gcd(s,e));function convertRadix2(s,e,o,a){if(!Array.isArray(s))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(o<=0||o>32)throw new Error(`convertRadix2: wrong to=${o}`);if(radix2carry(e,o)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${o} carryBits=${radix2carry(e,o)}`);let c=0,g=0;const b=2**o-1,_=[];for(const j of s){if(assertNumber(j),j>=2**e)throw new Error(`convertRadix2: invalid data word=${j} from=${e}`);if(c=c<<e|j,g+e>32)throw new Error(`convertRadix2: carry overflow pos=${g} from=${e}`);for(g+=e;g>=o;g-=o)_.push((c>>g-o&b)>>>0);c&=2**g-1}if(c=c<<o-g&b,!a&&g>=e)throw new Error("Excess padding");if(!a&&c)throw new Error(`Non-zero padding: ${c}`);return a&&g>0&&_.push(c>>>0),_}function radix(s){return assertNumber(s),{encode:e=>{if(!(e instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return convertRadix(Array.from(e),2**8,s)},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(convertRadix(e,s,2**8))}}}function radix2(s,e=!1){if(assertNumber(s),s<=0||s>32)throw new Error("radix2: bits should be in (0..32]");if(radix2carry(8,s)>32||radix2carry(s,8)>32)throw new Error("radix2: carry overflow");return{encode:o=>{if(!(o instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return convertRadix2(Array.from(o),8,s,!e)},decode:o=>{if(!Array.isArray(o)||o.length&&typeof o[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(convertRadix2(o,s,8,e))}}}function unsafeWrapper(s){if(typeof s!="function")throw new Error("unsafeWrapper fn should be function");return function(...e){try{return s.apply(null,e)}catch{}}}const base16=chain(radix2(4),alphabet("0123456789ABCDEF"),join("")),base32=chain(radix2(5),alphabet("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),padding(5),join(""));chain(radix2(5),alphabet("0123456789ABCDEFGHIJKLMNOPQRSTUV"),padding(5),join(""));chain(radix2(5),alphabet("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),join(""),normalize$1(s=>s.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const base64=chain(radix2(6),alphabet("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),padding(6),join("")),base64url=chain(radix2(6),alphabet("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),padding(6),join("")),genBase58=s=>chain(radix(58),alphabet(s),join("")),base58=genBase58("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");genBase58("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");genBase58("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const XMR_BLOCK_LEN=[0,2,3,5,6,7,9,10,11],base58xmr={encode(s){let e="";for(let o=0;o<s.length;o+=8){const a=s.subarray(o,o+8);e+=base58.encode(a).padStart(XMR_BLOCK_LEN[a.length],"1")}return e},decode(s){let e=[];for(let o=0;o<s.length;o+=11){const a=s.slice(o,o+11),c=XMR_BLOCK_LEN.indexOf(a.length),g=base58.decode(a);for(let b=0;b<g.length-c;b++)if(g[b]!==0)throw new Error("base58xmr: wrong padding");e=e.concat(Array.from(g.slice(g.length-c)))}return Uint8Array.from(e)}},BECH_ALPHABET=chain(alphabet("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),join("")),POLYMOD_GENERATORS=[996825010,642813549,513874426,1027748829,705979059];function bech32Polymod(s){const e=s>>25;let o=(s&33554431)<<5;for(let a=0;a<POLYMOD_GENERATORS.length;a++)(e>>a&1)===1&&(o^=POLYMOD_GENERATORS[a]);return o}function bechChecksum(s,e,o=1){const a=s.length;let c=1;for(let g=0;g<a;g++){const b=s.charCodeAt(g);if(b<33||b>126)throw new Error(`Invalid prefix (${s})`);c=bech32Polymod(c)^b>>5}c=bech32Polymod(c);for(let g=0;g<a;g++)c=bech32Polymod(c)^s.charCodeAt(g)&31;for(let g of e)c=bech32Polymod(c)^g;for(let g=0;g<6;g++)c=bech32Polymod(c);return c^=o,BECH_ALPHABET.encode(convertRadix2([c%2**30],30,5,!1))}function genBech32(s){const e=s==="bech32"?1:734539939,o=radix2(5),a=o.decode,c=o.encode,g=unsafeWrapper(a);function b(tt,et,nt=90){if(typeof tt!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof tt}`);if(!Array.isArray(et)||et.length&&typeof et[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof et}`);const rt=tt.length+7+et.length;if(nt!==!1&&rt>nt)throw new TypeError(`Length ${rt} exceeds limit ${nt}`);return tt=tt.toLowerCase(),`${tt}1${BECH_ALPHABET.encode(et)}${bechChecksum(tt,et,e)}`}function _(tt,et=90){if(typeof tt!="string")throw new Error(`bech32.decode input should be string, not ${typeof tt}`);if(tt.length<8||et!==!1&&tt.length>et)throw new TypeError(`Wrong string length: ${tt.length} (${tt}). Expected (8..${et})`);const nt=tt.toLowerCase();if(tt!==nt&&tt!==tt.toUpperCase())throw new Error("String must be lowercase or uppercase");tt=nt;const rt=tt.lastIndexOf("1");if(rt===0||rt===-1)throw new Error('Letter "1" must be present between prefix and data only');const it=tt.slice(0,rt),st=tt.slice(rt+1);if(st.length<6)throw new Error("Data must be at least 6 characters long");const lt=BECH_ALPHABET.decode(st).slice(0,-6),at=bechChecksum(it,lt,e);if(!st.endsWith(at))throw new Error(`Invalid checksum in ${tt}: expected "${at}"`);return{prefix:it,words:lt}}const j=unsafeWrapper(_);function _e(tt){const{prefix:et,words:nt}=_(tt,!1);return{prefix:et,words:nt,bytes:a(nt)}}return{encode:b,decode:_,decodeToBytes:_e,decodeUnsafe:j,fromWords:a,fromWordsUnsafe:g,toWords:c}}const bech32$1=genBech32("bech32");genBech32("bech32m");const utf8$1={encode:s=>new TextDecoder().decode(s),decode:s=>new TextEncoder().encode(s)},hex$1=chain(radix2(4),alphabet("0123456789abcdef"),join(""),normalize$1(s=>{if(typeof s!="string"||s.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof s} with length ${s.length}`);return s.toLowerCase()})),CODERS={utf8:utf8$1,hex:hex$1,base16,base32,base64,base64url,base58,base58xmr};`${Object.keys(CODERS).join(", ")}`;function number(s){if(!Number.isSafeInteger(s)||s<0)throw new Error(`positive integer expected, not ${s}`)}function bool(s){if(typeof s!="boolean")throw new Error(`boolean expected, not ${s}`)}function isBytes$1(s){return s instanceof Uint8Array||s!=null&&typeof s=="object"&&s.constructor.name==="Uint8Array"}function bytes(s,...e){if(!isBytes$1(s))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(s.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${s.length}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const u32=s=>new Uint32Array(s.buffer,s.byteOffset,Math.floor(s.byteLength/4)),isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE)throw new Error("Non little-endian hardware is not supported");function checkOpts(s,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(s,e)}function equalBytes(s,e){if(s.length!==e.length)return!1;let o=0;for(let a=0;a<s.length;a++)o|=s[a]^e[a];return o===0}const wrapCipher=(s,e)=>(Object.assign(e,s),e),BLOCK_SIZE=16,POLY=283;function mul2(s){return s<<1^POLY&-(s>>7)}function mul(s,e){let o=0;for(;e>0;e>>=1)o^=s&-(e&1),s=mul2(s);return o}const sbox=(()=>{let s=new Uint8Array(256);for(let o=0,a=1;o<256;o++,a^=mul2(a))s[o]=a;const e=new Uint8Array(256);e[0]=99;for(let o=0;o<255;o++){let a=s[255-o];a|=a<<8,e[s[o]]=(a^a>>4^a>>5^a>>6^a>>7^99)&255}return e})(),invSbox=sbox.map((s,e)=>sbox.indexOf(e)),rotr32_8=s=>s<<24|s>>>8,rotl32_8=s=>s<<8|s>>>24;function genTtable(s,e){if(s.length!==256)throw new Error("Wrong sbox length");const o=new Uint32Array(256).map((_e,tt)=>e(s[tt])),a=o.map(rotl32_8),c=a.map(rotl32_8),g=c.map(rotl32_8),b=new Uint32Array(256*256),_=new Uint32Array(256*256),j=new Uint16Array(256*256);for(let _e=0;_e<256;_e++)for(let tt=0;tt<256;tt++){const et=_e*256+tt;b[et]=o[_e]^a[tt],_[et]=c[_e]^g[tt],j[et]=s[_e]<<8|s[tt]}return{sbox:s,sbox2:j,T0:o,T1:a,T2:c,T3:g,T01:b,T23:_}}const tableEncoding=genTtable(sbox,s=>mul(s,3)<<24|s<<16|s<<8|mul(s,2)),tableDecoding=genTtable(invSbox,s=>mul(s,11)<<24|mul(s,13)<<16|mul(s,9)<<8|mul(s,14)),xPowers=(()=>{const s=new Uint8Array(16);for(let e=0,o=1;e<16;e++,o=mul2(o))s[e]=o;return s})();function expandKeyLE(s){bytes(s);const e=s.length;if(![16,24,32].includes(e))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${e}`);const{sbox2:o}=tableEncoding,a=u32(s),c=a.length,g=_=>applySbox(o,_,_,_,_),b=new Uint32Array(e+28);b.set(a);for(let _=c;_<b.length;_++){let j=b[_-1];_%c===0?j=g(rotr32_8(j))^xPowers[_/c-1]:c>6&&_%c===4&&(j=g(j)),b[_]=b[_-c]^j}return b}function expandKeyDecLE(s){const e=expandKeyLE(s),o=e.slice(),a=e.length,{sbox2:c}=tableEncoding,{T0:g,T1:b,T2:_,T3:j}=tableDecoding;for(let _e=0;_e<a;_e+=4)for(let tt=0;tt<4;tt++)o[_e+tt]=e[a-_e-4+tt];e.fill(0);for(let _e=4;_e<a-4;_e++){const tt=o[_e],et=applySbox(c,tt,tt,tt,tt);o[_e]=g[et&255]^b[et>>>8&255]^_[et>>>16&255]^j[et>>>24]}return o}function apply0123(s,e,o,a,c,g){return s[o<<8&65280|a>>>8&255]^e[c>>>8&65280|g>>>24&255]}function applySbox(s,e,o,a,c){return s[e&255|o&65280]|s[a>>>16&255|c>>>16&65280]<<16}function encrypt$2(s,e,o,a,c){const{sbox2:g,T01:b,T23:_}=tableEncoding;let j=0;e^=s[j++],o^=s[j++],a^=s[j++],c^=s[j++];const _e=s.length/4-2;for(let it=0;it<_e;it++){const st=s[j++]^apply0123(b,_,e,o,a,c),lt=s[j++]^apply0123(b,_,o,a,c,e),at=s[j++]^apply0123(b,_,a,c,e,o),ct=s[j++]^apply0123(b,_,c,e,o,a);e=st,o=lt,a=at,c=ct}const tt=s[j++]^applySbox(g,e,o,a,c),et=s[j++]^applySbox(g,o,a,c,e),nt=s[j++]^applySbox(g,a,c,e,o),rt=s[j++]^applySbox(g,c,e,o,a);return{s0:tt,s1:et,s2:nt,s3:rt}}function decrypt$2(s,e,o,a,c){const{sbox2:g,T01:b,T23:_}=tableDecoding;let j=0;e^=s[j++],o^=s[j++],a^=s[j++],c^=s[j++];const _e=s.length/4-2;for(let it=0;it<_e;it++){const st=s[j++]^apply0123(b,_,e,c,a,o),lt=s[j++]^apply0123(b,_,o,e,c,a),at=s[j++]^apply0123(b,_,a,o,e,c),ct=s[j++]^apply0123(b,_,c,a,o,e);e=st,o=lt,a=at,c=ct}const tt=s[j++]^applySbox(g,e,c,a,o),et=s[j++]^applySbox(g,o,e,c,a),nt=s[j++]^applySbox(g,a,o,e,c),rt=s[j++]^applySbox(g,c,a,o,e);return{s0:tt,s1:et,s2:nt,s3:rt}}function getDst(s,e){if(!e)return new Uint8Array(s);if(bytes(e),e.length<s)throw new Error(`aes: wrong destination length, expected at least ${s}, got: ${e.length}`);return e}function validateBlockDecrypt(s){if(bytes(s),s.length%BLOCK_SIZE!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${BLOCK_SIZE}`)}function validateBlockEncrypt(s,e,o){let a=s.length;const c=a%BLOCK_SIZE;if(!e&&c!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const g=u32(s);if(e){let j=BLOCK_SIZE-c;j||(j=BLOCK_SIZE),a=a+j}const b=getDst(a,o),_=u32(b);return{b:g,o:_,out:b}}function validatePCKS(s,e){if(!e)return s;const o=s.length;if(!o)throw new Error("aes/pcks5: empty ciphertext not allowed");const a=s[o-1];if(a<=0||a>16)throw new Error(`aes/pcks5: wrong padding byte: ${a}`);const c=s.subarray(0,-a);for(let g=0;g<a;g++)if(s[o-g-1]!==a)throw new Error("aes/pcks5: wrong padding");return c}function padPCKS(s){const e=new Uint8Array(16),o=u32(e);e.set(s);const a=BLOCK_SIZE-s.length;for(let c=BLOCK_SIZE-a;c<BLOCK_SIZE;c++)e[c]=a;return o}const cbc=wrapCipher({blockSize:16,nonceLength:16},function s(e,o,a={}){bytes(e),bytes(o,16);const c=!a.disablePadding;return{encrypt:(g,b)=>{const _=expandKeyLE(e),{b:j,o:_e,out:tt}=validateBlockEncrypt(g,c,b),et=u32(o);let nt=et[0],rt=et[1],it=et[2],st=et[3],lt=0;for(;lt+4<=j.length;)nt^=j[lt+0],rt^=j[lt+1],it^=j[lt+2],st^=j[lt+3],{s0:nt,s1:rt,s2:it,s3:st}=encrypt$2(_,nt,rt,it,st),_e[lt++]=nt,_e[lt++]=rt,_e[lt++]=it,_e[lt++]=st;if(c){const at=padPCKS(g.subarray(lt*4));nt^=at[0],rt^=at[1],it^=at[2],st^=at[3],{s0:nt,s1:rt,s2:it,s3:st}=encrypt$2(_,nt,rt,it,st),_e[lt++]=nt,_e[lt++]=rt,_e[lt++]=it,_e[lt++]=st}return _.fill(0),tt},decrypt:(g,b)=>{validateBlockDecrypt(g);const _=expandKeyDecLE(e),j=u32(o),_e=getDst(g.length,b),tt=u32(g),et=u32(_e);let nt=j[0],rt=j[1],it=j[2],st=j[3];for(let lt=0;lt+4<=tt.length;){const at=nt,ct=rt,ft=it,vt=st;nt=tt[lt+0],rt=tt[lt+1],it=tt[lt+2],st=tt[lt+3];const{s0:Rt,s1:_t,s2:Tt,s3:Ct}=decrypt$2(_,nt,rt,it,st);et[lt++]=Rt^at,et[lt++]=_t^ct,et[lt++]=Tt^ft,et[lt++]=Ct^vt}return _.fill(0),validatePCKS(_e,c)}}}),_utf8ToBytes=s=>Uint8Array.from(s.split("").map(e=>e.charCodeAt(0))),sigma16=_utf8ToBytes("expand 16-byte k"),sigma32=_utf8ToBytes("expand 32-byte k"),sigma16_32=u32(sigma16),sigma32_32=u32(sigma32);sigma32_32.slice();function rotl(s,e){return s<<e|s>>>32-e}function isAligned32(s){return s.byteOffset%4===0}const BLOCK_LEN=64,BLOCK_LEN32=16,MAX_COUNTER=2**32-1,U32_EMPTY=new Uint32Array;function runCipher(s,e,o,a,c,g,b,_){const j=c.length,_e=new Uint8Array(BLOCK_LEN),tt=u32(_e),et=isAligned32(c)&&isAligned32(g),nt=et?u32(c):U32_EMPTY,rt=et?u32(g):U32_EMPTY;for(let it=0;it<j;b++){if(s(e,o,a,tt,b,_),b>=MAX_COUNTER)throw new Error("arx: counter overflow");const st=Math.min(BLOCK_LEN,j-it);if(et&&st===BLOCK_LEN){const lt=it/4;if(it%4!==0)throw new Error("arx: invalid block position");for(let at=0,ct;at<BLOCK_LEN32;at++)ct=lt+at,rt[ct]=nt[ct]^tt[at];it+=BLOCK_LEN;continue}for(let lt=0,at;lt<st;lt++)at=it+lt,g[at]=c[at]^_e[lt];it+=st}}function createCipher(s,e){const{allowShortKeys:o,extendNonceFn:a,counterLength:c,counterRight:g,rounds:b}=checkOpts({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof s!="function")throw new Error("core must be a function");return number(c),number(b),bool(g),bool(o),(_,j,_e,tt,et=0)=>{bytes(_),bytes(j),bytes(_e);const nt=_e.length;if(tt||(tt=new Uint8Array(nt)),bytes(tt),number(et),et<0||et>=MAX_COUNTER)throw new Error("arx: counter overflow");if(tt.length<nt)throw new Error(`arx: output (${tt.length}) is shorter than data (${nt})`);const rt=[];let it=_.length,st,lt;if(it===32)st=_.slice(),rt.push(st),lt=sigma32_32;else if(it===16&&o)st=new Uint8Array(32),st.set(_),st.set(_,16),lt=sigma16_32,rt.push(st);else throw new Error(`arx: invalid 32-byte key, got length=${it}`);isAligned32(j)||(j=j.slice(),rt.push(j));const at=u32(st);if(a){if(j.length!==24)throw new Error("arx: extended nonce must be 24 bytes");a(lt,at,u32(j.subarray(0,16)),at),j=j.subarray(16)}const ct=16-c;if(ct!==j.length)throw new Error(`arx: nonce must be ${ct} or 16 bytes`);if(ct!==12){const vt=new Uint8Array(12);vt.set(j,g?0:12-j.length),j=vt,rt.push(j)}const ft=u32(j);for(runCipher(s,lt,at,ft,_e,tt,et,b);rt.length>0;)rt.pop().fill(0);return tt}}function chachaCore(s,e,o,a,c,g=20){let b=s[0],_=s[1],j=s[2],_e=s[3],tt=e[0],et=e[1],nt=e[2],rt=e[3],it=e[4],st=e[5],lt=e[6],at=e[7],ct=c,ft=o[0],vt=o[1],Rt=o[2],_t=b,Tt=_,Ct=j,Nt=_e,At=tt,yt=et,xt=nt,ht=rt,Et=it,ot=st,dt=lt,bt=at,wt=ct,St=ft,gt=vt,$t=Rt;for(let Pt=0;Pt<g;Pt+=2)_t=_t+At|0,wt=rotl(wt^_t,16),Et=Et+wt|0,At=rotl(At^Et,12),_t=_t+At|0,wt=rotl(wt^_t,8),Et=Et+wt|0,At=rotl(At^Et,7),Tt=Tt+yt|0,St=rotl(St^Tt,16),ot=ot+St|0,yt=rotl(yt^ot,12),Tt=Tt+yt|0,St=rotl(St^Tt,8),ot=ot+St|0,yt=rotl(yt^ot,7),Ct=Ct+xt|0,gt=rotl(gt^Ct,16),dt=dt+gt|0,xt=rotl(xt^dt,12),Ct=Ct+xt|0,gt=rotl(gt^Ct,8),dt=dt+gt|0,xt=rotl(xt^dt,7),Nt=Nt+ht|0,$t=rotl($t^Nt,16),bt=bt+$t|0,ht=rotl(ht^bt,12),Nt=Nt+ht|0,$t=rotl($t^Nt,8),bt=bt+$t|0,ht=rotl(ht^bt,7),_t=_t+yt|0,$t=rotl($t^_t,16),dt=dt+$t|0,yt=rotl(yt^dt,12),_t=_t+yt|0,$t=rotl($t^_t,8),dt=dt+$t|0,yt=rotl(yt^dt,7),Tt=Tt+xt|0,wt=rotl(wt^Tt,16),bt=bt+wt|0,xt=rotl(xt^bt,12),Tt=Tt+xt|0,wt=rotl(wt^Tt,8),bt=bt+wt|0,xt=rotl(xt^bt,7),Ct=Ct+ht|0,St=rotl(St^Ct,16),Et=Et+St|0,ht=rotl(ht^Et,12),Ct=Ct+ht|0,St=rotl(St^Ct,8),Et=Et+St|0,ht=rotl(ht^Et,7),Nt=Nt+At|0,gt=rotl(gt^Nt,16),ot=ot+gt|0,At=rotl(At^ot,12),Nt=Nt+At|0,gt=rotl(gt^Nt,8),ot=ot+gt|0,At=rotl(At^ot,7);let kt=0;a[kt++]=b+_t|0,a[kt++]=_+Tt|0,a[kt++]=j+Ct|0,a[kt++]=_e+Nt|0,a[kt++]=tt+At|0,a[kt++]=et+yt|0,a[kt++]=nt+xt|0,a[kt++]=rt+ht|0,a[kt++]=it+Et|0,a[kt++]=st+ot|0,a[kt++]=lt+dt|0,a[kt++]=at+bt|0,a[kt++]=ct+wt|0,a[kt++]=ft+St|0,a[kt++]=vt+gt|0,a[kt++]=Rt+$t|0}const chacha20=createCipher(chachaCore,{counterRight:!1,counterLength:4,allowShortKeys:!1});let HMAC$1=class extends Hash$1{constructor(e,o){super(),this.finished=!1,this.destroyed=!1,assert.hash(e);const a=toBytes$1(o);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const c=this.blockLen,g=new Uint8Array(c);g.set(a.length>c?e.create().update(a).digest():a);for(let b=0;b<g.length;b++)g[b]^=54;this.iHash.update(g),this.oHash=e.create();for(let b=0;b<g.length;b++)g[b]^=106;this.oHash.update(g),g.fill(0)}update(e){return assert.exists(this),this.iHash.update(e),this}digestInto(e){assert.exists(this),assert.bytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:o,iHash:a,finished:c,destroyed:g,blockLen:b,outputLen:_}=this;return e=e,e.finished=c,e.destroyed=g,e.blockLen=b,e.outputLen=_,e.oHash=o._cloneInto(e.oHash),e.iHash=a._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const hmac$1=(s,e,o)=>new HMAC$1(s,e).update(o).digest();hmac$1.create=(s,e)=>new HMAC$1(s,e);function extract(s,e,o){return assert.hash(s),hmac$1(s,toBytes$1(o),toBytes$1(e))}const HKDF_COUNTER=new Uint8Array([0]),EMPTY_BUFFER=new Uint8Array;function expand(s,e,o,a=32){if(assert.hash(s),assert.number(a),a>255*s.outputLen)throw new Error("Length should be <= 255*HashLen");const c=Math.ceil(a/s.outputLen);o===void 0&&(o=EMPTY_BUFFER);const g=new Uint8Array(c*s.outputLen),b=hmac$1.create(s,e),_=b._cloneInto(),j=new Uint8Array(b.outputLen);for(let _e=0;_e<c;_e++)HKDF_COUNTER[0]=_e+1,_.update(_e===0?EMPTY_BUFFER:j).update(o).update(HKDF_COUNTER).digestInto(j),g.set(j,s.outputLen*_e),b._cloneInto(_);return b.destroy(),_.destroy(),j.fill(0),HKDF_COUNTER.fill(0),g.slice(0,a)}var __defProp=Object.defineProperty,__export=(s,e)=>{for(var o in e)__defProp(s,o,{get:e[o],enumerable:!0})},verifiedSymbol=Symbol("verified"),isRecord=s=>s instanceof Object;function validateEvent(s){if(!isRecord(s)||typeof s.kind!="number"||typeof s.content!="string"||typeof s.created_at!="number"||typeof s.pubkey!="string"||!s.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(s.tags))return!1;for(let e=0;e<s.tags.length;e++){let o=s.tags[e];if(!Array.isArray(o))return!1;for(let a=0;a<o.length;a++)if(typeof o[a]!="string")return!1}return!0}var utils_exports={};__export(utils_exports,{Queue:()=>Queue$2,QueueNode:()=>QueueNode,binarySearch:()=>binarySearch,bytesToHex:()=>bytesToHex$1,hexToBytes:()=>hexToBytes$1,insertEventIntoAscendingList:()=>insertEventIntoAscendingList,insertEventIntoDescendingList:()=>insertEventIntoDescendingList,normalizeURL:()=>normalizeURL,utf8Decoder:()=>utf8Decoder,utf8Encoder:()=>utf8Encoder});var utf8Decoder=new TextDecoder("utf-8"),utf8Encoder=new TextEncoder;function normalizeURL(s){try{s.indexOf("://")===-1&&(s="wss://"+s);let e=new URL(s);return e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),(e.port==="80"&&e.protocol==="ws:"||e.port==="443"&&e.protocol==="wss:")&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}catch{throw new Error(`Invalid URL: ${s}`)}}function insertEventIntoDescendingList(s,e){const[o,a]=binarySearch(s,c=>e.id===c.id?0:e.created_at===c.created_at?-1:c.created_at-e.created_at);return a||s.splice(o,0,e),s}function insertEventIntoAscendingList(s,e){const[o,a]=binarySearch(s,c=>e.id===c.id?0:e.created_at===c.created_at?-1:e.created_at-c.created_at);return a||s.splice(o,0,e),s}function binarySearch(s,e){let o=0,a=s.length-1;for(;o<=a;){const c=Math.floor((o+a)/2),g=e(s[c]);if(g===0)return[c,!0];g<0?a=c-1:o=c+1}return[o,!1]}var QueueNode=class{constructor(s){pt(this,"value");pt(this,"next",null);pt(this,"prev",null);this.value=s}},Queue$2=class{constructor(){pt(this,"first");pt(this,"last");this.first=null,this.last=null}enqueue(e){const o=new QueueNode(e);return this.last?this.last===this.first?(this.last=o,this.last.prev=this.first,this.first.next=o):(o.prev=this.last,this.last.next=o,this.last=o):(this.first=o,this.last=o),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const o=this.first;return this.first=null,this.last=null,o.value}const e=this.first;return this.first=e.next,this.first&&(this.first.prev=null),e.value}},JS=class{generateSecretKey(){return schnorr$1.utils.randomPrivateKey()}getPublicKey(s){return bytesToHex$1(schnorr$1.getPublicKey(s))}finalizeEvent(s,e){const o=s;return o.pubkey=bytesToHex$1(schnorr$1.getPublicKey(e)),o.id=getEventHash$1(o),o.sig=bytesToHex$1(schnorr$1.sign(getEventHash$1(o),e)),o[verifiedSymbol]=!0,o}verifyEvent(s){if(typeof s[verifiedSymbol]=="boolean")return s[verifiedSymbol];const e=getEventHash$1(s);if(e!==s.id)return s[verifiedSymbol]=!1,!1;try{const o=schnorr$1.verify(s.sig,e,s.pubkey);return s[verifiedSymbol]=o,o}catch{return s[verifiedSymbol]=!1,!1}}};function serializeEvent(s){if(!validateEvent(s))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,s.pubkey,s.created_at,s.kind,s.tags,s.content])}function getEventHash$1(s){let e=sha256$2(utf8Encoder.encode(serializeEvent(s)));return bytesToHex$1(e)}var i=new JS,generateSecretKey=i.generateSecretKey,getPublicKey=i.getPublicKey,finalizeEvent=i.finalizeEvent,verifyEvent=i.verifyEvent,kinds_exports={};__export(kinds_exports,{Application:()=>Application,BadgeAward:()=>BadgeAward,BadgeDefinition:()=>BadgeDefinition,BlockedRelaysList:()=>BlockedRelaysList,BookmarkList:()=>BookmarkList,Bookmarksets:()=>Bookmarksets,Calendar:()=>Calendar,CalendarEventRSVP:()=>CalendarEventRSVP,ChannelCreation:()=>ChannelCreation,ChannelHideMessage:()=>ChannelHideMessage,ChannelMessage:()=>ChannelMessage,ChannelMetadata:()=>ChannelMetadata,ChannelMuteUser:()=>ChannelMuteUser,ClassifiedListing:()=>ClassifiedListing,ClientAuth:()=>ClientAuth,CommunitiesList:()=>CommunitiesList,CommunityDefinition:()=>CommunityDefinition,CommunityPostApproval:()=>CommunityPostApproval,Contacts:()=>Contacts,CreateOrUpdateProduct:()=>CreateOrUpdateProduct,CreateOrUpdateStall:()=>CreateOrUpdateStall,Curationsets:()=>Curationsets,Date:()=>Date2,DirectMessageRelaysList:()=>DirectMessageRelaysList,DraftClassifiedListing:()=>DraftClassifiedListing,DraftLong:()=>DraftLong,Emojisets:()=>Emojisets,EncryptedDirectMessage:()=>EncryptedDirectMessage,EventDeletion:()=>EventDeletion,FileMetadata:()=>FileMetadata,FileServerPreference:()=>FileServerPreference,Followsets:()=>Followsets,GenericRepost:()=>GenericRepost,Genericlists:()=>Genericlists,GiftWrap:()=>GiftWrap,HTTPAuth:()=>HTTPAuth,Handlerinformation:()=>Handlerinformation,Handlerrecommendation:()=>Handlerrecommendation,Highlights:()=>Highlights,InterestsList:()=>InterestsList,Interestsets:()=>Interestsets,JobFeedback:()=>JobFeedback,JobRequest:()=>JobRequest,JobResult:()=>JobResult,Label:()=>Label,LightningPubRPC:()=>LightningPubRPC,LiveChatMessage:()=>LiveChatMessage,LiveEvent:()=>LiveEvent,LongFormArticle:()=>LongFormArticle,Metadata:()=>Metadata,Mutelist:()=>Mutelist,NWCWalletInfo:()=>NWCWalletInfo,NWCWalletRequest:()=>NWCWalletRequest,NWCWalletResponse:()=>NWCWalletResponse,NostrConnect:()=>NostrConnect,OpenTimestamps:()=>OpenTimestamps,Pinlist:()=>Pinlist,PrivateDirectMessage:()=>PrivateDirectMessage,ProblemTracker:()=>ProblemTracker,ProfileBadges:()=>ProfileBadges,PublicChatsList:()=>PublicChatsList,Reaction:()=>Reaction,RecommendRelay:()=>RecommendRelay,RelayList:()=>RelayList,Relaysets:()=>Relaysets,Report:()=>Report,Reporting:()=>Reporting,Repost:()=>Repost,Seal:()=>Seal,SearchRelaysList:()=>SearchRelaysList,ShortTextNote:()=>ShortTextNote,Time:()=>Time,UserEmojiList:()=>UserEmojiList,UserStatuses:()=>UserStatuses,Zap:()=>Zap,ZapGoal:()=>ZapGoal,ZapRequest:()=>ZapRequest,classifyKind:()=>classifyKind,isAddressableKind:()=>isAddressableKind,isEphemeralKind:()=>isEphemeralKind,isKind:()=>isKind,isRegularKind:()=>isRegularKind,isReplaceableKind:()=>isReplaceableKind});function isRegularKind(s){return 1e3<=s&&s<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(s)}function isReplaceableKind(s){return[0,3].includes(s)||1e4<=s&&s<2e4}function isEphemeralKind(s){return 2e4<=s&&s<3e4}function isAddressableKind(s){return 3e4<=s&&s<4e4}function classifyKind(s){return isRegularKind(s)?"regular":isReplaceableKind(s)?"replaceable":isEphemeralKind(s)?"ephemeral":isAddressableKind(s)?"parameterized":"unknown"}function isKind(s,e){const o=e instanceof Array?e:[e];return validateEvent(s)&&o.includes(s.kind)||!1}var Metadata=0,ShortTextNote=1,RecommendRelay=2,Contacts=3,EncryptedDirectMessage=4,EventDeletion=5,Repost=6,Reaction=7,BadgeAward=8,Seal=13,PrivateDirectMessage=14,GenericRepost=16,ChannelCreation=40,ChannelMetadata=41,ChannelMessage=42,ChannelHideMessage=43,ChannelMuteUser=44,OpenTimestamps=1040,GiftWrap=1059,FileMetadata=1063,LiveChatMessage=1311,ProblemTracker=1971,Report=1984,Reporting=1984,Label=1985,CommunityPostApproval=4550,JobRequest=5999,JobResult=6999,JobFeedback=7e3,ZapGoal=9041,ZapRequest=9734,Zap=9735,Highlights=9802,Mutelist=1e4,Pinlist=10001,RelayList=10002,BookmarkList=10003,CommunitiesList=10004,PublicChatsList=10005,BlockedRelaysList=10006,SearchRelaysList=10007,InterestsList=10015,UserEmojiList=10030,DirectMessageRelaysList=10050,FileServerPreference=10096,NWCWalletInfo=13194,LightningPubRPC=21e3,ClientAuth=22242,NWCWalletRequest=23194,NWCWalletResponse=23195,NostrConnect=24133,HTTPAuth=27235,Followsets=3e4,Genericlists=30001,Relaysets=30002,Bookmarksets=30003,Curationsets=30004,ProfileBadges=30008,BadgeDefinition=30009,Interestsets=30015,CreateOrUpdateStall=30017,CreateOrUpdateProduct=30018,LongFormArticle=30023,DraftLong=30024,Emojisets=30030,Application=30078,LiveEvent=30311,UserStatuses=30315,ClassifiedListing=30402,DraftClassifiedListing=30403,Date2=31922,Time=31923,Calendar=31924,CalendarEventRSVP=31925,Handlerrecommendation=31989,Handlerinformation=31990,CommunityDefinition=34550;function matchFilter(s,e){if(s.ids&&s.ids.indexOf(e.id)===-1||s.kinds&&s.kinds.indexOf(e.kind)===-1||s.authors&&s.authors.indexOf(e.pubkey)===-1)return!1;for(let o in s)if(o[0]==="#"){let a=o.slice(1),c=s[`#${a}`];if(c&&!e.tags.find(([g,b])=>g===o.slice(1)&&c.indexOf(b)!==-1))return!1}return!(s.since&&e.created_at<s.since||s.until&&e.created_at>s.until)}function matchFilters(s,e){for(let o=0;o<s.length;o++)if(matchFilter(s[o],e))return!0;return!1}var fakejson_exports={};__export(fakejson_exports,{getHex64:()=>getHex64,getInt:()=>getInt,getSubscriptionId:()=>getSubscriptionId,matchEventId:()=>matchEventId,matchEventKind:()=>matchEventKind,matchEventPubkey:()=>matchEventPubkey});function getHex64(s,e){let o=e.length+3,a=s.indexOf(`"${e}":`)+o,c=s.slice(a).indexOf('"')+a+1;return s.slice(c,c+64)}function getInt(s,e){let o=e.length,a=s.indexOf(`"${e}":`)+o+3,c=s.slice(a),g=Math.min(c.indexOf(","),c.indexOf("}"));return parseInt(c.slice(0,g),10)}function getSubscriptionId(s){let e=s.slice(0,22).indexOf('"EVENT"');if(e===-1)return null;let o=s.slice(e+7+1).indexOf('"');if(o===-1)return null;let a=e+7+1+o,c=s.slice(a+1,80).indexOf('"');if(c===-1)return null;let g=a+1+c;return s.slice(a+1,g)}function matchEventId(s,e){return e===getHex64(s,"id")}function matchEventPubkey(s,e){return e===getHex64(s,"pubkey")}function matchEventKind(s,e){return e===getInt(s,"kind")}var nip42_exports={};__export(nip42_exports,{makeAuthEvent:()=>makeAuthEvent});function makeAuthEvent(s,e){return{kind:ClientAuth,created_at:Math.floor(Date.now()/1e3),tags:[["relay",s],["challenge",e]],content:""}}var _WebSocket;try{_WebSocket=WebSocket}catch{}var _WebSocket2;try{_WebSocket2=WebSocket}catch{}var nip19_exports={};__export(nip19_exports,{BECH32_REGEX:()=>BECH32_REGEX$1,Bech32MaxSize:()=>Bech32MaxSize,NostrTypeGuard:()=>NostrTypeGuard,decode:()=>decode,decodeNostrURI:()=>decodeNostrURI,encodeBytes:()=>encodeBytes,naddrEncode:()=>naddrEncode,neventEncode:()=>neventEncode,noteEncode:()=>noteEncode,nprofileEncode:()=>nprofileEncode,npubEncode:()=>npubEncode,nsecEncode:()=>nsecEncode});var NostrTypeGuard={isNProfile:s=>/^nprofile1[a-z\d]+$/.test(s||""),isNEvent:s=>/^nevent1[a-z\d]+$/.test(s||""),isNAddr:s=>/^naddr1[a-z\d]+$/.test(s||""),isNSec:s=>/^nsec1[a-z\d]{58}$/.test(s||""),isNPub:s=>/^npub1[a-z\d]{58}$/.test(s||""),isNote:s=>/^note1[a-z\d]+$/.test(s||""),isNcryptsec:s=>/^ncryptsec1[a-z\d]+$/.test(s||"")},Bech32MaxSize=5e3,BECH32_REGEX$1=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function integerToUint8Array(s){const e=new Uint8Array(4);return e[0]=s>>24&255,e[1]=s>>16&255,e[2]=s>>8&255,e[3]=s&255,e}function decodeNostrURI(s){try{return s.startsWith("nostr:")&&(s=s.substring(6)),decode(s)}catch{return{type:"invalid",data:null}}}function decode(s){var c,g,b,_,j,_e,tt;let{prefix:e,words:o}=bech32$1.decode(s,Bech32MaxSize),a=new Uint8Array(bech32$1.fromWords(o));switch(e){case"nprofile":{let et=parseTLV(a);if(!((c=et[0])!=null&&c[0]))throw new Error("missing TLV 0 for nprofile");if(et[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:bytesToHex$1(et[0][0]),relays:et[1]?et[1].map(nt=>utf8Decoder.decode(nt)):[]}}}case"nevent":{let et=parseTLV(a);if(!((g=et[0])!=null&&g[0]))throw new Error("missing TLV 0 for nevent");if(et[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(et[2]&&et[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(et[3]&&et[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:bytesToHex$1(et[0][0]),relays:et[1]?et[1].map(nt=>utf8Decoder.decode(nt)):[],author:(b=et[2])!=null&&b[0]?bytesToHex$1(et[2][0]):void 0,kind:(_=et[3])!=null&&_[0]?parseInt(bytesToHex$1(et[3][0]),16):void 0}}}case"naddr":{let et=parseTLV(a);if(!((j=et[0])!=null&&j[0]))throw new Error("missing TLV 0 for naddr");if(!((_e=et[2])!=null&&_e[0]))throw new Error("missing TLV 2 for naddr");if(et[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!((tt=et[3])!=null&&tt[0]))throw new Error("missing TLV 3 for naddr");if(et[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:utf8Decoder.decode(et[0][0]),pubkey:bytesToHex$1(et[2][0]),kind:parseInt(bytesToHex$1(et[3][0]),16),relays:et[1]?et[1].map(nt=>utf8Decoder.decode(nt)):[]}}}case"nsec":return{type:e,data:a};case"npub":case"note":return{type:e,data:bytesToHex$1(a)};default:throw new Error(`unknown prefix ${e}`)}}function parseTLV(s){let e={},o=s;for(;o.length>0;){let a=o[0],c=o[1],g=o.slice(2,2+c);if(o=o.slice(2+c),g.length<c)throw new Error(`not enough data to read on TLV ${a}`);e[a]=e[a]||[],e[a].push(g)}return e}function nsecEncode(s){return encodeBytes("nsec",s)}function npubEncode(s){return encodeBytes("npub",hexToBytes$1(s))}function noteEncode(s){return encodeBytes("note",hexToBytes$1(s))}function encodeBech32(s,e){let o=bech32$1.toWords(e);return bech32$1.encode(s,o,Bech32MaxSize)}function encodeBytes(s,e){return encodeBech32(s,e)}function nprofileEncode(s){let e=encodeTLV({0:[hexToBytes$1(s.pubkey)],1:(s.relays||[]).map(o=>utf8Encoder.encode(o))});return encodeBech32("nprofile",e)}function neventEncode(s){let e;s.kind!==void 0&&(e=integerToUint8Array(s.kind));let o=encodeTLV({0:[hexToBytes$1(s.id)],1:(s.relays||[]).map(a=>utf8Encoder.encode(a)),2:s.author?[hexToBytes$1(s.author)]:[],3:e?[new Uint8Array(e)]:[]});return encodeBech32("nevent",o)}function naddrEncode(s){let e=new ArrayBuffer(4);new DataView(e).setUint32(0,s.kind,!1);let o=encodeTLV({0:[utf8Encoder.encode(s.identifier)],1:(s.relays||[]).map(a=>utf8Encoder.encode(a)),2:[hexToBytes$1(s.pubkey)],3:[new Uint8Array(e)]});return encodeBech32("naddr",o)}function encodeTLV(s){let e=[];return Object.entries(s).reverse().forEach(([o,a])=>{a.forEach(c=>{let g=new Uint8Array(c.length+2);g.set([parseInt(o)],0),g.set([c.length],1),g.set(c,2),e.push(g)})}),concatBytes$1(...e)}var nip04_exports={};__export(nip04_exports,{decrypt:()=>decrypt$1,encrypt:()=>encrypt$1});function encrypt$1(s,e,o){const a=s instanceof Uint8Array?bytesToHex$1(s):s,c=secp256k1$1.getSharedSecret(a,"02"+e),g=getNormalizedX(c);let b=Uint8Array.from(randomBytes$1(16)),_=utf8Encoder.encode(o),j=cbc(g,b).encrypt(_),_e=base64.encode(new Uint8Array(j)),tt=base64.encode(new Uint8Array(b.buffer));return`${_e}?iv=${tt}`}function decrypt$1(s,e,o){const a=s instanceof Uint8Array?bytesToHex$1(s):s;let[c,g]=o.split("?iv="),b=secp256k1$1.getSharedSecret(a,"02"+e),_=getNormalizedX(b),j=base64.decode(g),_e=base64.decode(c),tt=cbc(_,j).decrypt(_e);return utf8Decoder.decode(tt)}function getNormalizedX(s){return s.slice(1,33)}var nip05_exports={};__export(nip05_exports,{NIP05_REGEX:()=>NIP05_REGEX$1,isNip05:()=>isNip05,isValid:()=>isValid,queryProfile:()=>queryProfile,searchDomain:()=>searchDomain,useFetchImplementation:()=>useFetchImplementation});var NIP05_REGEX$1=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,isNip05=s=>NIP05_REGEX$1.test(s||""),_fetch;try{_fetch=fetch}catch(s){}function useFetchImplementation(s){_fetch=s}async function searchDomain(s,e=""){try{const o=`https://${s}/.well-known/nostr.json?name=${e}`,a=await _fetch(o,{redirect:"manual"});if(a.status!==200)throw Error("Wrong response code");return(await a.json()).names}catch{return{}}}async function queryProfile(s){var c;const e=s.match(NIP05_REGEX$1);if(!e)return null;const[,o="_",a]=e;try{const g=`https://${a}/.well-known/nostr.json?name=${o}`,b=await _fetch(g,{redirect:"manual"});if(b.status!==200)throw Error("Wrong response code");const _=await b.json(),j=_.names[o];return j?{pubkey:j,relays:(c=_.relays)==null?void 0:c[j]}:null}catch{return null}}async function isValid(s,e){const o=await queryProfile(e);return o?o.pubkey===s:!1}var nip10_exports={};__export(nip10_exports,{parse:()=>parse});function parse(s){const e={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let o,a;for(let c=s.tags.length-1;c>=0;c--){const g=s.tags[c];if(g[0]==="e"&&g[1]){const[b,_,j,_e,tt]=g,et={id:_,relays:j?[j]:[],author:tt};if(_e==="root"){e.root=et;continue}if(_e==="reply"){e.reply=et;continue}if(_e==="mention"){e.mentions.push(et);continue}o?a=et:o=et,e.mentions.push(et);continue}if(g[0]==="q"&&g[1]){const[b,_,j]=g;e.quotes.push({id:_,relays:j?[j]:[]})}if(g[0]==="p"&&g[1]){e.profiles.push({pubkey:g[1],relays:g[2]?[g[2]]:[]});continue}}return e.root||(e.root=a||o||e.reply),e.reply||(e.reply=o||e.root),[e.reply,e.root].forEach(c=>{if(!c)return;let g=e.mentions.indexOf(c);if(g!==-1&&e.mentions.splice(g,1),c.author){let b=e.profiles.find(_=>_.pubkey===c.author);b&&b.relays&&(c.relays||(c.relays=[]),b.relays.forEach(_=>{var j;((j=c.relays)==null?void 0:j.indexOf(_))===-1&&c.relays.push(_)}),b.relays=c.relays)}}),e.mentions.forEach(c=>{if(c.author){let g=e.profiles.find(b=>b.pubkey===c.author);g&&g.relays&&(c.relays||(c.relays=[]),g.relays.forEach(b=>{c.relays.indexOf(b)===-1&&c.relays.push(b)}),g.relays=c.relays)}}),e}var nip11_exports={};__export(nip11_exports,{fetchRelayInformation:()=>fetchRelayInformation,useFetchImplementation:()=>useFetchImplementation2});var _fetch2;try{_fetch2=fetch}catch{}function useFetchImplementation2(s){_fetch2=s}async function fetchRelayInformation(s){return await(await fetch(s.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var nip13_exports={};__export(nip13_exports,{fastEventHash:()=>fastEventHash,getPow:()=>getPow,minePow:()=>minePow});function getPow(s){let e=0;for(let o=0;o<64;o+=8){const a=parseInt(s.substring(o,o+8),16);if(a===0)e+=32;else{e+=Math.clz32(a);break}}return e}function minePow(s,e){let o=0;const a=s,c=["nonce",o.toString(),e.toString()];for(a.tags.push(c);;){const g=Math.floor(new Date().getTime()/1e3);if(g!==a.created_at&&(o=0,a.created_at=g),c[1]=(++o).toString(),a.id=fastEventHash(a),getPow(a.id)>=e)break}return a}function fastEventHash(s){return bytesToHex$1(sha256$2(utf8Encoder.encode(JSON.stringify([0,s.pubkey,s.created_at,s.kind,s.tags,s.content]))))}var nip17_exports={};__export(nip17_exports,{unwrapEvent:()=>unwrapEvent2,unwrapManyEvents:()=>unwrapManyEvents2,wrapEvent:()=>wrapEvent2,wrapManyEvents:()=>wrapManyEvents2});var nip59_exports={};__export(nip59_exports,{createRumor:()=>createRumor,createSeal:()=>createSeal,createWrap:()=>createWrap,unwrapEvent:()=>unwrapEvent,unwrapManyEvents:()=>unwrapManyEvents,wrapEvent:()=>wrapEvent$1,wrapManyEvents:()=>wrapManyEvents});var nip44_exports={};__export(nip44_exports,{decrypt:()=>decrypt2,encrypt:()=>encrypt2,getConversationKey:()=>getConversationKey,v2:()=>v2});var minPlaintextSize=1,maxPlaintextSize=65535;function getConversationKey(s,e){const o=secp256k1$1.getSharedSecret(s,"02"+e).subarray(1,33);return extract(sha256$2,o,"nip44-v2")}function getMessageKeys(s,e){const o=expand(sha256$2,s,e,76);return{chacha_key:o.subarray(0,32),chacha_nonce:o.subarray(32,44),hmac_key:o.subarray(44,76)}}function calcPaddedLen(s){if(!Number.isSafeInteger(s)||s<1)throw new Error("expected positive integer");if(s<=32)return 32;const e=1<<Math.floor(Math.log2(s-1))+1,o=e<=256?32:e/8;return o*(Math.floor((s-1)/o)+1)}function writeU16BE(s){if(!Number.isSafeInteger(s)||s<minPlaintextSize||s>maxPlaintextSize)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const e=new Uint8Array(2);return new DataView(e.buffer).setUint16(0,s,!1),e}function pad(s){const e=utf8Encoder.encode(s),o=e.length,a=writeU16BE(o),c=new Uint8Array(calcPaddedLen(o)-o);return concatBytes$1(a,e,c)}function unpad(s){const e=new DataView(s.buffer).getUint16(0),o=s.subarray(2,2+e);if(e<minPlaintextSize||e>maxPlaintextSize||o.length!==e||s.length!==2+calcPaddedLen(e))throw new Error("invalid padding");return utf8Decoder.decode(o)}function hmacAad(s,e,o){if(o.length!==32)throw new Error("AAD associated data must be 32 bytes");const a=concatBytes$1(o,e);return hmac$1(sha256$2,s,a)}function decodePayload(s){if(typeof s!="string")throw new Error("payload must be a valid string");const e=s.length;if(e<132||e>87472)throw new Error("invalid payload length: "+e);if(s[0]==="#")throw new Error("unknown encryption version");let o;try{o=base64.decode(s)}catch(g){throw new Error("invalid base64: "+g.message)}const a=o.length;if(a<99||a>65603)throw new Error("invalid data length: "+a);const c=o[0];if(c!==2)throw new Error("unknown encryption version "+c);return{nonce:o.subarray(1,33),ciphertext:o.subarray(33,-32),mac:o.subarray(-32)}}function encrypt2(s,e,o=randomBytes$1(32)){const{chacha_key:a,chacha_nonce:c,hmac_key:g}=getMessageKeys(e,o),b=pad(s),_=chacha20(a,c,b),j=hmacAad(g,_,o);return base64.encode(concatBytes$1(new Uint8Array([2]),o,_,j))}function decrypt2(s,e){const{nonce:o,ciphertext:a,mac:c}=decodePayload(s),{chacha_key:g,chacha_nonce:b,hmac_key:_}=getMessageKeys(e,o),j=hmacAad(_,a,o);if(!equalBytes(j,c))throw new Error("invalid MAC");const _e=chacha20(g,b,a);return unpad(_e)}var v2={utils:{getConversationKey,calcPaddedLen},encrypt:encrypt2,decrypt:decrypt2},TWO_DAYS=2*24*60*60,now=()=>Math.round(Date.now()/1e3),randomNow=()=>Math.round(now()-Math.random()*TWO_DAYS),nip44ConversationKey=(s,e)=>getConversationKey(s,e),nip44Encrypt=(s,e,o)=>encrypt2(JSON.stringify(s),nip44ConversationKey(e,o)),nip44Decrypt=(s,e)=>JSON.parse(decrypt2(s.content,nip44ConversationKey(e,s.pubkey)));function createRumor(s,e){const o={created_at:now(),content:"",tags:[],...s,pubkey:getPublicKey(e)};return o.id=getEventHash$1(o),o}function createSeal(s,e,o){return finalizeEvent({kind:Seal,content:nip44Encrypt(s,e,o),created_at:randomNow(),tags:[]},e)}function createWrap(s,e){const o=generateSecretKey();return finalizeEvent({kind:GiftWrap,content:nip44Encrypt(s,o,e),created_at:randomNow(),tags:[["p",e]]},o)}function wrapEvent$1(s,e,o){const a=createRumor(s,e),c=createSeal(a,e,o);return createWrap(c,o)}function wrapManyEvents(s,e,o){if(!o||o.length===0)throw new Error("At least one recipient is required.");const a=getPublicKey(e),c=[wrapEvent$1(s,e,a)];return o.forEach(g=>{c.push(wrapEvent$1(s,e,g))}),c}function unwrapEvent(s,e){const o=nip44Decrypt(s,e);return nip44Decrypt(o,e)}function unwrapManyEvents(s,e){let o=[];return s.forEach(a=>{o.push(unwrapEvent(a,e))}),o.sort((a,c)=>a.created_at-c.created_at),o}function createEvent(s,e,o,a){const c={created_at:Math.ceil(Date.now()/1e3),kind:PrivateDirectMessage,tags:[],content:e};return(Array.isArray(s)?s:[s]).forEach(({publicKey:b,relayUrl:_})=>{c.tags.push(_?["p",b,_]:["p",b])}),a&&c.tags.push(["e",a.eventId,a.relayUrl||"","reply"]),o&&c.tags.push(["subject",o]),c}function wrapEvent2(s,e,o,a,c){const g=createEvent(e,o,a,c);return wrapEvent$1(g,s,e.publicKey)}function wrapManyEvents2(s,e,o,a,c){if(!e||e.length===0)throw new Error("At least one recipient is required.");return[{publicKey:getPublicKey(s)},...e].map(b=>wrapEvent2(s,b,o,a,c))}var unwrapEvent2=unwrapEvent,unwrapManyEvents2=unwrapManyEvents,nip18_exports={};__export(nip18_exports,{finishRepostEvent:()=>finishRepostEvent,getRepostedEvent:()=>getRepostedEvent,getRepostedEventPointer:()=>getRepostedEventPointer});function finishRepostEvent(s,e,o,a){var b;let c;const g=[...s.tags??[],["e",e.id,o],["p",e.pubkey]];return e.kind===ShortTextNote?c=Repost:(c=GenericRepost,g.push(["k",String(e.kind)])),finalizeEvent({kind:c,tags:g,content:s.content===""||(b=e.tags)!=null&&b.find(_=>_[0]==="-")?"":JSON.stringify(e),created_at:s.created_at},a)}function getRepostedEventPointer(s){if(![Repost,GenericRepost].includes(s.kind))return;let e,o;for(let a=s.tags.length-1;a>=0&&(e===void 0||o===void 0);a--){const c=s.tags[a];c.length>=2&&(c[0]==="e"&&e===void 0?e=c:c[0]==="p"&&o===void 0&&(o=c))}if(e!==void 0)return{id:e[1],relays:[e[2],o==null?void 0:o[2]].filter(a=>typeof a=="string"),author:o==null?void 0:o[1]}}function getRepostedEvent(s,{skipVerification:e}={}){const o=getRepostedEventPointer(s);if(o===void 0||s.content==="")return;let a;try{a=JSON.parse(s.content)}catch{return}if(a.id===o.id&&!(!e&&!verifyEvent(a)))return a}var nip21_exports={};__export(nip21_exports,{NOSTR_URI_REGEX:()=>NOSTR_URI_REGEX,parse:()=>parse2,test:()=>test$1});var NOSTR_URI_REGEX=new RegExp(`nostr:(${BECH32_REGEX$1.source})`);function test$1(s){return typeof s=="string"&&new RegExp(`^${NOSTR_URI_REGEX.source}$`).test(s)}function parse2(s){const e=s.match(new RegExp(`^${NOSTR_URI_REGEX.source}$`));if(!e)throw new Error(`Invalid Nostr URI: ${s}`);return{uri:e[0],value:e[1],decoded:decode(e[1])}}var nip25_exports={};__export(nip25_exports,{finishReactionEvent:()=>finishReactionEvent,getReactedEventPointer:()=>getReactedEventPointer});function finishReactionEvent(s,e,o){const a=e.tags.filter(c=>c.length>=2&&(c[0]==="e"||c[0]==="p"));return finalizeEvent({...s,kind:Reaction,tags:[...s.tags??[],...a,["e",e.id],["p",e.pubkey]],content:s.content??"+"},o)}function getReactedEventPointer(s){if(s.kind!==Reaction)return;let e,o;for(let a=s.tags.length-1;a>=0&&(e===void 0||o===void 0);a--){const c=s.tags[a];c.length>=2&&(c[0]==="e"&&e===void 0?e=c:c[0]==="p"&&o===void 0&&(o=c))}if(!(e===void 0||o===void 0))return{id:e[1],relays:[e[2],o[2]].filter(a=>a!==void 0),author:o[1]}}var nip27_exports={};__export(nip27_exports,{parse:()=>parse3});var noCharacter=/\W/m,noURLCharacter=/\W |\W$|$|,| /m;function*parse3(s){const e=s.length;let o=0,a=0;for(;a<e;){let c=s.indexOf(":",a);if(c===-1)break;if(s.substring(c-5,c)==="nostr"){const g=s.substring(c+60).match(noCharacter),b=g?c+60+g.index:e;try{let _,{data:j,type:_e}=decode(s.substring(c+1,b));switch(_e){case"npub":_={pubkey:j};break;case"nsec":case"note":a=b+1;continue;default:_=j}o!==c-5&&(yield{type:"text",text:s.substring(o,c-5)}),yield{type:"reference",pointer:_},a=b,o=a;continue}catch{a=c+1;continue}}else if(s.substring(c-5,c)==="https"||s.substring(c-4,c)==="http"){const g=s.substring(c+4).match(noURLCharacter),b=g?c+4+g.index:e,_=s[c-1]==="s"?5:4;try{let j=new URL(s.substring(c-_,b));if(j.hostname.indexOf(".")===-1)throw new Error("invalid url");if(o!==c-_&&(yield{type:"text",text:s.substring(o,c-_)}),j.pathname.endsWith(".png")||j.pathname.endsWith(".jpg")||j.pathname.endsWith(".jpeg")||j.pathname.endsWith(".gif")||j.pathname.endsWith(".webp")){yield{type:"image",url:j.toString()},a=b,o=a;continue}if(j.pathname.endsWith(".mp4")||j.pathname.endsWith(".avi")||j.pathname.endsWith(".webm")||j.pathname.endsWith(".mkv")){yield{type:"video",url:j.toString()},a=b,o=a;continue}if(j.pathname.endsWith(".mp3")||j.pathname.endsWith(".aac")||j.pathname.endsWith(".ogg")||j.pathname.endsWith(".opus")){yield{type:"audio",url:j.toString()},a=b,o=a;continue}yield{type:"url",url:j.toString()},a=b,o=a;continue}catch{a=b+1;continue}}else if(s.substring(c-3,c)==="wss"||s.substring(c-2,c)==="ws"){const g=s.substring(c+4).match(noURLCharacter),b=g?c+4+g.index:e,_=s[c-1]==="s"?3:2;try{let j=new URL(s.substring(c-_,b));if(j.hostname.indexOf(".")===-1)throw new Error("invalid ws url");o!==c-_&&(yield{type:"text",text:s.substring(o,c-_)}),yield{type:"relay",url:j.toString()},a=b,o=a;continue}catch{a=b+1;continue}}else{a=c+1;continue}}o!==e&&(yield{type:"text",text:s.substring(o)})}var nip28_exports={};__export(nip28_exports,{channelCreateEvent:()=>channelCreateEvent,channelHideMessageEvent:()=>channelHideMessageEvent,channelMessageEvent:()=>channelMessageEvent,channelMetadataEvent:()=>channelMetadataEvent,channelMuteUserEvent:()=>channelMuteUserEvent});var channelCreateEvent=(s,e)=>{let o;if(typeof s.content=="object")o=JSON.stringify(s.content);else if(typeof s.content=="string")o=s.content;else return;return finalizeEvent({kind:ChannelCreation,tags:[...s.tags??[]],content:o,created_at:s.created_at},e)},channelMetadataEvent=(s,e)=>{let o;if(typeof s.content=="object")o=JSON.stringify(s.content);else if(typeof s.content=="string")o=s.content;else return;return finalizeEvent({kind:ChannelMetadata,tags:[["e",s.channel_create_event_id],...s.tags??[]],content:o,created_at:s.created_at},e)},channelMessageEvent=(s,e)=>{const o=[["e",s.channel_create_event_id,s.relay_url,"root"]];return s.reply_to_channel_message_event_id&&o.push(["e",s.reply_to_channel_message_event_id,s.relay_url,"reply"]),finalizeEvent({kind:ChannelMessage,tags:[...o,...s.tags??[]],content:s.content,created_at:s.created_at},e)},channelHideMessageEvent=(s,e)=>{let o;if(typeof s.content=="object")o=JSON.stringify(s.content);else if(typeof s.content=="string")o=s.content;else return;return finalizeEvent({kind:ChannelHideMessage,tags:[["e",s.channel_message_event_id],...s.tags??[]],content:o,created_at:s.created_at},e)},channelMuteUserEvent=(s,e)=>{let o;if(typeof s.content=="object")o=JSON.stringify(s.content);else if(typeof s.content=="string")o=s.content;else return;return finalizeEvent({kind:ChannelMuteUser,tags:[["p",s.pubkey_to_mute],...s.tags??[]],content:o,created_at:s.created_at},e)},nip30_exports={};__export(nip30_exports,{EMOJI_SHORTCODE_REGEX:()=>EMOJI_SHORTCODE_REGEX,matchAll:()=>matchAll$1,regex:()=>regex,replaceAll:()=>replaceAll});var EMOJI_SHORTCODE_REGEX=/:(\w+):/,regex=()=>new RegExp(`\\B${EMOJI_SHORTCODE_REGEX.source}\\B`,"g");function*matchAll$1(s){const e=s.matchAll(regex());for(const o of e)try{const[a,c]=o;yield{shortcode:a,name:c,start:o.index,end:o.index+a.length}}catch{}}function replaceAll(s,e){return s.replaceAll(regex(),(o,a)=>e({shortcode:o,name:a}))}var nip39_exports={};__export(nip39_exports,{useFetchImplementation:()=>useFetchImplementation3,validateGithub:()=>validateGithub});var _fetch3;try{_fetch3=fetch}catch{}function useFetchImplementation3(s){_fetch3=s}async function validateGithub(s,e,o){try{return await(await _fetch3(`https://gist.github.com/${e}/${o}/raw`)).text()===`Verifying that I control the following Nostr public key: ${s}`}catch{return!1}}var nip47_exports={};__export(nip47_exports,{makeNwcRequestEvent:()=>makeNwcRequestEvent,parseConnectionString:()=>parseConnectionString});function parseConnectionString(s){const{host:e,pathname:o,searchParams:a}=new URL(s),c=o||e,g=a.get("relay"),b=a.get("secret");if(!c||!g||!b)throw new Error("invalid connection string");return{pubkey:c,relay:g,secret:b}}async function makeNwcRequestEvent(s,e,o){const c=encrypt$1(e,s,JSON.stringify({method:"pay_invoice",params:{invoice:o}})),g={kind:NWCWalletRequest,created_at:Math.round(Date.now()/1e3),content:c,tags:[["p",s]]};return finalizeEvent(g,e)}var nip54_exports={};__export(nip54_exports,{normalizeIdentifier:()=>normalizeIdentifier});function normalizeIdentifier(s){return s=s.trim().toLowerCase(),s=s.normalize("NFKC"),Array.from(s).map(e=>new RegExp("\\p{Letter}","u").test(e)||new RegExp("\\p{Number}","u").test(e)?e:"-").join("")}var nip57_exports={};__export(nip57_exports,{getSatoshisAmountFromBolt11:()=>getSatoshisAmountFromBolt11,getZapEndpoint:()=>getZapEndpoint,makeZapReceipt:()=>makeZapReceipt,makeZapRequest:()=>makeZapRequest,useFetchImplementation:()=>useFetchImplementation4,validateZapRequest:()=>validateZapRequest});var _fetch4;try{_fetch4=fetch}catch{}function useFetchImplementation4(s){_fetch4=s}async function getZapEndpoint(s){try{let e="",{lud06:o,lud16:a}=JSON.parse(s.content);if(o){let{words:b}=bech32$1.decode(o,1e3),_=bech32$1.fromWords(b);e=utf8Decoder.decode(_)}else if(a){let[b,_]=a.split("@");e=new URL(`/.well-known/lnurlp/${b}`,`https://${_}`).toString()}else return null;let g=await(await _fetch4(e)).json();if(g.allowsNostr&&g.nostrPubkey)return g.callback}catch{}return null}function makeZapRequest(s){let e={kind:9734,created_at:Math.round(Date.now()/1e3),content:s.comment||"",tags:[["p","pubkey"in s?s.pubkey:s.event.pubkey],["amount",s.amount.toString()],["relays",...s.relays]]};if("event"in s){if(e.tags.push(["e",s.event.id]),isReplaceableKind(s.event.kind)){const o=["a",`${s.event.kind}:${s.event.pubkey}:`];e.tags.push(o)}else if(isAddressableKind(s.event.kind)){let o=s.event.tags.find(([c,g])=>c==="d"&&g);if(!o)throw new Error("d tag not found or is empty");const a=["a",`${s.event.kind}:${s.event.pubkey}:${o[1]}`];e.tags.push(a)}e.tags.push(["k",s.event.kind.toString()])}return e}function validateZapRequest(s){let e;try{e=JSON.parse(s)}catch{return"Invalid zap request JSON."}if(!validateEvent(e))return"Zap request is not a valid Nostr event.";if(!verifyEvent(e))return"Invalid signature on zap request.";let o=e.tags.find(([g,b])=>g==="p"&&b);if(!o)return"Zap request doesn't have a 'p' tag.";if(!o[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let a=e.tags.find(([g,b])=>g==="e"&&b);return a&&!a[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":e.tags.find(([g,b])=>g==="relays"&&b)?null:"Zap request doesn't have a 'relays' tag."}function makeZapReceipt({zapRequest:s,preimage:e,bolt11:o,paidAt:a}){let c=JSON.parse(s),g=c.tags.filter(([_])=>_==="e"||_==="p"||_==="a"),b={kind:9735,created_at:Math.round(a.getTime()/1e3),content:"",tags:[...g,["P",c.pubkey],["bolt11",o],["description",s]]};return e&&b.tags.push(["preimage",e]),b}function getSatoshisAmountFromBolt11(s){if(s.length<50)return 0;s=s.substring(0,50);const e=s.lastIndexOf("1");if(e===-1)return 0;const o=s.substring(0,e);if(!o.startsWith("lnbc"))return 0;const a=o.substring(4);if(a.length<1)return 0;const c=a[a.length-1],g=c.charCodeAt(0)-48,b=g>=0&&g<=9;let _=a.length-1;if(b&&_++,_<1)return 0;const j=parseInt(a.substring(0,_));switch(c){case"m":return j*1e5;case"u":return j*100;case"n":return j/10;case"p":return j/1e4;default:return j*1e8}}var nip98_exports={};__export(nip98_exports,{getToken:()=>getToken,hashPayload:()=>hashPayload,unpackEventFromToken:()=>unpackEventFromToken,validateEvent:()=>validateEvent2,validateEventKind:()=>validateEventKind,validateEventMethodTag:()=>validateEventMethodTag,validateEventPayloadTag:()=>validateEventPayloadTag,validateEventTimestamp:()=>validateEventTimestamp,validateEventUrlTag:()=>validateEventUrlTag,validateToken:()=>validateToken});var _authorizationScheme="Nostr ";async function getToken(s,e,o,a=!1,c){const g={kind:HTTPAuth,tags:[["u",s],["method",e]],created_at:Math.round(new Date().getTime()/1e3),content:""};c&&g.tags.push(["payload",hashPayload(c)]);const b=await o(g);return(a?_authorizationScheme:"")+base64.encode(utf8Encoder.encode(JSON.stringify(b)))}async function validateToken(s,e,o){const a=await unpackEventFromToken(s).catch(g=>{throw g});return await validateEvent2(a,e,o).catch(g=>{throw g})}async function unpackEventFromToken(s){if(!s)throw new Error("Missing token");s=s.replace(_authorizationScheme,"");const e=utf8Decoder.decode(base64.decode(s));if(!e||e.length===0||!e.startsWith("{"))throw new Error("Invalid token");return JSON.parse(e)}function validateEventTimestamp(s){return s.created_at?Math.round(new Date().getTime()/1e3)-s.created_at<60:!1}function validateEventKind(s){return s.kind===HTTPAuth}function validateEventUrlTag(s,e){const o=s.tags.find(a=>a[0]==="u");return o?o.length>0&&o[1]===e:!1}function validateEventMethodTag(s,e){const o=s.tags.find(a=>a[0]==="method");return o?o.length>0&&o[1].toLowerCase()===e.toLowerCase():!1}function hashPayload(s){const e=sha256$2(utf8Encoder.encode(JSON.stringify(s)));return bytesToHex$1(e)}function validateEventPayloadTag(s,e){const o=s.tags.find(c=>c[0]==="payload");if(!o)return!1;const a=hashPayload(e);return o.length>0&&o[1]===a}async function validateEvent2(s,e,o,a){if(!verifyEvent(s))throw new Error("Invalid nostr event, signature invalid");if(!validateEventKind(s))throw new Error("Invalid nostr event, kind invalid");if(!validateEventTimestamp(s))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!validateEventUrlTag(s,e))throw new Error("Invalid nostr event, url tag invalid");if(!validateEventMethodTag(s,o))throw new Error("Invalid nostr event, method tag invalid");if(a&&typeof a=="object"&&Object.keys(a).length>0&&!validateEventPayloadTag(s,a))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}const crypto=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function isBytes(s){return s instanceof Uint8Array||ArrayBuffer.isView(s)&&s.constructor.name==="Uint8Array"}function anumber(s){if(!Number.isSafeInteger(s)||s<0)throw new Error("positive integer expected, got "+s)}function abytes(s,...e){if(!isBytes(s))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(s.length))throw new Error("Uint8Array expected of length "+e+", got length="+s.length)}function ahash(s){if(typeof s!="function"||typeof s.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");anumber(s.outputLen),anumber(s.blockLen)}function aexists(s,e=!0){if(s.destroyed)throw new Error("Hash instance has been destroyed");if(e&&s.finished)throw new Error("Hash#digest() has already been called")}function aoutput(s,e){abytes(s);const o=e.outputLen;if(s.length<o)throw new Error("digestInto() expects output buffer of length at least "+o)}function clean(...s){for(let e=0;e<s.length;e++)s[e].fill(0)}function createView(s){return new DataView(s.buffer,s.byteOffset,s.byteLength)}function rotr(s,e){return s<<32-e|s>>>e}const hasHexBuiltin=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",hexes=Array.from({length:256},(s,e)=>e.toString(16).padStart(2,"0"));function bytesToHex(s){if(abytes(s),hasHexBuiltin)return s.toHex();let e="";for(let o=0;o<s.length;o++)e+=hexes[s[o]];return e}const asciis={_0:48,_9:57,A:65,F:70,a:97,f:102};function asciiToBase16(s){if(s>=asciis._0&&s<=asciis._9)return s-asciis._0;if(s>=asciis.A&&s<=asciis.F)return s-(asciis.A-10);if(s>=asciis.a&&s<=asciis.f)return s-(asciis.a-10)}function hexToBytes(s){if(typeof s!="string")throw new Error("hex string expected, got "+typeof s);if(hasHexBuiltin)return Uint8Array.fromHex(s);const e=s.length,o=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const a=new Uint8Array(o);for(let c=0,g=0;c<o;c++,g+=2){const b=asciiToBase16(s.charCodeAt(g)),_=asciiToBase16(s.charCodeAt(g+1));if(b===void 0||_===void 0){const j=s[g]+s[g+1];throw new Error('hex string expected, got non-hex character "'+j+'" at index '+g)}a[c]=b*16+_}return a}function utf8ToBytes(s){if(typeof s!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(s))}function toBytes(s){return typeof s=="string"&&(s=utf8ToBytes(s)),abytes(s),s}function concatBytes(...s){let e=0;for(let a=0;a<s.length;a++){const c=s[a];abytes(c),e+=c.length}const o=new Uint8Array(e);for(let a=0,c=0;a<s.length;a++){const g=s[a];o.set(g,c),c+=g.length}return o}class Hash{}function createHasher(s){const e=a=>s().update(toBytes(a)).digest(),o=s();return e.outputLen=o.outputLen,e.blockLen=o.blockLen,e.create=()=>s(),e}function randomBytes(s=32){if(crypto&&typeof crypto.getRandomValues=="function")return crypto.getRandomValues(new Uint8Array(s));if(crypto&&typeof crypto.randomBytes=="function")return Uint8Array.from(crypto.randomBytes(s));throw new Error("crypto.getRandomValues must be defined")}function setBigUint64(s,e,o,a){if(typeof s.setBigUint64=="function")return s.setBigUint64(e,o,a);const c=BigInt(32),g=BigInt(4294967295),b=Number(o>>c&g),_=Number(o&g),j=a?4:0,_e=a?0:4;s.setUint32(e+j,b,a),s.setUint32(e+_e,_,a)}function Chi(s,e,o){return s&e^~s&o}function Maj(s,e,o){return s&e^s&o^e&o}class HashMD extends Hash{constructor(e,o,a,c){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=o,this.padOffset=a,this.isLE=c,this.buffer=new Uint8Array(e),this.view=createView(this.buffer)}update(e){aexists(this),e=toBytes(e),abytes(e);const{view:o,buffer:a,blockLen:c}=this,g=e.length;for(let b=0;b<g;){const _=Math.min(c-this.pos,g-b);if(_===c){const j=createView(e);for(;c<=g-b;b+=c)this.process(j,b);continue}a.set(e.subarray(b,b+_),this.pos),this.pos+=_,b+=_,this.pos===c&&(this.process(o,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){aexists(this),aoutput(e,this),this.finished=!0;const{buffer:o,view:a,blockLen:c,isLE:g}=this;let{pos:b}=this;o[b++]=128,clean(this.buffer.subarray(b)),this.padOffset>c-b&&(this.process(a,0),b=0);for(let et=b;et<c;et++)o[et]=0;setBigUint64(a,c-8,BigInt(this.length*8),g),this.process(a,0);const _=createView(e),j=this.outputLen;if(j%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const _e=j/4,tt=this.get();if(_e>tt.length)throw new Error("_sha2: outputLen bigger than state");for(let et=0;et<_e;et++)_.setUint32(4*et,tt[et],g)}digest(){const{buffer:e,outputLen:o}=this;this.digestInto(e);const a=e.slice(0,o);return this.destroy(),a}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:o,buffer:a,length:c,finished:g,destroyed:b,pos:_}=this;return e.destroyed=b,e.finished=g,e.length=c,e.pos=_,c%o&&e.buffer.set(a),e}clone(){return this._cloneInto()}}const SHA256_IV=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_K=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),SHA256_W=new Uint32Array(64);class SHA256 extends HashMD{constructor(e=32){super(64,e,8,!1),this.A=SHA256_IV[0]|0,this.B=SHA256_IV[1]|0,this.C=SHA256_IV[2]|0,this.D=SHA256_IV[3]|0,this.E=SHA256_IV[4]|0,this.F=SHA256_IV[5]|0,this.G=SHA256_IV[6]|0,this.H=SHA256_IV[7]|0}get(){const{A:e,B:o,C:a,D:c,E:g,F:b,G:_,H:j}=this;return[e,o,a,c,g,b,_,j]}set(e,o,a,c,g,b,_,j){this.A=e|0,this.B=o|0,this.C=a|0,this.D=c|0,this.E=g|0,this.F=b|0,this.G=_|0,this.H=j|0}process(e,o){for(let et=0;et<16;et++,o+=4)SHA256_W[et]=e.getUint32(o,!1);for(let et=16;et<64;et++){const nt=SHA256_W[et-15],rt=SHA256_W[et-2],it=rotr(nt,7)^rotr(nt,18)^nt>>>3,st=rotr(rt,17)^rotr(rt,19)^rt>>>10;SHA256_W[et]=st+SHA256_W[et-7]+it+SHA256_W[et-16]|0}let{A:a,B:c,C:g,D:b,E:_,F:j,G:_e,H:tt}=this;for(let et=0;et<64;et++){const nt=rotr(_,6)^rotr(_,11)^rotr(_,25),rt=tt+nt+Chi(_,j,_e)+SHA256_K[et]+SHA256_W[et]|0,st=(rotr(a,2)^rotr(a,13)^rotr(a,22))+Maj(a,c,g)|0;tt=_e,_e=j,j=_,_=b+rt|0,b=g,g=c,c=a,a=rt+st|0}a=a+this.A|0,c=c+this.B|0,g=g+this.C|0,b=b+this.D|0,_=_+this.E|0,j=j+this.F|0,_e=_e+this.G|0,tt=tt+this.H|0,this.set(a,c,g,b,_,j,_e,tt)}roundClean(){clean(SHA256_W)}destroy(){this.set(0,0,0,0,0,0,0,0),clean(this.buffer)}}const sha256$1=createHasher(()=>new SHA256);class HMAC extends Hash{constructor(e,o){super(),this.finished=!1,this.destroyed=!1,ahash(e);const a=toBytes(o);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const c=this.blockLen,g=new Uint8Array(c);g.set(a.length>c?e.create().update(a).digest():a);for(let b=0;b<g.length;b++)g[b]^=54;this.iHash.update(g),this.oHash=e.create();for(let b=0;b<g.length;b++)g[b]^=106;this.oHash.update(g),clean(g)}update(e){return aexists(this),this.iHash.update(e),this}digestInto(e){aexists(this),abytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:o,iHash:a,finished:c,destroyed:g,blockLen:b,outputLen:_}=this;return e=e,e.finished=c,e.destroyed=g,e.blockLen=b,e.outputLen=_,e.oHash=o._cloneInto(e.oHash),e.iHash=a._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const hmac=(s,e,o)=>new HMAC(s,e).update(o).digest();hmac.create=(s,e)=>new HMAC(s,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$4=BigInt(0),_1n$4=BigInt(1);function _abool2(s,e=""){if(typeof s!="boolean"){const o=e&&`"${e}"`;throw new Error(o+"expected boolean, got type="+typeof s)}return s}function _abytes2(s,e,o=""){const a=isBytes(s),c=s==null?void 0:s.length,g=e!==void 0;if(!a||g&&c!==e){const b=o&&`"${o}" `,_=g?` of length ${e}`:"",j=a?`length=${c}`:`type=${typeof s}`;throw new Error(b+"expected Uint8Array"+_+", got "+j)}return s}function numberToHexUnpadded(s){const e=s.toString(16);return e.length&1?"0"+e:e}function hexToNumber(s){if(typeof s!="string")throw new Error("hex string expected, got "+typeof s);return s===""?_0n$4:BigInt("0x"+s)}function bytesToNumberBE(s){return hexToNumber(bytesToHex(s))}function bytesToNumberLE(s){return abytes(s),hexToNumber(bytesToHex(Uint8Array.from(s).reverse()))}function numberToBytesBE(s,e){return hexToBytes(s.toString(16).padStart(e*2,"0"))}function numberToBytesLE(s,e){return numberToBytesBE(s,e).reverse()}function ensureBytes(s,e,o){let a;if(typeof e=="string")try{a=hexToBytes(e)}catch(g){throw new Error(s+" must be hex string or Uint8Array, cause: "+g)}else if(isBytes(e))a=Uint8Array.from(e);else throw new Error(s+" must be hex string or Uint8Array");const c=a.length;if(typeof o=="number"&&c!==o)throw new Error(s+" of length "+o+" expected, got "+c);return a}const isPosBig=s=>typeof s=="bigint"&&_0n$4<=s;function inRange(s,e,o){return isPosBig(s)&&isPosBig(e)&&isPosBig(o)&&e<=s&&s<o}function aInRange(s,e,o,a){if(!inRange(e,o,a))throw new Error("expected valid "+s+": "+o+" <= n < "+a+", got "+e)}function bitLen(s){let e;for(e=0;s>_0n$4;s>>=_1n$4,e+=1);return e}const bitMask=s=>(_1n$4<<BigInt(s))-_1n$4;function createHmacDrbg(s,e,o){if(typeof s!="number"||s<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof o!="function")throw new Error("hmacFn must be a function");const a=rt=>new Uint8Array(rt),c=rt=>Uint8Array.of(rt);let g=a(s),b=a(s),_=0;const j=()=>{g.fill(1),b.fill(0),_=0},_e=(...rt)=>o(b,g,...rt),tt=(rt=a(0))=>{b=_e(c(0),rt),g=_e(),rt.length!==0&&(b=_e(c(1),rt),g=_e())},et=()=>{if(_++>=1e3)throw new Error("drbg: tried 1000 values");let rt=0;const it=[];for(;rt<e;){g=_e();const st=g.slice();it.push(st),rt+=g.length}return concatBytes(...it)};return(rt,it)=>{j(),tt(rt);let st;for(;!(st=it(et()));)tt();return j(),st}}function _validateObject(s,e,o={}){if(!s||typeof s!="object")throw new Error("expected valid options object");function a(c,g,b){const _=s[c];if(b&&_===void 0)return;const j=typeof _;if(j!==g||_===null)throw new Error(`param "${c}" is invalid: expected ${g}, got ${j}`)}Object.entries(e).forEach(([c,g])=>a(c,g,!1)),Object.entries(o).forEach(([c,g])=>a(c,g,!0))}function memoized(s){const e=new WeakMap;return(o,...a)=>{const c=e.get(o);if(c!==void 0)return c;const g=s(o,...a);return e.set(o,g),g}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$3=BigInt(0),_1n$3=BigInt(1),_2n$2=BigInt(2),_3n$1=BigInt(3),_4n$1=BigInt(4),_5n=BigInt(5),_7n=BigInt(7),_8n=BigInt(8),_9n=BigInt(9),_16n=BigInt(16);function mod(s,e){const o=s%e;return o>=_0n$3?o:e+o}function pow2(s,e,o){let a=s;for(;e-- >_0n$3;)a*=a,a%=o;return a}function invert(s,e){if(s===_0n$3)throw new Error("invert: expected non-zero number");if(e<=_0n$3)throw new Error("invert: expected positive modulus, got "+e);let o=mod(s,e),a=e,c=_0n$3,g=_1n$3;for(;o!==_0n$3;){const _=a/o,j=a%o,_e=c-g*_;a=o,o=j,c=g,g=_e}if(a!==_1n$3)throw new Error("invert: does not exist");return mod(c,e)}function assertIsSquare(s,e,o){if(!s.eql(s.sqr(e),o))throw new Error("Cannot find square root")}function sqrt3mod4(s,e){const o=(s.ORDER+_1n$3)/_4n$1,a=s.pow(e,o);return assertIsSquare(s,a,e),a}function sqrt5mod8(s,e){const o=(s.ORDER-_5n)/_8n,a=s.mul(e,_2n$2),c=s.pow(a,o),g=s.mul(e,c),b=s.mul(s.mul(g,_2n$2),c),_=s.mul(g,s.sub(b,s.ONE));return assertIsSquare(s,_,e),_}function sqrt9mod16(s){const e=Field(s),o=tonelliShanks(s),a=o(e,e.neg(e.ONE)),c=o(e,a),g=o(e,e.neg(a)),b=(s+_7n)/_16n;return(_,j)=>{let _e=_.pow(j,b),tt=_.mul(_e,a);const et=_.mul(_e,c),nt=_.mul(_e,g),rt=_.eql(_.sqr(tt),j),it=_.eql(_.sqr(et),j);_e=_.cmov(_e,tt,rt),tt=_.cmov(nt,et,it);const st=_.eql(_.sqr(tt),j),lt=_.cmov(_e,tt,st);return assertIsSquare(_,lt,j),lt}}function tonelliShanks(s){if(s<_3n$1)throw new Error("sqrt is not defined for small field");let e=s-_1n$3,o=0;for(;e%_2n$2===_0n$3;)e/=_2n$2,o++;let a=_2n$2;const c=Field(s);for(;FpLegendre(c,a)===1;)if(a++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(o===1)return sqrt3mod4;let g=c.pow(a,e);const b=(e+_1n$3)/_2n$2;return function(j,_e){if(j.is0(_e))return _e;if(FpLegendre(j,_e)!==1)throw new Error("Cannot find square root");let tt=o,et=j.mul(j.ONE,g),nt=j.pow(_e,e),rt=j.pow(_e,b);for(;!j.eql(nt,j.ONE);){if(j.is0(nt))return j.ZERO;let it=1,st=j.sqr(nt);for(;!j.eql(st,j.ONE);)if(it++,st=j.sqr(st),it===tt)throw new Error("Cannot find square root");const lt=_1n$3<<BigInt(tt-it-1),at=j.pow(et,lt);tt=it,et=j.sqr(at),nt=j.mul(nt,et),rt=j.mul(rt,at)}return rt}}function FpSqrt(s){return s%_4n$1===_3n$1?sqrt3mod4:s%_8n===_5n?sqrt5mod8:s%_16n===_9n?sqrt9mod16(s):tonelliShanks(s)}const FIELD_FIELDS=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function validateField(s){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},o=FIELD_FIELDS.reduce((a,c)=>(a[c]="function",a),e);return _validateObject(s,o),s}function FpPow(s,e,o){if(o<_0n$3)throw new Error("invalid exponent, negatives unsupported");if(o===_0n$3)return s.ONE;if(o===_1n$3)return e;let a=s.ONE,c=e;for(;o>_0n$3;)o&_1n$3&&(a=s.mul(a,c)),c=s.sqr(c),o>>=_1n$3;return a}function FpInvertBatch(s,e,o=!1){const a=new Array(e.length).fill(o?s.ZERO:void 0),c=e.reduce((b,_,j)=>s.is0(_)?b:(a[j]=b,s.mul(b,_)),s.ONE),g=s.inv(c);return e.reduceRight((b,_,j)=>s.is0(_)?b:(a[j]=s.mul(b,a[j]),s.mul(b,_)),g),a}function FpLegendre(s,e){const o=(s.ORDER-_1n$3)/_2n$2,a=s.pow(e,o),c=s.eql(a,s.ONE),g=s.eql(a,s.ZERO),b=s.eql(a,s.neg(s.ONE));if(!c&&!g&&!b)throw new Error("invalid Legendre symbol result");return c?1:g?0:-1}function nLength(s,e){e!==void 0&&anumber(e);const o=e!==void 0?e:s.toString(2).length,a=Math.ceil(o/8);return{nBitLength:o,nByteLength:a}}function Field(s,e,o=!1,a={}){if(s<=_0n$3)throw new Error("invalid field: expected ORDER > 0, got "+s);let c,g,b=!1,_;if(typeof e=="object"&&e!=null){if(a.sqrt||o)throw new Error("cannot specify opts in two arguments");const nt=e;nt.BITS&&(c=nt.BITS),nt.sqrt&&(g=nt.sqrt),typeof nt.isLE=="boolean"&&(o=nt.isLE),typeof nt.modFromBytes=="boolean"&&(b=nt.modFromBytes),_=nt.allowedLengths}else typeof e=="number"&&(c=e),a.sqrt&&(g=a.sqrt);const{nBitLength:j,nByteLength:_e}=nLength(s,c);if(_e>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let tt;const et=Object.freeze({ORDER:s,isLE:o,BITS:j,BYTES:_e,MASK:bitMask(j),ZERO:_0n$3,ONE:_1n$3,allowedLengths:_,create:nt=>mod(nt,s),isValid:nt=>{if(typeof nt!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof nt);return _0n$3<=nt&&nt<s},is0:nt=>nt===_0n$3,isValidNot0:nt=>!et.is0(nt)&&et.isValid(nt),isOdd:nt=>(nt&_1n$3)===_1n$3,neg:nt=>mod(-nt,s),eql:(nt,rt)=>nt===rt,sqr:nt=>mod(nt*nt,s),add:(nt,rt)=>mod(nt+rt,s),sub:(nt,rt)=>mod(nt-rt,s),mul:(nt,rt)=>mod(nt*rt,s),pow:(nt,rt)=>FpPow(et,nt,rt),div:(nt,rt)=>mod(nt*invert(rt,s),s),sqrN:nt=>nt*nt,addN:(nt,rt)=>nt+rt,subN:(nt,rt)=>nt-rt,mulN:(nt,rt)=>nt*rt,inv:nt=>invert(nt,s),sqrt:g||(nt=>(tt||(tt=FpSqrt(s)),tt(et,nt))),toBytes:nt=>o?numberToBytesLE(nt,_e):numberToBytesBE(nt,_e),fromBytes:(nt,rt=!0)=>{if(_){if(!_.includes(nt.length)||nt.length>_e)throw new Error("Field.fromBytes: expected "+_+" bytes, got "+nt.length);const st=new Uint8Array(_e);st.set(nt,o?0:st.length-nt.length),nt=st}if(nt.length!==_e)throw new Error("Field.fromBytes: expected "+_e+" bytes, got "+nt.length);let it=o?bytesToNumberLE(nt):bytesToNumberBE(nt);if(b&&(it=mod(it,s)),!rt&&!et.isValid(it))throw new Error("invalid field element: outside of range 0..ORDER");return it},invertBatch:nt=>FpInvertBatch(et,nt),cmov:(nt,rt,it)=>it?rt:nt});return Object.freeze(et)}function getFieldBytesLength(s){if(typeof s!="bigint")throw new Error("field order must be bigint");const e=s.toString(2).length;return Math.ceil(e/8)}function getMinHashLength(s){const e=getFieldBytesLength(s);return e+Math.ceil(e/2)}function mapHashToField(s,e,o=!1){const a=s.length,c=getFieldBytesLength(e),g=getMinHashLength(e);if(a<16||a<g||a>1024)throw new Error("expected "+g+"-1024 bytes of input, got "+a);const b=o?bytesToNumberLE(s):bytesToNumberBE(s),_=mod(b,e-_1n$3)+_1n$3;return o?numberToBytesLE(_,c):numberToBytesBE(_,c)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$2=BigInt(0),_1n$2=BigInt(1);function negateCt(s,e){const o=e.negate();return s?o:e}function normalizeZ(s,e){const o=FpInvertBatch(s.Fp,e.map(a=>a.Z));return e.map((a,c)=>s.fromAffine(a.toAffine(o[c])))}function validateW(s,e){if(!Number.isSafeInteger(s)||s<=0||s>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+s)}function calcWOpts(s,e){validateW(s,e);const o=Math.ceil(e/s)+1,a=2**(s-1),c=2**s,g=bitMask(s),b=BigInt(s);return{windows:o,windowSize:a,mask:g,maxNumber:c,shiftBy:b}}function calcOffsets(s,e,o){const{windowSize:a,mask:c,maxNumber:g,shiftBy:b}=o;let _=Number(s&c),j=s>>b;_>a&&(_-=g,j+=_1n$2);const _e=e*a,tt=_e+Math.abs(_)-1,et=_===0,nt=_<0,rt=e%2!==0;return{nextN:j,offset:tt,isZero:et,isNeg:nt,isNegF:rt,offsetF:_e}}function validateMSMPoints(s,e){if(!Array.isArray(s))throw new Error("array expected");s.forEach((o,a)=>{if(!(o instanceof e))throw new Error("invalid point at index "+a)})}function validateMSMScalars(s,e){if(!Array.isArray(s))throw new Error("array of scalars expected");s.forEach((o,a)=>{if(!e.isValid(o))throw new Error("invalid scalar at index "+a)})}const pointPrecomputes=new WeakMap,pointWindowSizes=new WeakMap;function getW(s){return pointWindowSizes.get(s)||1}function assert0(s){if(s!==_0n$2)throw new Error("invalid wNAF")}class wNAF{constructor(e,o){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=o}_unsafeLadder(e,o,a=this.ZERO){let c=e;for(;o>_0n$2;)o&_1n$2&&(a=a.add(c)),c=c.double(),o>>=_1n$2;return a}precomputeWindow(e,o){const{windows:a,windowSize:c}=calcWOpts(o,this.bits),g=[];let b=e,_=b;for(let j=0;j<a;j++){_=b,g.push(_);for(let _e=1;_e<c;_e++)_=_.add(b),g.push(_);b=_.double()}return g}wNAF(e,o,a){if(!this.Fn.isValid(a))throw new Error("invalid scalar");let c=this.ZERO,g=this.BASE;const b=calcWOpts(e,this.bits);for(let _=0;_<b.windows;_++){const{nextN:j,offset:_e,isZero:tt,isNeg:et,isNegF:nt,offsetF:rt}=calcOffsets(a,_,b);a=j,tt?g=g.add(negateCt(nt,o[rt])):c=c.add(negateCt(et,o[_e]))}return assert0(a),{p:c,f:g}}wNAFUnsafe(e,o,a,c=this.ZERO){const g=calcWOpts(e,this.bits);for(let b=0;b<g.windows&&a!==_0n$2;b++){const{nextN:_,offset:j,isZero:_e,isNeg:tt}=calcOffsets(a,b,g);if(a=_,!_e){const et=o[j];c=c.add(tt?et.negate():et)}}return assert0(a),c}getPrecomputes(e,o,a){let c=pointPrecomputes.get(o);return c||(c=this.precomputeWindow(o,e),e!==1&&(typeof a=="function"&&(c=a(c)),pointPrecomputes.set(o,c))),c}cached(e,o,a){const c=getW(e);return this.wNAF(c,this.getPrecomputes(c,e,a),o)}unsafe(e,o,a,c){const g=getW(e);return g===1?this._unsafeLadder(e,o,c):this.wNAFUnsafe(g,this.getPrecomputes(g,e,a),o,c)}createCache(e,o){validateW(o,this.bits),pointWindowSizes.set(e,o),pointPrecomputes.delete(e)}hasCache(e){return getW(e)!==1}}function mulEndoUnsafe(s,e,o,a){let c=e,g=s.ZERO,b=s.ZERO;for(;o>_0n$2||a>_0n$2;)o&_1n$2&&(g=g.add(c)),a&_1n$2&&(b=b.add(c)),c=c.double(),o>>=_1n$2,a>>=_1n$2;return{p1:g,p2:b}}function pippenger(s,e,o,a){validateMSMPoints(o,s),validateMSMScalars(a,e);const c=o.length,g=a.length;if(c!==g)throw new Error("arrays of points and scalars must have equal length");const b=s.ZERO,_=bitLen(BigInt(c));let j=1;_>12?j=_-3:_>4?j=_-2:_>0&&(j=2);const _e=bitMask(j),tt=new Array(Number(_e)+1).fill(b),et=Math.floor((e.BITS-1)/j)*j;let nt=b;for(let rt=et;rt>=0;rt-=j){tt.fill(b);for(let st=0;st<g;st++){const lt=a[st],at=Number(lt>>BigInt(rt)&_e);tt[at]=tt[at].add(o[st])}let it=b;for(let st=tt.length-1,lt=b;st>0;st--)lt=lt.add(tt[st]),it=it.add(lt);if(nt=nt.add(it),rt!==0)for(let st=0;st<j;st++)nt=nt.double()}return nt}function createField(s,e,o){if(e){if(e.ORDER!==s)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return validateField(e),e}else return Field(s,{isLE:o})}function _createCurveFields(s,e,o={},a){if(a===void 0&&(a=s==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${s} CURVE object`);for(const j of["p","n","h"]){const _e=e[j];if(!(typeof _e=="bigint"&&_e>_0n$2))throw new Error(`CURVE.${j} must be positive bigint`)}const c=createField(e.p,o.Fp,a),g=createField(e.n,o.Fn,a),_=["Gx","Gy","a","b"];for(const j of _)if(!c.isValid(e[j]))throw new Error(`CURVE.${j} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:c,Fn:g}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const divNearest=(s,e)=>(s+(s>=0?e:-e)/_2n$1)/e;function _splitEndoScalar(s,e,o){const[[a,c],[g,b]]=e,_=divNearest(b*s,o),j=divNearest(-c*s,o);let _e=s-_*a-j*g,tt=-_*c-j*b;const et=_e<_0n$1,nt=tt<_0n$1;et&&(_e=-_e),nt&&(tt=-tt);const rt=bitMask(Math.ceil(bitLen(o)/2))+_1n$1;if(_e<_0n$1||_e>=rt||tt<_0n$1||tt>=rt)throw new Error("splitScalar (endomorphism): failed, k="+s);return{k1neg:et,k1:_e,k2neg:nt,k2:tt}}function validateSigFormat(s){if(!["compact","recovered","der"].includes(s))throw new Error('Signature format must be "compact", "recovered", or "der"');return s}function validateSigOpts(s,e){const o={};for(let a of Object.keys(e))o[a]=s[a]===void 0?e[a]:s[a];return _abool2(o.lowS,"lowS"),_abool2(o.prehash,"prehash"),o.format!==void 0&&validateSigFormat(o.format),o}class DERErr extends Error{constructor(e=""){super(e)}}const DER={Err:DERErr,_tlv:{encode:(s,e)=>{const{Err:o}=DER;if(s<0||s>256)throw new o("tlv.encode: wrong tag");if(e.length&1)throw new o("tlv.encode: unpadded data");const a=e.length/2,c=numberToHexUnpadded(a);if(c.length/2&128)throw new o("tlv.encode: long form length too big");const g=a>127?numberToHexUnpadded(c.length/2|128):"";return numberToHexUnpadded(s)+g+c+e},decode(s,e){const{Err:o}=DER;let a=0;if(s<0||s>256)throw new o("tlv.encode: wrong tag");if(e.length<2||e[a++]!==s)throw new o("tlv.decode: wrong tlv");const c=e[a++],g=!!(c&128);let b=0;if(!g)b=c;else{const j=c&127;if(!j)throw new o("tlv.decode(long): indefinite length not supported");if(j>4)throw new o("tlv.decode(long): byte length is too big");const _e=e.subarray(a,a+j);if(_e.length!==j)throw new o("tlv.decode: length bytes not complete");if(_e[0]===0)throw new o("tlv.decode(long): zero leftmost byte");for(const tt of _e)b=b<<8|tt;if(a+=j,b<128)throw new o("tlv.decode(long): not minimal encoding")}const _=e.subarray(a,a+b);if(_.length!==b)throw new o("tlv.decode: wrong value length");return{v:_,l:e.subarray(a+b)}}},_int:{encode(s){const{Err:e}=DER;if(s<_0n$1)throw new e("integer: negative integers are not allowed");let o=numberToHexUnpadded(s);if(Number.parseInt(o[0],16)&8&&(o="00"+o),o.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return o},decode(s){const{Err:e}=DER;if(s[0]&128)throw new e("invalid signature integer: negative");if(s[0]===0&&!(s[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return bytesToNumberBE(s)}},toSig(s){const{Err:e,_int:o,_tlv:a}=DER,c=ensureBytes("signature",s),{v:g,l:b}=a.decode(48,c);if(b.length)throw new e("invalid signature: left bytes after parsing");const{v:_,l:j}=a.decode(2,g),{v:_e,l:tt}=a.decode(2,j);if(tt.length)throw new e("invalid signature: left bytes after parsing");return{r:o.decode(_),s:o.decode(_e)}},hexFromSig(s){const{_tlv:e,_int:o}=DER,a=e.encode(2,o.encode(s.r)),c=e.encode(2,o.encode(s.s)),g=a+c;return e.encode(48,g)}},_0n$1=BigInt(0),_1n$1=BigInt(1),_2n$1=BigInt(2),_3n=BigInt(3),_4n=BigInt(4);function _normFnElement(s,e){const{BYTES:o}=s;let a;if(typeof e=="bigint")a=e;else{let c=ensureBytes("private key",e);try{a=s.fromBytes(c)}catch{throw new Error(`invalid private key: expected ui8a of size ${o}, got ${typeof e}`)}}if(!s.isValidNot0(a))throw new Error("invalid private key: out of range [1..N-1]");return a}function weierstrassN(s,e={}){const o=_createCurveFields("weierstrass",s,e),{Fp:a,Fn:c}=o;let g=o.CURVE;const{h:b,n:_}=g;_validateObject(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:j}=e;if(j&&(!a.is0(g.a)||typeof j.beta!="bigint"||!Array.isArray(j.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const _e=getWLengths(a,c);function tt(){if(!a.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function et(xt,ht,Et){const{x:ot,y:dt}=ht.toAffine(),bt=a.toBytes(ot);if(_abool2(Et,"isCompressed"),Et){tt();const wt=!a.isOdd(dt);return concatBytes(pprefix(wt),bt)}else return concatBytes(Uint8Array.of(4),bt,a.toBytes(dt))}function nt(xt){_abytes2(xt,void 0,"Point");const{publicKey:ht,publicKeyUncompressed:Et}=_e,ot=xt.length,dt=xt[0],bt=xt.subarray(1);if(ot===ht&&(dt===2||dt===3)){const wt=a.fromBytes(bt);if(!a.isValid(wt))throw new Error("bad point: is not on curve, wrong x");const St=st(wt);let gt;try{gt=a.sqrt(St)}catch(Pt){const jt=Pt instanceof Error?": "+Pt.message:"";throw new Error("bad point: is not on curve, sqrt error"+jt)}tt();const $t=a.isOdd(gt);return(dt&1)===1!==$t&&(gt=a.neg(gt)),{x:wt,y:gt}}else if(ot===Et&&dt===4){const wt=a.BYTES,St=a.fromBytes(bt.subarray(0,wt)),gt=a.fromBytes(bt.subarray(wt,wt*2));if(!lt(St,gt))throw new Error("bad point: is not on curve");return{x:St,y:gt}}else throw new Error(`bad point: got length ${ot}, expected compressed=${ht} or uncompressed=${Et}`)}const rt=e.toBytes||et,it=e.fromBytes||nt;function st(xt){const ht=a.sqr(xt),Et=a.mul(ht,xt);return a.add(a.add(Et,a.mul(xt,g.a)),g.b)}function lt(xt,ht){const Et=a.sqr(ht),ot=st(xt);return a.eql(Et,ot)}if(!lt(g.Gx,g.Gy))throw new Error("bad curve params: generator point");const at=a.mul(a.pow(g.a,_3n),_4n),ct=a.mul(a.sqr(g.b),BigInt(27));if(a.is0(a.add(at,ct)))throw new Error("bad curve params: a or b");function ft(xt,ht,Et=!1){if(!a.isValid(ht)||Et&&a.is0(ht))throw new Error(`bad point coordinate ${xt}`);return ht}function vt(xt){if(!(xt instanceof Nt))throw new Error("ProjectivePoint expected")}function Rt(xt){if(!j||!j.basises)throw new Error("no endo");return _splitEndoScalar(xt,j.basises,c.ORDER)}const _t=memoized((xt,ht)=>{const{X:Et,Y:ot,Z:dt}=xt;if(a.eql(dt,a.ONE))return{x:Et,y:ot};const bt=xt.is0();ht==null&&(ht=bt?a.ONE:a.inv(dt));const wt=a.mul(Et,ht),St=a.mul(ot,ht),gt=a.mul(dt,ht);if(bt)return{x:a.ZERO,y:a.ZERO};if(!a.eql(gt,a.ONE))throw new Error("invZ was invalid");return{x:wt,y:St}}),Tt=memoized(xt=>{if(xt.is0()){if(e.allowInfinityPoint&&!a.is0(xt.Y))return;throw new Error("bad point: ZERO")}const{x:ht,y:Et}=xt.toAffine();if(!a.isValid(ht)||!a.isValid(Et))throw new Error("bad point: x or y not field elements");if(!lt(ht,Et))throw new Error("bad point: equation left != right");if(!xt.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function Ct(xt,ht,Et,ot,dt){return Et=new Nt(a.mul(Et.X,xt),Et.Y,Et.Z),ht=negateCt(ot,ht),Et=negateCt(dt,Et),ht.add(Et)}class Nt{constructor(ht,Et,ot){this.X=ft("x",ht),this.Y=ft("y",Et,!0),this.Z=ft("z",ot),Object.freeze(this)}static CURVE(){return g}static fromAffine(ht){const{x:Et,y:ot}=ht||{};if(!ht||!a.isValid(Et)||!a.isValid(ot))throw new Error("invalid affine point");if(ht instanceof Nt)throw new Error("projective point not allowed");return a.is0(Et)&&a.is0(ot)?Nt.ZERO:new Nt(Et,ot,a.ONE)}static fromBytes(ht){const Et=Nt.fromAffine(it(_abytes2(ht,void 0,"point")));return Et.assertValidity(),Et}static fromHex(ht){return Nt.fromBytes(ensureBytes("pointHex",ht))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(ht=8,Et=!0){return yt.createCache(this,ht),Et||this.multiply(_3n),this}assertValidity(){Tt(this)}hasEvenY(){const{y:ht}=this.toAffine();if(!a.isOdd)throw new Error("Field doesn't support isOdd");return!a.isOdd(ht)}equals(ht){vt(ht);const{X:Et,Y:ot,Z:dt}=this,{X:bt,Y:wt,Z:St}=ht,gt=a.eql(a.mul(Et,St),a.mul(bt,dt)),$t=a.eql(a.mul(ot,St),a.mul(wt,dt));return gt&&$t}negate(){return new Nt(this.X,a.neg(this.Y),this.Z)}double(){const{a:ht,b:Et}=g,ot=a.mul(Et,_3n),{X:dt,Y:bt,Z:wt}=this;let St=a.ZERO,gt=a.ZERO,$t=a.ZERO,kt=a.mul(dt,dt),Pt=a.mul(bt,bt),jt=a.mul(wt,wt),Dt=a.mul(dt,bt);return Dt=a.add(Dt,Dt),$t=a.mul(dt,wt),$t=a.add($t,$t),St=a.mul(ht,$t),gt=a.mul(ot,jt),gt=a.add(St,gt),St=a.sub(Pt,gt),gt=a.add(Pt,gt),gt=a.mul(St,gt),St=a.mul(Dt,St),$t=a.mul(ot,$t),jt=a.mul(ht,jt),Dt=a.sub(kt,jt),Dt=a.mul(ht,Dt),Dt=a.add(Dt,$t),$t=a.add(kt,kt),kt=a.add($t,kt),kt=a.add(kt,jt),kt=a.mul(kt,Dt),gt=a.add(gt,kt),jt=a.mul(bt,wt),jt=a.add(jt,jt),kt=a.mul(jt,Dt),St=a.sub(St,kt),$t=a.mul(jt,Pt),$t=a.add($t,$t),$t=a.add($t,$t),new Nt(St,gt,$t)}add(ht){vt(ht);const{X:Et,Y:ot,Z:dt}=this,{X:bt,Y:wt,Z:St}=ht;let gt=a.ZERO,$t=a.ZERO,kt=a.ZERO;const Pt=g.a,jt=a.mul(g.b,_3n);let Dt=a.mul(Et,bt),Bt=a.mul(ot,wt),Mt=a.mul(dt,St),Wt=a.add(Et,ot),Kt=a.add(bt,wt);Wt=a.mul(Wt,Kt),Kt=a.add(Dt,Bt),Wt=a.sub(Wt,Kt),Kt=a.add(Et,dt);let Qt=a.add(bt,St);return Kt=a.mul(Kt,Qt),Qt=a.add(Dt,Mt),Kt=a.sub(Kt,Qt),Qt=a.add(ot,dt),gt=a.add(wt,St),Qt=a.mul(Qt,gt),gt=a.add(Bt,Mt),Qt=a.sub(Qt,gt),kt=a.mul(Pt,Kt),gt=a.mul(jt,Mt),kt=a.add(gt,kt),gt=a.sub(Bt,kt),kt=a.add(Bt,kt),$t=a.mul(gt,kt),Bt=a.add(Dt,Dt),Bt=a.add(Bt,Dt),Mt=a.mul(Pt,Mt),Kt=a.mul(jt,Kt),Bt=a.add(Bt,Mt),Mt=a.sub(Dt,Mt),Mt=a.mul(Pt,Mt),Kt=a.add(Kt,Mt),Dt=a.mul(Bt,Kt),$t=a.add($t,Dt),Dt=a.mul(Qt,Kt),gt=a.mul(Wt,gt),gt=a.sub(gt,Dt),Dt=a.mul(Wt,Bt),kt=a.mul(Qt,kt),kt=a.add(kt,Dt),new Nt(gt,$t,kt)}subtract(ht){return this.add(ht.negate())}is0(){return this.equals(Nt.ZERO)}multiply(ht){const{endo:Et}=e;if(!c.isValidNot0(ht))throw new Error("invalid scalar: out of range");let ot,dt;const bt=wt=>yt.cached(this,wt,St=>normalizeZ(Nt,St));if(Et){const{k1neg:wt,k1:St,k2neg:gt,k2:$t}=Rt(ht),{p:kt,f:Pt}=bt(St),{p:jt,f:Dt}=bt($t);dt=Pt.add(Dt),ot=Ct(Et.beta,kt,jt,wt,gt)}else{const{p:wt,f:St}=bt(ht);ot=wt,dt=St}return normalizeZ(Nt,[ot,dt])[0]}multiplyUnsafe(ht){const{endo:Et}=e,ot=this;if(!c.isValid(ht))throw new Error("invalid scalar: out of range");if(ht===_0n$1||ot.is0())return Nt.ZERO;if(ht===_1n$1)return ot;if(yt.hasCache(this))return this.multiply(ht);if(Et){const{k1neg:dt,k1:bt,k2neg:wt,k2:St}=Rt(ht),{p1:gt,p2:$t}=mulEndoUnsafe(Nt,ot,bt,St);return Ct(Et.beta,gt,$t,dt,wt)}else return yt.unsafe(ot,ht)}multiplyAndAddUnsafe(ht,Et,ot){const dt=this.multiplyUnsafe(Et).add(ht.multiplyUnsafe(ot));return dt.is0()?void 0:dt}toAffine(ht){return _t(this,ht)}isTorsionFree(){const{isTorsionFree:ht}=e;return b===_1n$1?!0:ht?ht(Nt,this):yt.unsafe(this,_).is0()}clearCofactor(){const{clearCofactor:ht}=e;return b===_1n$1?this:ht?ht(Nt,this):this.multiplyUnsafe(b)}isSmallOrder(){return this.multiplyUnsafe(b).is0()}toBytes(ht=!0){return _abool2(ht,"isCompressed"),this.assertValidity(),rt(Nt,this,ht)}toHex(ht=!0){return bytesToHex(this.toBytes(ht))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(ht=!0){return this.toBytes(ht)}_setWindowSize(ht){this.precompute(ht)}static normalizeZ(ht){return normalizeZ(Nt,ht)}static msm(ht,Et){return pippenger(Nt,c,ht,Et)}static fromPrivateKey(ht){return Nt.BASE.multiply(_normFnElement(c,ht))}}Nt.BASE=new Nt(g.Gx,g.Gy,a.ONE),Nt.ZERO=new Nt(a.ZERO,a.ONE,a.ZERO),Nt.Fp=a,Nt.Fn=c;const At=c.BITS,yt=new wNAF(Nt,e.endo?Math.ceil(At/2):At);return Nt.BASE.precompute(8),Nt}function pprefix(s){return Uint8Array.of(s?2:3)}function getWLengths(s,e){return{secretKey:e.BYTES,publicKey:1+s.BYTES,publicKeyUncompressed:1+2*s.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function ecdh(s,e={}){const{Fn:o}=s,a=e.randomBytes||randomBytes,c=Object.assign(getWLengths(s.Fp,o),{seed:getMinHashLength(o.ORDER)});function g(rt){try{return!!_normFnElement(o,rt)}catch{return!1}}function b(rt,it){const{publicKey:st,publicKeyUncompressed:lt}=c;try{const at=rt.length;return it===!0&&at!==st||it===!1&&at!==lt?!1:!!s.fromBytes(rt)}catch{return!1}}function _(rt=a(c.seed)){return mapHashToField(_abytes2(rt,c.seed,"seed"),o.ORDER)}function j(rt,it=!0){return s.BASE.multiply(_normFnElement(o,rt)).toBytes(it)}function _e(rt){const it=_(rt);return{secretKey:it,publicKey:j(it)}}function tt(rt){if(typeof rt=="bigint")return!1;if(rt instanceof s)return!0;const{secretKey:it,publicKey:st,publicKeyUncompressed:lt}=c;if(o.allowedLengths||it===st)return;const at=ensureBytes("key",rt).length;return at===st||at===lt}function et(rt,it,st=!0){if(tt(rt)===!0)throw new Error("first arg must be private key");if(tt(it)===!1)throw new Error("second arg must be public key");const lt=_normFnElement(o,rt);return s.fromHex(it).multiply(lt).toBytes(st)}return Object.freeze({getPublicKey:j,getSharedSecret:et,keygen:_e,Point:s,utils:{isValidSecretKey:g,isValidPublicKey:b,randomSecretKey:_,isValidPrivateKey:g,randomPrivateKey:_,normPrivateKeyToScalar:rt=>_normFnElement(o,rt),precompute(rt=8,it=s.BASE){return it.precompute(rt,!1)}},lengths:c})}function ecdsa(s,e,o={}){ahash(e),_validateObject(o,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const a=o.randomBytes||randomBytes,c=o.hmac||((Et,...ot)=>hmac(e,Et,concatBytes(...ot))),{Fp:g,Fn:b}=s,{ORDER:_,BITS:j}=b,{keygen:_e,getPublicKey:tt,getSharedSecret:et,utils:nt,lengths:rt}=ecdh(s,o),it={prehash:!1,lowS:typeof o.lowS=="boolean"?o.lowS:!1,format:void 0,extraEntropy:!1},st="compact";function lt(Et){const ot=_>>_1n$1;return Et>ot}function at(Et,ot){if(!b.isValidNot0(ot))throw new Error(`invalid signature ${Et}: out of range 1..Point.Fn.ORDER`);return ot}function ct(Et,ot){validateSigFormat(ot);const dt=rt.signature,bt=ot==="compact"?dt:ot==="recovered"?dt+1:void 0;return _abytes2(Et,bt,`${ot} signature`)}class ft{constructor(ot,dt,bt){this.r=at("r",ot),this.s=at("s",dt),bt!=null&&(this.recovery=bt),Object.freeze(this)}static fromBytes(ot,dt=st){ct(ot,dt);let bt;if(dt==="der"){const{r:$t,s:kt}=DER.toSig(_abytes2(ot));return new ft($t,kt)}dt==="recovered"&&(bt=ot[0],dt="compact",ot=ot.subarray(1));const wt=b.BYTES,St=ot.subarray(0,wt),gt=ot.subarray(wt,wt*2);return new ft(b.fromBytes(St),b.fromBytes(gt),bt)}static fromHex(ot,dt){return this.fromBytes(hexToBytes(ot),dt)}addRecoveryBit(ot){return new ft(this.r,this.s,ot)}recoverPublicKey(ot){const dt=g.ORDER,{r:bt,s:wt,recovery:St}=this;if(St==null||![0,1,2,3].includes(St))throw new Error("recovery id invalid");if(_*_2n$1<dt&&St>1)throw new Error("recovery id is ambiguous for h>1 curve");const $t=St===2||St===3?bt+_:bt;if(!g.isValid($t))throw new Error("recovery id 2 or 3 invalid");const kt=g.toBytes($t),Pt=s.fromBytes(concatBytes(pprefix((St&1)===0),kt)),jt=b.inv($t),Dt=Rt(ensureBytes("msgHash",ot)),Bt=b.create(-Dt*jt),Mt=b.create(wt*jt),Wt=s.BASE.multiplyUnsafe(Bt).add(Pt.multiplyUnsafe(Mt));if(Wt.is0())throw new Error("point at infinify");return Wt.assertValidity(),Wt}hasHighS(){return lt(this.s)}toBytes(ot=st){if(validateSigFormat(ot),ot==="der")return hexToBytes(DER.hexFromSig(this));const dt=b.toBytes(this.r),bt=b.toBytes(this.s);if(ot==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return concatBytes(Uint8Array.of(this.recovery),dt,bt)}return concatBytes(dt,bt)}toHex(ot){return bytesToHex(this.toBytes(ot))}assertValidity(){}static fromCompact(ot){return ft.fromBytes(ensureBytes("sig",ot),"compact")}static fromDER(ot){return ft.fromBytes(ensureBytes("sig",ot),"der")}normalizeS(){return this.hasHighS()?new ft(this.r,b.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return bytesToHex(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return bytesToHex(this.toBytes("compact"))}}const vt=o.bits2int||function(ot){if(ot.length>8192)throw new Error("input is too large");const dt=bytesToNumberBE(ot),bt=ot.length*8-j;return bt>0?dt>>BigInt(bt):dt},Rt=o.bits2int_modN||function(ot){return b.create(vt(ot))},_t=bitMask(j);function Tt(Et){return aInRange("num < 2^"+j,Et,_0n$1,_t),b.toBytes(Et)}function Ct(Et,ot){return _abytes2(Et,void 0,"message"),ot?_abytes2(e(Et),void 0,"prehashed message"):Et}function Nt(Et,ot,dt){if(["recovered","canonical"].some(Bt=>Bt in dt))throw new Error("sign() legacy options not supported");const{lowS:bt,prehash:wt,extraEntropy:St}=validateSigOpts(dt,it);Et=Ct(Et,wt);const gt=Rt(Et),$t=_normFnElement(b,ot),kt=[Tt($t),Tt(gt)];if(St!=null&&St!==!1){const Bt=St===!0?a(rt.secretKey):St;kt.push(ensureBytes("extraEntropy",Bt))}const Pt=concatBytes(...kt),jt=gt;function Dt(Bt){const Mt=vt(Bt);if(!b.isValidNot0(Mt))return;const Wt=b.inv(Mt),Kt=s.BASE.multiply(Mt).toAffine(),Qt=b.create(Kt.x);if(Qt===_0n$1)return;const Zt=b.create(Wt*b.create(jt+Qt*$t));if(Zt===_0n$1)return;let cn=(Kt.x===Qt?0:2)|Number(Kt.y&_1n$1),nn=Zt;return bt&&lt(Zt)&&(nn=b.neg(Zt),cn^=1),new ft(Qt,nn,cn)}return{seed:Pt,k2sig:Dt}}function At(Et,ot,dt={}){Et=ensureBytes("message",Et);const{seed:bt,k2sig:wt}=Nt(Et,ot,dt);return createHmacDrbg(e.outputLen,b.BYTES,c)(bt,wt)}function yt(Et){let ot;const dt=typeof Et=="string"||isBytes(Et),bt=!dt&&Et!==null&&typeof Et=="object"&&typeof Et.r=="bigint"&&typeof Et.s=="bigint";if(!dt&&!bt)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(bt)ot=new ft(Et.r,Et.s);else if(dt){try{ot=ft.fromBytes(ensureBytes("sig",Et),"der")}catch(wt){if(!(wt instanceof DER.Err))throw wt}if(!ot)try{ot=ft.fromBytes(ensureBytes("sig",Et),"compact")}catch{return!1}}return ot||!1}function xt(Et,ot,dt,bt={}){const{lowS:wt,prehash:St,format:gt}=validateSigOpts(bt,it);if(dt=ensureBytes("publicKey",dt),ot=Ct(ensureBytes("message",ot),St),"strict"in bt)throw new Error("options.strict was renamed to lowS");const $t=gt===void 0?yt(Et):ft.fromBytes(ensureBytes("sig",Et),gt);if($t===!1)return!1;try{const kt=s.fromBytes(dt);if(wt&&$t.hasHighS())return!1;const{r:Pt,s:jt}=$t,Dt=Rt(ot),Bt=b.inv(jt),Mt=b.create(Dt*Bt),Wt=b.create(Pt*Bt),Kt=s.BASE.multiplyUnsafe(Mt).add(kt.multiplyUnsafe(Wt));return Kt.is0()?!1:b.create(Kt.x)===Pt}catch{return!1}}function ht(Et,ot,dt={}){const{prehash:bt}=validateSigOpts(dt,it);return ot=Ct(ot,bt),ft.fromBytes(Et,"recovered").recoverPublicKey(ot).toBytes()}return Object.freeze({keygen:_e,getPublicKey:tt,getSharedSecret:et,utils:nt,lengths:rt,Point:s,sign:At,verify:xt,recoverPublicKey:ht,Signature:ft,hash:e})}function _weierstrass_legacy_opts_to_new(s){const e={a:s.a,b:s.b,p:s.Fp.ORDER,n:s.n,h:s.h,Gx:s.Gx,Gy:s.Gy},o=s.Fp;let a=s.allowedPrivateKeyLengths?Array.from(new Set(s.allowedPrivateKeyLengths.map(b=>Math.ceil(b/2)))):void 0;const c=Field(e.n,{BITS:s.nBitLength,allowedLengths:a,modFromBytes:s.wrapPrivateKey}),g={Fp:o,Fn:c,allowInfinityPoint:s.allowInfinityPoint,endo:s.endo,isTorsionFree:s.isTorsionFree,clearCofactor:s.clearCofactor,fromBytes:s.fromBytes,toBytes:s.toBytes};return{CURVE:e,curveOpts:g}}function _ecdsa_legacy_opts_to_new(s){const{CURVE:e,curveOpts:o}=_weierstrass_legacy_opts_to_new(s),a={hmac:s.hmac,randomBytes:s.randomBytes,lowS:s.lowS,bits2int:s.bits2int,bits2int_modN:s.bits2int_modN};return{CURVE:e,curveOpts:o,hash:s.hash,ecdsaOpts:a}}function _ecdsa_new_output_to_legacy(s,e){const o=e.Point;return Object.assign({},e,{ProjectivePoint:o,CURVE:Object.assign({},s,nLength(o.Fn.ORDER,o.Fn.BITS))})}function weierstrass(s){const{CURVE:e,curveOpts:o,hash:a,ecdsaOpts:c}=_ecdsa_legacy_opts_to_new(s),g=weierstrassN(e,o),b=ecdsa(g,a,c);return _ecdsa_new_output_to_legacy(s,b)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function createCurve(s,e){const o=a=>weierstrass({...s,hash:a});return{...o(e),create:o}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const secp256k1_CURVE={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},secp256k1_ENDO={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]},_0n=BigInt(0),_1n=BigInt(1),_2n=BigInt(2);function sqrtMod(s){const e=secp256k1_CURVE.p,o=BigInt(3),a=BigInt(6),c=BigInt(11),g=BigInt(22),b=BigInt(23),_=BigInt(44),j=BigInt(88),_e=s*s*s%e,tt=_e*_e*s%e,et=pow2(tt,o,e)*tt%e,nt=pow2(et,o,e)*tt%e,rt=pow2(nt,_2n,e)*_e%e,it=pow2(rt,c,e)*rt%e,st=pow2(it,g,e)*it%e,lt=pow2(st,_,e)*st%e,at=pow2(lt,j,e)*lt%e,ct=pow2(at,_,e)*st%e,ft=pow2(ct,o,e)*tt%e,vt=pow2(ft,b,e)*it%e,Rt=pow2(vt,a,e)*_e%e,_t=pow2(Rt,_2n,e);if(!Fpk1.eql(Fpk1.sqr(_t),s))throw new Error("Cannot find square root");return _t}const Fpk1=Field(secp256k1_CURVE.p,{sqrt:sqrtMod}),secp256k1=createCurve({...secp256k1_CURVE,Fp:Fpk1,lowS:!0,endo:secp256k1_ENDO},sha256$1),TAGGED_HASH_PREFIXES={};function taggedHash(s,...e){let o=TAGGED_HASH_PREFIXES[s];if(o===void 0){const a=sha256$1(utf8ToBytes(s));o=concatBytes(a,a),TAGGED_HASH_PREFIXES[s]=o}return sha256$1(concatBytes(o,...e))}const pointToBytes=s=>s.toBytes(!0).slice(1),Pointk1=secp256k1.Point,hasEven=s=>s%_2n===_0n;function schnorrGetExtPubKey(s){const{Fn:e,BASE:o}=Pointk1,a=_normFnElement(e,s),c=o.multiply(a);return{scalar:hasEven(c.y)?a:e.neg(a),bytes:pointToBytes(c)}}function lift_x(s){const e=Fpk1;if(!e.isValidNot0(s))throw new Error("invalid x: Fail if x ≥ p");const o=e.create(s*s),a=e.create(o*s+BigInt(7));let c=e.sqrt(a);hasEven(c)||(c=e.neg(c));const g=Pointk1.fromAffine({x:s,y:c});return g.assertValidity(),g}const num=bytesToNumberBE;function challenge(...s){return Pointk1.Fn.create(num(taggedHash("BIP0340/challenge",...s)))}function schnorrGetPublicKey(s){return schnorrGetExtPubKey(s).bytes}function schnorrSign(s,e,o=randomBytes(32)){const{Fn:a}=Pointk1,c=ensureBytes("message",s),{bytes:g,scalar:b}=schnorrGetExtPubKey(e),_=ensureBytes("auxRand",o,32),j=a.toBytes(b^num(taggedHash("BIP0340/aux",_))),_e=taggedHash("BIP0340/nonce",j,g,c),{bytes:tt,scalar:et}=schnorrGetExtPubKey(_e),nt=challenge(tt,g,c),rt=new Uint8Array(64);if(rt.set(tt,0),rt.set(a.toBytes(a.create(et+nt*b)),32),!schnorrVerify(rt,c,g))throw new Error("sign: Invalid signature produced");return rt}function schnorrVerify(s,e,o){const{Fn:a,BASE:c}=Pointk1,g=ensureBytes("signature",s,64),b=ensureBytes("message",e),_=ensureBytes("publicKey",o,32);try{const j=lift_x(num(_)),_e=num(g.subarray(0,32));if(!inRange(_e,_1n,secp256k1_CURVE.p))return!1;const tt=num(g.subarray(32,64));if(!inRange(tt,_1n,secp256k1_CURVE.n))return!1;const et=challenge(a.toBytes(_e),pointToBytes(j),b),nt=c.multiplyUnsafe(tt).add(j.multiplyUnsafe(a.neg(et))),{x:rt,y:it}=nt.toAffine();return!(nt.is0()||!hasEven(it)||rt!==_e)}catch{return!1}}const schnorr=(()=>{const o=(c=randomBytes(48))=>mapHashToField(c,secp256k1_CURVE.n);secp256k1.utils.randomSecretKey;function a(c){const g=o(c);return{secretKey:g,publicKey:schnorrGetPublicKey(g)}}return{keygen:a,getPublicKey:schnorrGetPublicKey,sign:schnorrSign,verify:schnorrVerify,Point:Pointk1,utils:{randomSecretKey:o,randomPrivateKey:o,taggedHash,lift_x,pointToBytes,numberToBytesBE,bytesToNumberBE,mod},lengths:{secretKey:32,publicKey:32,publicKeyHasPrefix:!1,signature:32*2,seed:48}}})(),sha256=sha256$1;var dist={},LRUCache$1={},LRUCacheNode$1={};Object.defineProperty(LRUCacheNode$1,"__esModule",{value:!0});LRUCacheNode$1.LRUCacheNode=void 0;class LRUCacheNode{constructor(e,o,a){const{entryExpirationTimeInMS:c=null,next:g=null,prev:b=null,onEntryEvicted:_,onEntryMarkedAsMostRecentlyUsed:j,clone:_e,cloneFn:tt}=a??{};if(typeof c=="number"&&(c<=0||Number.isNaN(c)))throw new Error("entryExpirationTimeInMS must either be null (no expiry) or greater than 0");this.clone=_e??!1,this.cloneFn=tt??this.defaultClone,this.key=e,this.internalValue=this.clone?this.cloneFn(o):o,this.created=Date.now(),this.entryExpirationTimeInMS=c,this.next=g,this.prev=b,this.onEntryEvicted=_,this.onEntryMarkedAsMostRecentlyUsed=j}get value(){return this.clone?this.cloneFn(this.internalValue):this.internalValue}get isExpired(){return typeof this.entryExpirationTimeInMS=="number"&&Date.now()-this.created>this.entryExpirationTimeInMS}invokeOnEvicted(){if(this.onEntryEvicted){const{key:e,value:o,isExpired:a}=this;this.onEntryEvicted({key:e,value:o,isExpired:a})}}invokeOnEntryMarkedAsMostRecentlyUsed(){if(this.onEntryMarkedAsMostRecentlyUsed){const{key:e,value:o}=this;this.onEntryMarkedAsMostRecentlyUsed({key:e,value:o})}}defaultClone(e){return typeof e=="boolean"||typeof e=="string"||typeof e=="number"?e:JSON.parse(JSON.stringify(e))}}LRUCacheNode$1.LRUCacheNode=LRUCacheNode;Object.defineProperty(LRUCache$1,"__esModule",{value:!0});LRUCache$1.LRUCache=void 0;const LRUCacheNode_1=LRUCacheNode$1;class LRUCache{constructor(e){this.lookupTable=new Map,this.head=null,this.tail=null;const{maxSize:o=25,entryExpirationTimeInMS:a=null,onEntryEvicted:c,onEntryMarkedAsMostRecentlyUsed:g,cloneFn:b,clone:_}=e??{};if(Number.isNaN(o)||o<=0)throw new Error("maxSize must be greater than 0.");if(typeof a=="number"&&(a<=0||Number.isNaN(a)))throw new Error("entryExpirationTimeInMS must either be null (no expiry) or greater than 0");this.maxSizeInternal=o,this.entryExpirationTimeInMS=a,this.onEntryEvicted=c,this.onEntryMarkedAsMostRecentlyUsed=g,this.clone=_,this.cloneFn=b}get size(){return this.cleanCache(),this.lookupTable.size}get remainingSize(){return this.maxSizeInternal-this.size}get newest(){return this.head?this.head.isExpired?(this.removeNodeFromListAndLookupTable(this.head),this.newest):this.mapNodeToEntry(this.head):null}get oldest(){return this.tail?this.tail.isExpired?(this.removeNodeFromListAndLookupTable(this.tail),this.oldest):this.mapNodeToEntry(this.tail):null}get maxSize(){return this.maxSizeInternal}set maxSize(e){if(Number.isNaN(e)||e<=0)throw new Error("maxSize must be greater than 0.");this.maxSizeInternal=e,this.enforceSizeLimit()}set(e,o,a){const c=this.lookupTable.get(e);c&&this.removeNodeFromListAndLookupTable(c);const g=new LRUCacheNode_1.LRUCacheNode(e,o,{entryExpirationTimeInMS:this.entryExpirationTimeInMS,onEntryEvicted:this.onEntryEvicted,onEntryMarkedAsMostRecentlyUsed:this.onEntryMarkedAsMostRecentlyUsed,clone:this.clone,cloneFn:this.cloneFn,...a});return this.setNodeAsHead(g),this.lookupTable.set(e,g),this.enforceSizeLimit(),this}get(e){const o=this.lookupTable.get(e);return o?o.isExpired?(this.removeNodeFromListAndLookupTable(o),null):(this.setNodeAsHead(o),o.value):null}peek(e){const o=this.lookupTable.get(e);return o?o.isExpired?(this.removeNodeFromListAndLookupTable(o),null):o.value:null}delete(e){const o=this.lookupTable.get(e);return o?this.removeNodeFromListAndLookupTable(o):!1}has(e){const o=this.lookupTable.get(e);return o?o.isExpired?(this.removeNodeFromListAndLookupTable(o),!1):!0:!1}clear(){this.head=null,this.tail=null,this.lookupTable.clear()}find(e){let o=this.head;for(;o;){if(o.isExpired){const c=o.next;this.removeNodeFromListAndLookupTable(o),o=c;continue}const a=this.mapNodeToEntry(o);if(e(a))return this.setNodeAsHead(o),a;o=o.next}return null}forEach(e){let o=this.head,a=0;for(;o;){if(o.isExpired){const c=o.next;this.removeNodeFromListAndLookupTable(o),o=c;continue}e(o.value,o.key,a),o=o.next,a++}}*values(){let e=this.head;for(;e;){if(e.isExpired){const o=e.next;this.removeNodeFromListAndLookupTable(e),e=o;continue}yield e.value,e=e.next}}*keys(){let e=this.head;for(;e;){if(e.isExpired){const o=e.next;this.removeNodeFromListAndLookupTable(e),e=o;continue}yield e.key,e=e.next}}*entries(){let e=this.head;for(;e;){if(e.isExpired){const o=e.next;this.removeNodeFromListAndLookupTable(e),e=o;continue}yield this.mapNodeToEntry(e),e=e.next}}*[Symbol.iterator](){let e=this.head;for(;e;){if(e.isExpired){const o=e.next;this.removeNodeFromListAndLookupTable(e),e=o;continue}yield this.mapNodeToEntry(e),e=e.next}}enforceSizeLimit(){let e=this.tail;for(;e!==null&&this.size>this.maxSizeInternal;){const o=e.prev;this.removeNodeFromListAndLookupTable(e),e=o}}mapNodeToEntry({key:e,value:o}){return{key:e,value:o}}setNodeAsHead(e){this.removeNodeFromList(e),this.head?(e.next=this.head,this.head.prev=e,this.head=e):(this.head=e,this.tail=e),e.invokeOnEntryMarkedAsMostRecentlyUsed()}removeNodeFromList(e){e.prev!==null&&(e.prev.next=e.next),e.next!==null&&(e.next.prev=e.prev),this.head===e&&(this.head=e.next),this.tail===e&&(this.tail=e.prev),e.next=null,e.prev=null}removeNodeFromListAndLookupTable(e){return e.invokeOnEvicted(),this.removeNodeFromList(e),this.lookupTable.delete(e.key)}cleanCache(){if(!this.entryExpirationTimeInMS)return;const e=[];for(const o of this.lookupTable.values())o.isExpired&&e.push(o);e.forEach(o=>this.removeNodeFromListAndLookupTable(o))}}LRUCache$1.LRUCache=LRUCache;(function(s){var e=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(a,c,g,b){b===void 0&&(b=g);var _=Object.getOwnPropertyDescriptor(c,g);(!_||("get"in _?!c.__esModule:_.writable||_.configurable))&&(_={enumerable:!0,get:function(){return c[g]}}),Object.defineProperty(a,b,_)}:function(a,c,g,b){b===void 0&&(b=g),a[b]=c[g]}),o=commonjsGlobal&&commonjsGlobal.__exportStar||function(a,c){for(var g in a)g!=="default"&&!Object.prototype.hasOwnProperty.call(c,g)&&e(c,a,g)};Object.defineProperty(s,"__esModule",{value:!0}),o(LRUCache$1,s)})(dist);var lib={};(function(s){/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */Object.defineProperty(s,"__esModule",{value:!0}),s.bytes=s.stringToBytes=s.str=s.bytesToString=s.hex=s.utf8=s.bech32m=s.bech32=s.base58check=s.base58xmr=s.base58xrp=s.base58flickr=s.base58=s.base64url=s.base64=s.base32crockford=s.base32hex=s.base32=s.base16=s.utils=s.assertNumber=void 0;function e(yt){if(!Number.isSafeInteger(yt))throw new Error(`Wrong integer: ${yt}`)}s.assertNumber=e;function o(...yt){const xt=(ot,dt)=>bt=>ot(dt(bt)),ht=Array.from(yt).reverse().reduce((ot,dt)=>ot?xt(ot,dt.encode):dt.encode,void 0),Et=yt.reduce((ot,dt)=>ot?xt(ot,dt.decode):dt.decode,void 0);return{encode:ht,decode:Et}}function a(yt){return{encode:xt=>{if(!Array.isArray(xt)||xt.length&&typeof xt[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return xt.map(ht=>{if(e(ht),ht<0||ht>=yt.length)throw new Error(`Digit index outside alphabet: ${ht} (alphabet: ${yt.length})`);return yt[ht]})},decode:xt=>{if(!Array.isArray(xt)||xt.length&&typeof xt[0]!="string")throw new Error("alphabet.decode input should be array of strings");return xt.map(ht=>{if(typeof ht!="string")throw new Error(`alphabet.decode: not string element=${ht}`);const Et=yt.indexOf(ht);if(Et===-1)throw new Error(`Unknown letter: "${ht}". Allowed: ${yt}`);return Et})}}}function c(yt=""){if(typeof yt!="string")throw new Error("join separator should be string");return{encode:xt=>{if(!Array.isArray(xt)||xt.length&&typeof xt[0]!="string")throw new Error("join.encode input should be array of strings");for(let ht of xt)if(typeof ht!="string")throw new Error(`join.encode: non-string input=${ht}`);return xt.join(yt)},decode:xt=>{if(typeof xt!="string")throw new Error("join.decode input should be string");return xt.split(yt)}}}function g(yt,xt="="){if(e(yt),typeof xt!="string")throw new Error("padding chr should be string");return{encode(ht){if(!Array.isArray(ht)||ht.length&&typeof ht[0]!="string")throw new Error("padding.encode input should be array of strings");for(let Et of ht)if(typeof Et!="string")throw new Error(`padding.encode: non-string input=${Et}`);for(;ht.length*yt%8;)ht.push(xt);return ht},decode(ht){if(!Array.isArray(ht)||ht.length&&typeof ht[0]!="string")throw new Error("padding.encode input should be array of strings");for(let ot of ht)if(typeof ot!="string")throw new Error(`padding.decode: non-string input=${ot}`);let Et=ht.length;if(Et*yt%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;Et>0&&ht[Et-1]===xt;Et--)if(!((Et-1)*yt%8))throw new Error("Invalid padding: string has too much padding");return ht.slice(0,Et)}}}function b(yt){if(typeof yt!="function")throw new Error("normalize fn should be function");return{encode:xt=>xt,decode:xt=>yt(xt)}}function _(yt,xt,ht){if(xt<2)throw new Error(`convertRadix: wrong from=${xt}, base cannot be less than 2`);if(ht<2)throw new Error(`convertRadix: wrong to=${ht}, base cannot be less than 2`);if(!Array.isArray(yt))throw new Error("convertRadix: data should be array");if(!yt.length)return[];let Et=0;const ot=[],dt=Array.from(yt);for(dt.forEach(bt=>{if(e(bt),bt<0||bt>=xt)throw new Error(`Wrong integer: ${bt}`)});;){let bt=0,wt=!0;for(let St=Et;St<dt.length;St++){const gt=dt[St],$t=xt*bt+gt;if(!Number.isSafeInteger($t)||xt*bt/xt!==bt||$t-gt!==xt*bt)throw new Error("convertRadix: carry overflow");if(bt=$t%ht,dt[St]=Math.floor($t/ht),!Number.isSafeInteger(dt[St])||dt[St]*ht+bt!==$t)throw new Error("convertRadix: carry overflow");if(wt)dt[St]?wt=!1:Et=St;else continue}if(ot.push(bt),wt)break}for(let bt=0;bt<yt.length-1&&yt[bt]===0;bt++)ot.push(0);return ot.reverse()}const j=(yt,xt)=>xt?j(xt,yt%xt):yt,_e=(yt,xt)=>yt+(xt-j(yt,xt));function tt(yt,xt,ht,Et){if(!Array.isArray(yt))throw new Error("convertRadix2: data should be array");if(xt<=0||xt>32)throw new Error(`convertRadix2: wrong from=${xt}`);if(ht<=0||ht>32)throw new Error(`convertRadix2: wrong to=${ht}`);if(_e(xt,ht)>32)throw new Error(`convertRadix2: carry overflow from=${xt} to=${ht} carryBits=${_e(xt,ht)}`);let ot=0,dt=0;const bt=2**ht-1,wt=[];for(const St of yt){if(e(St),St>=2**xt)throw new Error(`convertRadix2: invalid data word=${St} from=${xt}`);if(ot=ot<<xt|St,dt+xt>32)throw new Error(`convertRadix2: carry overflow pos=${dt} from=${xt}`);for(dt+=xt;dt>=ht;dt-=ht)wt.push((ot>>dt-ht&bt)>>>0);ot&=2**dt-1}if(ot=ot<<ht-dt&bt,!Et&&dt>=xt)throw new Error("Excess padding");if(!Et&&ot)throw new Error(`Non-zero padding: ${ot}`);return Et&&dt>0&&wt.push(ot>>>0),wt}function et(yt){return e(yt),{encode:xt=>{if(!(xt instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return _(Array.from(xt),2**8,yt)},decode:xt=>{if(!Array.isArray(xt)||xt.length&&typeof xt[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(_(xt,yt,2**8))}}}function nt(yt,xt=!1){if(e(yt),yt<=0||yt>32)throw new Error("radix2: bits should be in (0..32]");if(_e(8,yt)>32||_e(yt,8)>32)throw new Error("radix2: carry overflow");return{encode:ht=>{if(!(ht instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return tt(Array.from(ht),8,yt,!xt)},decode:ht=>{if(!Array.isArray(ht)||ht.length&&typeof ht[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(tt(ht,yt,8,xt))}}}function rt(yt){if(typeof yt!="function")throw new Error("unsafeWrapper fn should be function");return function(...xt){try{return yt.apply(null,xt)}catch{}}}function it(yt,xt){if(e(yt),typeof xt!="function")throw new Error("checksum fn should be function");return{encode(ht){if(!(ht instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");const Et=xt(ht).slice(0,yt),ot=new Uint8Array(ht.length+yt);return ot.set(ht),ot.set(Et,ht.length),ot},decode(ht){if(!(ht instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");const Et=ht.slice(0,-yt),ot=xt(Et).slice(0,yt),dt=ht.slice(-yt);for(let bt=0;bt<yt;bt++)if(ot[bt]!==dt[bt])throw new Error("Invalid checksum");return Et}}}s.utils={alphabet:a,chain:o,checksum:it,radix:et,radix2:nt,join:c,padding:g},s.base16=o(nt(4),a("0123456789ABCDEF"),c("")),s.base32=o(nt(5),a("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),g(5),c("")),s.base32hex=o(nt(5),a("0123456789ABCDEFGHIJKLMNOPQRSTUV"),g(5),c("")),s.base32crockford=o(nt(5),a("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),c(""),b(yt=>yt.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1"))),s.base64=o(nt(6),a("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),g(6),c("")),s.base64url=o(nt(6),a("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),g(6),c(""));const st=yt=>o(et(58),a(yt),c(""));s.base58=st("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),s.base58flickr=st("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),s.base58xrp=st("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const lt=[0,2,3,5,6,7,9,10,11];s.base58xmr={encode(yt){let xt="";for(let ht=0;ht<yt.length;ht+=8){const Et=yt.subarray(ht,ht+8);xt+=s.base58.encode(Et).padStart(lt[Et.length],"1")}return xt},decode(yt){let xt=[];for(let ht=0;ht<yt.length;ht+=11){const Et=yt.slice(ht,ht+11),ot=lt.indexOf(Et.length),dt=s.base58.decode(Et);for(let bt=0;bt<dt.length-ot;bt++)if(dt[bt]!==0)throw new Error("base58xmr: wrong padding");xt=xt.concat(Array.from(dt.slice(dt.length-ot)))}return Uint8Array.from(xt)}};const at=yt=>o(it(4,xt=>yt(yt(xt))),s.base58);s.base58check=at;const ct=o(a("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),c("")),ft=[996825010,642813549,513874426,1027748829,705979059];function vt(yt){const xt=yt>>25;let ht=(yt&33554431)<<5;for(let Et=0;Et<ft.length;Et++)(xt>>Et&1)===1&&(ht^=ft[Et]);return ht}function Rt(yt,xt,ht=1){const Et=yt.length;let ot=1;for(let dt=0;dt<Et;dt++){const bt=yt.charCodeAt(dt);if(bt<33||bt>126)throw new Error(`Invalid prefix (${yt})`);ot=vt(ot)^bt>>5}ot=vt(ot);for(let dt=0;dt<Et;dt++)ot=vt(ot)^yt.charCodeAt(dt)&31;for(let dt of xt)ot=vt(ot)^dt;for(let dt=0;dt<6;dt++)ot=vt(ot);return ot^=ht,ct.encode(tt([ot%2**30],30,5,!1))}function _t(yt){const xt=yt==="bech32"?1:734539939,ht=nt(5),Et=ht.decode,ot=ht.encode,dt=rt(Et);function bt($t,kt,Pt=90){if(typeof $t!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof $t}`);if(!Array.isArray(kt)||kt.length&&typeof kt[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof kt}`);const jt=$t.length+7+kt.length;if(Pt!==!1&&jt>Pt)throw new TypeError(`Length ${jt} exceeds limit ${Pt}`);return $t=$t.toLowerCase(),`${$t}1${ct.encode(kt)}${Rt($t,kt,xt)}`}function wt($t,kt=90){if(typeof $t!="string")throw new Error(`bech32.decode input should be string, not ${typeof $t}`);if($t.length<8||kt!==!1&&$t.length>kt)throw new TypeError(`Wrong string length: ${$t.length} (${$t}). Expected (8..${kt})`);const Pt=$t.toLowerCase();if($t!==Pt&&$t!==$t.toUpperCase())throw new Error("String must be lowercase or uppercase");$t=Pt;const jt=$t.lastIndexOf("1");if(jt===0||jt===-1)throw new Error('Letter "1" must be present between prefix and data only');const Dt=$t.slice(0,jt),Bt=$t.slice(jt+1);if(Bt.length<6)throw new Error("Data must be at least 6 characters long");const Mt=ct.decode(Bt).slice(0,-6),Wt=Rt(Dt,Mt,xt);if(!Bt.endsWith(Wt))throw new Error(`Invalid checksum in ${$t}: expected "${Wt}"`);return{prefix:Dt,words:Mt}}const St=rt(wt);function gt($t){const{prefix:kt,words:Pt}=wt($t,!1);return{prefix:kt,words:Pt,bytes:Et(Pt)}}return{encode:bt,decode:wt,decodeToBytes:gt,decodeUnsafe:St,fromWords:Et,fromWordsUnsafe:dt,toWords:ot}}s.bech32=_t("bech32"),s.bech32m=_t("bech32m"),s.utf8={encode:yt=>new TextDecoder().decode(yt),decode:yt=>new TextEncoder().encode(yt)},s.hex=o(nt(4),a("0123456789abcdef"),c(""),b(yt=>{if(typeof yt!="string"||yt.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof yt} with length ${yt.length}`);return yt.toLowerCase()}));const Tt={utf8:s.utf8,hex:s.hex,base16:s.base16,base32:s.base32,base64:s.base64,base64url:s.base64url,base58:s.base58,base58xmr:s.base58xmr},Ct=`Invalid encoding type. Available types: ${Object.keys(Tt).join(", ")}`,Nt=(yt,xt)=>{if(typeof yt!="string"||!Tt.hasOwnProperty(yt))throw new TypeError(Ct);if(!(xt instanceof Uint8Array))throw new TypeError("bytesToString() expects Uint8Array");return Tt[yt].encode(xt)};s.bytesToString=Nt,s.str=s.bytesToString;const At=(yt,xt)=>{if(!Tt.hasOwnProperty(yt))throw new TypeError(Ct);if(typeof xt!="string")throw new TypeError("stringToBytes() expects string");return Tt[yt].decode(xt)};s.stringToBytes=At,s.bytes=s.stringToBytes})(lib);const{bech32,hex,utf8}=lib;BigInt(1e3),BigInt(1e6),BigInt(1e9),BigInt(1e12);BigInt("2100000000000000000");BigInt(1e11);const TAGCODES={payment_hash:1,payment_secret:16,description:13,payee:19,description_hash:23,expiry:6,min_final_cltv_expiry:24,fallback_address:9,route_hint:3,feature_bits:5,metadata:27};for(let s=0,e=Object.keys(TAGCODES);s<e.length;s++)e[s],TAGCODES[e[s]].toString();function getRelaysForSync(s,e,o="write"){if(!s.outboxTracker)return;const a=s.outboxTracker.data.get(e);if(a)return o==="write"?a.writeRelays:a.readRelays}async function getWriteRelaysFor(s,e,o="write"){if(s.outboxTracker)return s.outboxTracker.data.has(e)||await s.outboxTracker.trackUsers([e]),getRelaysForSync(s,e,o)}function getTopRelaysForAuthors(s,e){const o=new Map;return e.forEach(c=>{const g=getRelaysForSync(s,c);g&&g.forEach(b=>{const _=o.get(b)||0;o.set(b,_+1)})}),Array.from(o.entries()).sort((c,g)=>g[1]-c[1]).map(c=>c[0])}function getAllRelaysForAllPubkeys(s,e,o="read"){const a=new Map,c=new Set;return e.forEach(g=>{const b=getRelaysForSync(s,g,o);b&&b.size>0?(b.forEach(_=>{(a.get(_)||new Set).add(g)}),a.set(g,b)):c.add(g)}),{pubkeysToRelays:a,authorsMissingRelays:c}}function chooseRelayCombinationForPubkeys(s,e,o,{count:a,preferredRelays:c}={}){a??(a=2),c??(c=new Set);const g=s.pool,b=g.connectedRelays();b.forEach(nt=>{c==null||c.add(nt.url)});const _=new Map,{pubkeysToRelays:j,authorsMissingRelays:_e}=getAllRelaysForAllPubkeys(s,e,o),tt=getTopRelaysForAuthors(s,e),et=(nt,rt)=>{const it=_.get(rt)||[];it.push(nt),_.set(rt,it)};for(const[nt,rt]of j.entries()){let it=a;for(const st of b)rt.has(st.url)&&(et(nt,st.url),it--);for(const st of rt)_.has(st)&&(et(nt,st),it--);if(!(it<=0))for(const st of tt){if(it<=0)break;rt.has(st)&&(et(nt,st),it--)}}for(const nt of _e)g.permanentAndConnectedRelays().forEach(rt=>{const it=_.get(rt.url)||[];it.push(nt),_.set(rt.url,it)});return _}function getRelaysForFilterWithAuthors(s,e,o=2){return chooseRelayCombinationForPubkeys(s,e,"write",{count:o})}function tryNormalizeRelayUrl(s){try{return normalizeRelayUrl(s)}catch{return}}function normalizeRelayUrl(s){let e=normalizeUrl(s,{stripAuthentication:!1,stripWWW:!1,stripHash:!0});return e.endsWith("/")||(e+="/"),e}function normalize(s){const e=new Set;for(const o of s)try{e.add(normalizeRelayUrl(o))}catch{}return Array.from(e)}var DATA_URL_DEFAULT_MIME_TYPE="text/plain",DATA_URL_DEFAULT_CHARSET="us-ascii",testParameter=(s,e)=>e.some(o=>o instanceof RegExp?o.test(s):o===s),supportedProtocols=new Set(["https:","http:","file:"]),hasCustomProtocol=s=>{try{const{protocol:e}=new URL(s);return e.endsWith(":")&&!e.includes(".")&&!supportedProtocols.has(e)}catch{return!1}},normalizeDataURL=(s,{stripHash:e})=>{var et,nt,rt,it;const o=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(s);if(!o)throw new Error(`Invalid URL: ${s}`);const a=((et=o.groups)==null?void 0:et.type)??"",c=((nt=o.groups)==null?void 0:nt.data)??"";let g=((rt=o.groups)==null?void 0:rt.hash)??"";const b=a.split(";");g=e?"":g;let _=!1;b[b.length-1]==="base64"&&(b.pop(),_=!0);const j=((it=b.shift())==null?void 0:it.toLowerCase())??"",tt=[...b.map(st=>{let[lt,at=""]=st.split("=").map(ct=>ct.trim());return lt==="charset"&&(at=at.toLowerCase(),at===DATA_URL_DEFAULT_CHARSET)?"":`${lt}${at?`=${at}`:""}`}).filter(Boolean)];return _&&tt.push("base64"),(tt.length>0||j&&j!==DATA_URL_DEFAULT_MIME_TYPE)&&tt.unshift(j),`data:${tt.join(";")},${_?c.trim():c}${g?`#${g}`:""}`};function normalizeUrl(s,e={}){if(e={defaultProtocol:"http",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,removeExplicitPort:!1,sortQueryParameters:!0,...e},typeof e.defaultProtocol=="string"&&!e.defaultProtocol.endsWith(":")&&(e.defaultProtocol=`${e.defaultProtocol}:`),s=s.trim(),/^data:/i.test(s))return normalizeDataURL(s,e);if(hasCustomProtocol(s))return s;const o=s.startsWith("//");!o&&/^\.*\//.test(s)||(s=s.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,e.defaultProtocol));const c=new URL(s);if(c.hostname=c.hostname.toLowerCase(),e.forceHttp&&e.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(e.forceHttp&&c.protocol==="https:"&&(c.protocol="http:"),e.forceHttps&&c.protocol==="http:"&&(c.protocol="https:"),e.stripAuthentication&&(c.username="",c.password=""),e.stripHash?c.hash="":e.stripTextFragment&&(c.hash=c.hash.replace(/#?:~:text.*?$/i,"")),c.pathname){const b=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g;let _=0,j="";for(;;){const tt=b.exec(c.pathname);if(!tt)break;const et=tt[0],nt=tt.index,rt=c.pathname.slice(_,nt);j+=rt.replace(/\/{2,}/g,"/"),j+=et,_=nt+et.length}const _e=c.pathname.slice(_,c.pathname.length);j+=_e.replace(/\/{2,}/g,"/"),c.pathname=j}if(c.pathname)try{c.pathname=decodeURI(c.pathname)}catch{}if(e.removeDirectoryIndex===!0&&(e.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(e.removeDirectoryIndex)&&e.removeDirectoryIndex.length>0){let b=c.pathname.split("/");const _=b[b.length-1];testParameter(_,e.removeDirectoryIndex)&&(b=b.slice(0,-1),c.pathname=`${b.slice(1).join("/")}/`)}if(c.hostname&&(c.hostname=c.hostname.replace(/\.$/,""),e.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(c.hostname)&&(c.hostname=c.hostname.replace(/^www\./,""))),Array.isArray(e.removeQueryParameters))for(const b of[...c.searchParams.keys()])testParameter(b,e.removeQueryParameters)&&c.searchParams.delete(b);if(!Array.isArray(e.keepQueryParameters)&&e.removeQueryParameters===!0&&(c.search=""),Array.isArray(e.keepQueryParameters)&&e.keepQueryParameters.length>0)for(const b of[...c.searchParams.keys()])testParameter(b,e.keepQueryParameters)||c.searchParams.delete(b);if(e.sortQueryParameters){c.searchParams.sort();try{c.search=decodeURIComponent(c.search)}catch{}}e.removeTrailingSlash&&(c.pathname=c.pathname.replace(/\/$/,"")),e.removeExplicitPort&&c.port&&(c.port="");const g=s;return s=c.toString(),!e.removeSingleSlash&&c.pathname==="/"&&!g.endsWith("/")&&c.hash===""&&(s=s.replace(/\/$/,"")),(e.removeTrailingSlash||c.pathname==="/")&&c.hash===""&&e.removeSingleSlash&&(s=s.replace(/\/$/,"")),o&&!e.normalizeProtocol&&(s=s.replace(/^http:\/\//,"//")),e.stripProtocol&&(s=s.replace(/^(?:https?:)?\/\//,"")),s}var NDKRelayKeepalive=class{constructor(s=3e4,e){pt(this,"lastActivity",Date.now());pt(this,"timer");pt(this,"timeout");pt(this,"isRunning",!1);this.onSilenceDetected=e,this.timeout=s}recordActivity(){this.lastActivity=Date.now(),this.isRunning&&this.resetTimer()}start(){this.isRunning||(this.isRunning=!0,this.lastActivity=Date.now(),this.resetTimer())}stop(){this.isRunning=!1,this.timer&&(clearTimeout(this.timer),this.timer=void 0)}resetTimer(){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{const s=Date.now()-this.lastActivity;if(s>=this.timeout)this.onSilenceDetected();else{const e=this.timeout-s;this.timer=setTimeout(()=>{this.onSilenceDetected()},e)}},this.timeout)}};async function probeRelayConnection(s){const e=`probe-${Math.random().toString(36).substring(7)}`;return new Promise(o=>{let a=!1;const c=setTimeout(()=>{a||(a=!0,s.send(["CLOSE",e]),o(!1))},5e3),g=()=>{a||(a=!0,clearTimeout(c),s.send(["CLOSE",e]),o(!0))};s.once("message",g),s.send(["REQ",e,{kinds:[99999],limit:0}])})}var MAX_RECONNECT_ATTEMPTS=5,FLAPPING_THRESHOLD_MS=1e3,NDKRelayConnectivity=class{constructor(s,e){pt(this,"ndkRelay");pt(this,"ws");pt(this,"_status");pt(this,"timeoutMs");pt(this,"connectedAt");pt(this,"_connectionStats",{attempts:0,success:0,durations:[]});pt(this,"debug");pt(this,"netDebug");pt(this,"connectTimeout");pt(this,"reconnectTimeout");pt(this,"ndk");pt(this,"openSubs",new Map);pt(this,"openCountRequests",new Map);pt(this,"openEventPublishes",new Map);pt(this,"serial",0);pt(this,"baseEoseTimeout",4400);pt(this,"keepalive");pt(this,"wsStateMonitor");pt(this,"sleepDetector");pt(this,"lastSleepCheck",Date.now());pt(this,"lastMessageSent",Date.now());pt(this,"wasIdle",!1);pt(this,"updateConnectionStats",{connected:()=>{this._connectionStats.success++,this._connectionStats.connectedAt=Date.now()},disconnected:()=>{this._connectionStats.connectedAt&&(this._connectionStats.durations.push(Date.now()-this._connectionStats.connectedAt),this._connectionStats.durations.length>100&&this._connectionStats.durations.shift()),this._connectionStats.connectedAt=void 0},attempt:()=>{this._connectionStats.attempts++,this._connectionStats.connectedAt=Date.now()}});this.ndkRelay=s,this._status=1;const o=Math.floor(Math.random()*1e3);this.debug=this.ndkRelay.debug.extend(`connectivity${o}`),this.ndk=e,this.setupMonitoring()}setupMonitoring(){this.keepalive=new NDKRelayKeepalive(3e4,async()=>{this.debug("Relay silence detected, probing connection"),await probeRelayConnection({send:e=>this.send(JSON.stringify(e)),once:(e,o)=>{var c;const a=g=>{var b;try{const _=JSON.parse(g.data);(_[0]==="EOSE"||_[0]==="EVENT"||_[0]==="NOTICE")&&(o(),(b=this.ws)==null||b.removeEventListener("message",a))}catch{}};(c=this.ws)==null||c.addEventListener("message",a)}})||(this.debug("Probe failed, connection is stale"),this.handleStaleConnection())}),this.wsStateMonitor=setInterval(()=>{this._status===5&&(!this.ws||this.ws.readyState!==WebSocket.OPEN)&&(this.debug("WebSocket died silently, reconnecting"),this.handleStaleConnection())},5e3),this.sleepDetector=setInterval(()=>{const s=Date.now(),e=s-this.lastSleepCheck;e>15e3&&(this.debug(`Detected possible sleep/wake (${e}ms gap)`),this.handlePossibleWake()),this.lastSleepCheck=s},1e4)}handleStaleConnection(){this._status=1,this.wasIdle=!0,this.onDisconnect()}handlePossibleWake(){this.debug("System wake detected, checking all connections"),this.wasIdle=!0,this._status>=5&&(!this.ws||this.ws.readyState!==WebSocket.OPEN?this.handleStaleConnection():probeRelayConnection({send:s=>this.send(JSON.stringify(s)),once:(s,e)=>{var a;const o=c=>{var g;try{const b=JSON.parse(c.data);(b[0]==="EOSE"||b[0]==="EVENT"||b[0]==="NOTICE")&&(e(),(g=this.ws)==null||g.removeEventListener("message",o))}catch{}};(a=this.ws)==null||a.addEventListener("message",o)}}).then(s=>{s||this.handleStaleConnection()}))}resetReconnectionState(){this.wasIdle=!0,this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0)}async connect(s,e=!0){if(this.ws&&this.ws.readyState!==WebSocket.OPEN&&this.ws.readyState!==WebSocket.CONNECTING){this.debug("Cleaning up stale WebSocket connection");try{this.ws.close()}catch{}this.ws=void 0,this._status=1}if(this._status!==2&&this._status!==1||this.reconnectTimeout){this.debug("Relay requested to be connected but was in state %s or it had a reconnect timeout",this._status);return}this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0),this.connectTimeout&&(clearTimeout(this.connectTimeout),this.connectTimeout=void 0),s??(s=this.timeoutMs),!this.timeoutMs&&s&&(this.timeoutMs=s),this.timeoutMs&&(this.connectTimeout=setTimeout(()=>this.onConnectionError(e),this.timeoutMs));try{this.updateConnectionStats.attempt(),this._status===1?this._status=4:this._status=2,this.ws=new WebSocket(this.ndkRelay.url),this.ws.onopen=this.onConnect.bind(this),this.ws.onclose=this.onDisconnect.bind(this),this.ws.onmessage=this.onMessage.bind(this),this.ws.onerror=this.onError.bind(this)}catch(o){throw this.debug(`Failed to connect to ${this.ndkRelay.url}`,o),this._status=1,e?this.handleReconnection():this.ndkRelay.emit("delayed-connect",2*24*60*60*1e3),o}}disconnect(){var s,e;this._status=0,(s=this.keepalive)==null||s.stop(),this.wsStateMonitor&&(clearInterval(this.wsStateMonitor),this.wsStateMonitor=void 0),this.sleepDetector&&(clearInterval(this.sleepDetector),this.sleepDetector=void 0);try{(e=this.ws)==null||e.close()}catch(o){this.debug("Failed to disconnect",o),this._status=1}}onConnectionError(s){this.debug(`Error connecting to ${this.ndkRelay.url}`,this.timeoutMs),s&&!this.reconnectTimeout&&this.handleReconnection()}onConnect(){var s,e;(s=this.netDebug)==null||s.call(this,"connected",this.ndkRelay),this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0),this.connectTimeout&&(clearTimeout(this.connectTimeout),this.connectTimeout=void 0),this.updateConnectionStats.connected(),this._status=5,(e=this.keepalive)==null||e.start(),this.wasIdle=!1,this.ndkRelay.emit("connect"),this.ndkRelay.emit("ready")}onDisconnect(){var s,e;(s=this.netDebug)==null||s.call(this,"disconnected",this.ndkRelay),this.updateConnectionStats.disconnected(),(e=this.keepalive)==null||e.stop(),this._status===5&&this.handleReconnection(),this._status=1,this.ndkRelay.emit("disconnect")}onMessage(s){var e,o;(e=this.netDebug)==null||e.call(this,s.data,this.ndkRelay,"recv"),(o=this.keepalive)==null||o.recordActivity();try{const a=JSON.parse(s.data),[c,g,...b]=a;switch(c){case"EVENT":{const _=this.openSubs.get(g),j=a[2];if(!_){this.debug(`Received event for unknown subscription ${g}`);return}_.onevent(j);return}case"COUNT":{const _=a[2],j=this.openCountRequests.get(g);j&&(j.resolve(_.count),this.openCountRequests.delete(g));return}case"EOSE":{const _=this.openSubs.get(g);if(!_)return;_.oneose(g);return}case"OK":{const _=a[2],j=a[3],_e=this.openEventPublishes.get(g),tt=_e==null?void 0:_e.pop();if(!_e||!tt){this.debug("Received OK for unknown event publish",g);return}_?tt.resolve(j):tt.reject(new Error(j)),_e.length===0?this.openEventPublishes.delete(g):this.openEventPublishes.set(g,_e);return}case"CLOSED":{const _=this.openSubs.get(g);if(!_)return;_.onclosed(a[2]);return}case"NOTICE":this.onNotice(a[1]);return;case"AUTH":{this.onAuthRequested(a[1]);return}}}catch(a){this.debug(`Error parsing message from ${this.ndkRelay.url}: ${a.message}`,a==null?void 0:a.stack);return}}async onAuthRequested(s){var o,a,c;const e=this.ndkRelay.authPolicy??((o=this.ndk)==null?void 0:o.relayAuthDefaultPolicy);if(this.debug("Relay requested authentication",{havePolicy:!!e}),this._status===7){this.debug("Already authenticating, ignoring");return}if(this._status=6,e){if(this._status>=5){this._status=7;let g;try{g=await e(this.ndkRelay,s)}catch(b){this.debug("Authentication policy threw an error",b),g=!1}if(this.debug("Authentication policy returned",!!g),g instanceof NDKEvent||g===!0){g instanceof NDKEvent&&await this.auth(g);const b=async()=>{if(this._status>=5&&this._status<8){const _=new NDKEvent(this.ndk);_.kind=22242,_.tags=[["relay",this.ndkRelay.url],["challenge",s]],await _.sign(),this.auth(_).then(()=>{this._status=8,this.ndkRelay.emit("authed"),this.debug("Authentication successful")}).catch(j=>{this._status=6,this.ndkRelay.emit("auth:failed",j),this.debug("Authentication failed",j)})}else this.debug("Authentication failed, it changed status, status is %d",this._status)};g===!0&&((a=this.ndk)!=null&&a.signer?b().catch(_=>{console.error("Error authenticating",_)}):(this.debug("No signer available for authentication localhost"),(c=this.ndk)==null||c.once("signer:ready",b))),this._status=5,this.ndkRelay.emit("authed")}}}else this.ndkRelay.emit("auth",s)}onError(s){this.debug(`WebSocket error on ${this.ndkRelay.url}:`,s)}get status(){return this._status}isAvailable(){return this._status===5}isFlapping(){const s=this._connectionStats.durations;if(s.length%3!==0)return!1;const o=s.reduce((b,_)=>b+_,0)/s.length,a=s.map(b=>(b-o)**2).reduce((b,_)=>b+_,0)/s.length;return Math.sqrt(a)<FLAPPING_THRESHOLD_MS}async onNotice(s){this.ndkRelay.emit("notice",s)}handleReconnection(s=0){if(this.reconnectTimeout)return;if(this.isFlapping()){this.ndkRelay.emit("flapping",this._connectionStats),this._status=3;return}let e;if(this.wasIdle){const o=[0,1e3,2e3,5e3,1e4,3e4];e=o[Math.min(s,o.length-1)],this.debug(`Using aggressive reconnect after idle, attempt ${s}, delay ${e}ms`)}else this.connectedAt?e=Math.max(0,6e4-(Date.now()-this.connectedAt)):(e=Math.min(1e3*Math.pow(2,s),3e4),this.debug(`Using standard backoff, attempt ${s}, delay ${e}ms`));this.reconnectTimeout=setTimeout(()=>{this.reconnectTimeout=void 0,this._status=2,this.connect().catch(o=>{s<MAX_RECONNECT_ATTEMPTS?this.handleReconnection(s+1):(this.debug("Max reconnect attempts reached"),this.wasIdle=!1)})},e),this.ndkRelay.emit("delayed-connect",e),this.debug("Reconnecting in",e),this._connectionStats.nextReconnectAt=Date.now()+e}async send(s){var o,a,c,g,b;Date.now()-this.lastMessageSent>12e4&&(this.wasIdle=!0),this._status>=5&&((o=this.ws)==null?void 0:o.readyState)===WebSocket.OPEN?((a=this.ws)==null||a.send(s),(c=this.netDebug)==null||c.call(this,s,this.ndkRelay,"send"),this.lastMessageSent=Date.now()):(this.debug(`Not connected to ${this.ndkRelay.url} (%d), not sending message ${s}`,this._status),this._status>=5&&((g=this.ws)==null?void 0:g.readyState)!==WebSocket.OPEN&&(this.debug(`Stale connection detected, WebSocket state: ${(b=this.ws)==null?void 0:b.readyState}`),this.handleStaleConnection()))}async auth(s){const e=new Promise((o,a)=>{const c=this.openEventPublishes.get(s.id)??[];c.push({resolve:o,reject:a}),this.openEventPublishes.set(s.id,c)});return this.send(`["AUTH",${JSON.stringify(s.rawEvent())}]`),e}async publish(s){const e=new Promise((o,a)=>{const c=this.openEventPublishes.get(s.id)??[];c.length>0&&console.warn(`Duplicate event publishing detected, you are publishing event ${s.id} twice`),c.push({resolve:o,reject:a}),this.openEventPublishes.set(s.id,c)});return this.send(`["EVENT",${JSON.stringify(s)}]`),e}async count(s,e){this.serial++;const o=(e==null?void 0:e.id)||`count:${this.serial}`,a=new Promise((c,g)=>{this.openCountRequests.set(o,{resolve:c,reject:g})});return this.send(`["COUNT","${o}",${JSON.stringify(s).substring(1)}`),a}close(s,e){this.send(`["CLOSE","${s}"]`);const o=this.openSubs.get(s);this.openSubs.delete(s),o&&o.onclose(e)}req(s){`${this.send(`["REQ","${s.subId}",${JSON.stringify(s.executeFilters).substring(1)}`)}`,this.openSubs.set(s.subId,s)}get connectionStats(){return this._connectionStats}get url(){return this.ndkRelay.url}get connected(){var s;return this._status>=5&&((s=this.ws)==null?void 0:s.readyState)===WebSocket.OPEN}},NDKRelayPublisher=class{constructor(s){pt(this,"ndkRelay");pt(this,"debug");this.ndkRelay=s,this.debug=s.debug.extend("publisher")}async publish(s,e=2500){let o;const a=()=>new Promise((tt,et)=>{try{this.publishEvent(s).then(nt=>{this.ndkRelay.emit("published",s),s.emit("relay:published",this.ndkRelay),tt(!0)}).catch(et)}catch(nt){et(nt)}}),c=new Promise((tt,et)=>{o=setTimeout(()=>{o=void 0,et(new Error(`Timeout: ${e}ms`))},e)}),g=()=>{a().then(tt=>b(tt)).catch(tt=>_(tt))};let b,_;const j=tt=>{throw this.ndkRelay.debug("Publish failed",tt,s.id),this.ndkRelay.emit("publish:failed",s,tt),s.emit("relay:publish:failed",this.ndkRelay,tt),tt},_e=()=>{o&&clearTimeout(o),this.ndkRelay.removeListener("connect",g)};return this.ndkRelay.status>=5?Promise.race([a(),c]).catch(j).finally(_e):(this.ndkRelay.status<=1?(console.warn("Relay is disconnected, trying to connect to publish an event",this.ndkRelay.url),this.ndkRelay.connect()):console.warn("Relay not connected, waiting for connection to publish an event",this.ndkRelay.url),Promise.race([new Promise((tt,et)=>{b=tt,_=et,this.ndkRelay.on("connect",g)}),c]).catch(j).finally(_e))}async publishEvent(s){return this.ndkRelay.connectivity.publish(s.rawEvent())}};function filterFingerprint(s,e){const o=[];for(const c of s){const g=Object.entries(c||{}).map(([b,_])=>["since","until"].includes(b)?`${b}:${_}`:b).sort().join("-");o.push(g)}let a=e?"+":"";return a+=o.join("|"),a}function mergeFilters(s){const e=[],o={};return s.filter(a=>!!a.limit).forEach(a=>e.push(a)),s=s.filter(a=>!a.limit),s.length===0?e:(s.forEach(a=>{Object.entries(a).forEach(([c,g])=>{Array.isArray(g)?o[c]===void 0?o[c]=[...g]:o[c]=Array.from(new Set([...o[c],...g])):o[c]=g})}),[...e,o])}var NDKRelaySubscription=class{constructor(s,e,o){pt(this,"fingerprint");pt(this,"items",new Map);pt(this,"topSubManager");pt(this,"debug");pt(this,"status",0);pt(this,"onClose");pt(this,"relay");pt(this,"eosed",!1);pt(this,"executionTimer");pt(this,"fireTime");pt(this,"delayType");pt(this,"executeFilters");pt(this,"id",Math.random().toString(36).substring(7));pt(this,"_subId");pt(this,"subIdParts",new Set);pt(this,"executeOnRelayReady",()=>{if(this.status===2){if(this.items.size===0){this.debug("No items to execute; this relay was probably too slow to respond and the caller gave up",{status:this.status,fingerprint:this.fingerprint,items:this.items,itemsSize:this.items.size,id:this.id,subId:this.subId}),this.cleanup();return}this.debug("Executing on relay ready",{status:this.status,fingerprint:this.fingerprint,items:this.items,itemsSize:this.items.size}),this.status=1,this.execute()}});pt(this,"reExecuteAfterAuth",(()=>{const s=this.subId;this.debug("Re-executing after auth",this.items.size),this.eosed?this.relay.close(this.subId):this.debug("We are abandoning an opened subscription, once it EOSE's, the handler will close it",{oldSubId:s}),this._subId=void 0,this.status=1,this.execute(),this.debug("Re-executed after auth %s 👉 %s",s,this.subId)}).bind(this));this.relay=s,this.topSubManager=o,this.debug=s.debug.extend(`sub[${this.id}]`),this.fingerprint=e||Math.random().toString(36).substring(7)}get subId(){return this._subId?this._subId:(this._subId=this.fingerprint.slice(0,15),this._subId)}addSubIdPart(s){this.subIdParts.add(s)}addItem(s,e){if(this.debug("Adding item",{filters:e,internalId:s.internalId,status:this.status,fingerprint:this.fingerprint,id:this.subId,items:this.items,itemsSize:this.items.size}),!this.items.has(s.internalId))switch(s.on("close",this.removeItem.bind(this,s)),this.items.set(s.internalId,{subscription:s,filters:e}),this.status!==3&&s.subId&&(!this._subId||this._subId.length<48)&&(this.status===0||this.status===1)&&this.addSubIdPart(s.subId),this.status){case 0:this.evaluateExecutionPlan(s);break;case 3:break;case 1:this.evaluateExecutionPlan(s);break;case 4:throw this.debug("Subscription is closed, cannot add new items %o (%o)",s,e),new Error("Cannot add new items to a closed subscription")}}removeItem(s){if(this.items.delete(s.internalId),this.items.size===0){if(!this.eosed)return;this.close(),this.cleanup()}}close(){if(this.status===4)return;const s=this.status;if(this.status=4,s===3)try{this.relay.close(this.subId)}catch(e){this.debug("Error closing subscription",e,this)}else this.debug("Subscription wanted to close but it wasn't running, this is probably ok",{subId:this.subId,prevStatus:s,sub:this});this.cleanup()}cleanup(){this.executionTimer&&clearTimeout(this.executionTimer),this.relay.off("ready",this.executeOnRelayReady),this.relay.off("authed",this.reExecuteAfterAuth),this.onClose&&this.onClose(this)}evaluateExecutionPlan(s){if(!s.isGroupable()){this.status=1,this.execute();return}if(s.filters.find(a=>!!a.limit)&&(this.executeFilters=this.compileFilters(),this.executeFilters.length>=10)){this.status=1,this.execute();return}const e=s.groupableDelay,o=s.groupableDelayType;if(!e)throw new Error("Cannot group a subscription without a delay");if(this.status===0)this.schedule(e,o);else{const a=this.delayType,c=this.fireTime-Date.now();if(a==="at-least"&&o==="at-least")c<e&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(e,o));else if(a==="at-least"&&o==="at-most")c>e&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(e,o));else if(a==="at-most"&&o==="at-most")c>e&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(e,o));else if(a==="at-most"&&o==="at-least")c>e&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(e,o));else throw new Error(`Unknown delay type combination ${a} ${o}`)}}schedule(s,e){this.status=1;const o=Date.now();this.fireTime=o+s,this.delayType=e;const a=setTimeout(this.execute.bind(this),s);e==="at-least"&&(this.executionTimer=a)}finalizeSubId(){this.subIdParts.size>0?this._subId=Array.from(this.subIdParts).join("-"):this._subId=this.fingerprint.slice(0,15),this._subId+=`-${Math.random().toString(36).substring(2,7)}`}execute(){if(this.status===1){if(!this.relay.connected){this.status=2,this.debug("Waiting for relay to be ready",{status:this.status,id:this.subId,fingerprint:this.fingerprint,items:this.items,itemsSize:this.items.size}),this.relay.once("ready",this.executeOnRelayReady);return}this.relay.status<8&&this.relay.once("authed",this.reExecuteAfterAuth),this.status=3,this.finalizeSubId(),this.executeFilters=this.compileFilters(),this.relay.req(this)}}onstart(){}onevent(s){this.topSubManager.dispatchEvent(s,this.relay)}oneose(s){if(this.eosed=!0,s!==this.subId){this.debug("Received EOSE for an abandoned subscription",s,this.subId),this.relay.close(s);return}this.items.size===0&&this.close();for(const{subscription:e}of this.items.values())e.eoseReceived(this.relay),e.closeOnEose&&(this.debug("Removing item because of EOSE",{filters:e.filters,internalId:e.internalId,status:this.status,fingerprint:this.fingerprint,items:this.items,itemsSize:this.items.size}),this.removeItem(e))}onclose(s){this.status=4}onclosed(s){if(s)for(const{subscription:e}of this.items.values())e.closedReceived(this.relay,s)}compileFilters(){const s=[],e=Array.from(this.items.values()).map(a=>a.filters);if(!e[0])return this.debug("👀 No filters to merge",this.items),console.error("BUG: No filters to merge!",this.items),[];const o=e[0].length;for(let a=0;a<o;a++){const c=e.map(g=>g[a]);s.push(...mergeFilters(c))}return s}},NDKRelaySubscriptionManager=class{constructor(s,e){pt(this,"relay");pt(this,"subscriptions");pt(this,"generalSubManager");this.relay=s,this.subscriptions=new Map,this.generalSubManager=e}addSubscription(s,e){let o;if(!s.isGroupable())o=this.createSubscription(s,e);else{const a=filterFingerprint(e,s.closeOnEose);a&&(o=(this.subscriptions.get(a)||[]).find(g=>g.status<3)),o??(o=this.createSubscription(s,e,a))}o.addItem(s,e)}createSubscription(s,e,o){const a=new NDKRelaySubscription(this.relay,o||null,this.generalSubManager);a.onClose=this.onRelaySubscriptionClose.bind(this);const c=this.subscriptions.get(a.fingerprint)??[];return this.subscriptions.set(a.fingerprint,[...c,a]),a}onRelaySubscriptionClose(s){let e=this.subscriptions.get(s.fingerprint)??[];e?e.length===1?this.subscriptions.delete(s.fingerprint):(e=e.filter(o=>o.id!==s.id),this.subscriptions.set(s.fingerprint,e)):console.warn("Unexpectedly did not find a subscription with fingerprint",s.fingerprint)}},wr,NDKRelay=(wr=class extends lib$1.EventEmitter{constructor(o,a,c){super();pt(this,"url");pt(this,"scores");pt(this,"connectivity");pt(this,"subs");pt(this,"publisher");pt(this,"authPolicy");pt(this,"lowestValidationRatio");pt(this,"targetValidationRatio");pt(this,"validationRatioFn");pt(this,"validatedEventCount",0);pt(this,"nonValidatedEventCount",0);pt(this,"trusted",!1);pt(this,"complaining",!1);pt(this,"debug");pt(this,"req");pt(this,"close");this.url=normalizeRelayUrl(o),this.scores=new Map,this.debug=createDebug5(`ndk:relay:${o}`),this.connectivity=new NDKRelayConnectivity(this,c),this.connectivity.netDebug=c==null?void 0:c.netDebug,this.req=this.connectivity.req.bind(this.connectivity),this.close=this.connectivity.close.bind(this.connectivity),this.subs=new NDKRelaySubscriptionManager(this,c.subManager),this.publisher=new NDKRelayPublisher(this),this.authPolicy=a,this.targetValidationRatio=c==null?void 0:c.initialValidationRatio,this.lowestValidationRatio=c==null?void 0:c.lowestValidationRatio,this.validationRatioFn=((c==null?void 0:c.validationRatioFn)??wr.defaultValidationRatioUpdateFn).bind(this),this.updateValidationRatio(),c||console.trace("relay created without ndk")}updateValidationRatio(){if(this.validationRatioFn&&this.validatedEventCount>0){const o=this.validationRatioFn(this,this.validatedEventCount,this.nonValidatedEventCount);this.targetValidationRatio=o}setTimeout(()=>{this.updateValidationRatio()},3e4)}get status(){return this.connectivity.status}get connectionStats(){return this.connectivity.connectionStats}async connect(o,a=!0){return this.connectivity.connect(o,a)}disconnect(){this.status!==1&&this.connectivity.disconnect()}subscribe(o,a){this.subs.addSubscription(o,a)}async publish(o,a=2500){return this.publisher.publish(o,a)}referenceTags(){return[["r",this.url]]}addValidatedEvent(){this.validatedEventCount++}addNonValidatedEvent(){this.nonValidatedEventCount++}get validationRatio(){return this.nonValidatedEventCount===0?1:this.validatedEventCount/(this.validatedEventCount+this.nonValidatedEventCount)}shouldValidateEvent(){return this.trusted?!1:this.targetValidationRatio===void 0||this.targetValidationRatio>=1?!0:Math.random()<this.targetValidationRatio}get connected(){return this.connectivity.connected}},pt(wr,"defaultValidationRatioUpdateFn",(o,a,c)=>{if(o.lowestValidationRatio===void 0||o.targetValidationRatio===void 0)return 1;let g=o.validationRatio;if(o.validationRatio>o.targetValidationRatio){const b=a/100;g=Math.max(o.lowestValidationRatio,o.validationRatio-b)}return g<o.validationRatio?g:o.validationRatio}),wr),NDKPublishError=class extends Error{constructor(e,o,a,c){super(e);pt(this,"errors");pt(this,"publishedToRelays");pt(this,"intendedRelaySet");this.errors=o,this.publishedToRelays=a,this.intendedRelaySet=c}get relayErrors(){const e=[];for(const[o,a]of this.errors)e.push(`${o.url}: ${a}`);return e.join(`
`)}},NDKRelaySet=class Zs{constructor(e,o,a){pt(this,"relays");pt(this,"debug");pt(this,"ndk");pt(this,"pool");this.relays=e,this.ndk=o,this.pool=a??o.pool,this.debug=o.debug.extend("relayset")}addRelay(e){this.relays.add(e)}get relayUrls(){return Array.from(this.relays).map(e=>e.url)}static fromRelayUrls(e,o,a=!0,c){if(c=c??o.pool,!c)throw new Error("No pool provided");const g=new Set;for(const b of e){const _=c.relays.get(normalizeRelayUrl(b));if(_)_.status<5&&a&&_.connect(),g.add(_);else{const j=new NDKRelay(normalizeRelayUrl(b),o==null?void 0:o.relayAuthDefaultPolicy,o);c.useTemporaryRelay(j,void 0,`requested from fromRelayUrls ${e}`),g.add(j)}}return new Zs(new Set(g),o,c)}async publish(e,o,a=1){var j;const c=new Set,g=new Map,b=e.isEphemeral();e.publishStatus="pending";const _=_e=>{c.add(_e)};e.on("relay:published",_);try{const _e=Array.from(this.relays).map(tt=>new Promise(et=>{const nt=o?setTimeout(()=>{c.has(tt)||(g.set(tt,new Error(`Publish timeout after ${o}ms`)),et(!1))},o):null;tt.publish(e,o).then(rt=>{nt&&clearTimeout(nt),rt?(c.add(tt),et(!0)):et(!1)}).catch(rt=>{nt&&clearTimeout(nt),b||g.set(tt,rt),et(!1)})}));if(await Promise.all(_e),c.size<a){if(!b){const tt=new NDKPublishError("Not enough relays received the event ("+c.size+" published, "+a+" required)",g,c,this);throw e.publishStatus="error",e.publishError=tt,(j=this.ndk)==null||j.emit("event:publish-failed",e,tt,this.relayUrls),tt}}else e.publishStatus="success",e.emit("published",{relaySet:this,publishedToRelays:c});return c}finally{e.off("relay:published",_)}}get size(){return this.relays.size}},d$1=createDebug5("ndk:outbox:calculate");async function calculateRelaySetFromEvent(s,e,o){var _,j;const a=new Set,c=await getWriteRelaysFor(s,e.pubkey);c&&c.forEach(_e=>{var et;const tt=(et=s.pool)==null?void 0:et.getRelay(_e);tt&&a.add(tt)});let g=e.tags.filter(_e=>["a","e"].includes(_e[0])).map(_e=>_e[2]).filter(_e=>_e==null?void 0:_e.startsWith("wss://")).filter(_e=>{try{return new URL(_e),!0}catch{return!1}}).map(_e=>normalizeRelayUrl(_e));g=Array.from(new Set(g)).slice(0,5),g.forEach(_e=>{var et;const tt=(et=s.pool)==null?void 0:et.getRelay(_e,!0,!0);tt&&(d$1("Adding relay hint %s",_e),a.add(tt))});const b=e.getMatchingTags("p").map(_e=>_e[1]);if(b.length<5?Array.from(chooseRelayCombinationForPubkeys(s,b,"read",{preferredRelays:new Set(c)}).keys()).forEach(tt=>{var nt;const et=(nt=s.pool)==null?void 0:nt.getRelay(tt,!1,!0);et&&(d$1("Adding p-tagged relay %s",tt),a.add(et))}):d$1("Too many p-tags to consider %d",b.length),(_=s.pool)==null||_.permanentAndConnectedRelays().forEach(_e=>a.add(_e)),o&&a.size<o){const _e=(j=s.explicitRelayUrls)==null?void 0:j.filter(tt=>!Array.from(a).some(et=>et.url===tt)).slice(0,o-a.size);_e==null||_e.forEach(tt=>{var nt;const et=(nt=s.pool)==null?void 0:nt.getRelay(tt,!1,!0);et&&(d$1("Adding explicit relay %s",tt),a.add(et))})}return new NDKRelaySet(a,s)}function calculateRelaySetsFromFilter(s,e,o){const a=new Map,c=new Set;if(e.forEach(g=>{g.authors&&g.authors.forEach(b=>c.add(b))}),c.size>0){const g=getRelaysForFilterWithAuthors(s,Array.from(c));for(const b of g.keys())a.set(b,[]);for(const b of e)if(b.authors)for(const[_,j]of g.entries()){const _e=b.authors.filter(tt=>j.includes(tt));a.set(_,[...a.get(_),{...b,authors:_e}])}else for(const _ of g.keys())a.set(_,[...a.get(_),b])}else s.explicitRelayUrls&&s.explicitRelayUrls.forEach(g=>{a.set(g,e)});return a.size===0&&o.permanentAndConnectedRelays().slice(0,5).forEach(g=>{a.set(g.url,e)}),a}function calculateRelaySetsFromFilters(s,e,o){return calculateRelaySetsFromFilter(s,e,o)}function mergeTags(s,e){const o=new Map,a=b=>b.join(","),c=(b,_)=>b.every((j,_e)=>j===_[_e]),g=b=>{for(const[_,j]of o)if(c(j,b)||c(b,j)){b.length>=j.length&&o.set(_,b);return}o.set(a(b),b)};return s.concat(e).forEach(g),Array.from(o.values())}var hashtagRegex=new RegExp(`(?<=\\s|^)(#[^\\s!@#$%^&*()=+./,[{\\]};:'"?><]+)`,"g");function generateHashtags(s){const e=s.match(hashtagRegex),o=new Set,a=new Set;if(e)for(const c of e)o.has(c.slice(1))||(a.add(c.slice(1)),o.add(c.slice(1)));return Array.from(a)}async function generateContentTags(s,e=[],o,a){var _,j;if(o!=null&&o.skipContentTagging)return{content:s,tags:e};const c=/(@|nostr:)(npub|nprofile|note|nevent|naddr)[a-zA-Z0-9]+/g,g=[],b=_e=>{e.find(tt=>["q",_e[0]].includes(tt[0])&&tt[1]===_e[1])||e.push(_e)};if(s=s.replace(c,_e=>{var tt;try{const et=_e.split(/(@|nostr:)/)[2],{type:nt,data:rt}=nip19_exports.decode(et);let it;if(o!=null&&o.filters){const st=!o.filters.includeTypes||o.filters.includeTypes.includes(nt),lt=(tt=o.filters.excludeTypes)==null?void 0:tt.includes(nt);if(!st||lt)return _e}switch(nt){case"npub":(o==null?void 0:o.pTags)!==!1&&(it=["p",rt]);break;case"nprofile":(o==null?void 0:o.pTags)!==!1&&(it=["p",rt.pubkey]);break;case"note":g.push(new Promise(async st=>{const lt=await maybeGetEventRelayUrl(et);b(["q",rt,lt]),st()}));break;case"nevent":g.push(new Promise(async st=>{const{id:lt,author:at}=rt;let{relays:ct}=rt;(!ct||ct.length===0)&&(ct=[await maybeGetEventRelayUrl(et)]),b(["q",lt,ct[0]]),at&&(o==null?void 0:o.pTags)!==!1&&(o==null?void 0:o.pTagOnQTags)!==!1&&b(["p",at]),st()}));break;case"naddr":g.push(new Promise(async st=>{const lt=[rt.kind,rt.pubkey,rt.identifier].join(":");let at=rt.relays??[];at.length===0&&(at=[await maybeGetEventRelayUrl(et)]),b(["q",lt,at[0]]),(o==null?void 0:o.pTags)!==!1&&(o==null?void 0:o.pTagOnQTags)!==!1&&(o==null?void 0:o.pTagOnATags)!==!1&&b(["p",rt.pubkey]),st()}));break;default:return _e}return it&&b(it),`nostr:${et}`}catch{return _e}}),await Promise.all(g),!((j=(_=o==null?void 0:o.filters)==null?void 0:_.excludeTypes)!=null&&j.includes("hashtag"))){const _e=generateHashtags(s).map(tt=>["t",tt]);e=mergeTags(e,_e)}if((o==null?void 0:o.pTags)!==!1&&(o!=null&&o.copyPTagsFromTarget)&&a){const _e=a.getMatchingTags("p");for(const tt of _e)e.find(et=>et[0]==="p"&&et[1]===tt[1])||e.push(tt)}return{content:s,tags:e}}async function maybeGetEventRelayUrl(s){return""}async function encrypt(s,e,o="nip44"){let a;if(!this.ndk)throw new Error("No NDK instance found!");let c=e;if(c||(this.ndk.assertSigner(),c=this.ndk.signer),!c)throw new Error("no NDK signer");const g=s||(()=>{const b=this.getMatchingTags("p");if(b.length!==1)throw new Error("No recipient could be determined and no explicit recipient was provided");return this.ndk.getUser({pubkey:b[0][1]})})();if(o==="nip44"&&await isEncryptionEnabled(c,"nip44")&&(a=await c.encrypt(g,this.content,"nip44")),(!a||o==="nip04")&&await isEncryptionEnabled(c,"nip04")&&(a=await c.encrypt(g,this.content,"nip04")),!a)throw new Error("Failed to encrypt event.");this.content=a}async function decrypt(s,e,o){var _,j,_e,tt;if((j=(_=this.ndk)==null?void 0:_.cacheAdapter)!=null&&j.getDecryptedEvent){let et=null;if(typeof this.ndk.cacheAdapter.getDecryptedEvent=="function"&&(et=this.ndk.cacheAdapter.getDecryptedEvent(this.id)),et){this.content=et.content;return}}let a;if(!this.ndk)throw new Error("No NDK instance found!");let c=e;if(c||(this.ndk.assertSigner(),c=this.ndk.signer),!c)throw new Error("no NDK signer");const g=s||this.author;if(!g)throw new Error("No sender provided and no author available");const b=o||(this.content.match(/\\?iv=/)?"nip04":"nip44");if((b==="nip04"||this.kind===4)&&await isEncryptionEnabled(c,"nip04")&&this.content.search("\\?iv=")&&(a=await c.decrypt(g,this.content,"nip04")),!a&&b==="nip44"&&await isEncryptionEnabled(c,"nip44")&&(a=await c.decrypt(g,this.content,"nip44")),!a)throw new Error("Failed to decrypt event.");this.content=a,(tt=(_e=this.ndk)==null?void 0:_e.cacheAdapter)!=null&&tt.addDecryptedEvent&&this.ndk.cacheAdapter.addDecryptedEvent(this)}async function isEncryptionEnabled(s,e){return s.encryptionEnabled?e?!!await s.encryptionEnabled(e):!0:!1}function eventHasETagMarkers(s){for(const e of s.tags)if(e[0]==="e"&&(e[3]??"").length>0)return!0;return!1}function getRootTag(s,e){e??(e=s.tagType());const o=s.tags.find(isTagRootTag);if(!o){if(eventHasETagMarkers(s))return;const a=s.getMatchingTags(e);if(a.length<3)return a[0]}return o}var nip22RootTags=new Set(["A","E","I"]),nip22ReplyTags=new Set(["a","e","i"]);function getReplyTag(s,e){if(s.kind===1111){let c;for(const g of s.tags)if(nip22RootTags.has(g[0]))c=g;else if(nip22ReplyTags.has(g[0])){c=g;break}return c}e??(e=s.tagType());let o=!1,a;for(const c of s.tags)if(c[0]===e){if((c[3]??"").length>0&&(o=!0),o&&c[3]==="reply")return c;o&&c[3]==="root"&&(a=c),o||(a=c)}return a}function isTagRootTag(s){return s[0]==="E"||s[3]==="root"}async function fetchTaggedEvent(s,e){if(!this.ndk)throw new Error("NDK instance not found");const o=this.getMatchingTags(s,e);if(o.length===0)return;const[a,c,g]=o[0];let b=g!==""?this.ndk.pool.getRelay(g):void 0;return await this.ndk.fetchEvent(c,{},b)}async function fetchRootEvent(s){if(!this.ndk)throw new Error("NDK instance not found");const e=getRootTag(this);if(e)return this.ndk.fetchEventFromTag(e,this,s)}async function fetchReplyEvent(s){if(!this.ndk)throw new Error("NDK instance not found");const e=getReplyTag(this);if(e)return this.ndk.fetchEventFromTag(e,this,s)}function isReplaceable(){if(this.kind===void 0)throw new Error("Kind not set");return[0,3].includes(this.kind)||this.kind>=1e4&&this.kind<2e4||this.kind>=3e4&&this.kind<4e4}function isEphemeral(){if(this.kind===void 0)throw new Error("Kind not set");return this.kind>=2e4&&this.kind<3e4}function isParamReplaceable(){if(this.kind===void 0)throw new Error("Kind not set");return this.kind>=3e4&&this.kind<4e4}var DEFAULT_RELAY_COUNT=2;function encode$2(s=DEFAULT_RELAY_COUNT){let e=[];return this.onRelays.length>0?e=this.onRelays.map(o=>o.url):this.relay&&(e=[this.relay.url]),e.length>s&&(e=e.slice(0,s)),this.isParamReplaceable()?nip19_exports.naddrEncode({kind:this.kind,pubkey:this.pubkey,identifier:this.replaceableDTag(),relays:e}):e.length>0?nip19_exports.neventEncode({id:this.tagId(),relays:e,author:this.pubkey}):nip19_exports.noteEncode(this.tagId())}async function repost(s=!0,e){if(!e&&s){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner(),e=this.ndk.signer}const o=new NDKEvent(this.ndk,{kind:getKind(this)});return this.isProtected||(o.content=JSON.stringify(this.rawEvent())),o.tag(this),this.kind!==1&&o.tags.push(["k",`${this.kind}`]),e&&await o.sign(e),s&&await o.publish(),o}function getKind(s){return s.kind===1?6:16}function serialize(s=!1,e=!1){const o=[0,this.pubkey,this.created_at,this.kind,this.tags,this.content];return s&&o.push(this.sig),e&&o.push(this.id),JSON.stringify(o)}function deserialize(s){const e=JSON.parse(s),o={pubkey:e[1],created_at:e[2],kind:e[3],tags:e[4],content:e[5]};if(e.length>=7){const a=e[6],c=e[7];a&&a.length===128?(o.sig=a,c&&c.length===64&&(o.id=c)):a&&a.length===64&&(o.id=a,c&&c.length===128&&(o.sig=c))}return o}var worker,processingQueue={};function signatureVerificationInit(s){worker=s,worker.onmessage=e=>{const[o,a]=e.data,c=processingQueue[o];if(!c){console.error("No record found for event",o);return}delete processingQueue[o];for(const g of c.resolves)g(a)}}async function verifySignatureAsync(s,e,o){const a=s.ndk,c=Date.now();let g;return a.signatureVerificationFunction?(console.log("[NDK-CORE] Using custom signature verification function async"),g=await a.signatureVerificationFunction(s),console.log("Custom signature verification result",s.id,{result:g})):(console.log("Using worker-based signature verification async"),g=await new Promise(b=>{const _=s.serialize();let j=!1;processingQueue[s.id]||(processingQueue[s.id]={event:s,resolves:[],relay:o},j=!0),processingQueue[s.id].resolves.push(b),j&&(worker==null||worker.postMessage({serialized:_,id:s.id,sig:s.sig,pubkey:s.pubkey}))})),a.signatureVerificationTimeMs+=Date.now()-c,g}var PUBKEY_REGEX=/^[a-f0-9]{64}$/;function validate(){if(typeof this.kind!="number"||typeof this.content!="string"||typeof this.created_at!="number"||typeof this.pubkey!="string"||!this.pubkey.match(PUBKEY_REGEX)||!Array.isArray(this.tags))return!1;for(let s=0;s<this.tags.length;s++){const e=this.tags[s];if(!Array.isArray(e))return!1;for(let o=0;o<e.length;o++)if(typeof e[o]=="object")return!1}return!0}var verifiedSignatures=new dist.LRUCache({maxSize:1e3,entryExpirationTimeInMS:6e4});function verifySignature(s){var o;if(typeof this.signatureVerified=="boolean")return this.signatureVerified;const e=verifiedSignatures.get(this.id);if(e!==null)return this.signatureVerified=!!e,this.signatureVerified;try{if((o=this.ndk)!=null&&o.asyncSigVerification)verifySignatureAsync(this,s,this.relay).then(a=>{var c,g;s&&(this.signatureVerified=a,a&&verifiedSignatures.set(this.id,this.sig)),a||(this.relay?(c=this.ndk)==null||c.reportInvalidSignature(this,this.relay):(g=this.ndk)==null||g.reportInvalidSignature(this),verifiedSignatures.set(this.id,!1))}).catch(a=>{console.error("signature verification error",this.id,a)});else{const a=sha256(new TextEncoder().encode(this.serialize())),c=schnorr.verify(this.sig,a,this.pubkey);return c?verifiedSignatures.set(this.id,this.sig):verifiedSignatures.set(this.id,!1),this.signatureVerified=c,c}}catch{return this.signatureVerified=!1,!1}}function getEventHash(){return getEventHashFromSerializedEvent(this.serialize())}function getEventHashFromSerializedEvent(s){const e=sha256(new TextEncoder().encode(s));return bytesToHex(e)}var skipClientTagOnKinds=new Set([0,4,1059,13,3,9734,5]),NDKEvent=class vr extends lib$1.EventEmitter{constructor(o,a){var c;super();pt(this,"ndk");pt(this,"created_at");pt(this,"content","");pt(this,"tags",[]);pt(this,"kind");pt(this,"id","");pt(this,"sig");pt(this,"pubkey","");pt(this,"signatureVerified");pt(this,"_author");pt(this,"relay");pt(this,"publishStatus","success");pt(this,"publishError");pt(this,"serialize",serialize.bind(this));pt(this,"getEventHash",getEventHash.bind(this));pt(this,"validate",validate.bind(this));pt(this,"verifySignature",verifySignature.bind(this));pt(this,"isReplaceable",isReplaceable.bind(this));pt(this,"isEphemeral",isEphemeral.bind(this));pt(this,"isDvm",()=>this.kind&&this.kind>=5e3&&this.kind<=7e3);pt(this,"isParamReplaceable",isParamReplaceable.bind(this));pt(this,"encode",encode$2.bind(this));pt(this,"encrypt",encrypt.bind(this));pt(this,"decrypt",decrypt.bind(this));pt(this,"fetchTaggedEvent",fetchTaggedEvent.bind(this));pt(this,"fetchRootEvent",fetchRootEvent.bind(this));pt(this,"fetchReplyEvent",fetchReplyEvent.bind(this));pt(this,"repost",repost.bind(this));this.ndk=o,this.created_at=a==null?void 0:a.created_at,this.content=(a==null?void 0:a.content)||"",this.tags=(a==null?void 0:a.tags)||[],this.id=(a==null?void 0:a.id)||"",this.sig=a==null?void 0:a.sig,this.pubkey=(a==null?void 0:a.pubkey)||"",this.kind=a==null?void 0:a.kind,a instanceof vr&&(this.relay&&(this.relay=a.relay,(c=this.ndk)==null||c.subManager.seenEvent(a.id,this.relay)),this.publishStatus=a.publishStatus,this.publishError=a.publishError)}get onRelays(){let o=[];return this.ndk?o=this.ndk.subManager.seenEvents.get(this.id)||[]:this.relay&&o.push(this.relay),o}static deserialize(o,a){return new vr(o,deserialize(a))}rawEvent(){return{created_at:this.created_at,content:this.content,tags:this.tags,kind:this.kind,pubkey:this.pubkey,id:this.id,sig:this.sig}}set author(o){var a;this.pubkey=o.pubkey,this._author=o,(a=this._author).ndk??(a.ndk=this.ndk)}get author(){if(this._author)return this._author;if(!this.ndk)throw new Error("No NDK instance found");const o=this.ndk.getUser({pubkey:this.pubkey});return this._author=o,o}tagExternal(o,a,c){const g=["i"],b=["k"];switch(a){case"url":{const _=new URL(o);_.hash="",g.push(_.toString()),b.push(`${_.protocol}//${_.host}`);break}case"hashtag":g.push(`#${o.toLowerCase()}`),b.push("#");break;case"geohash":g.push(`geo:${o.toLowerCase()}`),b.push("geo");break;case"isbn":g.push(`isbn:${o.replace(/-/g,"")}`),b.push("isbn");break;case"podcast:guid":g.push(`podcast:guid:${o}`),b.push("podcast:guid");break;case"podcast:item:guid":g.push(`podcast:item:guid:${o}`),b.push("podcast:item:guid");break;case"podcast:publisher:guid":g.push(`podcast:publisher:guid:${o}`),b.push("podcast:publisher:guid");break;case"isan":g.push(`isan:${o.split("-").slice(0,4).join("-")}`),b.push("isan");break;case"doi":g.push(`doi:${o.toLowerCase()}`),b.push("doi");break;default:throw new Error(`Unsupported NIP-73 entity type: ${a}`)}c&&g.push(c),this.tags.push(g),this.tags.push(b)}tag(o,a,c,g,b){let _=[];if(o.fetchProfile!==void 0){if(g??(g="p"),g==="p"&&(b==null?void 0:b.pTags)===!1)return;const _e=[g,o.pubkey];a&&_e.push("",a),_.push(_e)}else if(o instanceof vr){const _e=o;if(c??(c=(_e==null?void 0:_e.pubkey)===this.pubkey),_=_e.referenceTags(a,c,g,b),(b==null?void 0:b.pTags)!==!1)for(const tt of _e.getMatchingTags("p"))tt[1]!==this.pubkey&&(this.tags.find(et=>et[0]==="p"&&et[1]===tt[1])||this.tags.push(["p",tt[1]]))}else if(Array.isArray(o))_=[o];else throw new Error("Invalid argument",o);this.tags=mergeTags(this.tags,_)}async toNostrEvent(o,a){var b,_;if(!o&&this.pubkey===""){const j=await((_=(b=this.ndk)==null?void 0:b.signer)==null?void 0:_.user());this.pubkey=(j==null?void 0:j.pubkey)||""}this.created_at||(this.created_at=Math.floor(Date.now()/1e3));const{content:c,tags:g}=await this.generateTags(a);this.content=c||"",this.tags=g;try{this.id=this.getEventHash()}catch{}return this.rawEvent()}getMatchingTags(o,a){const c=this.tags.filter(g=>g[0]===o);return a===void 0?c:c.filter(g=>g[3]===a)}hasTag(o,a){return this.tags.some(c=>c[0]===o&&(!a||c[3]===a))}tagValue(o,a){const c=this.getMatchingTags(o,a);if(c.length!==0)return c[0][1]}get alt(){return this.tagValue("alt")}set alt(o){this.removeTag("alt"),o&&this.tags.push(["alt",o])}get dTag(){return this.tagValue("d")}set dTag(o){this.removeTag("d"),o&&this.tags.push(["d",o])}removeTag(o,a){const c=Array.isArray(o)?o:[o];this.tags=this.tags.filter(g=>{const b=c.includes(g[0]),_=a?g[3]===a:!0;return!(b&&_)})}replaceTag(o){this.removeTag(o[0]),this.tags.push(o)}async sign(o,a){var g,b;o?this.author=await o.user():((g=this.ndk)==null||g.assertSigner(),o=(b=this.ndk)==null?void 0:b.signer);const c=await this.toNostrEvent(void 0,a);return this.sig=await o.sign(c),this.sig}async publishReplaceable(o,a,c){return this.id="",this.created_at=Math.floor(Date.now()/1e3),this.sig="",this.publish(o,a,c)}async publish(o,a,c,g){var j,_e,tt;if(c||(c=1),this.sig||await this.sign(void 0,g),!this.ndk)throw new Error("NDKEvent must be associated with an NDK instance to publish");if((!o||o.size===0)&&(o=this.ndk.devWriteRelaySet||await calculateRelaySetFromEvent(this.ndk,this,c)),this.kind===5&&((j=this.ndk.cacheAdapter)!=null&&j.deleteEventIds)){const et=this.getMatchingTags("e").map(nt=>nt[1]);this.ndk.cacheAdapter.deleteEventIds(et)}const b=this.rawEvent();if((_e=this.ndk.cacheAdapter)!=null&&_e.addUnpublishedEvent&&shouldTrackUnpublishedEvent(this))try{this.ndk.cacheAdapter.addUnpublishedEvent(this,o.relayUrls)}catch(et){console.error("Error adding unpublished event to cache",et)}this.kind===5&&((tt=this.ndk.cacheAdapter)!=null&&tt.deleteEventIds)&&this.ndk.cacheAdapter.deleteEventIds(this.getMatchingTags("e").map(et=>et[1])),this.ndk.subManager.dispatchEvent(b,void 0,!0);const _=await o.publish(this,a,c);return _.forEach(et=>{var nt;return(nt=this.ndk)==null?void 0:nt.subManager.seenEvent(this.id,et)}),_}async generateTags(o){var b,_,j;let a=[];const c=await generateContentTags(this.content,this.tags,o,this),g=c.content;if(a=c.tags,this.kind&&this.isParamReplaceable()&&!this.getMatchingTags("d")[0]){const tt=this.tagValue("title");let nt=[...Array(tt?6:16)].map(()=>Math.random().toString(36)[2]).join("");tt&&tt.length>0&&(nt=`${tt.replace(/[^a-z0-9]+/gi,"-").replace(/^-|-$/g,"")}-${nt}`),a.push(["d",nt])}if(this.shouldAddClientTag){const _e=["client",((b=this.ndk)==null?void 0:b.clientName)??""];(_=this.ndk)!=null&&_.clientNip89&&_e.push((j=this.ndk)==null?void 0:j.clientNip89),a.push(_e)}else this.shouldStripClientTag&&(a=a.filter(_e=>_e[0]!=="client"));return{content:g||"",tags:a}}get shouldAddClientTag(){var o,a;return!(!((o=this.ndk)!=null&&o.clientName)&&!((a=this.ndk)!=null&&a.clientNip89)||skipClientTagOnKinds.has(this.kind)||this.isEphemeral()||this.isReplaceable()&&!this.isParamReplaceable()||this.isDvm()||this.hasTag("client"))}get shouldStripClientTag(){return skipClientTagOnKinds.has(this.kind)}muted(){var g,b;const o=(g=this.ndk)==null?void 0:g.mutedIds.get(this.pubkey);if(o&&o==="p")return"author";const a=this.tagReference(),c=(b=this.ndk)==null?void 0:b.mutedIds.get(a[1]);return c&&c===a[0]?"event":null}replaceableDTag(){if(this.kind&&this.kind>=3e4&&this.kind<=4e4){const o=this.getMatchingTags("d")[0];return o?o[1]:""}throw new Error("Event is not a parameterized replaceable event")}deduplicationKey(){return this.kind===0||this.kind===3||this.kind&&this.kind>=1e4&&this.kind<2e4?`${this.kind}:${this.pubkey}`:this.tagId()}tagId(){return this.isParamReplaceable()?this.tagAddress():this.id}tagAddress(){if(this.isParamReplaceable()){const o=this.dTag??"";return`${this.kind}:${this.pubkey}:${o}`}if(this.isReplaceable())return`${this.kind}:${this.pubkey}:`;throw new Error("Event is not a replaceable event")}tagType(){return this.isParamReplaceable()?"a":"e"}tagReference(o){let a;return this.isParamReplaceable()?a=["a",this.tagAddress()]:a=["e",this.tagId()],this.relay?a.push(this.relay.url):a.push(""),a.push(o??""),this.isParamReplaceable()||a.push(this.pubkey),a}referenceTags(o,a,c,g){let b=[];return this.isParamReplaceable()?b=[[c??"a",this.tagAddress()],[c??"e",this.id]]:b=[[c??"e",this.id]],b=b.map(_=>{var j,_e,tt;return _[0]==="e"||o?_.push(((j=this.relay)==null?void 0:j.url)??""):(_e=this.relay)!=null&&_e.url&&_.push((tt=this.relay)==null?void 0:tt.url),_}),b.forEach(_=>{_[0]==="e"?(_.push(o??""),_.push(this.pubkey)):o&&_.push(o)}),b=[...b,...this.getMatchingTags("h")],!a&&(g==null?void 0:g.pTags)!==!1&&b.push(...this.author.referenceTags()),b}filter(){return this.isParamReplaceable()?{"#a":[this.tagId()]}:{"#e":[this.tagId()]}}nip22Filter(){return this.isParamReplaceable()?{"#A":[this.tagId()]}:{"#E":[this.tagId()]}}async delete(o,a=!0){var g;if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner();const c=new vr(this.ndk,{kind:5,content:o||""});return c.tag(this,void 0,!0),c.tags.push(["k",(g=this.kind)==null?void 0:g.toString()]),a&&(this.emit("deleted"),await c.publish()),c}set isProtected(o){this.removeTag("-"),o&&this.tags.push(["-"])}get isProtected(){return this.hasTag("-")}async react(o,a=!0){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner();const c=new vr(this.ndk,{kind:7,content:o});return c.tag(this),this.kind!==1&&c.tags.push(["k",`${this.kind}`]),a&&await c.publish(),c}get isValid(){return this.validate()}get inspect(){return JSON.stringify(this.rawEvent(),null,4)}dump(){console.debug(JSON.stringify(this.rawEvent(),null,4)),console.debug("Event on relays:",this.onRelays.map(o=>o.url).join(", "))}reply(o,a){var g,b,_,j,_e;const c=new vr(this.ndk);if(this.kind===1&&!o)c.kind=1,this.hasTag("e")?c.tags=[...c.tags,...this.getMatchingTags("e"),...this.getMatchingTags("p"),...this.getMatchingTags("a"),...this.referenceTags("reply",!1,void 0,a)]:c.tag(this,"root",!1,void 0,a);else{c.kind=1111;const tt=["A","E","I","P"],et=this.tags.filter(nt=>tt.includes(nt[0]));if(et.length>0){const nt=this.tagValue("K");c.tags.push(...et),nt&&c.tags.push(["K",nt]);let rt;if(this.isParamReplaceable()){rt=["a",this.tagAddress()];const it=((g=this.relay)==null?void 0:g.url)??"";it&&rt.push(it)}else{rt=["e",this.tagId()];const it=((b=this.relay)==null?void 0:b.url)??"";rt.push(it),rt.push(this.pubkey)}c.tags.push(rt)}else{let nt,rt;const it=((_=this.relay)==null?void 0:_.url)??"";this.isParamReplaceable()?(nt=["a",this.tagAddress(),it],rt=["A",this.tagAddress(),it]):(nt=["e",this.tagId(),it,this.pubkey],rt=["E",this.tagId(),it,this.pubkey]),c.tags.push(nt),c.tags.push(rt),c.tags.push(["K",(j=this.kind)==null?void 0:j.toString()]),(a==null?void 0:a.pTags)!==!1&&(a==null?void 0:a.pTagOnATags)!==!1&&c.tags.push(["P",this.pubkey])}c.tags.push(["k",(_e=this.kind)==null?void 0:_e.toString()]),(a==null?void 0:a.pTags)!==!1&&(c.tags.push(...this.getMatchingTags("p")),c.tags.push(["p",this.pubkey]))}return c}},untrackedUnpublishedEvents=new Set([24133,13194,23194,23195]);function shouldTrackUnpublishedEvent(s){return!untrackedUnpublishedEvents.has(s.kind)}var NDKPool=class extends lib$1.EventEmitter{constructor(e,o,a,{debug:c,name:g}={}){super();pt(this,"_relays",new Map);pt(this,"status","idle");pt(this,"autoConnectRelays",new Set);pt(this,"poolBlacklistRelayUrls",new Set);pt(this,"debug");pt(this,"temporaryRelayTimers",new Map);pt(this,"flappingRelays",new Set);pt(this,"backoffTimes",new Map);pt(this,"ndk");pt(this,"disconnectionTimes",new Map);pt(this,"systemEventDetector");pt(this,"_name","unnamed");this.debug=c??a.debug.extend("pool"),g&&(this._name=g),this.ndk=a,this.relayUrls=e,this.poolBlacklistRelayUrls=new Set(o),this.ndk.pools.push(this)}get blacklistRelayUrls(){const e=new Set(this.ndk.blacklistRelayUrls);return this.poolBlacklistRelayUrls.forEach(o=>e.add(o)),e}get relays(){return this._relays}set relayUrls(e){this._relays.clear();for(const o of e){const a=new NDKRelay(o,void 0,this.ndk);a.connectivity.netDebug=this.ndk.netDebug,this.addRelay(a)}}get name(){return this._name}set name(e){this._name=e,this.debug=this.debug.extend(e)}useTemporaryRelay(e,o=3e4,a){const c=this.relays.has(e.url);c||(this.addRelay(e),this.debug("Adding temporary relay %s for filters %o",e.url,a));const g=this.temporaryRelayTimers.get(e.url);if(g&&clearTimeout(g),!c||g){const b=setTimeout(()=>{var _;(_=this.ndk.explicitRelayUrls)!=null&&_.includes(e.url)||this.removeRelay(e.url)},o);this.temporaryRelayTimers.set(e.url,b)}}addRelay(e,o=!0){var st,lt;const a=this.relays.has(e.url),c=(st=this.blacklistRelayUrls)==null?void 0:st.has(e.url),g=e.url.includes("/npub1");let b=!0;const _=e.url;if(a)return;if(c){this.debug(`Refusing to add relay ${_}: blacklisted`);return}if(g){this.debug(`Refusing to add relay ${_}: is a filter relay`);return}if((lt=this.ndk.cacheAdapter)!=null&&lt.getRelayStatus){const at=this.ndk.cacheAdapter.getRelayStatus(_);if(at!=null&&at.dontConnectBefore){if(at.dontConnectBefore>Date.now()){const ct=at.dontConnectBefore-Date.now();this.debug(`Refusing to add relay ${_}: delayed connect for ${ct}ms`),setTimeout(()=>{this.addRelay(e,o)},ct);return}b=!1}}const j=at=>this.emit("notice",e,at),_e=()=>this.handleRelayConnect(_),tt=()=>this.handleRelayReady(e),et=()=>{this.recordDisconnection(e),this.emit("relay:disconnect",e)},nt=()=>this.handleFlapping(e),rt=at=>this.emit("relay:auth",e,at),it=()=>this.emit("relay:authed",e);e.off("notice",j),e.off("connect",_e),e.off("ready",tt),e.off("disconnect",et),e.off("flapping",nt),e.off("auth",rt),e.off("authed",it),e.on("notice",j),e.on("connect",_e),e.on("ready",tt),e.on("disconnect",et),e.on("flapping",nt),e.on("auth",rt),e.on("authed",it),e.on("delayed-connect",at=>{var ct;(ct=this.ndk.cacheAdapter)!=null&&ct.updateRelayStatus&&this.ndk.cacheAdapter.updateRelayStatus(e.url,{dontConnectBefore:Date.now()+at})}),this._relays.set(_,e),o&&this.autoConnectRelays.add(_),o&&this.status==="active"&&(this.emit("relay:connecting",e),e.connect(void 0,b).catch(at=>{this.debug(`Failed to connect to relay ${_}`,at)}))}removeRelay(e){const o=this.relays.get(e);if(o)return o.disconnect(),this.relays.delete(e),this.autoConnectRelays.delete(e),this.emit("relay:disconnect",o),!0;const a=this.temporaryRelayTimers.get(e);return a&&(clearTimeout(a),this.temporaryRelayTimers.delete(e)),!1}isRelayConnected(e){const o=normalizeRelayUrl(e),a=this.relays.get(o);return a?a.status===5:!1}getRelay(e,o=!0,a=!1,c){let g=this.relays.get(normalizeRelayUrl(e));return g||(g=new NDKRelay(e,void 0,this.ndk),g.connectivity.netDebug=this.ndk.netDebug,a?this.useTemporaryRelay(g,3e4,c):this.addRelay(g,o)),g}handleRelayConnect(e){const o=this.relays.get(e);if(!o){console.error("NDK BUG: relay not found in pool",{relayUrl:e});return}this.emit("relay:connect",o),this.stats().connected===this.relays.size&&this.emit("connect")}handleRelayReady(e){this.emit("relay:ready",e)}async connect(e){this.status="active",this.debug(`Connecting to ${this.relays.size} relays${e?`, timeout ${e}ms`:""}...`);const o=Array.from(this.autoConnectRelays.keys()).map(b=>this.relays.get(b)).filter(b=>!!b);for(const b of o)b.status!==5&&b.status!==4&&(this.emit("relay:connecting",b),b.connect().catch(_=>{this.debug(`Failed to connect to relay ${b.url}: ${_??"No reason specified"}`)}));const a=()=>o.every(b=>b.status===5),c=new Promise(b=>{if(a()){b();return}const _=[];for(const j of o){const _e=()=>{if(a()){for(let tt=0;tt<o.length;tt++)o[tt].off("connect",_[tt]);b()}};_.push(_e),j.on("connect",_e)}}),g=typeof e=="number"?new Promise(b=>setTimeout(b,e)):new Promise(()=>{});await Promise.race([c,g])}checkOnFlappingRelays(){const e=this.flappingRelays.size,o=this.relays.size;if(e/o>=.8)for(const a of this.flappingRelays)this.backoffTimes.set(a,0)}recordDisconnection(e){const o=Date.now();this.disconnectionTimes.set(e.url,o);for(const[a,c]of this.disconnectionTimes.entries())o-c>1e4&&this.disconnectionTimes.delete(a);this.checkForSystemWideDisconnection()}checkForSystemWideDisconnection(){const e=Date.now(),o=[];for(const a of this.disconnectionTimes.values())e-a<5e3&&o.push(a);o.length>this.relays.size/2&&this.relays.size>1&&(this.debug(`System-wide disconnection detected: ${o.length}/${this.relays.size} relays disconnected`),this.handleSystemWideReconnection())}handleSystemWideReconnection(){this.debug("Initiating system-wide reconnection with reset backoff"),this.systemEventDetector&&clearTimeout(this.systemEventDetector),this.systemEventDetector=setTimeout(()=>{this.systemEventDetector=void 0},1e4);for(const e of this.relays.values())e.connectivity&&(e.connectivity.resetReconnectionState(),e.status!==5&&e.status!==4&&e.connect().catch(o=>{this.debug(`Failed to reconnect relay ${e.url} after system event: ${o}`)}));this.disconnectionTimes.clear()}handleFlapping(e){this.debug(`Relay ${e.url} is flapping`);let o=this.backoffTimes.get(e.url)||5e3;o=o*2,this.backoffTimes.set(e.url,o),this.debug(`Backoff time for ${e.url} is ${o}ms`),setTimeout(()=>{this.debug(`Attempting to reconnect to ${e.url}`),this.emit("relay:connecting",e),e.connect(),this.checkOnFlappingRelays()},o),e.disconnect(),this.emit("flapping",e)}size(){return this.relays.size}stats(){const e={total:0,connected:0,disconnected:0,connecting:0};for(const o of this.relays.values())e.total++,o.status===5?e.connected++:o.status===1?e.disconnected++:o.status===4&&e.connecting++;return e}connectedRelays(){return Array.from(this.relays.values()).filter(e=>e.status>=5)}permanentAndConnectedRelays(){return Array.from(this.relays.values()).filter(e=>e.status>=5&&!this.temporaryRelayTimers.has(e.url))}urls(){return Array.from(this.relays.keys())}},Kn,NDKCashuMintList=(Kn=class extends NDKEvent{constructor(o,a){super(o,a);pt(this,"_p2pk");this.kind??(this.kind=10019)}static from(o){return new Kn(o.ndk,o)}set relays(o){this.tags=this.tags.filter(a=>a[0]!=="relay");for(const a of o)this.tags.push(["relay",a])}get relays(){const o=[];for(const a of this.tags)a[0]==="relay"&&o.push(a[1]);return o}set mints(o){this.tags=this.tags.filter(a=>a[0]!=="mint");for(const a of o)this.tags.push(["mint",a])}get mints(){const o=[];for(const a of this.tags)a[0]==="mint"&&o.push(a[1]);return Array.from(new Set(o))}get p2pk(){return this._p2pk?this._p2pk:(this._p2pk=this.tagValue("pubkey")??this.pubkey,this._p2pk)}set p2pk(o){this._p2pk=o,this.removeTag("pubkey"),o&&this.tags.push(["pubkey",o])}get relaySet(){return NDKRelaySet.fromRelayUrls(this.relays,this.ndk)}},pt(Kn,"kind",10019),pt(Kn,"kinds",[10019]),Kn),Vn,NDKArticle=(Vn=class extends NDKEvent{constructor(e,o){super(e,o),this.kind??(this.kind=30023)}static from(e){return new Vn(e.ndk,e)}get title(){return this.tagValue("title")}set title(e){this.removeTag("title"),e&&this.tags.push(["title",e])}get image(){return this.tagValue("image")}set image(e){this.removeTag("image"),e&&this.tags.push(["image",e])}get summary(){return this.tagValue("summary")}set summary(e){this.removeTag("summary"),e&&this.tags.push(["summary",e])}get published_at(){const e=this.tagValue("published_at");if(e){let o=Number.parseInt(e);return o>1e12&&(o=Math.floor(o/1e3)),o}}set published_at(e){this.removeTag("published_at"),e!==void 0&&this.tags.push(["published_at",e.toString()])}async generateTags(){return super.generateTags(),this.published_at||(this.published_at=this.created_at),super.generateTags()}get url(){return this.tagValue("url")}set url(e){e?this.tags.push(["url",e]):this.removeTag("url")}},pt(Vn,"kind",30023),pt(Vn,"kinds",[30023]),Vn);function proofsTotalBalance(s){return s.reduce((e,o)=>{if(o.amount<0)throw new Error("proof amount is negative");return e+o.amount},0)}var qn,NDKCashuToken=(qn=class extends NDKEvent{constructor(o,a){super(o,a);pt(this,"_proofs",[]);pt(this,"_mint");pt(this,"_deletes",[]);pt(this,"original");this.kind??(this.kind=7375)}static async from(o){const a=new qn(o.ndk,o);a.original=o;try{await a.decrypt()}catch{a.content=a.original.content}try{const c=JSON.parse(a.content);if(a.proofs=c.proofs,a.mint=c.mint??a.tagValue("mint"),a.deletedTokens=c.del??[],!Array.isArray(a.proofs))return}catch{return}return a}get proofs(){return this._proofs}set proofs(o){const a=new Set;this._proofs=o.filter(c=>a.has(c.C)?(console.warn("Passed in proofs had duplicates, ignoring",c.C),!1):c.amount<0?(console.warn("Invalid proof with negative amount",c),!1):(a.add(c.C),!0)).map(this.cleanProof)}cleanProof(o){return{id:o.id,amount:o.amount,C:o.C,secret:o.secret}}async toNostrEvent(o){if(!this.ndk)throw new Error("no ndk");if(!this.ndk.signer)throw new Error("no signer");const a={proofs:this.proofs.map(this.cleanProof),mint:this.mint,del:this.deletedTokens??[]};this.content=JSON.stringify(a);const c=await this.ndk.signer.user();return await this.encrypt(c,void 0,"nip44"),super.toNostrEvent(o)}set mint(o){this._mint=o}get mint(){return this._mint}get deletedTokens(){return this._deletes}set deletedTokens(o){this._deletes=o}get amount(){return proofsTotalBalance(this.proofs)}async publish(o,a,c){return this.original?this.original.publish(o,a,c):super.publish(o,a,c)}},pt(qn,"kind",7375),pt(qn,"kinds",[7375]),qn),Wn,NDKHighlight=(Wn=class extends NDKEvent{constructor(o,a){super(o,a);pt(this,"_article");this.kind??(this.kind=9802)}static from(o){return new Wn(o.ndk,o)}get url(){return this.tagValue("r")}set context(o){o===void 0?this.tags=this.tags.filter(([a,c])=>a!=="context"):(this.tags=this.tags.filter(([a,c])=>a!=="context"),this.tags.push(["context",o]))}get context(){var o;return((o=this.tags.find(([a,c])=>a==="context"))==null?void 0:o[1])??void 0}get article(){return this._article}set article(o){this._article=o,typeof o=="string"?this.tags.push(["r",o]):this.tag(o)}getArticleTag(){return this.getMatchingTags("a")[0]||this.getMatchingTags("e")[0]||this.getMatchingTags("r")[0]}async getArticle(){var c;if(this._article!==void 0)return this._article;let o;const a=this.getArticleTag();if(a){switch(a[0]){case"a":{const[g,b,_]=a[1].split(":");o=nip19_exports.naddrEncode({kind:Number.parseInt(g),pubkey:b,identifier:_});break}case"e":o=nip19_exports.noteEncode(a[1]);break;case"r":this._article=a[1];break}if(o){let g=await((c=this.ndk)==null?void 0:c.fetchEvent(o));g&&(g.kind===30023&&(g=NDKArticle.from(g)),this._article=g)}return this._article}}},pt(Wn,"kind",9802),pt(Wn,"kinds",[9802]),Wn);function mapImetaTag(s){const e={};if(s.length===2){const a=s[1].split(" ");for(let c=0;c<a.length;c+=2){const g=a[c],b=a[c+1];g==="fallback"?(e.fallback||(e.fallback=[]),e.fallback.push(b)):e[g]=b}return e}const o=s.slice(1);for(const a of o){const c=a.split(" "),g=c[0],b=c.slice(1).join(" ");g==="fallback"?(e.fallback||(e.fallback=[]),e.fallback.push(b)):e[g]=b}return e}function imetaTagToTag(s){const e=["imeta"];for(const[o,a]of Object.entries(s))if(Array.isArray(a))for(const c of a)e.push(`${o} ${c}`);else a&&e.push(`${o} ${a}`);return e}var Qn,NDKImage=(Qn=class extends NDKEvent{constructor(o,a){super(o,a);pt(this,"_imetas");this.kind??(this.kind=20)}static from(o){return new Qn(o.ndk,o.rawEvent())}get isValid(){return this.imetas.length>0}get imetas(){return this._imetas?this._imetas:(this._imetas=this.tags.filter(o=>o[0]==="imeta").map(mapImetaTag).filter(o=>!!o.url),this._imetas)}set imetas(o){this._imetas=o,this.tags=this.tags.filter(a=>a[0]!=="imeta"),this.tags.push(...o.map(imetaTagToTag))}},pt(Qn,"kind",20),pt(Qn,"kinds",[20]),Qn),xr,NDKList=(xr=class extends NDKEvent{constructor(o,a){super(o,a);pt(this,"_encryptedTags");pt(this,"encryptedTagsLength");this.kind??(this.kind=30001)}static from(o){return new xr(o.ndk,o)}get title(){const o=this.tagValue("title")||this.tagValue("name");return o||(this.kind===3?"Contacts":this.kind===1e4?"Mute":this.kind===10001?"Pinned Notes":this.kind===10002?"Relay Metadata":this.kind===10003?"Bookmarks":this.kind===10004?"Communities":this.kind===10005?"Public Chats":this.kind===10006?"Blocked Relays":this.kind===10007?"Search Relays":this.kind===10050?"Direct Message Receive Relays":this.kind===10015?"Interests":this.kind===10030?"Emojis":this.tagValue("d"))}set title(o){this.removeTag(["title","name"]),o&&this.tags.push(["title",o])}get name(){return this.title}set name(o){this.title=o}get description(){return this.tagValue("description")}set description(o){this.removeTag("description"),o&&this.tags.push(["description",o])}get image(){return this.tagValue("image")}set image(o){this.removeTag("image"),o&&this.tags.push(["image",o])}isEncryptedTagsCacheValid(){return!!(this._encryptedTags&&this.encryptedTagsLength===this.content.length)}async encryptedTags(o=!0){if(o&&this.isEncryptedTagsCacheValid())return this._encryptedTags;if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");const a=await this.ndk.signer.user();try{if(this.content.length>0)try{const c=await this.ndk.signer.decrypt(a,this.content),g=JSON.parse(c);return g!=null&&g[0]?(this.encryptedTagsLength=this.content.length,this._encryptedTags=g):(this.encryptedTagsLength=this.content.length,this._encryptedTags=[])}catch{}}catch{}return[]}validateTag(o){return!0}getItems(o){return this.tags.filter(a=>a[0]===o)}get items(){return this.tags.filter(o=>!["d","L","l","title","name","description","published_at","summary","image","thumb","alt","expiration","subject","client"].includes(o[0]))}async addItem(o,a=void 0,c=!1,g="bottom"){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");let b;if(o instanceof NDKEvent)b=[o.tagReference(a)];else if(o instanceof NDKUser)b=o.referenceTags();else if(o instanceof NDKRelay)b=o.referenceTags();else if(Array.isArray(o))b=[o];else throw new Error("Invalid object type");if(a&&b[0].push(a),c){const _=await this.ndk.signer.user(),j=await this.encryptedTags();g==="top"?j.unshift(...b):j.push(...b),this._encryptedTags=j,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(j),await this.encrypt(_)}else g==="top"?this.tags.unshift(...b):this.tags.push(...b);this.created_at=Math.floor(Date.now()/1e3),this.emit("change")}async removeItemByValue(o,a=!0){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");const c=this.tags.findIndex(j=>j[1]===o);c>=0&&this.tags.splice(c,1);const g=await this.ndk.signer.user(),b=await this.encryptedTags(),_=b.findIndex(j=>j[1]===o);if(_>=0&&(b.splice(_,1),this._encryptedTags=b,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(b),await this.encrypt(g)),a)return this.publishReplaceable();this.created_at=Math.floor(Date.now()/1e3),this.emit("change")}async removeItem(o,a){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");if(a){const c=await this.ndk.signer.user(),g=await this.encryptedTags();g.splice(o,1),this._encryptedTags=g,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(g),await this.encrypt(c)}else this.tags.splice(o,1);return this.created_at=Math.floor(Date.now()/1e3),this.emit("change"),this}has(o){return this.items.some(a=>a[1]===o)}filterForItems(){const o=new Set,a=new Map,c=[];for(const g of this.items)if(g[0]==="e"&&g[1])o.add(g[1]);else if(g[0]==="a"&&g[1]){const[b,_,j]=g[1].split(":");if(!b||!_)continue;const _e=`${b}:${_}`,tt=a.get(_e)||[];tt.push(j||""),a.set(_e,tt)}if(o.size>0&&c.push({ids:Array.from(o)}),a.size>0)for(const[g,b]of a.entries()){const[_,j]=g.split(":");c.push({kinds:[Number.parseInt(_)],authors:[j],"#d":b})}return c}},pt(xr,"kinds",[10063,30001,10004,10050,10030,10015,10001,10002,10007,10006,10003]),xr),lists_default=NDKList,Un,NDKNutzap=(Un=class extends NDKEvent{constructor(o,a){super(o,a);pt(this,"debug");pt(this,"_proofs",[]);pt(this,"sender",this.author);this.kind??(this.kind=9321),this.debug=(o==null?void 0:o.debug.extend("nutzap"))??createDebug5("ndk:nutzap"),this.alt||(this.alt="This is a nutzap");try{const c=this.getMatchingTags("proof");c.length?this._proofs=c.map(g=>JSON.parse(g[1])):this._proofs=JSON.parse(this.content)}catch{return}}static from(o){const a=new Un(o.ndk,o);if(!(!a._proofs||!a._proofs.length))return a}set comment(o){this.content=o??""}get comment(){const o=this.tagValue("comment");return o||this.content}set proofs(o){this._proofs=o,this.tags=this.tags.filter(a=>a[0]!=="proof");for(const a of o)this.tags.push(["proof",JSON.stringify(a)])}get proofs(){return this._proofs}get rawP2pk(){var a;const o=this.proofs[0];try{const c=JSON.parse(o.secret);let g;if(typeof c=="string"?(g=JSON.parse(c),this.debug("stringified payload",o.secret)):typeof c=="object"&&(g=c),Array.isArray(g)&&g[0]==="P2PK"&&g.length>1&&typeof g[1]=="object"&&g[1]!==null||typeof g=="object"&&g!==null&&typeof((a=g[1])==null?void 0:a.data)=="string")return g[1].data}catch(c){this.debug("error parsing p2pk pubkey",c,this.proofs[0])}}get p2pk(){const o=this.rawP2pk;if(o)return o.startsWith("02")?o.slice(2):o}get mint(){return this.tagValue("u")}set mint(o){this.replaceTag(["u",o])}get unit(){let o=this.tagValue("unit")??"sat";return o!=null&&o.startsWith("msat")&&(o="sat"),o}set unit(o){if(this.removeTag("unit"),o!=null&&o.startsWith("msat"))throw new Error("msat is not allowed, use sat denomination instead");o&&this.tag(["unit",o])}get amount(){return this.proofs.reduce((a,c)=>a+c.amount,0)}set target(o){this.tags=this.tags.filter(a=>a[0]!=="p"),o instanceof NDKEvent&&this.tags.push(o.tagReference())}set recipientPubkey(o){this.removeTag("p"),this.tag(["p",o])}get recipientPubkey(){return this.tagValue("p")}get recipient(){const o=this.recipientPubkey;return this.ndk?this.ndk.getUser({pubkey:o}):new NDKUser({pubkey:o})}async toNostrEvent(){this.unit==="msat"&&(this.unit="sat"),this.removeTag("amount"),this.tags.push(["amount",this.amount.toString()]);const o=await super.toNostrEvent();return o.content=this.comment,o}get isValid(){let o=0,a=0,c=0;for(const g of this.tags)g[0]==="e"&&o++,g[0]==="p"&&a++,g[0]==="u"&&c++;return a===1&&c===1&&o<=1&&this.proofs.length>0}},pt(Un,"kind",9321),pt(Un,"kinds",[Un.kind]),Un),Gn,NDKSimpleGroupMemberList=(Gn=class extends NDKEvent{constructor(o,a){super(o,a);pt(this,"relaySet");pt(this,"memberSet",new Set);this.kind??(this.kind=39002),this.memberSet=new Set(this.members)}static from(o){return new Gn(o.ndk,o)}get members(){return this.getMatchingTags("p").map(o=>o[1])}hasMember(o){return this.memberSet.has(o)}async publish(o,a,c){return o??(o=this.relaySet),super.publishReplaceable(o,a,c)}},pt(Gn,"kind",39002),pt(Gn,"kinds",[39002]),Gn),Zn,NDKSimpleGroupMetadata=(Zn=class extends NDKEvent{constructor(e,o){super(e,o),this.kind??(this.kind=39e3)}static from(e){return new Zn(e.ndk,e)}get name(){return this.tagValue("name")}get picture(){return this.tagValue("picture")}get about(){return this.tagValue("about")}get scope(){if(this.getMatchingTags("public").length>0)return"public";if(this.getMatchingTags("public").length>0)return"private"}set scope(e){this.removeTag("public"),this.removeTag("private"),e==="public"?this.tags.push(["public",""]):e==="private"&&this.tags.push(["private",""])}get access(){if(this.getMatchingTags("open").length>0)return"open";if(this.getMatchingTags("closed").length>0)return"closed"}set access(e){this.removeTag("open"),this.removeTag("closed"),e==="open"?this.tags.push(["open",""]):e==="closed"&&this.tags.push(["closed",""])}},pt(Zn,"kind",39e3),pt(Zn,"kinds",[39e3]),Zn);function strToPosition(s){const[e,o]=s.split(",").map(Number);return{x:e,y:o}}function strToDimension(s){const[e,o]=s.split("x").map(Number);return{width:e,height:o}}var kn,NDKStorySticker=(kn=class{constructor(e){pt(this,"type");pt(this,"value");pt(this,"position");pt(this,"dimension");pt(this,"properties");pt(this,"hasValidDimensions",()=>typeof this.dimension.width=="number"&&typeof this.dimension.height=="number"&&!Number.isNaN(this.dimension.width)&&!Number.isNaN(this.dimension.height));pt(this,"hasValidPosition",()=>typeof this.position.x=="number"&&typeof this.position.y=="number"&&!Number.isNaN(this.position.x)&&!Number.isNaN(this.position.y));if(Array.isArray(e)){const o=e;if(o[0]!=="sticker"||o.length<5)throw new Error("Invalid sticker tag");this.type=o[1],this.value=o[2],this.position=strToPosition(o[3]),this.dimension=strToDimension(o[4]);const a={};for(let c=5;c<o.length;c++){const[g,...b]=o[c].split(" ");a[g]=b.join(" ")}Object.keys(a).length>0&&(this.properties=a)}else this.type=e,this.value=void 0,this.position={x:0,y:0},this.dimension={width:0,height:0}}static fromTag(e){try{return new kn(e)}catch{return null}}get style(){var e;return(e=this.properties)==null?void 0:e.style}set style(e){var o;e?this.properties={...this.properties,style:e}:(o=this.properties)==null||delete o.style}get rotation(){var e;return(e=this.properties)!=null&&e.rot?Number.parseFloat(this.properties.rot):void 0}set rotation(e){var o;e!==void 0?this.properties={...this.properties,rot:e.toString()}:(o=this.properties)==null||delete o.rot}get isValid(){return this.hasValidDimensions()&&this.hasValidPosition()}toTag(){if(!this.isValid){const a=[this.hasValidDimensions()?void 0:"dimensions is invalid",this.hasValidPosition()?void 0:"position is invalid"].filter(Boolean);throw new Error(`Invalid sticker: ${a.join(", ")}`)}let e;switch(this.type){case"event":e=this.value.tagId();break;case"pubkey":e=this.value.pubkey;break;default:e=this.value}const o=["sticker",this.type,e,coordinates(this.position),dimension(this.dimension)];if(this.properties)for(const[a,c]of Object.entries(this.properties))o.push(`${a} ${c}`);return o}},pt(kn,"Text","text"),pt(kn,"Pubkey","pubkey"),pt(kn,"Event","event"),pt(kn,"Prompt","prompt"),pt(kn,"Countdown","countdown"),kn),Yn,NDKStory=(Yn=class extends NDKEvent{constructor(o,a){super(o,a);pt(this,"_imeta");pt(this,"_dimensions");if(this.kind??(this.kind=23),a)for(const c of a.tags)switch(c[0]){case"imeta":this._imeta=mapImetaTag(c);break;case"dim":this.dimensions=strToDimension(c[1]);break}}static from(o){return new Yn(o.ndk,o)}get isValid(){return!!this.imeta}get imeta(){return this._imeta}set imeta(o){this._imeta=o,this.tags=this.tags.filter(a=>a[0]!=="imeta"),o&&this.tags.push(imetaTagToTag(o))}get dimensions(){const o=this.tagValue("dim");if(o)return strToDimension(o)}set dimensions(o){this.removeTag("dim"),o&&this.tags.push(["dim",`${o.width}x${o.height}`])}get duration(){const o=this.tagValue("dur");if(o)return Number.parseInt(o)}set duration(o){this.removeTag("dur"),o!==void 0&&this.tags.push(["dur",o.toString()])}get stickers(){const o=[];for(const a of this.tags){if(a[0]!=="sticker"||a.length<5)continue;const c=NDKStorySticker.fromTag(a);c&&o.push(c)}return o}addSticker(o){let a;if(o instanceof NDKStorySticker)a=o;else{const c=["sticker",o.type,typeof o.value=="string"?o.value:"",coordinates(o.position),dimension(o.dimension)];if(o.properties)for(const[g,b]of Object.entries(o.properties))c.push(`${g} ${b}`);a=new NDKStorySticker(c),a.value=o.value}a.type==="pubkey"?this.tag(a.value):a.type==="event"&&this.tag(a.value),this.tags.push(a.toTag())}removeSticker(o){const a=this.stickers;if(o<0||o>=a.length)return;let c=0;for(let g=0;g<this.tags.length;g++)if(this.tags[g][0]==="sticker"){if(c===o){this.tags.splice(g,1);break}c++}}},pt(Yn,"kind",23),pt(Yn,"kinds",[23]),Yn),coordinates=s=>`${s.x},${s.y}`,dimension=s=>`${s.width}x${s.height}`,possibleIntervalFrequencies=["daily","weekly","monthly","quarterly","yearly"];function newAmount(s,e,o){return["amount",s.toString(),e,o]}function parseTagToSubscriptionAmount(s){const e=Number.parseInt(s[1]);if(Number.isNaN(e)||e===void 0||e===null||e<=0)return;const o=s[2];if(o===void 0||o==="")return;const a=s[3];if(a!==void 0&&possibleIntervalFrequencies.includes(a))return{amount:e,currency:o,term:a}}var Xn,NDKSubscriptionTier=(Xn=class extends NDKArticle{constructor(e,o){const a=(o==null?void 0:o.kind)??37001;super(e,o),this.kind=a}static from(e){return new Xn(e.ndk,e)}get perks(){return this.getMatchingTags("perk").map(e=>e[1]).filter(e=>e!==void 0)}addPerk(e){this.tags.push(["perk",e])}get amounts(){return this.getMatchingTags("amount").map(e=>parseTagToSubscriptionAmount(e)).filter(e=>e!==void 0)}addAmount(e,o,a){this.tags.push(newAmount(e,o,a))}set relayUrl(e){this.tags.push(["r",e])}get relayUrls(){return this.getMatchingTags("r").map(e=>e[1]).filter(e=>e!==void 0)}get verifierPubkey(){return this.tagValue("p")}set verifierPubkey(e){this.removeTag("p"),e&&this.tags.push(["p",e])}get isValid(){return this.title!==void 0&&this.amounts.length>0}},pt(Xn,"kind",37001),pt(Xn,"kinds",[37001]),Xn),Jn,NDKVideo=(Jn=class extends NDKEvent{constructor(){super(...arguments);pt(this,"_imetas")}static from(o){return new Jn(o.ndk,o.rawEvent())}get title(){return this.tagValue("title")}set title(o){this.removeTag("title"),o&&this.tags.push(["title",o])}get thumbnail(){var a;let o;return this.imetas&&this.imetas.length>0&&(o=(a=this.imetas[0].image)==null?void 0:a[0]),o??this.tagValue("thumb")}get imetas(){return this._imetas?this._imetas:(this._imetas=this.tags.filter(o=>o[0]==="imeta").map(mapImetaTag),this._imetas)}set imetas(o){this._imetas=o,this.tags=this.tags.filter(a=>a[0]!=="imeta"),this.tags.push(...o.map(imetaTagToTag))}get url(){return this.imetas&&this.imetas.length>0?this.imetas[0].url:this.tagValue("url")}get published_at(){const o=this.tagValue("published_at");if(o)return Number.parseInt(o)}async generateTags(){var o,a;if(super.generateTags(),!this.kind&&(a=(o=this.imetas)==null?void 0:o[0])!=null&&a.dim){const[c,g]=this.imetas[0].dim.split("x"),b=c&&g&&Number.parseInt(c)<Number.parseInt(g);this.duration&&this.duration<120&&b?this.kind=22:this.kind=21}return super.generateTags()}get duration(){const o=this.tagValue("duration");if(o)return Number.parseInt(o)}set duration(o){this.removeTag("duration"),o!==void 0&&this.tags.push(["duration",Math.floor(o).toString()])}},pt(Jn,"kind",21),pt(Jn,"kinds",[34235,34236,22,21]),Jn),er,NDKWiki=(er=class extends NDKArticle{static from(e){return new er(e.ndk,e.rawEvent())}get isDefered(){return this.hasTag("a","defer")}get deferedId(){return this.tagValue("a","defer")}set defer(e){this.removeTag("a","defer"),this.tag(e,"defer")}},pt(er,"kind",30818),pt(er,"kinds",[30818]),er),Er,NDKBlossomList=(Er=class extends NDKEvent{constructor(e,o){super(e,o),this.kind??(this.kind=10063)}static from(e){return new Er(e.ndk,e.rawEvent())}get servers(){return this.tags.filter(e=>e[0]==="server").map(e=>e[1])}set servers(e){this.tags=this.tags.filter(o=>o[0]!=="server");for(const o of e)this.tags.push(["server",o])}get default(){const e=this.servers;return e.length>0?e[0]:void 0}set default(e){if(!e)return;const a=this.servers.filter(c=>c!==e);this.servers=[e,...a]}addServer(e){if(!e)return;const o=this.servers;o.includes(e)||(this.servers=[...o,e])}removeServer(e){if(!e)return;const o=this.servers;this.servers=o.filter(a=>a!==e)}},pt(Er,"kinds",[10063]),Er),tr,NDKFollowPack=(tr=class extends NDKEvent{constructor(e,o){super(e,o),this.kind??(this.kind=39089)}static from(e){return new tr(e.ndk,e)}get title(){return this.tagValue("title")}set title(e){this.removeTag("title"),e&&this.tags.push(["title",e])}get image(){const e=this.tags.find(o=>o[0]==="imeta");if(e){const o=mapImetaTag(e);if(o.url)return o.url}return this.tagValue("image")}set image(e){this.tags=this.tags.filter(o=>o[0]!=="imeta"&&o[0]!=="image"),typeof e=="string"?e!==void 0&&this.tags.push(["image",e]):e&&typeof e=="object"&&(this.tags.push(imetaTagToTag(e)),e.url&&this.tags.push(["image",e.url]))}get pubkeys(){return Array.from(new Set(this.tags.filter(e=>e[0]==="p").map(e=>e[1])))}set pubkeys(e){this.tags=this.tags.filter(o=>o[0]!=="p");for(const o of e)this.tags.push(["p",o])}get description(){return this.tagValue("description")}set description(e){this.removeTag("description"),e&&this.tags.push(["description",e])}},pt(tr,"kind",39089),pt(tr,"kinds",[39089,39092]),tr),signerRegistry=new Map;function registerSigner(s,e){signerRegistry.set(s,e)}var NDKPrivateKeySigner=class gs{constructor(e,o){pt(this,"_user");pt(this,"_privateKey");pt(this,"_pubkey");if(typeof e=="string")if(e.startsWith("nsec1")){const{type:a,data:c}=nip19_exports.decode(e);if(a==="nsec")this._privateKey=c;else throw new Error("Invalid private key provided.")}else if(e.length===64)this._privateKey=hexToBytes(e);else throw new Error("Invalid private key provided.");else this._privateKey=e;this._pubkey=getPublicKey(this._privateKey),o&&(this._user=o.getUser({pubkey:this._pubkey})),this._user??(this._user=new NDKUser({pubkey:this._pubkey}))}get privateKey(){if(!this._privateKey)throw new Error("Not ready");return bytesToHex(this._privateKey)}get pubkey(){if(!this._pubkey)throw new Error("Not ready");return this._pubkey}get nsec(){if(!this._privateKey)throw new Error("Not ready");return nip19_exports.nsecEncode(this._privateKey)}get npub(){if(!this._pubkey)throw new Error("Not ready");return nip19_exports.npubEncode(this._pubkey)}static generate(){const e=generateSecretKey();return new gs(e)}async blockUntilReady(){return this._user}async user(){return this._user}get userSync(){return this._user}async sign(e){if(!this._privateKey)throw Error("Attempted to sign without a private key");return finalizeEvent(e,this._privateKey).sig}async encryptionEnabled(e){const o=[];return(!e||e==="nip04")&&o.push("nip04"),(!e||e==="nip44")&&o.push("nip44"),o}async encrypt(e,o,a){if(!this._privateKey||!this.privateKey)throw Error("Attempted to encrypt without a private key");const c=e.pubkey;if(a==="nip44"){const g=nip44_exports.v2.utils.getConversationKey(this._privateKey,c);return await nip44_exports.v2.encrypt(o,g)}return await nip04_exports.encrypt(this._privateKey,c,o)}async decrypt(e,o,a){if(!this._privateKey||!this.privateKey)throw Error("Attempted to decrypt without a private key");const c=e.pubkey;if(a==="nip44"){const g=nip44_exports.v2.utils.getConversationKey(this._privateKey,c);return await nip44_exports.v2.decrypt(o,g)}return await nip04_exports.decrypt(this._privateKey,c,o)}toPayload(){if(!this._privateKey)throw new Error("Private key not available");const e={type:"private-key",payload:this.privateKey};return JSON.stringify(e)}static async fromPayload(e,o){const a=JSON.parse(e);if(a.type!=="private-key")throw new Error(`Invalid payload type: expected 'private-key', got ${a.type}`);if(!a.payload||typeof a.payload!="string")throw new Error("Invalid payload content for private-key signer");return new gs(a.payload,o)}};registerSigner("private-key",NDKPrivateKeySigner);var Ln,NDKProject=(Ln=class extends NDKEvent{constructor(o,a){super(o,a);pt(this,"_signer");this.kind=31933}static from(o){return new Ln(o.ndk,o.rawEvent())}set repo(o){this.removeTag("repo"),o&&this.tags.push(["repo",o])}set hashtags(o){this.removeTag("hashtags"),o.filter(a=>a.length>0).length&&this.tags.push(["hashtags",...o])}get hashtags(){const o=this.tags.find(a=>a[0]==="hashtags");return o?o.slice(1):[]}get repo(){return this.tagValue("repo")}get title(){return this.tagValue("title")}set title(o){this.removeTag("title"),o&&this.tags.push(["title",o])}get picture(){return this.tagValue("picture")}set picture(o){this.removeTag("picture"),o&&this.tags.push(["picture",o])}set description(o){this.content=o}get description(){return this.content}get slug(){return this.dTag??"empty-dtag"}async getSigner(){var a,c;if(this._signer)return this._signer;const o=this.tagValue("key");if(!o)this._signer=NDKPrivateKeySigner.generate(),await this.encryptAndSaveNsec();else{const g=await((c=(a=this.ndk)==null?void 0:a.signer)==null?void 0:c.decrypt(this.ndk.activeUser,o));if(!g)throw new Error("Failed to decrypt project key or missing signer context.");this._signer=new NDKPrivateKeySigner(g)}return this._signer}async getNsec(){return(await this.getSigner()).privateKey}async setNsec(o){this._signer=new NDKPrivateKeySigner(o),await this.encryptAndSaveNsec()}async encryptAndSaveNsec(){var c,g;if(!this._signer)throw new Error("Signer is not set.");const o=this._signer.privateKey,a=await((g=(c=this.ndk)==null?void 0:c.signer)==null?void 0:g.encrypt(this.ndk.activeUser,o));a&&(this.removeTag("key"),this.tags.push(["key",a]))}},pt(Ln,"kind",31933),pt(Ln,"kinds",[Ln.kind]),Ln),nr,NDKThread=(nr=class extends NDKEvent{constructor(e,o){super(e,o),this.kind??(this.kind=11)}static from(e){return new nr(e.ndk,e)}get title(){return this.tagValue("title")}set title(e){this.removeTag("title"),e&&this.tags.push(["title",e])}},pt(nr,"kind",11),pt(nr,"kinds",[11]),nr),rr,NDKDraft=(rr=class extends NDKEvent{constructor(o,a){super(o,a);pt(this,"_event");pt(this,"counterparty");this.kind??(this.kind=31234)}static from(o){return new rr(o.ndk,o)}set identifier(o){this.removeTag("d"),this.tags.push(["d",o])}get identifier(){return this.dTag}set event(o){o instanceof NDKEvent?this._event=o:this._event=new NDKEvent(void 0,o),this.prepareEvent()}set checkpoint(o){o?(this.tags.push(o.tagReference()),this.kind=1234):(this.removeTag("a"),this.kind=31234)}get isCheckpoint(){return this.kind===1234}get isProposal(){const o=this.tagValue("p");return!!o&&o!==this.pubkey}async getEvent(o){var a;if(this._event)return this._event;if(o??(o=(a=this.ndk)==null?void 0:a.signer),!o)throw new Error("No signer available");if(this.content&&this.content.length>0)try{const c=o.pubkey,b=[this.tagValue("p"),this.pubkey].filter(Boolean).find(_e=>_e!==c);let _;_=new NDKUser({pubkey:b??c}),await this.decrypt(_,o);const j=JSON.parse(this.content);return this._event=await wrapEvent(new NDKEvent(this.ndk,j)),this._event}catch(c){console.error(c);return}else return null}prepareEvent(){if(!this._event)throw new Error("No event has been provided");this.removeTag("k"),this._event.kind&&this.tags.push(["k",this._event.kind.toString()]),this.content=JSON.stringify(this._event.rawEvent())}async save({signer:o,publish:a,relaySet:c}){var b;if(o??(o=(b=this.ndk)==null?void 0:b.signer),!o)throw new Error("No signer available");const g=this.counterparty||await o.user();if(await this.encrypt(g,o),this.counterparty){const _=this.counterparty.pubkey;this.removeTag("p"),this.tags.push(["p",_])}if(a!==!1)return this.publishReplaceable(c)}},pt(rr,"kind",31234),pt(rr,"kinds",[31234,1234]),rr),sr,NDKTask=(sr=class extends NDKEvent{constructor(e,o){super(e,o),this.kind=1934}static from(e){return new sr(e.ndk,e.rawEvent())}set title(e){this.removeTag("title"),e&&this.tags.push(["title",e])}get title(){return this.tagValue("title")}set project(e){this.removeTag("a"),this.tags.push(e.tagReference())}get projectSlug(){var o;const e=this.getMatchingTags("a")[0];return e?(o=e[1].split(/:/))==null?void 0:o[2]:void 0}},pt(sr,"kind",1934),pt(sr,"kinds",[1934]),sr),ir,NDKProjectTemplate=(ir=class extends NDKEvent{constructor(e,o){super(e,o),this.kind=30717}static from(e){return new ir(e.ndk,e.rawEvent())}get templateId(){return this.dTag??""}set templateId(e){this.dTag=e}get name(){return this.tagValue("title")??""}set name(e){this.removeTag("title"),e&&this.tags.push(["title",e])}get description(){return this.tagValue("description")??""}set description(e){this.removeTag("description"),e&&this.tags.push(["description",e])}get repoUrl(){return this.tagValue("uri")??""}set repoUrl(e){this.removeTag("uri"),e&&this.tags.push(["uri",e])}get image(){return this.tagValue("image")}set image(e){this.removeTag("image"),e&&this.tags.push(["image",e])}get command(){return this.tagValue("command")}set command(e){this.removeTag("command"),e&&this.tags.push(["command",e])}get agentConfig(){const e=this.tagValue("agent");if(e)try{return JSON.parse(e)}catch{return}}set agentConfig(e){this.removeTag("agent"),e&&this.tags.push(["agent",JSON.stringify(e)])}get templateTags(){return this.getMatchingTags("t").map(e=>e[1]).filter(Boolean)}set templateTags(e){this.tags=this.tags.filter(o=>o[0]!=="t"),e.forEach(o=>{o&&this.tags.push(["t",o])})}},pt(ir,"kind",30717),pt(ir,"kinds",[30717]),ir),registeredEventClasses=new Set;function wrapEvent(s){const e=new Map,a=[...[NDKImage,NDKVideo,NDKCashuMintList,NDKArticle,NDKHighlight,NDKDraft,NDKWiki,NDKNutzap,NDKProject,NDKTask,NDKProjectTemplate,NDKSimpleGroupMemberList,NDKSimpleGroupMetadata,NDKSubscriptionTier,NDKCashuToken,NDKList,NDKStory,NDKBlossomList,NDKFollowPack,NDKThread],...registeredEventClasses];for(const g of a)for(const b of g.kinds)e.set(b,g);const c=e.get(s.kind);return c?c.from(s):s}function queryFullyFilled(s){return!!(filterIncludesIds(s.filter)&&resultHasAllRequestedIds(s))}function filterIncludesIds(s){return!!s.ids}function resultHasAllRequestedIds(s){const e=s.filter.ids;return!!e&&e.length===s.eventFirstSeen.size}function filterFromId(s){let e;if(s.match(NIP33_A_REGEX)){const[o,a,c]=s.split(":"),g={authors:[a],kinds:[Number.parseInt(o)]};return c&&(g["#d"]=[c]),g}if(s.match(BECH32_REGEX))try{switch(e=nip19_exports.decode(s),e.type){case"nevent":{const o={ids:[e.data.id]};return e.data.author&&(o.authors=[e.data.author]),e.data.kind&&(o.kinds=[e.data.kind]),o}case"note":return{ids:[e.data]};case"naddr":{const o={authors:[e.data.pubkey],kinds:[e.data.kind]};return e.data.identifier&&(o["#d"]=[e.data.identifier]),o}}}catch(o){console.error("Error decoding",s,o)}return{ids:[s]}}function isNip33AValue(s){return s.match(NIP33_A_REGEX)!==null}var NIP33_A_REGEX=/^(\d+):([0-9A-Fa-f]+)(?::(.*))?$/,BECH32_REGEX=/^n(event|ote|profile|pub|addr)1[\d\w]+$/;function relaysFromBech32(s,e){try{const o=nip19_exports.decode(s);if(["naddr","nevent"].includes(o==null?void 0:o.type)){const a=o.data;if(a!=null&&a.relays)return a.relays.map(c=>new NDKRelay(c,e.relayAuthDefaultPolicy,e))}}catch{}return[]}var defaultOpts={closeOnEose:!1,cacheUsage:"CACHE_FIRST",dontSaveToCache:!1,groupable:!0,groupableDelay:100,groupableDelayType:"at-most",cacheUnconstrainFilter:["limit","since","until"]},NDKSubscription=class extends lib$1.EventEmitter{constructor(e,o,a,c){super();pt(this,"subId");pt(this,"filters");pt(this,"opts");pt(this,"pool");pt(this,"skipVerification",!1);pt(this,"skipValidation",!1);pt(this,"relayFilters");pt(this,"relaySet");pt(this,"ndk");pt(this,"debug");pt(this,"eventFirstSeen",new Map);pt(this,"eosesSeen",new Set);pt(this,"lastEventReceivedAt");pt(this,"mostRecentCacheEventTimestamp");pt(this,"internalId");pt(this,"closeOnEose");pt(this,"poolMonitor");pt(this,"skipOptimisticPublishEvent",!1);pt(this,"cacheUnconstrainFilter");pt(this,"onStopped");pt(this,"eoseTimeout");pt(this,"eosed",!1);this.ndk=e,this.opts={...defaultOpts,...a||{}},this.pool=this.opts.pool||e.pool,this.filters=Array.isArray(o)?o:[o],this.subId=c||this.opts.subId,this.internalId=Math.random().toString(36).substring(7),this.debug=e.debug.extend(`subscription[${this.opts.subId??this.internalId}]`),this.opts.relaySet?this.relaySet=this.opts.relaySet:this.opts.relayUrls&&(this.relaySet=NDKRelaySet.fromRelayUrls(this.opts.relayUrls,this.ndk)),this.skipVerification=this.opts.skipVerification||!1,this.skipValidation=this.opts.skipValidation||!1,this.closeOnEose=this.opts.closeOnEose||!1,this.skipOptimisticPublishEvent=this.opts.skipOptimisticPublishEvent||!1,this.cacheUnconstrainFilter=this.opts.cacheUnconstrainFilter}relaysMissingEose(){var o;return this.relayFilters?Array.from((o=this.relayFilters)==null?void 0:o.keys()).filter(a=>!this.eosesSeen.has(this.pool.getRelay(a,!1,!1))):[]}get filter(){return this.filters[0]}get groupableDelay(){var e;if(this.isGroupable())return(e=this.opts)==null?void 0:e.groupableDelay}get groupableDelayType(){var e;return((e=this.opts)==null?void 0:e.groupableDelayType)||"at-most"}isGroupable(){var e;return((e=this.opts)==null?void 0:e.groupable)||!1}shouldQueryCache(){var o;return this.opts.addSinceFromCache?!0:((o=this.opts)==null?void 0:o.cacheUsage)==="ONLY_RELAY"?!1:(this.filters.some(a=>{var c;return(c=a.kinds)==null?void 0:c.some(g=>kindIsEphemeral(g))}),!0)}shouldQueryRelays(){var e;return((e=this.opts)==null?void 0:e.cacheUsage)!=="ONLY_CACHE"}shouldWaitForCache(){var e;return this.opts.addSinceFromCache?!0:!!this.opts.closeOnEose&&!!((e=this.ndk.cacheAdapter)!=null&&e.locking)&&this.opts.cacheUsage!=="PARALLEL"}start(e=!0){let o;const a=g=>{if(e)for(const b of g)b.created_at&&(!this.mostRecentCacheEventTimestamp||b.created_at>this.mostRecentCacheEventTimestamp)&&(this.mostRecentCacheEventTimestamp=b.created_at),this.eventReceived(b,void 0,!0,!1);else{o=[];for(const b of g){b.created_at&&(!this.mostRecentCacheEventTimestamp||b.created_at>this.mostRecentCacheEventTimestamp)&&(this.mostRecentCacheEventTimestamp=b.created_at),b.ndk=this.ndk;const _=this.opts.wrap?wrapEvent(b):b;if(!_)break;if(_ instanceof Promise){_.then(j=>{this.emitEvent(!1,j,void 0,!0,!1)});break}this.eventFirstSeen.set(_.id,Date.now()),o.push(_)}}},c=()=>{this.shouldQueryRelays()?(this.startWithRelays(),this.startPoolMonitor()):this.emit("eose",this)};return this.shouldQueryCache()?(o=this.startWithCache(),o instanceof Promise?this.shouldWaitForCache()?(o.then(g=>{if(a(g),queryFullyFilled(this)){this.emit("eose",this);return}c()}),null):(o.then(g=>{a(g)}),c(),null):(a(o),queryFullyFilled(this)?this.emit("eose",this):c(),o)):(c(),null)}startPoolMonitor(){this.debug.extend("pool-monitor"),this.poolMonitor=e=>{var a,c;if((a=this.relayFilters)!=null&&a.has(e.url))return;calculateRelaySetsFromFilters(this.ndk,this.filters,this.pool).get(e.url)&&((c=this.relayFilters)==null||c.set(e.url,this.filters),e.subscribe(this,this.filters))},this.pool.on("relay:connect",this.poolMonitor)}stop(){var e;this.emit("close",this),this.poolMonitor&&this.pool.off("relay:connect",this.poolMonitor),(e=this.onStopped)==null||e.call(this)}hasAuthorsFilter(){return this.filters.some(e=>{var o;return(o=e.authors)==null?void 0:o.length})}startWithCache(){var e;return(e=this.ndk.cacheAdapter)!=null&&e.query?this.ndk.cacheAdapter.query(this):[]}startWithRelays(){let e=this.filters;if(this.opts.addSinceFromCache&&this.mostRecentCacheEventTimestamp){const o=this.mostRecentCacheEventTimestamp+1;e=e.map(a=>({...a,since:Math.max(a.since||0,o)}))}if(!this.relaySet||this.relaySet.relays.size===0)this.relayFilters=calculateRelaySetsFromFilters(this.ndk,e,this.pool);else{this.relayFilters=new Map;for(const o of this.relaySet.relays)this.relayFilters.set(o.url,e)}for(const[o,a]of this.relayFilters)this.pool.getRelay(o,!0,!0,a).subscribe(this,a)}eventReceived(e,o,a=!1,c=!1){var j;const g=e.id,b=this.eventFirstSeen.has(g);let _;if(e instanceof NDKEvent&&(_=e),b){const _e=Date.now()-(this.eventFirstSeen.get(g)||0);if(this.emit("event:dup",e,o,_e,this,a,c),o){const tt=verifiedSignatures.get(g);if(tt&&typeof tt=="string")if(e.sig===tt)o.addValidatedEvent();else{const et=e instanceof NDKEvent?e:new NDKEvent(this.ndk,e);this.ndk.reportInvalidSignature(et,o)}}}else{if(_??(_=new NDKEvent(this.ndk,e)),_.ndk=this.ndk,_.relay=o,!a&&!c){if(!this.skipValidation&&!_.isValid){this.debug("Event failed validation %s from relay %s",g,o==null?void 0:o.url);return}if(o)if(o.shouldValidateEvent()&&!this.skipVerification){if(_.relay=o,!this.ndk.asyncSigVerification){if(!_.verifySignature(!0)){this.debug("Event failed signature validation",e),this.ndk.reportInvalidSignature(_,o);return}o.addValidatedEvent()}}else o.addNonValidatedEvent();this.ndk.cacheAdapter&&!this.opts.dontSaveToCache&&this.ndk.cacheAdapter.setEvent(_,this.filters,o)}(!c||this.skipOptimisticPublishEvent!==!0)&&(this.emitEvent(((j=this.opts)==null?void 0:j.wrap)??!1,_,o,a,c),this.eventFirstSeen.set(g,Date.now()))}this.lastEventReceivedAt=Date.now()}emitEvent(e,o,a,c,g){const b=e?wrapEvent(o):o;b instanceof Promise?b.then(_=>this.emitEvent(!1,_,a,c,g)):b&&this.emit("event",b,a,this,c,g)}closedReceived(e,o){this.emit("closed",e,o)}eoseReceived(e){var b;this.debug("EOSE received from %s",e.url),this.eosesSeen.add(e);let o=this.lastEventReceivedAt?Date.now()-this.lastEventReceivedAt:void 0;const a=this.eosesSeen.size===((b=this.relayFilters)==null?void 0:b.size),c=queryFullyFilled(this),g=_=>{var j;this.debug("Performing EOSE: %s %d",_,this.eosed),!this.eosed&&(this.eoseTimeout&&clearTimeout(this.eoseTimeout),this.emit("eose",this),this.eosed=!0,(j=this.opts)!=null&&j.closeOnEose&&this.stop())};if(c||a)g("query filled or seen all");else if(this.relayFilters){let _=1e3;const j=new Set(this.pool.connectedRelays().map(et=>et.url)),_e=Array.from(this.relayFilters.keys()).filter(et=>j.has(et));if(_e.length===0){this.debug("No connected relays, waiting for all relays to connect",Array.from(this.relayFilters.keys()).join(", "));return}const tt=this.eosesSeen.size/_e.length;if(this.debug("Percentage of relays that have sent EOSE",{subId:this.subId,percentageOfRelaysThatHaveSentEose:tt,seen:this.eosesSeen.size,total:_e.length}),this.eosesSeen.size>=2&&tt>=.5){if(_=_*(1-tt),_===0){g("time to wait was 0");return}this.eoseTimeout&&clearTimeout(this.eoseTimeout);const et=()=>{o=this.lastEventReceivedAt?Date.now()-this.lastEventReceivedAt:void 0,o!==void 0&&o<20?this.eoseTimeout=setTimeout(et,_):g(`send eose timeout: ${_}`)};this.eoseTimeout=setTimeout(et,_)}}}},kindIsEphemeral=s=>s>=2e4&&s<3e4;async function follows(s,e,o=3){var c,g;if(!this.ndk)throw new Error("NDK not set");const a=await this.ndk.fetchEvent({kinds:[o],authors:[this.pubkey]},s||{groupable:!1});if(a){const b=new Set;return a.tags.forEach(_=>{_[0]==="p"&&b.add(_[1])}),e&&((g=(c=this.ndk)==null?void 0:c.outboxTracker)==null||g.trackUsers(Array.from(b))),[...b].reduce((_,j)=>{const _e=new NDKUser({pubkey:j});return _e.ndk=this.ndk,_.add(_e),_},new Set)}return new Set}var NIP05_REGEX=/^(?:([\w.+-]+)@)?([\w.-]+)$/;async function getNip05For(s,e,o=fetch,a={}){return await s.queuesNip05.add({id:e,func:async()=>{var j,_e,tt;if((j=s.cacheAdapter)!=null&&j.loadNip05){const et=await s.cacheAdapter.loadNip05(e);if(et!=="missing"){if(et){const nt=new NDKUser({pubkey:et.pubkey,relayUrls:et.relays,nip46Urls:et.nip46});return nt.ndk=s,nt}if(a.cache!=="no-cache")return null}}const c=e.match(NIP05_REGEX);if(!c)return null;const[g,b="_",_]=c;try{const et=await o(`https://${_}/.well-known/nostr.json?name=${b}`,a),{names:nt,relays:rt,nip46:it}=parseNIP05Result(await et.json()),st=nt[b.toLowerCase()];let lt=null;return st&&(lt={pubkey:st,relays:rt==null?void 0:rt[st],nip46:it==null?void 0:it[st]}),(_e=s==null?void 0:s.cacheAdapter)!=null&&_e.saveNip05&&s.cacheAdapter.saveNip05(e,lt),lt}catch(et){return(tt=s==null?void 0:s.cacheAdapter)!=null&&tt.saveNip05&&(s==null||s.cacheAdapter.saveNip05(e,null)),console.error("Failed to fetch NIP05 for",e,et),null}}})}function parseNIP05Result(s){const e={names:{}};for(const[o,a]of Object.entries(s.names))typeof o=="string"&&typeof a=="string"&&(e.names[o.toLowerCase()]=a);if(s.relays){e.relays={};for(const[o,a]of Object.entries(s.relays))typeof o=="string"&&Array.isArray(a)&&(e.relays[o]=a.filter(c=>typeof c=="string"))}if(s.nip46){e.nip46={};for(const[o,a]of Object.entries(s.nip46))typeof o=="string"&&Array.isArray(a)&&(e.nip46[o]=a.filter(c=>typeof c=="string"))}return e}function profileFromEvent(s){const e={};let o;try{o=JSON.parse(s.content)}catch(a){throw new Error(`Failed to parse profile event: ${a}`)}e.profileEvent=JSON.stringify(s.rawEvent());for(const a of Object.keys(o))switch(a){case"name":e.name=o.name;break;case"display_name":e.displayName=o.display_name;break;case"image":case"picture":e.picture=o.picture||o.image,e.image=e.picture;break;case"banner":e.banner=o.banner;break;case"bio":e.bio=o.bio;break;case"nip05":e.nip05=o.nip05;break;case"lud06":e.lud06=o.lud06;break;case"lud16":e.lud16=o.lud16;break;case"about":e.about=o.about;break;case"website":e.website=o.website;break;default:e[a]=o[a];break}return e.created_at=s.created_at,e}function serializeProfile(s){const e={};for(const[o,a]of Object.entries(s))switch(o){case"username":case"name":e.name=a;break;case"displayName":e.display_name=a;break;case"image":case"picture":e.picture=a;break;case"bio":case"about":e.about=a;break;default:e[o]=a;break}return JSON.stringify(e)}var NDKUser=class Ys{constructor(e){pt(this,"ndk");pt(this,"profile");pt(this,"profileEvent");pt(this,"_npub");pt(this,"_pubkey");pt(this,"relayUrls",[]);pt(this,"nip46Urls",[]);pt(this,"follows",follows.bind(this));if(e.npub&&(this._npub=e.npub),e.hexpubkey&&(this._pubkey=e.hexpubkey),e.pubkey&&(this._pubkey=e.pubkey),e.relayUrls&&(this.relayUrls=e.relayUrls),e.nip46Urls&&(this.nip46Urls=e.nip46Urls),e.nprofile)try{const o=nip19_exports.decode(e.nprofile);o.type==="nprofile"&&(this._pubkey=o.data.pubkey,o.data.relays&&o.data.relays.length>0&&this.relayUrls.push(...o.data.relays))}catch(o){console.error("Failed to decode nprofile",o)}}get npub(){if(!this._npub){if(!this._pubkey)throw new Error("pubkey not set");this._npub=nip19_exports.npubEncode(this.pubkey)}return this._npub}get nprofile(){var o,a;const e=(a=(o=this.profileEvent)==null?void 0:o.onRelays)==null?void 0:a.map(c=>c.url);return nip19_exports.nprofileEncode({pubkey:this.pubkey,relays:e})}set npub(e){this._npub=e}get pubkey(){if(!this._pubkey){if(!this._npub)throw new Error("npub not set");this._pubkey=nip19_exports.decode(this.npub).data}return this._pubkey}set pubkey(e){this._pubkey=e}filter(){return{"#p":[this.pubkey]}}async getZapInfo(e){if(!this.ndk)throw new Error("No NDK instance found");const o=async b=>{if(!e)return b;let _;const j=new Promise((_e,tt)=>{_=setTimeout(()=>tt(new Error("Timeout")),e)});try{const _e=await Promise.race([b,j]);return _&&clearTimeout(_),_e}catch(_e){if(_e instanceof Error&&_e.message==="Timeout")try{return await b}catch{return}return}},[a,c]=await Promise.all([o(this.fetchProfile()),o(this.ndk.fetchEvent({kinds:[10019],authors:[this.pubkey]}))]),g=new Map;if(c){const b=NDKCashuMintList.from(c);b.mints.length>0&&g.set("nip61",{mints:b.mints,relays:b.relays,p2pk:b.p2pk})}if(a){const{lud06:b,lud16:_}=a;g.set("nip57",{lud06:b,lud16:_})}return g}static async fromNip05(e,o,a=!1){if(!o)throw new Error("No NDK instance found");const c={};a&&(c.cache="no-cache");const g=await getNip05For(o,e,o==null?void 0:o.httpFetch,c);if(g){const b=new Ys({pubkey:g.pubkey,relayUrls:g.relays,nip46Urls:g.nip46});return b.ndk=o,b}}async fetchProfile(e,o=!1){if(!this.ndk)throw new Error("NDK not set");let a=null;if(this.ndk.cacheAdapter&&(this.ndk.cacheAdapter.fetchProfile||this.ndk.cacheAdapter.fetchProfileSync)&&(e==null?void 0:e.cacheUsage)!=="ONLY_RELAY"){let c=null;if(this.ndk.cacheAdapter.fetchProfileSync?c=this.ndk.cacheAdapter.fetchProfileSync(this.pubkey):this.ndk.cacheAdapter.fetchProfile&&(c=await this.ndk.cacheAdapter.fetchProfile(this.pubkey)),c)return this.profile=c,c}return e??(e={}),e.cacheUsage??(e.cacheUsage="ONLY_RELAY"),e.closeOnEose??(e.closeOnEose=!0),e.groupable??(e.groupable=!0),e.groupableDelay??(e.groupableDelay=250),a||(a=await this.ndk.fetchEvent({kinds:[0],authors:[this.pubkey]},e)),a?(this.profile=profileFromEvent(a),o&&this.profile&&this.ndk.cacheAdapter&&this.ndk.cacheAdapter.saveProfile&&this.ndk.cacheAdapter.saveProfile(this.pubkey,this.profile),this.profile):null}async followSet(e,o,a=3){const c=await this.follows(e,o,a);return new Set(Array.from(c).map(g=>g.pubkey))}tagReference(){return["p",this.pubkey]}referenceTags(e){const o=[["p",this.pubkey]];return e&&o[0].push("",e),o}async publish(){if(!this.ndk)throw new Error("No NDK instance found");if(!this.profile)throw new Error("No profile available");this.ndk.assertSigner(),await new NDKEvent(this.ndk,{kind:0,content:serializeProfile(this.profile)}).publish()}async follow(e,o,a=3){if(!this.ndk)throw new Error("No NDK instance found");if(this.ndk.assertSigner(),o||(o=await this.follows(void 0,void 0,a)),o.has(e))return!1;o.add(e);const c=new NDKEvent(this.ndk,{kind:a});for(const g of o)c.tag(g);return await c.publish(),!0}async unfollow(e,o,a=3){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner(),o||(o=await this.follows(void 0,void 0,a));const c=new Set;let g=!1;for(const _ of o)_.pubkey!==e.pubkey?c.add(_):g=!0;if(!g)return!1;const b=new NDKEvent(this.ndk,{kind:a});for(const _ of c)b.tag(_);return await b.publish()}async validateNip05(e){if(!this.ndk)throw new Error("No NDK instance found");const o=await getNip05For(this.ndk,e);return o===null?null:o.pubkey===this.pubkey}},READ_MARKER="read",WRITE_MARKER="write",NDKRelayList=class Xs extends NDKEvent{constructor(e,o){super(e,o),this.kind??(this.kind=10002)}static from(e){return new Xs(e.ndk,e.rawEvent())}get readRelayUrls(){return this.tags.filter(e=>e[0]==="r"||e[0]==="relay").filter(e=>!e[2]||e[2]&&e[2]===READ_MARKER).map(e=>tryNormalizeRelayUrl(e[1])).filter(e=>!!e)}set readRelayUrls(e){for(const o of e)this.tags.push(["r",o,READ_MARKER])}get writeRelayUrls(){return this.tags.filter(e=>e[0]==="r"||e[0]==="relay").filter(e=>!e[2]||e[2]&&e[2]===WRITE_MARKER).map(e=>tryNormalizeRelayUrl(e[1])).filter(e=>!!e)}set writeRelayUrls(e){for(const o of e)this.tags.push(["r",o,WRITE_MARKER])}get bothRelayUrls(){return this.tags.filter(e=>e[0]==="r"||e[0]==="relay").filter(e=>!e[2]).map(e=>e[1])}set bothRelayUrls(e){for(const o of e)this.tags.push(["r",o])}get relays(){return this.tags.filter(e=>e[0]==="r"||e[0]==="relay").map(e=>e[1])}get relaySet(){if(!this.ndk)throw new Error("NDKRelayList has no NDK instance");return new NDKRelaySet(new Set(this.relays.map(e=>{var o;return(o=this.ndk)==null?void 0:o.pool.getRelay(e)}).filter(e=>!!e)),this.ndk)}};function relayListFromKind3(s,e){try{const o=JSON.parse(e.content),a=new NDKRelayList(s),c=new Set,g=new Set;for(let[b,_]of Object.entries(o)){try{b=normalizeRelayUrl(b)}catch{continue}if(!_)c.add(b),g.add(b);else{const j=_;j.write&&g.add(b),j.read&&c.add(b)}}return a.readRelayUrls=Array.from(c),a.writeRelayUrls=Array.from(g),a}catch{}}function disconnect(s,e){return e??(e=createDebug5("ndk:relay:auth-policies:disconnect")),async o=>{e==null||e(`Relay ${o.url} requested authentication, disconnecting`),s.removeRelay(o.url)}}async function signAndAuth(s,e,o,a,c,g){try{await s.sign(o),c(s)}catch(b){a==null||a(`Failed to publish auth event to relay ${e.url}`,b),g(s)}}function signIn({ndk:s,signer:e,debug:o}={}){return o??(o=createDebug5("ndk:auth-policies:signIn")),async(a,c)=>{o==null||o(`Relay ${a.url} requested authentication, signing in`);const g=new NDKEvent(s);return g.kind=22242,g.tags=[["relay",a.url],["challenge",c]],e??(e=s==null?void 0:s.signer),new Promise(async(b,_)=>{e?await signAndAuth(g,a,e,o,b,_):s==null||s.once("signer:ready",async j=>{await signAndAuth(g,a,j,o,b,_)})})}}var NDKRelayAuthPolicies={disconnect,signIn},NDKNip07Signer=class Js{constructor(e=1e3,o){pt(this,"_userPromise");pt(this,"encryptionQueue",[]);pt(this,"encryptionProcessing",!1);pt(this,"debug");pt(this,"waitTimeout");pt(this,"_pubkey");pt(this,"ndk");pt(this,"_user");this.debug=createDebug5("ndk:nip07"),this.waitTimeout=e,this.ndk=o}get pubkey(){if(!this._pubkey)throw new Error("Not ready");return this._pubkey}async blockUntilReady(){var a;await this.waitForExtension();const e=await((a=window.nostr)==null?void 0:a.getPublicKey());if(!e)throw new Error("User rejected access");this._pubkey=e;let o;return this.ndk?o=this.ndk.getUser({pubkey:e}):o=new NDKUser({pubkey:e}),this._user=o,o}async user(){return this._userPromise||(this._userPromise=this.blockUntilReady()),this._userPromise}get userSync(){if(!this._user)throw new Error("User not ready");return this._user}async sign(e){var a;await this.waitForExtension();const o=await((a=window.nostr)==null?void 0:a.signEvent(e));if(!o)throw new Error("Failed to sign event");return o.sig}async relays(e){var c,g;await this.waitForExtension();const o=await((g=(c=window.nostr)==null?void 0:c.getRelays)==null?void 0:g.call(c))||{},a=[];for(const b of Object.keys(o))o[b].read&&o[b].write&&a.push(b);return a.map(b=>new NDKRelay(b,e==null?void 0:e.relayAuthDefaultPolicy,e))}async encryptionEnabled(e){var a,c;const o=[];return(!e||e==="nip04")&&((a=window.nostr)!=null&&a.nip04)&&o.push("nip04"),(!e||e==="nip44")&&((c=window.nostr)!=null&&c.nip44)&&o.push("nip44"),o}async encrypt(e,o,a="nip04"){if(!await this.encryptionEnabled(a))throw new Error(`${a}encryption is not available from your browser extension`);await this.waitForExtension();const c=e.pubkey;return this.queueEncryption(a,"encrypt",c,o)}async decrypt(e,o,a="nip04"){if(!await this.encryptionEnabled(a))throw new Error(`${a}encryption is not available from your browser extension`);await this.waitForExtension();const c=e.pubkey;return this.queueEncryption(a,"decrypt",c,o)}async queueEncryption(e,o,a,c){return new Promise((g,b)=>{this.encryptionQueue.push({scheme:e,method:o,counterpartyHexpubkey:a,value:c,resolve:g,reject:b}),this.encryptionProcessing||this.processEncryptionQueue()})}async processEncryptionQueue(e,o=0){var tt,et;if(!e&&this.encryptionQueue.length===0){this.encryptionProcessing=!1;return}this.encryptionProcessing=!0;const a=e||this.encryptionQueue.shift();if(!a){this.encryptionProcessing=!1;return}const{scheme:c,method:g,counterpartyHexpubkey:b,value:_,resolve:j,reject:_e}=a;this.debug("Processing encryption queue item",{method:g,counterpartyHexpubkey:b,value:_});try{const nt=await((et=(tt=window.nostr)==null?void 0:tt[c])==null?void 0:et[g](b,_));if(!nt)throw new Error("Failed to encrypt/decrypt");j(nt)}catch(nt){const rt=nt instanceof Error?nt.message:String(nt);if(rt.includes("call already executing")&&o<5){this.debug("Retrying encryption queue item",{method:g,counterpartyHexpubkey:b,value:_,retries:o}),setTimeout(()=>{this.processEncryptionQueue(a,o+1)},50*o);return}_e(nt instanceof Error?nt:new Error(rt))}this.processEncryptionQueue()}waitForExtension(){return new Promise((e,o)=>{if(window.nostr){e();return}let a;const c=setInterval(()=>{window.nostr&&(clearTimeout(a),clearInterval(c),e())},100);a=setTimeout(()=>{clearInterval(c),o(new Error("NIP-07 extension not available"))},this.waitTimeout)})}toPayload(){return JSON.stringify({type:"nip07",payload:""})}static async fromPayload(e,o){const a=JSON.parse(e);if(a.type!=="nip07")throw new Error(`Invalid payload type: expected 'nip07', got ${a.type}`);return new Js(void 0,o)}};registerSigner("nip07",NDKNip07Signer);var NDKNostrRpc=class extends lib$1.EventEmitter{constructor(e,o,a,c){super();pt(this,"ndk");pt(this,"signer");pt(this,"relaySet");pt(this,"debug");pt(this,"encryptionType","nip04");pt(this,"pool");if(this.ndk=e,this.signer=o,c){this.pool=new NDKPool(c,[],e,{debug:a.extend("rpc-pool"),name:"Nostr RPC"}),this.relaySet=new NDKRelaySet(new Set,e,this.pool);for(const g of c){const b=this.pool.getRelay(g,!1,!1);b.authPolicy=NDKRelayAuthPolicies.signIn({ndk:e,signer:o,debug:a}),this.relaySet.addRelay(b),b.connect()}}this.debug=a.extend("rpc")}subscribe(e){const o=this.ndk.subscribe(e,{closeOnEose:!1,groupable:!1,cacheUsage:"ONLY_RELAY",pool:this.pool,relaySet:this.relaySet},!1);return o.on("event",async a=>{try{const c=await this.parseEvent(a);c.method?this.emit("request",c):(this.emit(`response-${c.id}`,c),this.emit("response",c))}catch(c){this.debug("error parsing event",c,a.rawEvent())}}),new Promise(a=>{o.on("eose",()=>{this.debug("eosed"),a(o)}),o.start()})}async parseEvent(e){this.encryptionType==="nip44"&&e.content.includes("?iv=")?this.encryptionType="nip04":this.encryptionType==="nip04"&&!e.content.includes("?iv=")&&(this.encryptionType="nip44");const o=this.ndk.getUser({pubkey:e.pubkey});o.ndk=this.ndk;let a;try{a=await this.signer.decrypt(o,e.content,this.encryptionType)}catch{const et=this.encryptionType==="nip04"?"nip44":"nip04";a=await this.signer.decrypt(o,e.content,et),this.encryptionType=et}const c=JSON.parse(a),{id:g,method:b,params:_,result:j,error:_e}=c;return b?{id:g,pubkey:e.pubkey,method:b,params:_,event:e}:{id:g,result:j,error:_e,event:e}}async sendResponse(e,o,a,c=24133,g){const b={id:e,result:a};g&&(b.error=g);const _=await this.signer.user(),j=this.ndk.getUser({pubkey:o}),_e=new NDKEvent(this.ndk,{kind:c,content:JSON.stringify(b),tags:[["p",o]],pubkey:_.pubkey});_e.content=await this.signer.encrypt(j,_e.content,this.encryptionType),await _e.sign(this.signer),await _e.publish(this.relaySet)}async sendRequest(e,o,a=[],c=24133,g){const b=Math.random().toString(36).substring(7),_=await this.signer.user(),j=this.ndk.getUser({pubkey:e}),_e={id:b,method:o,params:a},tt=new Promise(()=>{const nt=rt=>{rt.result==="auth_url"?(this.once(`response-${b}`,nt),this.emit("authUrl",rt.error)):g&&g(rt)};this.once(`response-${b}`,nt)}),et=new NDKEvent(this.ndk,{kind:c,content:JSON.stringify(_e),tags:[["p",e]],pubkey:_.pubkey});return et.content=await this.signer.encrypt(j,et.content,this.encryptionType),await et.sign(this.signer),await et.publish(this.relaySet),tt}};async function ndkSignerFromPayload(s,e){let o;try{o=JSON.parse(s)}catch(c){console.error("Failed to parse signer payload string",s,c);return}if(!o||typeof o.type!="string"){console.error("Failed to parse signer payload string",s,new Error("Missing type field"));return}const a=signerRegistry.get(o.type);if(!a)throw new Error(`Unknown signer type: ${o.type}`);try{return await a.fromPayload(s,e)}catch(c){const g=c instanceof Error?c.message:String(c);throw new Error(`Failed to deserialize signer type ${o.type}: ${g}`)}}function nostrConnectGenerateSecret(){return Math.random().toString(36).substring(2,15)}function generateNostrConnectUri(s,e,o,a){const c={name:a!=null&&a.name?encodeURIComponent(a.name):"",url:a!=null&&a.url?encodeURIComponent(a.url):"",image:a!=null&&a.image?encodeURIComponent(a.image):"",perms:a!=null&&a.perms?encodeURIComponent(a.perms):""};let g=`nostrconnect://${s}?image=${c.image}&url=${c.url}&name=${c.name}&perms=${c.perms}&secret=${encodeURIComponent(e)}`;return o&&(g+=`&relay=${encodeURIComponent(o)}`),g}var NDKNip46Signer=class us extends lib$1.EventEmitter{constructor(o,a,c,g,b){super();pt(this,"ndk");pt(this,"_user");pt(this,"bunkerPubkey");pt(this,"userPubkey");pt(this,"secret");pt(this,"localSigner");pt(this,"nip05");pt(this,"rpc");pt(this,"debug");pt(this,"relayUrls");pt(this,"subscription");pt(this,"nostrConnectUri");pt(this,"nostrConnectSecret");this.ndk=o,this.debug=o.debug.extend("nip46:signer"),this.relayUrls=g,c?typeof c=="string"?this.localSigner=new NDKPrivateKeySigner(c):this.localSigner=c:this.localSigner=NDKPrivateKeySigner.generate(),a===!1||(a?a.startsWith("bunker://")?this.bunkerFlowInit(a):this.nip05Init(a):this.nostrconnectFlowInit(b)),this.rpc=new NDKNostrRpc(this.ndk,this.localSigner,this.debug,this.relayUrls)}get pubkey(){if(!this.userPubkey)throw new Error("Not ready");return this.userPubkey}static bunker(o,a,c){return new us(o,a,c)}static nostrconnect(o,a,c,g){return new us(o,void 0,c,[a],g)}nostrconnectFlowInit(o){var c;this.nostrConnectSecret=nostrConnectGenerateSecret();const a=this.localSigner.pubkey;this.nostrConnectUri=generateNostrConnectUri(a,this.nostrConnectSecret,(c=this.relayUrls)==null?void 0:c[0],o)}bunkerFlowInit(o){const a=new URL(o),c=a.hostname||a.pathname.replace(/^\/\//,""),g=a.searchParams.get("pubkey"),b=a.searchParams.getAll("relay"),_=a.searchParams.get("secret");this.bunkerPubkey=c,this.userPubkey=g,this.relayUrls=b,this.secret=_}nip05Init(o){this.nip05=o}async startListening(){if(this.subscription)return;const o=await this.localSigner.user();if(!o)throw new Error("Local signer not ready");this.subscription=await this.rpc.subscribe({kinds:[24133],"#p":[o.pubkey]})}async user(){return this._user?this._user:this.blockUntilReady()}get userSync(){if(!this._user)throw new Error("Remote user not ready synchronously");return this._user}async blockUntilReadyNostrConnect(){return new Promise((o,a)=>{const c=g=>{g.result===this.nostrConnectSecret&&(this._user=g.event.author,this.userPubkey=g.event.pubkey,this.bunkerPubkey=g.event.pubkey,this.rpc.off("response",c),o(this._user))};this.startListening(),this.rpc.on("response",c)})}async blockUntilReady(){if(!this.bunkerPubkey&&!this.nostrConnectSecret&&!this.nip05)throw new Error("Bunker pubkey not set");if(this.nostrConnectSecret)return this.blockUntilReadyNostrConnect();if(this.nip05&&!this.userPubkey){const o=await NDKUser.fromNip05(this.nip05,this.ndk);o&&(this._user=o,this.userPubkey=o.pubkey,this.relayUrls=o.nip46Urls,this.rpc=new NDKNostrRpc(this.ndk,this.localSigner,this.debug,this.relayUrls))}if(!this.bunkerPubkey&&this.userPubkey)this.bunkerPubkey=this.userPubkey;else if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");return await this.startListening(),this.rpc.on("authUrl",(...o)=>{this.emit("authUrl",...o)}),new Promise((o,a)=>{const c=[this.userPubkey??""];if(this.secret&&c.push(this.secret),!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,"connect",c,24133,g=>{g.result==="ack"?this.getPublicKey().then(b=>{this.userPubkey=b,this._user=this.ndk.getUser({pubkey:b}),o(this._user)}):a(g.error)})})}stop(){var o;(o=this.subscription)==null||o.stop(),this.subscription=void 0}async getPublicKey(){return this.userPubkey?this.userPubkey:new Promise((o,a)=>{if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,"get_public_key",[],24133,c=>{o(c.result)})})}async encryptionEnabled(o){return o?[o]:Promise.resolve(["nip04","nip44"])}async encrypt(o,a,c="nip04"){return this.encryption(o,a,c,"encrypt")}async decrypt(o,a,c="nip04"){return this.encryption(o,a,c,"decrypt")}async encryption(o,a,c,g){return new Promise((_,j)=>{if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,`${c}_${g}`,[o.pubkey,a],24133,_e=>{_e.error?j(_e.error):_(_e.result)})})}async sign(o){return new Promise((c,g)=>{if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,"sign_event",[JSON.stringify(o)],24133,b=>{if(b.error)g(b.error);else{const _=JSON.parse(b.result);c(_.sig)}})})}async createAccount(o,a,c){await this.startListening();const g=[];return o&&g.push(o),a&&g.push(a),c&&g.push(c),new Promise((b,_)=>{if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,"create_account",g,24133,j=>{if(j.error)_(j.error);else{const _e=j.result;b(_e)}})})}toPayload(){if(!this.bunkerPubkey||!this.userPubkey)throw new Error("NIP-46 signer is not fully initialized for serialization");const o={type:"nip46",payload:{bunkerPubkey:this.bunkerPubkey,userPubkey:this.userPubkey,relayUrls:this.relayUrls,secret:this.secret,localSignerPayload:this.localSigner.toPayload(),nip05:this.nip05||null}};return JSON.stringify(o)}static async fromPayload(o,a){if(!a)throw new Error("NDK instance is required to deserialize NIP-46 signer");const c=JSON.parse(o);if(c.type!=="nip46")throw new Error(`Invalid payload type: expected 'nip46', got ${c.type}`);const g=c.payload;if(!g||typeof g!="object"||!g.localSignerPayload)throw new Error("Invalid payload content for nip46 signer");const b=await ndkSignerFromPayload(g.localSignerPayload,a);if(!b)throw new Error("Failed to deserialize local signer for NIP-46");if(!(b instanceof NDKPrivateKeySigner))throw new Error("Local signer must be an instance of NDKPrivateKeySigner");let _;return _=new us(a,!1,b,g.relayUrls),_.userPubkey=g.userPubkey,_.bunkerPubkey=g.bunkerPubkey,_.relayUrls=g.relayUrls,_.secret=g.secret,g.userPubkey&&(_._user=new NDKUser({pubkey:g.userPubkey}),_._user&&(_._user.ndk=a)),_}};registerSigner("nip46",NDKNip46Signer);function dedup(s,e){return s.created_at>e.created_at?s:e}async function getRelayListForUser(s,e){return(await getRelayListForUsers([s],e)).get(s)}async function getRelayListForUsers(s,e,o=!1,a=1e3){var et;const c=e.outboxPool||e.pool,g=new Set;for(const nt of c.relays.values())g.add(nt);const b=new Map,_=new Map,j=new NDKRelaySet(g,e);if((et=e.cacheAdapter)!=null&&et.locking&&!o){const nt=await e.fetchEvents({kinds:[3,10002],authors:Array.from(new Set(s))},{cacheUsage:"ONLY_CACHE",subId:"ndk-relay-list-fetch"});for(const rt of nt)rt.kind===10002&&b.set(rt.pubkey,NDKRelayList.from(rt));for(const rt of nt)if(rt.kind===3){if(b.has(rt.pubkey))continue;const it=relayListFromKind3(e,rt);it&&_.set(rt.pubkey,it)}s=s.filter(rt=>!b.has(rt)&&!_.has(rt))}if(s.length===0)return b;const _e=new Map,tt=new Map;return new Promise(nt=>{(async()=>{const it={closeOnEose:!0,pool:c,groupable:!0,subId:"ndk-relay-list-fetch",addSinceFromCache:!0,relaySet:j};j&&(it.relaySet=j),e.subscribe({kinds:[3,10002],authors:s},it,{onEvent:st=>{if(st.kind===10002){const lt=_e.get(st.pubkey);if(lt&&lt.created_at>st.created_at)return;_e.set(st.pubkey,st)}else if(st.kind===3){const lt=tt.get(st.pubkey);if(lt&&lt.created_at>st.created_at)return;tt.set(st.pubkey,st)}},onEose:()=>{for(const st of _e.values())b.set(st.pubkey,NDKRelayList.from(st));for(const st of s){if(b.has(st))continue;const lt=tt.get(st);if(!lt)continue;const at=relayListFromKind3(e,lt);at&&b.set(st,at)}nt(b)}}),setTimeout(()=>{nt(b)},a)})()})}var OutboxItem=class{constructor(s){pt(this,"type");pt(this,"relayUrlScores");pt(this,"readRelays");pt(this,"writeRelays");this.type=s,this.relayUrlScores=new Map,this.readRelays=new Set,this.writeRelays=new Set}},OutboxTracker=class extends lib$1.EventEmitter{constructor(e){super();pt(this,"data");pt(this,"ndk");pt(this,"debug");this.ndk=e,this.debug=e.debug.extend("outbox-tracker"),this.data=new dist.LRUCache({maxSize:1e5,entryExpirationTimeInMS:2*60*1e3})}async trackUsers(e,o=!1){const a=[];for(let c=0;c<e.length;c+=400){const b=e.slice(c,c+400).map(_=>getKeyFromItem(_)).filter(_=>!this.data.has(_));if(b.length!==0){for(const _ of b)this.data.set(_,new OutboxItem("user"));a.push(new Promise(_=>{getRelayListForUsers(b,this.ndk,o).then(j=>{for(const[_e,tt]of j){let et=this.data.get(_e);if(et??(et=new OutboxItem("user")),tt){et.readRelays=new Set(normalize(tt.readRelayUrls)),et.writeRelays=new Set(normalize(tt.writeRelayUrls));for(const nt of et.readRelays)this.ndk.pool.blacklistRelayUrls.has(nt)&&et.readRelays.delete(nt);for(const nt of et.writeRelays)this.ndk.pool.blacklistRelayUrls.has(nt)&&et.writeRelays.delete(nt);this.data.set(_e,et)}}}).finally(_)}))}}return Promise.all(a)}track(e,o,a=!0){const c=getKeyFromItem(e);o??(o=getTypeFromItem(e));let g=this.data.get(c);return g||(g=new OutboxItem(o),e instanceof NDKUser&&this.trackUsers([e])),g}};function getKeyFromItem(s){return s instanceof NDKUser?s.pubkey:s}function getTypeFromItem(s){return s instanceof NDKUser?"user":"kind"}function correctRelaySet(s,e){const o=e.connectedRelays();if(!Array.from(s.relays).some(c=>o.map(g=>g.url).includes(c.url)))for(const c of o)s.addRelay(c);if(o.length===0)for(const c of e.relays.values())s.addRelay(c);return s}var NDKSubscriptionManager=class{constructor(){pt(this,"subscriptions");pt(this,"seenEvents",new Map);this.subscriptions=new Map}add(s){this.subscriptions.set(s.internalId,s),s.onStopped,s.onStopped=()=>{this.subscriptions.delete(s.internalId)},s.on("close",()=>{this.subscriptions.delete(s.internalId)})}seenEvent(s,e){const o=this.seenEvents.get(s)||[];o.push(e),this.seenEvents.set(s,o)}dispatchEvent(s,e,o=!1){e&&this.seenEvent(s.id,e);const a=this.subscriptions.values(),c=[];for(const g of a)matchFilters(g.filters,s)&&c.push(g);for(const g of c)g.eventReceived(s,e,!1,o)}},debug7=createDebug5("ndk:active-user");async function getUserRelayList(s){if(!this.autoConnectUserRelays)return;const e=await getRelayListForUser(s.pubkey,this);if(e){for(const o of e.relays){let a=this.pool.relays.get(o);a||(a=new NDKRelay(o,this.relayAuthDefaultPolicy,this),this.pool.addRelay(a))}return e}}async function setActiveUser(s){const e=this.outboxPool||this.pool;e.connectedRelays.length>0?setActiveUserConnected.call(this,s):e.once("connect",()=>{setActiveUserConnected.call(this,s)})}async function setActiveUserConnected(s){var g;const e=await getUserRelayList.call(this,s),o=[{kinds:[10006],authors:[s.pubkey]}];this.autoFetchUserMutelist&&((g=o[0].kinds)==null||g.push(1e4));const a=new Map,c=e?e.relaySet:void 0;this.subscribe(o,{subId:"active-user-settings",closeOnEose:!0,relaySet:c},{onEvent:b=>{const _=a.get(b.kind);_&&_.created_at>=b.created_at||a.set(b.kind,b)},onEose:()=>{for(const b of a.values())processEvent.call(this,b)}})}async function processEvent(s){s.kind===10006?processBlockRelayList.call(this,s):s.kind===1e4&&processMuteList.call(this,s)}function processBlockRelayList(s){const e=lists_default.from(s);for(const o of e.items)this.pool.blacklistRelayUrls.add(o[0]);debug7("Added %d relays to relay blacklist",e.items.length)}function processMuteList(s){const e=lists_default.from(s);for(const o of e.items)this.mutedIds.set(o[1],o[0]);debug7("Added %d users to mute list",e.items.length)}function getEntity(s){try{const e=nip19_exports.decode(s);return e.type==="npub"?npub(this,e.data):e.type==="nprofile"?nprofile(this,e.data):e}catch{return null}}function npub(s,e){return s.getUser({pubkey:e})}function nprofile(s,e){const o=s.getUser({pubkey:e.pubkey});return e.relays&&(o.relayUrls=e.relays),o}function isValidHint(s){if(!s||s==="")return!1;try{return new URL(s),!0}catch{return!1}}async function fetchEventFromTag(s,e,o,a={type:"timeout"}){const c=this.debug.extend("fetch-event-from-tag"),[g,b,_]=s;o={},c("fetching event from tag",s,o,a);const j=getRelaysForSync(this,e.pubkey);if(j&&j.size>0){c("fetching event from author relays %o",Array.from(j));const st=NDKRelaySet.fromRelayUrls(Array.from(j),this),lt=await this.fetchEvent(b,o,st);if(lt)return lt}else c("no author relays found for %s",e.pubkey,e);const _e=calculateRelaySetsFromFilters(this,[{ids:[b]}],this.pool);c("fetching event without relay hint",_e);const tt=await this.fetchEvent(b,o);if(tt)return tt;if(_&&_!==""){const st=await this.fetchEvent(b,o,this.pool.getRelay(_,!0,!0,[{ids:[b]}]));if(st)return st}let et;const nt=isValidHint(_)?this.pool.getRelay(_,!1,!0,[{ids:[b]}]):void 0,rt=new Promise(st=>{this.fetchEvent(b,o,nt).then(st)});if(!isValidHint(_)||a.type==="none")return rt;const it=new Promise(async st=>{const lt=a.relaySet,at=a.timeout??1500,ct=new Promise(ft=>setTimeout(ft,at));if(a.type==="timeout"&&await ct,et)st(et);else{c("fallback fetch triggered");const ft=await this.fetchEvent(b,o,lt);st(ft)}});switch(a.type){case"timeout":return Promise.race([rt,it]);case"eose":return et=await rt,et||it}}var Queue$1=class{constructor(e,o){pt(this,"queue",[]);pt(this,"maxConcurrency");pt(this,"processing",new Set);pt(this,"promises",new Map);this.maxConcurrency=o}add(e){if(this.promises.has(e.id))return this.promises.get(e.id);const o=new Promise((a,c)=>{this.queue.push({...e,func:()=>e.func().then(g=>(a(g),g),g=>{throw c(g),g})}),this.process()});return this.promises.set(e.id,o),o.finally(()=>{this.promises.delete(e.id),this.processing.delete(e.id),this.process()}),o}process(){if(this.processing.size>=this.maxConcurrency||this.queue.length===0)return;const e=this.queue.shift();!e||this.processing.has(e.id)||(this.processing.add(e.id),e.func())}clear(){this.queue=[]}clearProcessing(){this.processing.clear()}clearAll(){this.clear(),this.clearProcessing()}length(){return this.queue.length}},DEFAULT_OUTBOX_RELAYS=["wss://purplepag.es/","wss://nos.lol/"],DEFAULT_BLACKLISTED_RELAYS=["wss://brb.io/","wss://nostr.mutinywallet.com/"],NDK=class extends lib$1.EventEmitter{constructor(e={}){super();pt(this,"_explicitRelayUrls");pt(this,"blacklistRelayUrls");pt(this,"pool");pt(this,"outboxPool");pt(this,"_signer");pt(this,"_activeUser");pt(this,"cacheAdapter");pt(this,"debug");pt(this,"devWriteRelaySet");pt(this,"outboxTracker");pt(this,"mutedIds");pt(this,"clientName");pt(this,"clientNip89");pt(this,"queuesZapConfig");pt(this,"queuesNip05");pt(this,"asyncSigVerification",!1);pt(this,"initialValidationRatio",1);pt(this,"lowestValidationRatio",.1);pt(this,"validationRatioFn");pt(this,"autoBlacklistInvalidRelays",!1);pt(this,"subManager");pt(this,"_signatureVerificationFunction");pt(this,"_signatureVerificationWorker");pt(this,"signatureVerificationTimeMs",0);pt(this,"publishingFailureHandled",!1);pt(this,"pools",[]);pt(this,"relayAuthDefaultPolicy");pt(this,"httpFetch");pt(this,"netDebug");pt(this,"autoConnectUserRelays",!0);pt(this,"autoFetchUserMutelist",!0);pt(this,"walletConfig");pt(this,"fetchEventFromTag",fetchEventFromTag.bind(this));pt(this,"getEntity",getEntity.bind(this));this.debug=e.debug||createDebug5("ndk"),this.netDebug=e.netDebug,this._explicitRelayUrls=e.explicitRelayUrls||[],this.blacklistRelayUrls=e.blacklistRelayUrls||DEFAULT_BLACKLISTED_RELAYS,this.subManager=new NDKSubscriptionManager,this.pool=new NDKPool(e.explicitRelayUrls||[],[],this),this.pool.name="Main",this.pool.on("relay:auth",async(o,a)=>{this.relayAuthDefaultPolicy&&await this.relayAuthDefaultPolicy(o,a)}),this.autoConnectUserRelays=e.autoConnectUserRelays??!0,this.autoFetchUserMutelist=e.autoFetchUserMutelist??!0,this.clientName=e.clientName,this.clientNip89=e.clientNip89,this.relayAuthDefaultPolicy=e.relayAuthDefaultPolicy,e.enableOutboxModel&&(this.outboxPool=new NDKPool(e.outboxRelayUrls||DEFAULT_OUTBOX_RELAYS,[],this,{debug:this.debug.extend("outbox-pool"),name:"Outbox Pool"}),this.outboxTracker=new OutboxTracker(this)),this.signer=e.signer,this.cacheAdapter=e.cacheAdapter,this.mutedIds=e.mutedIds||new Map,e.devWriteRelayUrls&&(this.devWriteRelaySet=NDKRelaySet.fromRelayUrls(e.devWriteRelayUrls,this)),this.queuesZapConfig=new Queue$1("zaps",3),this.queuesNip05=new Queue$1("nip05",10),e.signatureVerificationWorker&&(this.signatureVerificationWorker=e.signatureVerificationWorker),e.signatureVerificationFunction&&(this.signatureVerificationFunction=e.signatureVerificationFunction),this.initialValidationRatio=e.initialValidationRatio||1,this.lowestValidationRatio=e.lowestValidationRatio||.1,this.autoBlacklistInvalidRelays=e.autoBlacklistInvalidRelays||!1,this.validationRatioFn=e.validationRatioFn||this.defaultValidationRatioFn;try{this.httpFetch=fetch}catch{}}set explicitRelayUrls(e){this._explicitRelayUrls=e.map(normalizeRelayUrl),this.pool.relayUrls=e}get explicitRelayUrls(){return this._explicitRelayUrls||[]}set signatureVerificationWorker(e){this._signatureVerificationWorker=e,e?(signatureVerificationInit(e),this.asyncSigVerification=!0):this.asyncSigVerification=!1}set signatureVerificationFunction(e){this._signatureVerificationFunction=e,this.asyncSigVerification=!!e}get signatureVerificationFunction(){return this._signatureVerificationFunction}addExplicitRelay(e,o,a=!0){var g;let c;return typeof e=="string"?c=new NDKRelay(e,o,this):c=e,this.pool.addRelay(c,a),(g=this.explicitRelayUrls)==null||g.push(c.url),c}toJSON(){return{relayCount:this.pool.relays.size}.toString()}get activeUser(){return this._activeUser}set activeUser(e){var a;const o=((a=this._activeUser)==null?void 0:a.pubkey)!==(e==null?void 0:e.pubkey);this._activeUser=e,e&&o?setActiveUser.call(this,e):e||(this.mutedIds=new Map)}get signer(){return this._signer}set signer(e){this._signer=e,e&&this.emit("signer:ready",e),e==null||e.user().then(o=>{o.ndk=this,this.activeUser=o})}async connect(e){var a,c;this._signer&&this.autoConnectUserRelays&&(this.debug("Attempting to connect to user relays specified by signer %o",await((c=(a=this._signer).relays)==null?void 0:c.call(a,this))),this._signer.relays&&(await this._signer.relays(this)).forEach(b=>this.pool.addRelay(b)));const o=[this.pool.connect(e)];return this.outboxPool&&o.push(this.outboxPool.connect(e)),Promise.allSettled(o).then(()=>{})}reportInvalidSignature(e,o){this.debug(`Invalid signature detected for event ${e.id}${o?` from relay ${o.url}`:""}`),this.emit("event:invalid-sig",e,o),this.autoBlacklistInvalidRelays&&o&&this.blacklistRelay(o.url)}blacklistRelay(e){if(this.blacklistRelayUrls||(this.blacklistRelayUrls=[]),!this.blacklistRelayUrls.includes(e)){this.blacklistRelayUrls.push(e),this.debug(`Added relay to blacklist: ${e}`);const o=this.pool.getRelay(e,!1,!1);o&&(o.disconnect(),this.debug(`Disconnected from blacklisted relay: ${e}`))}}defaultValidationRatioFn(e,o,a){if(o<10)return this.initialValidationRatio;const c=Math.min(o/100,1),g=this.initialValidationRatio*(1-c)+this.lowestValidationRatio*c;return Math.max(g,this.lowestValidationRatio)}getUser(e){const o=new NDKUser(e);return o.ndk=this,o}async getUserFromNip05(e,o=!1){return NDKUser.fromNip05(e,this,o)}subscribe(e,o,a=!0,c=!0){var _e;let g=o==null?void 0:o.relaySet,b=c;a instanceof NDKRelaySet?(console.warn("relaySet is deprecated, use opts.relaySet instead. This will be removed in version v2.14.0"),g=a,b=c):(typeof a=="boolean"||typeof a=="object")&&(b=a);const _=new NDKSubscription(this,e,{relaySet:g,...o});this.subManager.add(_);const j=_.pool;if(_.relaySet)for(const tt of _.relaySet.relays)j.useTemporaryRelay(tt,void 0,_.filters);if(this.outboxPool&&_.hasAuthorsFilter()){const tt=_.filters.filter(et=>{var nt;return et.authors&&((nt=et.authors)==null?void 0:nt.length)>0}).flatMap(et=>et.authors);(_e=this.outboxTracker)==null||_e.trackUsers(tt)}if(b){let tt;typeof b=="object"&&(b.onEvent&&_.on("event",b.onEvent),b.onEose&&_.on("eose",b.onEose),b.onEvents&&(tt=b.onEvents)),setTimeout(()=>{const et=_.start(!tt);et&&et.length>0&&tt&&tt(et)},0)}return _}fetchEventSync(e){if(!this.cacheAdapter)throw new Error("Cache adapter not set");let o;typeof e=="string"?o=[filterFromId(e)]:o=e;const a=new NDKSubscription(this,o),c=this.cacheAdapter.query(a);if(c instanceof Promise)throw new Error("Cache adapter is async");return c.map(g=>(g.ndk=this,g))}async fetchEvent(e,o,a){let c,g;if(a instanceof NDKRelay?g=new NDKRelaySet(new Set([a]),this):a instanceof NDKRelaySet&&(g=a),!a&&typeof e=="string"&&!isNip33AValue(e)){const b=relaysFromBech32(e,this);b.length>0&&(g=new NDKRelaySet(new Set(b),this),g=correctRelaySet(g,this.pool))}if(typeof e=="string"?c=[filterFromId(e)]:Array.isArray(e)?c=e:c=[e],c.length===0)throw new Error(`Invalid filter: ${JSON.stringify(e)}`);return new Promise(b=>{let _=null;const j={...o||{},closeOnEose:!0};g&&(j.relaySet=g);const _e=this.subscribe(c,j,!1),tt=setTimeout(()=>{_e.stop(),b(_)},1e4);_e.on("event",et=>{et.ndk=this,et.isReplaceable()?(!_||_.created_at<et.created_at)&&(_=et):(clearTimeout(tt),b(et))}),_e.on("eose",()=>{clearTimeout(tt),b(_)}),_e.start()})}async fetchEvents(e,o,a){return new Promise(c=>{const g=new Map,b={...o||{},closeOnEose:!0};a&&(b.relaySet=a);const _=this.subscribe(e,b,!1),j=_e=>{let tt;_e instanceof NDKEvent?tt=_e:tt=new NDKEvent(void 0,_e);const et=tt.deduplicationKey(),nt=g.get(et);nt&&(tt=dedup(nt,tt)),tt.ndk=this,g.set(et,tt)};_.on("event",j),_.on("eose",()=>{c(new Set(g.values()))}),_.start()})}assertSigner(){if(!this.signer)throw this.emit("signer:required"),new Error("Signer required")}set wallet(e){var o,a;if(!e){this.walletConfig=void 0;return}this.walletConfig??(this.walletConfig={}),this.walletConfig.lnPay=(o=e==null?void 0:e.lnPay)==null?void 0:o.bind(e),this.walletConfig.cashuPay=(a=e==null?void 0:e.cashuPay)==null?void 0:a.bind(e)}};createDebug5("ndk:zapper:ln");createDebug5("ndk:zapper");const NdkContext=reactExports.createContext(void 0),DEFAULT_RELAYS=["wss://purplepag.es","wss://relay.damus.io","wss://nos.lol"],NdkProvider=({children:s})=>{const[e]=reactExports.useState(()=>new NDK({explicitRelayUrls:DEFAULT_RELAYS})),[o,a]=reactExports.useState(null),[c,g]=reactExports.useState(null);reactExports.useEffect(()=>{e.connect().catch(()=>{})},[e]);const b=reactExports.useCallback(async()=>{if(!window.nostr)throw new Error("A NIP-07 signer is required (e.g. Alby, nos2x).");const tt=new NDKNip07Signer;await tt.blockUntilReady();const et=await tt.user();a(tt),g(et),e.signer=tt},[e]),_=reactExports.useCallback(()=>{a(null),g(null),e.signer=void 0},[e]),j=reactExports.useCallback(async tt=>{if(!o||!e)throw new Error("Connect a signer first.");const et=new NDKEvent(e,tt);return et.created_at||(et.created_at=Math.floor(Date.now()/1e3)),await et.sign(),et.rawEvent()},[o,e]),_e=reactExports.useMemo(()=>({ndk:e,signer:o,user:c,connect:b,disconnect:_,signEventTemplate:j}),[e,o,c,b,_,j]);return jsxRuntimeExports.jsx(NdkContext.Provider,{value:_e,children:s})},useNdk=()=>{const s=reactExports.useContext(NdkContext);if(!s)throw new Error("useNdk must be used within NdkProvider");return s},useCurrentPubkey=()=>{const{user:s}=useNdk();return(s==null?void 0:s.pubkey)||null};var Subscribable=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(s){return this.listeners.add(s),this.onSubscribe(),()=>{this.listeners.delete(s),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},defaultTimeoutProvider={setTimeout:(s,e)=>setTimeout(s,e),clearTimeout:s=>clearTimeout(s),setInterval:(s,e)=>setInterval(s,e),clearInterval:s=>clearInterval(s)},or,Ns,Ls,TimeoutManager=(Ls=class{constructor(){Lt(this,or,defaultTimeoutProvider);Lt(this,Ns,!1)}setTimeoutProvider(s){Ot(this,or,s)}setTimeout(s,e){return mt(this,or).setTimeout(s,e)}clearTimeout(s){mt(this,or).clearTimeout(s)}setInterval(s,e){return mt(this,or).setInterval(s,e)}clearInterval(s){mt(this,or).clearInterval(s)}},or=new WeakMap,Ns=new WeakMap,Ls),timeoutManager=new TimeoutManager;function systemSetTimeoutZero(s){setTimeout(s,0)}var isServer=typeof window>"u"||"Deno"in globalThis;function noop$1(){}function functionalUpdate(s,e){return typeof s=="function"?s(e):s}function isValidTimeout(s){return typeof s=="number"&&s>=0&&s!==1/0}function timeUntilStale(s,e){return Math.max(s+(e||0)-Date.now(),0)}function resolveStaleTime(s,e){return typeof s=="function"?s(e):s}function resolveEnabled(s,e){return typeof s=="function"?s(e):s}function matchQuery(s,e){const{type:o="all",exact:a,fetchStatus:c,predicate:g,queryKey:b,stale:_}=s;if(b){if(a){if(e.queryHash!==hashQueryKeyByOptions(b,e.options))return!1}else if(!partialMatchKey(e.queryKey,b))return!1}if(o!=="all"){const j=e.isActive();if(o==="active"&&!j||o==="inactive"&&j)return!1}return!(typeof _=="boolean"&&e.isStale()!==_||c&&c!==e.state.fetchStatus||g&&!g(e))}function matchMutation(s,e){const{exact:o,status:a,predicate:c,mutationKey:g}=s;if(g){if(!e.options.mutationKey)return!1;if(o){if(hashKey(e.options.mutationKey)!==hashKey(g))return!1}else if(!partialMatchKey(e.options.mutationKey,g))return!1}return!(a&&e.state.status!==a||c&&!c(e))}function hashQueryKeyByOptions(s,e){return((e==null?void 0:e.queryKeyHashFn)||hashKey)(s)}function hashKey(s){return JSON.stringify(s,(e,o)=>isPlainObject$1(o)?Object.keys(o).sort().reduce((a,c)=>(a[c]=o[c],a),{}):o)}function partialMatchKey(s,e){return s===e?!0:typeof s!=typeof e?!1:s&&e&&typeof s=="object"&&typeof e=="object"?Object.keys(e).every(o=>partialMatchKey(s[o],e[o])):!1}var hasOwn=Object.prototype.hasOwnProperty;function replaceEqualDeep(s,e){if(s===e)return s;const o=isPlainArray(s)&&isPlainArray(e);if(!o&&!(isPlainObject$1(s)&&isPlainObject$1(e)))return e;const c=(o?s:Object.keys(s)).length,g=o?e:Object.keys(e),b=g.length,_=o?new Array(b):{};let j=0;for(let _e=0;_e<b;_e++){const tt=o?_e:g[_e],et=s[tt],nt=e[tt];if(et===nt){_[tt]=et,(o?_e<c:hasOwn.call(s,tt))&&j++;continue}if(et===null||nt===null||typeof et!="object"||typeof nt!="object"){_[tt]=nt;continue}const rt=replaceEqualDeep(et,nt);_[tt]=rt,rt===et&&j++}return c===b&&j===c?s:_}function shallowEqualObjects(s,e){if(!e||Object.keys(s).length!==Object.keys(e).length)return!1;for(const o in s)if(s[o]!==e[o])return!1;return!0}function isPlainArray(s){return Array.isArray(s)&&s.length===Object.keys(s).length}function isPlainObject$1(s){if(!hasObjectPrototype(s))return!1;const e=s.constructor;if(e===void 0)return!0;const o=e.prototype;return!(!hasObjectPrototype(o)||!o.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(s)!==Object.prototype)}function hasObjectPrototype(s){return Object.prototype.toString.call(s)==="[object Object]"}function sleep(s){return new Promise(e=>{timeoutManager.setTimeout(e,s)})}function replaceData(s,e,o){return typeof o.structuralSharing=="function"?o.structuralSharing(s,e):o.structuralSharing!==!1?replaceEqualDeep(s,e):e}function addToEnd(s,e,o=0){const a=[...s,e];return o&&a.length>o?a.slice(1):a}function addToStart(s,e,o=0){const a=[e,...s];return o&&a.length>o?a.slice(0,-1):a}var skipToken=Symbol();function ensureQueryFn(s,e){return!s.queryFn&&(e!=null&&e.initialPromise)?()=>e.initialPromise:!s.queryFn||s.queryFn===skipToken?()=>Promise.reject(new Error(`Missing queryFn: '${s.queryHash}'`)):s.queryFn}function shouldThrowError(s,e){return typeof s=="function"?s(...e):!!s}var br,ar,Or,Is,FocusManager=(Is=class extends Subscribable{constructor(){super();Lt(this,br);Lt(this,ar);Lt(this,Or);Ot(this,Or,e=>{if(!isServer&&window.addEventListener){const o=()=>e();return window.addEventListener("visibilitychange",o,!1),()=>{window.removeEventListener("visibilitychange",o)}}})}onSubscribe(){mt(this,ar)||this.setEventListener(mt(this,Or))}onUnsubscribe(){var e;this.hasListeners()||((e=mt(this,ar))==null||e.call(this),Ot(this,ar,void 0))}setEventListener(e){var o;Ot(this,Or,e),(o=mt(this,ar))==null||o.call(this),Ot(this,ar,e(a=>{typeof a=="boolean"?this.setFocused(a):this.onFocus()}))}setFocused(e){mt(this,br)!==e&&(Ot(this,br,e),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(o=>{o(e)})}isFocused(){var e;return typeof mt(this,br)=="boolean"?mt(this,br):((e=globalThis.document)==null?void 0:e.visibilityState)!=="hidden"}},br=new WeakMap,ar=new WeakMap,Or=new WeakMap,Is),focusManager=new FocusManager;function pendingThenable(){let s,e;const o=new Promise((c,g)=>{s=c,e=g});o.status="pending",o.catch(()=>{});function a(c){Object.assign(o,c),delete o.resolve,delete o.reject}return o.resolve=c=>{a({status:"fulfilled",value:c}),s(c)},o.reject=c=>{a({status:"rejected",reason:c}),e(c)},o}var defaultScheduler=systemSetTimeoutZero;function createNotifyManager(){let s=[],e=0,o=_=>{_()},a=_=>{_()},c=defaultScheduler;const g=_=>{e?s.push(_):c(()=>{o(_)})},b=()=>{const _=s;s=[],_.length&&c(()=>{a(()=>{_.forEach(j=>{o(j)})})})};return{batch:_=>{let j;e++;try{j=_()}finally{e--,e||b()}return j},batchCalls:_=>(...j)=>{g(()=>{_(...j)})},schedule:g,setNotifyFunction:_=>{o=_},setBatchNotifyFunction:_=>{a=_},setScheduler:_=>{c=_}}}var notifyManager=createNotifyManager(),Ur,lr,Lr,Ms,OnlineManager=(Ms=class extends Subscribable{constructor(){super();Lt(this,Ur,!0);Lt(this,lr);Lt(this,Lr);Ot(this,Lr,e=>{if(!isServer&&window.addEventListener){const o=()=>e(!0),a=()=>e(!1);return window.addEventListener("online",o,!1),window.addEventListener("offline",a,!1),()=>{window.removeEventListener("online",o),window.removeEventListener("offline",a)}}})}onSubscribe(){mt(this,lr)||this.setEventListener(mt(this,Lr))}onUnsubscribe(){var e;this.hasListeners()||((e=mt(this,lr))==null||e.call(this),Ot(this,lr,void 0))}setEventListener(e){var o;Ot(this,Lr,e),(o=mt(this,lr))==null||o.call(this),Ot(this,lr,e(this.setOnline.bind(this)))}setOnline(e){mt(this,Ur)!==e&&(Ot(this,Ur,e),this.listeners.forEach(a=>{a(e)}))}isOnline(){return mt(this,Ur)}},Ur=new WeakMap,lr=new WeakMap,Lr=new WeakMap,Ms),onlineManager=new OnlineManager;function defaultRetryDelay(s){return Math.min(1e3*2**s,3e4)}function canFetch(s){return(s??"online")==="online"?onlineManager.isOnline():!0}var CancelledError=class extends Error{constructor(s){super("CancelledError"),this.revert=s==null?void 0:s.revert,this.silent=s==null?void 0:s.silent}};function createRetryer(s){let e=!1,o=0,a;const c=pendingThenable(),g=()=>c.status!=="pending",b=st=>{var lt;if(!g()){const at=new CancelledError(st);nt(at),(lt=s.onCancel)==null||lt.call(s,at)}},_=()=>{e=!0},j=()=>{e=!1},_e=()=>focusManager.isFocused()&&(s.networkMode==="always"||onlineManager.isOnline())&&s.canRun(),tt=()=>canFetch(s.networkMode)&&s.canRun(),et=st=>{g()||(a==null||a(),c.resolve(st))},nt=st=>{g()||(a==null||a(),c.reject(st))},rt=()=>new Promise(st=>{var lt;a=at=>{(g()||_e())&&st(at)},(lt=s.onPause)==null||lt.call(s)}).then(()=>{var st;a=void 0,g()||(st=s.onContinue)==null||st.call(s)}),it=()=>{if(g())return;let st;const lt=o===0?s.initialPromise:void 0;try{st=lt??s.fn()}catch(at){st=Promise.reject(at)}Promise.resolve(st).then(et).catch(at=>{var _t;if(g())return;const ct=s.retry??(isServer?0:3),ft=s.retryDelay??defaultRetryDelay,vt=typeof ft=="function"?ft(o,at):ft,Rt=ct===!0||typeof ct=="number"&&o<ct||typeof ct=="function"&&ct(o,at);if(e||!Rt){nt(at);return}o++,(_t=s.onFail)==null||_t.call(s,o,at),sleep(vt).then(()=>_e()?void 0:rt()).then(()=>{e?nt(at):it()})})};return{promise:c,status:()=>c.status,cancel:b,continue:()=>(a==null||a(),c),cancelRetry:_,continueRetry:j,canStart:tt,start:()=>(tt()?it():rt().then(it),c)}}var kr,Fs,Removable=(Fs=class{constructor(){Lt(this,kr)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),isValidTimeout(this.gcTime)&&Ot(this,kr,timeoutManager.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(s){this.gcTime=Math.max(this.gcTime||0,s??(isServer?1/0:5*60*1e3))}clearGcTimeout(){mt(this,kr)&&(timeoutManager.clearTimeout(mt(this,kr)),Ot(this,kr,void 0))}},kr=new WeakMap,Fs),Sr,Ir,En,_r,rn,es,Rr,Sn,jn,zs,Query=(zs=class extends Removable{constructor(e){super();Lt(this,Sn);Lt(this,Sr);Lt(this,Ir);Lt(this,En);Lt(this,_r);Lt(this,rn);Lt(this,es);Lt(this,Rr);Ot(this,Rr,!1),Ot(this,es,e.defaultOptions),this.setOptions(e.options),this.observers=[],Ot(this,_r,e.client),Ot(this,En,mt(this,_r).getQueryCache()),this.queryKey=e.queryKey,this.queryHash=e.queryHash,Ot(this,Sr,getDefaultState$1(this.options)),this.state=e.state??mt(this,Sr),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var e;return(e=mt(this,rn))==null?void 0:e.promise}setOptions(e){if(this.options={...mt(this,es),...e},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const o=getDefaultState$1(this.options);o.data!==void 0&&(this.setData(o.data,{updatedAt:o.dataUpdatedAt,manual:!0}),Ot(this,Sr,o))}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&mt(this,En).remove(this)}setData(e,o){const a=replaceData(this.state.data,e,this.options);return Ft(this,Sn,jn).call(this,{data:a,type:"success",dataUpdatedAt:o==null?void 0:o.updatedAt,manual:o==null?void 0:o.manual}),a}setState(e,o){Ft(this,Sn,jn).call(this,{type:"setState",state:e,setStateOptions:o})}cancel(e){var a,c;const o=(a=mt(this,rn))==null?void 0:a.promise;return(c=mt(this,rn))==null||c.cancel(e),o?o.then(noop$1).catch(noop$1):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(mt(this,Sr))}isActive(){return this.observers.some(e=>resolveEnabled(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===skipToken||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>resolveStaleTime(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!timeUntilStale(this.state.dataUpdatedAt,e)}onFocus(){var o;const e=this.observers.find(a=>a.shouldFetchOnWindowFocus());e==null||e.refetch({cancelRefetch:!1}),(o=mt(this,rn))==null||o.continue()}onOnline(){var o;const e=this.observers.find(a=>a.shouldFetchOnReconnect());e==null||e.refetch({cancelRefetch:!1}),(o=mt(this,rn))==null||o.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),mt(this,En).notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(o=>o!==e),this.observers.length||(mt(this,rn)&&(mt(this,Rr)?mt(this,rn).cancel({revert:!0}):mt(this,rn).cancelRetry()),this.scheduleGc()),mt(this,En).notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||Ft(this,Sn,jn).call(this,{type:"invalidate"})}async fetch(e,o){var j,_e,tt,et,nt,rt,it,st,lt,at,ct,ft;if(this.state.fetchStatus!=="idle"&&((j=mt(this,rn))==null?void 0:j.status())!=="rejected"){if(this.state.data!==void 0&&(o!=null&&o.cancelRefetch))this.cancel({silent:!0});else if(mt(this,rn))return mt(this,rn).continueRetry(),mt(this,rn).promise}if(e&&this.setOptions(e),!this.options.queryFn){const vt=this.observers.find(Rt=>Rt.options.queryFn);vt&&this.setOptions(vt.options)}const a=new AbortController,c=vt=>{Object.defineProperty(vt,"signal",{enumerable:!0,get:()=>(Ot(this,Rr,!0),a.signal)})},g=()=>{const vt=ensureQueryFn(this.options,o),_t=(()=>{const Tt={client:mt(this,_r),queryKey:this.queryKey,meta:this.meta};return c(Tt),Tt})();return Ot(this,Rr,!1),this.options.persister?this.options.persister(vt,_t,this):vt(_t)},_=(()=>{const vt={fetchOptions:o,options:this.options,queryKey:this.queryKey,client:mt(this,_r),state:this.state,fetchFn:g};return c(vt),vt})();(_e=this.options.behavior)==null||_e.onFetch(_,this),Ot(this,Ir,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((tt=_.fetchOptions)==null?void 0:tt.meta))&&Ft(this,Sn,jn).call(this,{type:"fetch",meta:(et=_.fetchOptions)==null?void 0:et.meta}),Ot(this,rn,createRetryer({initialPromise:o==null?void 0:o.initialPromise,fn:_.fetchFn,onCancel:vt=>{vt instanceof CancelledError&&vt.revert&&this.setState({...mt(this,Ir),fetchStatus:"idle"}),a.abort()},onFail:(vt,Rt)=>{Ft(this,Sn,jn).call(this,{type:"failed",failureCount:vt,error:Rt})},onPause:()=>{Ft(this,Sn,jn).call(this,{type:"pause"})},onContinue:()=>{Ft(this,Sn,jn).call(this,{type:"continue"})},retry:_.options.retry,retryDelay:_.options.retryDelay,networkMode:_.options.networkMode,canRun:()=>!0}));try{const vt=await mt(this,rn).start();if(vt===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(vt),(rt=(nt=mt(this,En).config).onSuccess)==null||rt.call(nt,vt,this),(st=(it=mt(this,En).config).onSettled)==null||st.call(it,vt,this.state.error,this),vt}catch(vt){if(vt instanceof CancelledError){if(vt.silent)return mt(this,rn).promise;if(vt.revert){if(this.state.data===void 0)throw vt;return this.state.data}}throw Ft(this,Sn,jn).call(this,{type:"error",error:vt}),(at=(lt=mt(this,En).config).onError)==null||at.call(lt,vt,this),(ft=(ct=mt(this,En).config).onSettled)==null||ft.call(ct,this.state.data,vt,this),vt}finally{this.scheduleGc()}}},Sr=new WeakMap,Ir=new WeakMap,En=new WeakMap,_r=new WeakMap,rn=new WeakMap,es=new WeakMap,Rr=new WeakMap,Sn=new WeakSet,jn=function(e){const o=a=>{switch(e.type){case"failed":return{...a,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...a,fetchStatus:"paused"};case"continue":return{...a,fetchStatus:"fetching"};case"fetch":return{...a,...fetchState(a.data,this.options),fetchMeta:e.meta??null};case"success":const c={...a,data:e.data,dataUpdateCount:a.dataUpdateCount+1,dataUpdatedAt:e.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return Ot(this,Ir,e.manual?c:void 0),c;case"error":const g=e.error;return{...a,error:g,errorUpdateCount:a.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:a.fetchFailureCount+1,fetchFailureReason:g,fetchStatus:"idle",status:"error"};case"invalidate":return{...a,isInvalidated:!0};case"setState":return{...a,...e.state}}};this.state=o(this.state),notifyManager.batch(()=>{this.observers.forEach(a=>{a.onQueryUpdate()}),mt(this,En).notify({query:this,type:"updated",action:e})})},zs);function fetchState(s,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:canFetch(e.networkMode)?"fetching":"paused",...s===void 0&&{error:null,status:"pending"}}}function getDefaultState$1(s){const e=typeof s.initialData=="function"?s.initialData():s.initialData,o=e!==void 0,a=o?typeof s.initialDataUpdatedAt=="function"?s.initialDataUpdatedAt():s.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:o?a??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:o?"success":"pending",fetchStatus:"idle"}}var pn,Vt,ts,dn,$r,Mr,Pn,ur,ns,Fr,zr,Tr,Cr,cr,Hr,qt,Jr,vs,ws,xs,Es,bs,ks,Ss,_i,Hs,QueryObserver=(Hs=class extends Subscribable{constructor(e,o){super();Lt(this,qt);Lt(this,pn);Lt(this,Vt);Lt(this,ts);Lt(this,dn);Lt(this,$r);Lt(this,Mr);Lt(this,Pn);Lt(this,ur);Lt(this,ns);Lt(this,Fr);Lt(this,zr);Lt(this,Tr);Lt(this,Cr);Lt(this,cr);Lt(this,Hr,new Set);this.options=o,Ot(this,pn,e),Ot(this,ur,null),Ot(this,Pn,pendingThenable()),this.bindMethods(),this.setOptions(o)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(mt(this,Vt).addObserver(this),shouldFetchOnMount(mt(this,Vt),this.options)?Ft(this,qt,Jr).call(this):this.updateResult(),Ft(this,qt,Es).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return shouldFetchOn(mt(this,Vt),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return shouldFetchOn(mt(this,Vt),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,Ft(this,qt,bs).call(this),Ft(this,qt,ks).call(this),mt(this,Vt).removeObserver(this)}setOptions(e){const o=this.options,a=mt(this,Vt);if(this.options=mt(this,pn).defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof resolveEnabled(this.options.enabled,mt(this,Vt))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");Ft(this,qt,Ss).call(this),mt(this,Vt).setOptions(this.options),o._defaulted&&!shallowEqualObjects(this.options,o)&&mt(this,pn).getQueryCache().notify({type:"observerOptionsUpdated",query:mt(this,Vt),observer:this});const c=this.hasListeners();c&&shouldFetchOptionally(mt(this,Vt),a,this.options,o)&&Ft(this,qt,Jr).call(this),this.updateResult(),c&&(mt(this,Vt)!==a||resolveEnabled(this.options.enabled,mt(this,Vt))!==resolveEnabled(o.enabled,mt(this,Vt))||resolveStaleTime(this.options.staleTime,mt(this,Vt))!==resolveStaleTime(o.staleTime,mt(this,Vt)))&&Ft(this,qt,vs).call(this);const g=Ft(this,qt,ws).call(this);c&&(mt(this,Vt)!==a||resolveEnabled(this.options.enabled,mt(this,Vt))!==resolveEnabled(o.enabled,mt(this,Vt))||g!==mt(this,cr))&&Ft(this,qt,xs).call(this,g)}getOptimisticResult(e){const o=mt(this,pn).getQueryCache().build(mt(this,pn),e),a=this.createResult(o,e);return shouldAssignObserverCurrentProperties(this,a)&&(Ot(this,dn,a),Ot(this,Mr,this.options),Ot(this,$r,mt(this,Vt).state)),a}getCurrentResult(){return mt(this,dn)}trackResult(e,o){return new Proxy(e,{get:(a,c)=>(this.trackProp(c),o==null||o(c),c==="promise"&&!this.options.experimental_prefetchInRender&&mt(this,Pn).status==="pending"&&mt(this,Pn).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),Reflect.get(a,c))})}trackProp(e){mt(this,Hr).add(e)}getCurrentQuery(){return mt(this,Vt)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const o=mt(this,pn).defaultQueryOptions(e),a=mt(this,pn).getQueryCache().build(mt(this,pn),o);return a.fetch().then(()=>this.createResult(a,o))}fetch(e){return Ft(this,qt,Jr).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),mt(this,dn)))}createResult(e,o){var Nt;const a=mt(this,Vt),c=this.options,g=mt(this,dn),b=mt(this,$r),_=mt(this,Mr),_e=e!==a?e.state:mt(this,ts),{state:tt}=e;let et={...tt},nt=!1,rt;if(o._optimisticResults){const At=this.hasListeners(),yt=!At&&shouldFetchOnMount(e,o),xt=At&&shouldFetchOptionally(e,a,o,c);(yt||xt)&&(et={...et,...fetchState(tt.data,e.options)}),o._optimisticResults==="isRestoring"&&(et.fetchStatus="idle")}let{error:it,errorUpdatedAt:st,status:lt}=et;rt=et.data;let at=!1;if(o.placeholderData!==void 0&&rt===void 0&&lt==="pending"){let At;g!=null&&g.isPlaceholderData&&o.placeholderData===(_==null?void 0:_.placeholderData)?(At=g.data,at=!0):At=typeof o.placeholderData=="function"?o.placeholderData((Nt=mt(this,zr))==null?void 0:Nt.state.data,mt(this,zr)):o.placeholderData,At!==void 0&&(lt="success",rt=replaceData(g==null?void 0:g.data,At,o),nt=!0)}if(o.select&&rt!==void 0&&!at)if(g&&rt===(b==null?void 0:b.data)&&o.select===mt(this,ns))rt=mt(this,Fr);else try{Ot(this,ns,o.select),rt=o.select(rt),rt=replaceData(g==null?void 0:g.data,rt,o),Ot(this,Fr,rt),Ot(this,ur,null)}catch(At){Ot(this,ur,At)}mt(this,ur)&&(it=mt(this,ur),rt=mt(this,Fr),st=Date.now(),lt="error");const ct=et.fetchStatus==="fetching",ft=lt==="pending",vt=lt==="error",Rt=ft&&ct,_t=rt!==void 0,Ct={status:lt,fetchStatus:et.fetchStatus,isPending:ft,isSuccess:lt==="success",isError:vt,isInitialLoading:Rt,isLoading:Rt,data:rt,dataUpdatedAt:et.dataUpdatedAt,error:it,errorUpdatedAt:st,failureCount:et.fetchFailureCount,failureReason:et.fetchFailureReason,errorUpdateCount:et.errorUpdateCount,isFetched:et.dataUpdateCount>0||et.errorUpdateCount>0,isFetchedAfterMount:et.dataUpdateCount>_e.dataUpdateCount||et.errorUpdateCount>_e.errorUpdateCount,isFetching:ct,isRefetching:ct&&!ft,isLoadingError:vt&&!_t,isPaused:et.fetchStatus==="paused",isPlaceholderData:nt,isRefetchError:vt&&_t,isStale:isStale(e,o),refetch:this.refetch,promise:mt(this,Pn),isEnabled:resolveEnabled(o.enabled,e)!==!1};if(this.options.experimental_prefetchInRender){const At=ht=>{Ct.status==="error"?ht.reject(Ct.error):Ct.data!==void 0&&ht.resolve(Ct.data)},yt=()=>{const ht=Ot(this,Pn,Ct.promise=pendingThenable());At(ht)},xt=mt(this,Pn);switch(xt.status){case"pending":e.queryHash===a.queryHash&&At(xt);break;case"fulfilled":(Ct.status==="error"||Ct.data!==xt.value)&&yt();break;case"rejected":(Ct.status!=="error"||Ct.error!==xt.reason)&&yt();break}}return Ct}updateResult(){const e=mt(this,dn),o=this.createResult(mt(this,Vt),this.options);if(Ot(this,$r,mt(this,Vt).state),Ot(this,Mr,this.options),mt(this,$r).data!==void 0&&Ot(this,zr,mt(this,Vt)),shallowEqualObjects(o,e))return;Ot(this,dn,o);const a=()=>{if(!e)return!0;const{notifyOnChangeProps:c}=this.options,g=typeof c=="function"?c():c;if(g==="all"||!g&&!mt(this,Hr).size)return!0;const b=new Set(g??mt(this,Hr));return this.options.throwOnError&&b.add("error"),Object.keys(mt(this,dn)).some(_=>{const j=_;return mt(this,dn)[j]!==e[j]&&b.has(j)})};Ft(this,qt,_i).call(this,{listeners:a()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&Ft(this,qt,Es).call(this)}},pn=new WeakMap,Vt=new WeakMap,ts=new WeakMap,dn=new WeakMap,$r=new WeakMap,Mr=new WeakMap,Pn=new WeakMap,ur=new WeakMap,ns=new WeakMap,Fr=new WeakMap,zr=new WeakMap,Tr=new WeakMap,Cr=new WeakMap,cr=new WeakMap,Hr=new WeakMap,qt=new WeakSet,Jr=function(e){Ft(this,qt,Ss).call(this);let o=mt(this,Vt).fetch(this.options,e);return e!=null&&e.throwOnError||(o=o.catch(noop$1)),o},vs=function(){Ft(this,qt,bs).call(this);const e=resolveStaleTime(this.options.staleTime,mt(this,Vt));if(isServer||mt(this,dn).isStale||!isValidTimeout(e))return;const a=timeUntilStale(mt(this,dn).dataUpdatedAt,e)+1;Ot(this,Tr,timeoutManager.setTimeout(()=>{mt(this,dn).isStale||this.updateResult()},a))},ws=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(mt(this,Vt)):this.options.refetchInterval)??!1},xs=function(e){Ft(this,qt,ks).call(this),Ot(this,cr,e),!(isServer||resolveEnabled(this.options.enabled,mt(this,Vt))===!1||!isValidTimeout(mt(this,cr))||mt(this,cr)===0)&&Ot(this,Cr,timeoutManager.setInterval(()=>{(this.options.refetchIntervalInBackground||focusManager.isFocused())&&Ft(this,qt,Jr).call(this)},mt(this,cr)))},Es=function(){Ft(this,qt,vs).call(this),Ft(this,qt,xs).call(this,Ft(this,qt,ws).call(this))},bs=function(){mt(this,Tr)&&(timeoutManager.clearTimeout(mt(this,Tr)),Ot(this,Tr,void 0))},ks=function(){mt(this,Cr)&&(timeoutManager.clearInterval(mt(this,Cr)),Ot(this,Cr,void 0))},Ss=function(){const e=mt(this,pn).getQueryCache().build(mt(this,pn),this.options);if(e===mt(this,Vt))return;const o=mt(this,Vt);Ot(this,Vt,e),Ot(this,ts,e.state),this.hasListeners()&&(o==null||o.removeObserver(this),e.addObserver(this))},_i=function(e){notifyManager.batch(()=>{e.listeners&&this.listeners.forEach(o=>{o(mt(this,dn))}),mt(this,pn).getQueryCache().notify({query:mt(this,Vt),type:"observerResultsUpdated"})})},Hs);function shouldLoadOnMount(s,e){return resolveEnabled(e.enabled,s)!==!1&&s.state.data===void 0&&!(s.state.status==="error"&&e.retryOnMount===!1)}function shouldFetchOnMount(s,e){return shouldLoadOnMount(s,e)||s.state.data!==void 0&&shouldFetchOn(s,e,e.refetchOnMount)}function shouldFetchOn(s,e,o){if(resolveEnabled(e.enabled,s)!==!1&&resolveStaleTime(e.staleTime,s)!=="static"){const a=typeof o=="function"?o(s):o;return a==="always"||a!==!1&&isStale(s,e)}return!1}function shouldFetchOptionally(s,e,o,a){return(s!==e||resolveEnabled(a.enabled,s)===!1)&&(!o.suspense||s.state.status!=="error")&&isStale(s,o)}function isStale(s,e){return resolveEnabled(e.enabled,s)!==!1&&s.isStaleByTime(resolveStaleTime(e.staleTime,s))}function shouldAssignObserverCurrentProperties(s,e){return!shallowEqualObjects(s.getCurrentResult(),e)}function infiniteQueryBehavior(s){return{onFetch:(e,o)=>{var tt,et,nt,rt,it;const a=e.options,c=(nt=(et=(tt=e.fetchOptions)==null?void 0:tt.meta)==null?void 0:et.fetchMore)==null?void 0:nt.direction,g=((rt=e.state.data)==null?void 0:rt.pages)||[],b=((it=e.state.data)==null?void 0:it.pageParams)||[];let _={pages:[],pageParams:[]},j=0;const _e=async()=>{let st=!1;const lt=ft=>{Object.defineProperty(ft,"signal",{enumerable:!0,get:()=>(e.signal.aborted?st=!0:e.signal.addEventListener("abort",()=>{st=!0}),e.signal)})},at=ensureQueryFn(e.options,e.fetchOptions),ct=async(ft,vt,Rt)=>{if(st)return Promise.reject();if(vt==null&&ft.pages.length)return Promise.resolve(ft);const Tt=(()=>{const yt={client:e.client,queryKey:e.queryKey,pageParam:vt,direction:Rt?"backward":"forward",meta:e.options.meta};return lt(yt),yt})(),Ct=await at(Tt),{maxPages:Nt}=e.options,At=Rt?addToStart:addToEnd;return{pages:At(ft.pages,Ct,Nt),pageParams:At(ft.pageParams,vt,Nt)}};if(c&&g.length){const ft=c==="backward",vt=ft?getPreviousPageParam:getNextPageParam,Rt={pages:g,pageParams:b},_t=vt(a,Rt);_=await ct(Rt,_t,ft)}else{const ft=s??g.length;do{const vt=j===0?b[0]??a.initialPageParam:getNextPageParam(a,_);if(j>0&&vt==null)break;_=await ct(_,vt),j++}while(j<ft)}return _};e.options.persister?e.fetchFn=()=>{var st,lt;return(lt=(st=e.options).persister)==null?void 0:lt.call(st,_e,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},o)}:e.fetchFn=_e}}}function getNextPageParam(s,{pages:e,pageParams:o}){const a=e.length-1;return e.length>0?s.getNextPageParam(e[a],e,o[a],o):void 0}function getPreviousPageParam(s,{pages:e,pageParams:o}){var a;return e.length>0?(a=s.getPreviousPageParam)==null?void 0:a.call(s,e[0],e,o[0],o):void 0}var rs,Tn,fn,Ar,Cn,Hn,Ks,Mutation=(Ks=class extends Removable{constructor(e){super();Lt(this,Cn);Lt(this,rs);Lt(this,Tn);Lt(this,fn);Lt(this,Ar);Ot(this,rs,e.client),this.mutationId=e.mutationId,Ot(this,fn,e.mutationCache),Ot(this,Tn,[]),this.state=e.state||getDefaultState(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){mt(this,Tn).includes(e)||(mt(this,Tn).push(e),this.clearGcTimeout(),mt(this,fn).notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){Ot(this,Tn,mt(this,Tn).filter(o=>o!==e)),this.scheduleGc(),mt(this,fn).notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){mt(this,Tn).length||(this.state.status==="pending"?this.scheduleGc():mt(this,fn).remove(this))}continue(){var e;return((e=mt(this,Ar))==null?void 0:e.continue())??this.execute(this.state.variables)}async execute(e){var b,_,j,_e,tt,et,nt,rt,it,st,lt,at,ct,ft,vt,Rt,_t,Tt,Ct,Nt;const o=()=>{Ft(this,Cn,Hn).call(this,{type:"continue"})},a={client:mt(this,rs),meta:this.options.meta,mutationKey:this.options.mutationKey};Ot(this,Ar,createRetryer({fn:()=>this.options.mutationFn?this.options.mutationFn(e,a):Promise.reject(new Error("No mutationFn found")),onFail:(At,yt)=>{Ft(this,Cn,Hn).call(this,{type:"failed",failureCount:At,error:yt})},onPause:()=>{Ft(this,Cn,Hn).call(this,{type:"pause"})},onContinue:o,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>mt(this,fn).canRun(this)}));const c=this.state.status==="pending",g=!mt(this,Ar).canStart();try{if(c)o();else{Ft(this,Cn,Hn).call(this,{type:"pending",variables:e,isPaused:g}),await((_=(b=mt(this,fn).config).onMutate)==null?void 0:_.call(b,e,this,a));const yt=await((_e=(j=this.options).onMutate)==null?void 0:_e.call(j,e,a));yt!==this.state.context&&Ft(this,Cn,Hn).call(this,{type:"pending",context:yt,variables:e,isPaused:g})}const At=await mt(this,Ar).start();return await((et=(tt=mt(this,fn).config).onSuccess)==null?void 0:et.call(tt,At,e,this.state.context,this,a)),await((rt=(nt=this.options).onSuccess)==null?void 0:rt.call(nt,At,e,this.state.context,a)),await((st=(it=mt(this,fn).config).onSettled)==null?void 0:st.call(it,At,null,this.state.variables,this.state.context,this,a)),await((at=(lt=this.options).onSettled)==null?void 0:at.call(lt,At,null,e,this.state.context,a)),Ft(this,Cn,Hn).call(this,{type:"success",data:At}),At}catch(At){try{throw await((ft=(ct=mt(this,fn).config).onError)==null?void 0:ft.call(ct,At,e,this.state.context,this,a)),await((Rt=(vt=this.options).onError)==null?void 0:Rt.call(vt,At,e,this.state.context,a)),await((Tt=(_t=mt(this,fn).config).onSettled)==null?void 0:Tt.call(_t,void 0,At,this.state.variables,this.state.context,this,a)),await((Nt=(Ct=this.options).onSettled)==null?void 0:Nt.call(Ct,void 0,At,e,this.state.context,a)),At}finally{Ft(this,Cn,Hn).call(this,{type:"error",error:At})}}finally{mt(this,fn).runNext(this)}}},rs=new WeakMap,Tn=new WeakMap,fn=new WeakMap,Ar=new WeakMap,Cn=new WeakSet,Hn=function(e){const o=a=>{switch(e.type){case"failed":return{...a,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...a,isPaused:!0};case"continue":return{...a,isPaused:!1};case"pending":return{...a,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...a,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...a,data:void 0,error:e.error,failureCount:a.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=o(this.state),notifyManager.batch(()=>{mt(this,Tn).forEach(a=>{a.onMutationUpdate(e)}),mt(this,fn).notify({mutation:this,type:"updated",action:e})})},Ks);function getDefaultState(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Bn,_n,ss,Vs,MutationCache=(Vs=class extends Subscribable{constructor(e={}){super();Lt(this,Bn);Lt(this,_n);Lt(this,ss);this.config=e,Ot(this,Bn,new Set),Ot(this,_n,new Map),Ot(this,ss,0)}build(e,o,a){const c=new Mutation({client:e,mutationCache:this,mutationId:++Dr(this,ss)._,options:e.defaultMutationOptions(o),state:a});return this.add(c),c}add(e){mt(this,Bn).add(e);const o=scopeFor(e);if(typeof o=="string"){const a=mt(this,_n).get(o);a?a.push(e):mt(this,_n).set(o,[e])}this.notify({type:"added",mutation:e})}remove(e){if(mt(this,Bn).delete(e)){const o=scopeFor(e);if(typeof o=="string"){const a=mt(this,_n).get(o);if(a)if(a.length>1){const c=a.indexOf(e);c!==-1&&a.splice(c,1)}else a[0]===e&&mt(this,_n).delete(o)}}this.notify({type:"removed",mutation:e})}canRun(e){const o=scopeFor(e);if(typeof o=="string"){const a=mt(this,_n).get(o),c=a==null?void 0:a.find(g=>g.state.status==="pending");return!c||c===e}else return!0}runNext(e){var a;const o=scopeFor(e);if(typeof o=="string"){const c=(a=mt(this,_n).get(o))==null?void 0:a.find(g=>g!==e&&g.state.isPaused);return(c==null?void 0:c.continue())??Promise.resolve()}else return Promise.resolve()}clear(){notifyManager.batch(()=>{mt(this,Bn).forEach(e=>{this.notify({type:"removed",mutation:e})}),mt(this,Bn).clear(),mt(this,_n).clear()})}getAll(){return Array.from(mt(this,Bn))}find(e){const o={exact:!0,...e};return this.getAll().find(a=>matchMutation(o,a))}findAll(e={}){return this.getAll().filter(o=>matchMutation(e,o))}notify(e){notifyManager.batch(()=>{this.listeners.forEach(o=>{o(e)})})}resumePausedMutations(){const e=this.getAll().filter(o=>o.state.isPaused);return notifyManager.batch(()=>Promise.all(e.map(o=>o.continue().catch(noop$1))))}},Bn=new WeakMap,_n=new WeakMap,ss=new WeakMap,Vs);function scopeFor(s){var e;return(e=s.options.scope)==null?void 0:e.id}var Dn,dr,yn,On,In,cs,_s,qs,MutationObserver$1=(qs=class extends Subscribable{constructor(o,a){super();Lt(this,In);Lt(this,Dn);Lt(this,dr);Lt(this,yn);Lt(this,On);Ot(this,Dn,o),this.setOptions(a),this.bindMethods(),Ft(this,In,cs).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(o){var c;const a=this.options;this.options=mt(this,Dn).defaultMutationOptions(o),shallowEqualObjects(this.options,a)||mt(this,Dn).getMutationCache().notify({type:"observerOptionsUpdated",mutation:mt(this,yn),observer:this}),a!=null&&a.mutationKey&&this.options.mutationKey&&hashKey(a.mutationKey)!==hashKey(this.options.mutationKey)?this.reset():((c=mt(this,yn))==null?void 0:c.state.status)==="pending"&&mt(this,yn).setOptions(this.options)}onUnsubscribe(){var o;this.hasListeners()||(o=mt(this,yn))==null||o.removeObserver(this)}onMutationUpdate(o){Ft(this,In,cs).call(this),Ft(this,In,_s).call(this,o)}getCurrentResult(){return mt(this,dr)}reset(){var o;(o=mt(this,yn))==null||o.removeObserver(this),Ot(this,yn,void 0),Ft(this,In,cs).call(this),Ft(this,In,_s).call(this)}mutate(o,a){var c;return Ot(this,On,a),(c=mt(this,yn))==null||c.removeObserver(this),Ot(this,yn,mt(this,Dn).getMutationCache().build(mt(this,Dn),this.options)),mt(this,yn).addObserver(this),mt(this,yn).execute(o)}},Dn=new WeakMap,dr=new WeakMap,yn=new WeakMap,On=new WeakMap,In=new WeakSet,cs=function(){var a;const o=((a=mt(this,yn))==null?void 0:a.state)??getDefaultState();Ot(this,dr,{...o,isPending:o.status==="pending",isSuccess:o.status==="success",isError:o.status==="error",isIdle:o.status==="idle",mutate:this.mutate,reset:this.reset})},_s=function(o){notifyManager.batch(()=>{var a,c,g,b,_,j,_e,tt;if(mt(this,On)&&this.hasListeners()){const et=mt(this,dr).variables,nt=mt(this,dr).context,rt={client:mt(this,Dn),meta:this.options.meta,mutationKey:this.options.mutationKey};(o==null?void 0:o.type)==="success"?((c=(a=mt(this,On)).onSuccess)==null||c.call(a,o.data,et,nt,rt),(b=(g=mt(this,On)).onSettled)==null||b.call(g,o.data,null,et,nt,rt)):(o==null?void 0:o.type)==="error"&&((j=(_=mt(this,On)).onError)==null||j.call(_,o.error,et,nt,rt),(tt=(_e=mt(this,On)).onSettled)==null||tt.call(_e,void 0,o.error,et,nt,rt))}this.listeners.forEach(et=>{et(mt(this,dr))})})},qs);function difference(s,e){const o=new Set(e);return s.filter(a=>!o.has(a))}function replaceAt(s,e,o){const a=s.slice(0);return a[e]=o,a}var Kr,vn,Vr,qr,bn,fr,is,os,as,un,Rs,$s,Ts,Cs,As,Ws,QueriesObserver=(Ws=class extends Subscribable{constructor(e,o,a){super();Lt(this,un);Lt(this,Kr);Lt(this,vn);Lt(this,Vr);Lt(this,qr);Lt(this,bn);Lt(this,fr);Lt(this,is);Lt(this,os);Lt(this,as,[]);Ot(this,Kr,e),Ot(this,qr,a),Ot(this,Vr,[]),Ot(this,bn,[]),Ot(this,vn,[]),this.setQueries(o)}onSubscribe(){this.listeners.size===1&&mt(this,bn).forEach(e=>{e.subscribe(o=>{Ft(this,un,Cs).call(this,e,o)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,mt(this,bn).forEach(e=>{e.destroy()})}setQueries(e,o){Ot(this,Vr,e),Ot(this,qr,o),notifyManager.batch(()=>{const a=mt(this,bn),c=Ft(this,un,Ts).call(this,mt(this,Vr));Ot(this,as,c),c.forEach(et=>et.observer.setOptions(et.defaultedQueryOptions));const g=c.map(et=>et.observer),b=g.map(et=>et.getCurrentResult()),_=a.length!==g.length,j=g.some((et,nt)=>et!==a[nt]),_e=_||j,tt=_e?!0:b.some((et,nt)=>{const rt=mt(this,vn)[nt];return!rt||!shallowEqualObjects(et,rt)});!_e&&!tt||(_e&&Ot(this,bn,g),Ot(this,vn,b),this.hasListeners()&&(_e&&(difference(a,g).forEach(et=>{et.destroy()}),difference(g,a).forEach(et=>{et.subscribe(nt=>{Ft(this,un,Cs).call(this,et,nt)})})),Ft(this,un,As).call(this)))})}getCurrentResult(){return mt(this,vn)}getQueries(){return mt(this,bn).map(e=>e.getCurrentQuery())}getObservers(){return mt(this,bn)}getOptimisticResult(e,o){const a=Ft(this,un,Ts).call(this,e),c=a.map(g=>g.observer.getOptimisticResult(g.defaultedQueryOptions));return[c,g=>Ft(this,un,$s).call(this,g??c,o),()=>Ft(this,un,Rs).call(this,c,a)]}},Kr=new WeakMap,vn=new WeakMap,Vr=new WeakMap,qr=new WeakMap,bn=new WeakMap,fr=new WeakMap,is=new WeakMap,os=new WeakMap,as=new WeakMap,un=new WeakSet,Rs=function(e,o){return o.map((a,c)=>{const g=e[c];return a.defaultedQueryOptions.notifyOnChangeProps?g:a.observer.trackResult(g,b=>{o.forEach(_=>{_.observer.trackProp(b)})})})},$s=function(e,o){return o?((!mt(this,fr)||mt(this,vn)!==mt(this,os)||o!==mt(this,is))&&(Ot(this,is,o),Ot(this,os,mt(this,vn)),Ot(this,fr,replaceEqualDeep(mt(this,fr),o(e)))),mt(this,fr)):e},Ts=function(e){const o=new Map(mt(this,bn).map(c=>[c.options.queryHash,c])),a=[];return e.forEach(c=>{const g=mt(this,Kr).defaultQueryOptions(c),b=o.get(g.queryHash);b?a.push({defaultedQueryOptions:g,observer:b}):a.push({defaultedQueryOptions:g,observer:new QueryObserver(mt(this,Kr),g)})}),a},Cs=function(e,o){const a=mt(this,bn).indexOf(e);a!==-1&&(Ot(this,vn,replaceAt(mt(this,vn),a,o)),Ft(this,un,As).call(this))},As=function(){var e;if(this.hasListeners()){const o=mt(this,fr),a=Ft(this,un,Rs).call(this,mt(this,vn),mt(this,as)),c=Ft(this,un,$s).call(this,a,(e=mt(this,qr))==null?void 0:e.combine);o!==c&&notifyManager.batch(()=>{this.listeners.forEach(g=>{g(mt(this,vn))})})}},Ws),An,Qs,QueryCache=(Qs=class extends Subscribable{constructor(e={}){super();Lt(this,An);this.config=e,Ot(this,An,new Map)}build(e,o,a){const c=o.queryKey,g=o.queryHash??hashQueryKeyByOptions(c,o);let b=this.get(g);return b||(b=new Query({client:e,queryKey:c,queryHash:g,options:e.defaultQueryOptions(o),state:a,defaultOptions:e.getQueryDefaults(c)}),this.add(b)),b}add(e){mt(this,An).has(e.queryHash)||(mt(this,An).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const o=mt(this,An).get(e.queryHash);o&&(e.destroy(),o===e&&mt(this,An).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){notifyManager.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return mt(this,An).get(e)}getAll(){return[...mt(this,An).values()]}find(e){const o={exact:!0,...e};return this.getAll().find(a=>matchQuery(o,a))}findAll(e={}){const o=this.getAll();return Object.keys(e).length>0?o.filter(a=>matchQuery(e,a)):o}notify(e){notifyManager.batch(()=>{this.listeners.forEach(o=>{o(e)})})}onFocus(){notifyManager.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){notifyManager.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},An=new WeakMap,Qs),Jt,hr,pr,Wr,Qr,yr,Gr,Zr,Gs,QueryClient=(Gs=class{constructor(s={}){Lt(this,Jt);Lt(this,hr);Lt(this,pr);Lt(this,Wr);Lt(this,Qr);Lt(this,yr);Lt(this,Gr);Lt(this,Zr);Ot(this,Jt,s.queryCache||new QueryCache),Ot(this,hr,s.mutationCache||new MutationCache),Ot(this,pr,s.defaultOptions||{}),Ot(this,Wr,new Map),Ot(this,Qr,new Map),Ot(this,yr,0)}mount(){Dr(this,yr)._++,mt(this,yr)===1&&(Ot(this,Gr,focusManager.subscribe(async s=>{s&&(await this.resumePausedMutations(),mt(this,Jt).onFocus())})),Ot(this,Zr,onlineManager.subscribe(async s=>{s&&(await this.resumePausedMutations(),mt(this,Jt).onOnline())})))}unmount(){var s,e;Dr(this,yr)._--,mt(this,yr)===0&&((s=mt(this,Gr))==null||s.call(this),Ot(this,Gr,void 0),(e=mt(this,Zr))==null||e.call(this),Ot(this,Zr,void 0))}isFetching(s){return mt(this,Jt).findAll({...s,fetchStatus:"fetching"}).length}isMutating(s){return mt(this,hr).findAll({...s,status:"pending"}).length}getQueryData(s){var o;const e=this.defaultQueryOptions({queryKey:s});return(o=mt(this,Jt).get(e.queryHash))==null?void 0:o.state.data}ensureQueryData(s){const e=this.defaultQueryOptions(s),o=mt(this,Jt).build(this,e),a=o.state.data;return a===void 0?this.fetchQuery(s):(s.revalidateIfStale&&o.isStaleByTime(resolveStaleTime(e.staleTime,o))&&this.prefetchQuery(e),Promise.resolve(a))}getQueriesData(s){return mt(this,Jt).findAll(s).map(({queryKey:e,state:o})=>{const a=o.data;return[e,a]})}setQueryData(s,e,o){const a=this.defaultQueryOptions({queryKey:s}),c=mt(this,Jt).get(a.queryHash),g=c==null?void 0:c.state.data,b=functionalUpdate(e,g);if(b!==void 0)return mt(this,Jt).build(this,a).setData(b,{...o,manual:!0})}setQueriesData(s,e,o){return notifyManager.batch(()=>mt(this,Jt).findAll(s).map(({queryKey:a})=>[a,this.setQueryData(a,e,o)]))}getQueryState(s){var o;const e=this.defaultQueryOptions({queryKey:s});return(o=mt(this,Jt).get(e.queryHash))==null?void 0:o.state}removeQueries(s){const e=mt(this,Jt);notifyManager.batch(()=>{e.findAll(s).forEach(o=>{e.remove(o)})})}resetQueries(s,e){const o=mt(this,Jt);return notifyManager.batch(()=>(o.findAll(s).forEach(a=>{a.reset()}),this.refetchQueries({type:"active",...s},e)))}cancelQueries(s,e={}){const o={revert:!0,...e},a=notifyManager.batch(()=>mt(this,Jt).findAll(s).map(c=>c.cancel(o)));return Promise.all(a).then(noop$1).catch(noop$1)}invalidateQueries(s,e={}){return notifyManager.batch(()=>(mt(this,Jt).findAll(s).forEach(o=>{o.invalidate()}),(s==null?void 0:s.refetchType)==="none"?Promise.resolve():this.refetchQueries({...s,type:(s==null?void 0:s.refetchType)??(s==null?void 0:s.type)??"active"},e)))}refetchQueries(s,e={}){const o={...e,cancelRefetch:e.cancelRefetch??!0},a=notifyManager.batch(()=>mt(this,Jt).findAll(s).filter(c=>!c.isDisabled()&&!c.isStatic()).map(c=>{let g=c.fetch(void 0,o);return o.throwOnError||(g=g.catch(noop$1)),c.state.fetchStatus==="paused"?Promise.resolve():g}));return Promise.all(a).then(noop$1)}fetchQuery(s){const e=this.defaultQueryOptions(s);e.retry===void 0&&(e.retry=!1);const o=mt(this,Jt).build(this,e);return o.isStaleByTime(resolveStaleTime(e.staleTime,o))?o.fetch(e):Promise.resolve(o.state.data)}prefetchQuery(s){return this.fetchQuery(s).then(noop$1).catch(noop$1)}fetchInfiniteQuery(s){return s.behavior=infiniteQueryBehavior(s.pages),this.fetchQuery(s)}prefetchInfiniteQuery(s){return this.fetchInfiniteQuery(s).then(noop$1).catch(noop$1)}ensureInfiniteQueryData(s){return s.behavior=infiniteQueryBehavior(s.pages),this.ensureQueryData(s)}resumePausedMutations(){return onlineManager.isOnline()?mt(this,hr).resumePausedMutations():Promise.resolve()}getQueryCache(){return mt(this,Jt)}getMutationCache(){return mt(this,hr)}getDefaultOptions(){return mt(this,pr)}setDefaultOptions(s){Ot(this,pr,s)}setQueryDefaults(s,e){mt(this,Wr).set(hashKey(s),{queryKey:s,defaultOptions:e})}getQueryDefaults(s){const e=[...mt(this,Wr).values()],o={};return e.forEach(a=>{partialMatchKey(s,a.queryKey)&&Object.assign(o,a.defaultOptions)}),o}setMutationDefaults(s,e){mt(this,Qr).set(hashKey(s),{mutationKey:s,defaultOptions:e})}getMutationDefaults(s){const e=[...mt(this,Qr).values()],o={};return e.forEach(a=>{partialMatchKey(s,a.mutationKey)&&Object.assign(o,a.defaultOptions)}),o}defaultQueryOptions(s){if(s._defaulted)return s;const e={...mt(this,pr).queries,...this.getQueryDefaults(s.queryKey),...s,_defaulted:!0};return e.queryHash||(e.queryHash=hashQueryKeyByOptions(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===skipToken&&(e.enabled=!1),e}defaultMutationOptions(s){return s!=null&&s._defaulted?s:{...mt(this,pr).mutations,...(s==null?void 0:s.mutationKey)&&this.getMutationDefaults(s.mutationKey),...s,_defaulted:!0}}clear(){mt(this,Jt).clear(),mt(this,hr).clear()}},Jt=new WeakMap,hr=new WeakMap,pr=new WeakMap,Wr=new WeakMap,Qr=new WeakMap,yr=new WeakMap,Gr=new WeakMap,Zr=new WeakMap,Gs),QueryClientContext=reactExports.createContext(void 0),useQueryClient=s=>{const e=reactExports.useContext(QueryClientContext);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},QueryClientProvider=({client:s,children:e})=>(reactExports.useEffect(()=>(s.mount(),()=>{s.unmount()}),[s]),jsxRuntimeExports.jsx(QueryClientContext.Provider,{value:s,children:e})),IsRestoringContext=reactExports.createContext(!1),useIsRestoring=()=>reactExports.useContext(IsRestoringContext);IsRestoringContext.Provider;function createValue(){let s=!1;return{clearReset:()=>{s=!1},reset:()=>{s=!0},isReset:()=>s}}var QueryErrorResetBoundaryContext=reactExports.createContext(createValue()),useQueryErrorResetBoundary=()=>reactExports.useContext(QueryErrorResetBoundaryContext),ensurePreventErrorBoundaryRetry=(s,e)=>{(s.suspense||s.throwOnError||s.experimental_prefetchInRender)&&(e.isReset()||(s.retryOnMount=!1))},useClearResetErrorBoundary=s=>{reactExports.useEffect(()=>{s.clearReset()},[s])},getHasError=({result:s,errorResetBoundary:e,throwOnError:o,query:a,suspense:c})=>s.isError&&!e.isReset()&&!s.isFetching&&a&&(c&&s.data===void 0||shouldThrowError(o,[s.error,a])),ensureSuspenseTimers=s=>{if(s.suspense){const o=c=>c==="static"?c:Math.max(c??1e3,1e3),a=s.staleTime;s.staleTime=typeof a=="function"?(...c)=>o(a(...c)):o(a),typeof s.gcTime=="number"&&(s.gcTime=Math.max(s.gcTime,1e3))}},willFetch=(s,e)=>s.isLoading&&s.isFetching&&!e,shouldSuspend=(s,e)=>(s==null?void 0:s.suspense)&&e.isPending,fetchOptimistic=(s,e,o)=>e.fetchOptimistic(s).catch(()=>{o.clearReset()});function useQueries({queries:s,...e},o){const a=useQueryClient(),c=useIsRestoring(),g=useQueryErrorResetBoundary(),b=reactExports.useMemo(()=>s.map(st=>{const lt=a.defaultQueryOptions(st);return lt._optimisticResults=c?"isRestoring":"optimistic",lt}),[s,a,c]);b.forEach(st=>{ensureSuspenseTimers(st),ensurePreventErrorBoundaryRetry(st,g)}),useClearResetErrorBoundary(g);const[_]=reactExports.useState(()=>new QueriesObserver(a,b,e)),[j,_e,tt]=_.getOptimisticResult(b,e.combine),et=!c&&e.subscribed!==!1;reactExports.useSyncExternalStore(reactExports.useCallback(st=>et?_.subscribe(notifyManager.batchCalls(st)):noop$1,[_,et]),()=>_.getCurrentResult(),()=>_.getCurrentResult()),reactExports.useEffect(()=>{_.setQueries(b,e)},[b,e,_]);const rt=j.some((st,lt)=>shouldSuspend(b[lt],st))?j.flatMap((st,lt)=>{const at=b[lt];if(at){const ct=new QueryObserver(a,at);if(shouldSuspend(at,st))return fetchOptimistic(at,ct,g);willFetch(st,c)&&fetchOptimistic(at,ct,g)}return[]}):[];if(rt.length>0)throw Promise.all(rt);const it=j.find((st,lt)=>{const at=b[lt];return at&&getHasError({result:st,errorResetBoundary:g,throwOnError:at.throwOnError,query:a.getQueryCache().get(at.queryHash),suspense:at.suspense})});if(it!=null&&it.error)throw it.error;return _e(tt())}function useBaseQuery(s,e,o){var et,nt,rt,it,st;const a=useIsRestoring(),c=useQueryErrorResetBoundary(),g=useQueryClient(),b=g.defaultQueryOptions(s);(nt=(et=g.getDefaultOptions().queries)==null?void 0:et._experimental_beforeQuery)==null||nt.call(et,b),b._optimisticResults=a?"isRestoring":"optimistic",ensureSuspenseTimers(b),ensurePreventErrorBoundaryRetry(b,c),useClearResetErrorBoundary(c);const _=!g.getQueryCache().get(b.queryHash),[j]=reactExports.useState(()=>new e(g,b)),_e=j.getOptimisticResult(b),tt=!a&&s.subscribed!==!1;if(reactExports.useSyncExternalStore(reactExports.useCallback(lt=>{const at=tt?j.subscribe(notifyManager.batchCalls(lt)):noop$1;return j.updateResult(),at},[j,tt]),()=>j.getCurrentResult(),()=>j.getCurrentResult()),reactExports.useEffect(()=>{j.setOptions(b)},[b,j]),shouldSuspend(b,_e))throw fetchOptimistic(b,j,c);if(getHasError({result:_e,errorResetBoundary:c,throwOnError:b.throwOnError,query:g.getQueryCache().get(b.queryHash),suspense:b.suspense}))throw _e.error;if((it=(rt=g.getDefaultOptions().queries)==null?void 0:rt._experimental_afterQuery)==null||it.call(rt,b,_e),b.experimental_prefetchInRender&&!isServer&&willFetch(_e,a)){const lt=_?fetchOptimistic(b,j,c):(st=g.getQueryCache().get(b.queryHash))==null?void 0:st.promise;lt==null||lt.catch(noop$1).finally(()=>{j.updateResult()})}return b.notifyOnChangeProps?_e:j.trackResult(_e)}function useQuery(s,e){return useBaseQuery(s,QueryObserver)}function useMutation(s,e){const o=useQueryClient(),[a]=reactExports.useState(()=>new MutationObserver$1(o,s));reactExports.useEffect(()=>{a.setOptions(s)},[a,s]);const c=reactExports.useSyncExternalStore(reactExports.useCallback(b=>a.subscribe(notifyManager.batchCalls(b)),[a]),()=>a.getCurrentResult(),()=>a.getCurrentResult()),g=reactExports.useCallback((b,_)=>{a.mutate(b,_).catch(noop$1)},[a]);if(c.error&&shouldThrowError(a.options.throwOnError,[c.error]))throw c.error;return{...c,mutate:g,mutateAsync:c.mutate}}var browserPonyfill={exports:{}};(function(s,e){var o=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof commonjsGlobal<"u"&&commonjsGlobal,a=function(){function g(){this.fetch=!1,this.DOMException=o.DOMException}return g.prototype=o,new g}();(function(g){(function(b){var _=typeof g<"u"&&g||typeof self<"u"&&self||typeof commonjsGlobal<"u"&&commonjsGlobal||{},j={searchParams:"URLSearchParams"in _,iterable:"Symbol"in _&&"iterator"in Symbol,blob:"FileReader"in _&&"Blob"in _&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in _,arrayBuffer:"ArrayBuffer"in _};function _e(ot){return ot&&DataView.prototype.isPrototypeOf(ot)}if(j.arrayBuffer)var tt=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],et=ArrayBuffer.isView||function(ot){return ot&&tt.indexOf(Object.prototype.toString.call(ot))>-1};function nt(ot){if(typeof ot!="string"&&(ot=String(ot)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(ot)||ot==="")throw new TypeError('Invalid character in header field name: "'+ot+'"');return ot.toLowerCase()}function rt(ot){return typeof ot!="string"&&(ot=String(ot)),ot}function it(ot){var dt={next:function(){var bt=ot.shift();return{done:bt===void 0,value:bt}}};return j.iterable&&(dt[Symbol.iterator]=function(){return dt}),dt}function st(ot){this.map={},ot instanceof st?ot.forEach(function(dt,bt){this.append(bt,dt)},this):Array.isArray(ot)?ot.forEach(function(dt){if(dt.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+dt.length);this.append(dt[0],dt[1])},this):ot&&Object.getOwnPropertyNames(ot).forEach(function(dt){this.append(dt,ot[dt])},this)}st.prototype.append=function(ot,dt){ot=nt(ot),dt=rt(dt);var bt=this.map[ot];this.map[ot]=bt?bt+", "+dt:dt},st.prototype.delete=function(ot){delete this.map[nt(ot)]},st.prototype.get=function(ot){return ot=nt(ot),this.has(ot)?this.map[ot]:null},st.prototype.has=function(ot){return this.map.hasOwnProperty(nt(ot))},st.prototype.set=function(ot,dt){this.map[nt(ot)]=rt(dt)},st.prototype.forEach=function(ot,dt){for(var bt in this.map)this.map.hasOwnProperty(bt)&&ot.call(dt,this.map[bt],bt,this)},st.prototype.keys=function(){var ot=[];return this.forEach(function(dt,bt){ot.push(bt)}),it(ot)},st.prototype.values=function(){var ot=[];return this.forEach(function(dt){ot.push(dt)}),it(ot)},st.prototype.entries=function(){var ot=[];return this.forEach(function(dt,bt){ot.push([bt,dt])}),it(ot)},j.iterable&&(st.prototype[Symbol.iterator]=st.prototype.entries);function lt(ot){if(!ot._noBody){if(ot.bodyUsed)return Promise.reject(new TypeError("Already read"));ot.bodyUsed=!0}}function at(ot){return new Promise(function(dt,bt){ot.onload=function(){dt(ot.result)},ot.onerror=function(){bt(ot.error)}})}function ct(ot){var dt=new FileReader,bt=at(dt);return dt.readAsArrayBuffer(ot),bt}function ft(ot){var dt=new FileReader,bt=at(dt),wt=/charset=([A-Za-z0-9_-]+)/.exec(ot.type),St=wt?wt[1]:"utf-8";return dt.readAsText(ot,St),bt}function vt(ot){for(var dt=new Uint8Array(ot),bt=new Array(dt.length),wt=0;wt<dt.length;wt++)bt[wt]=String.fromCharCode(dt[wt]);return bt.join("")}function Rt(ot){if(ot.slice)return ot.slice(0);var dt=new Uint8Array(ot.byteLength);return dt.set(new Uint8Array(ot)),dt.buffer}function _t(){return this.bodyUsed=!1,this._initBody=function(ot){this.bodyUsed=this.bodyUsed,this._bodyInit=ot,ot?typeof ot=="string"?this._bodyText=ot:j.blob&&Blob.prototype.isPrototypeOf(ot)?this._bodyBlob=ot:j.formData&&FormData.prototype.isPrototypeOf(ot)?this._bodyFormData=ot:j.searchParams&&URLSearchParams.prototype.isPrototypeOf(ot)?this._bodyText=ot.toString():j.arrayBuffer&&j.blob&&_e(ot)?(this._bodyArrayBuffer=Rt(ot.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):j.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(ot)||et(ot))?this._bodyArrayBuffer=Rt(ot):this._bodyText=ot=Object.prototype.toString.call(ot):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof ot=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):j.searchParams&&URLSearchParams.prototype.isPrototypeOf(ot)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},j.blob&&(this.blob=function(){var ot=lt(this);if(ot)return ot;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var ot=lt(this);return ot||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(j.blob)return this.blob().then(ct);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var ot=lt(this);if(ot)return ot;if(this._bodyBlob)return ft(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(vt(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},j.formData&&(this.formData=function(){return this.text().then(At)}),this.json=function(){return this.text().then(JSON.parse)},this}var Tt=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function Ct(ot){var dt=ot.toUpperCase();return Tt.indexOf(dt)>-1?dt:ot}function Nt(ot,dt){if(!(this instanceof Nt))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');dt=dt||{};var bt=dt.body;if(ot instanceof Nt){if(ot.bodyUsed)throw new TypeError("Already read");this.url=ot.url,this.credentials=ot.credentials,dt.headers||(this.headers=new st(ot.headers)),this.method=ot.method,this.mode=ot.mode,this.signal=ot.signal,!bt&&ot._bodyInit!=null&&(bt=ot._bodyInit,ot.bodyUsed=!0)}else this.url=String(ot);if(this.credentials=dt.credentials||this.credentials||"same-origin",(dt.headers||!this.headers)&&(this.headers=new st(dt.headers)),this.method=Ct(dt.method||this.method||"GET"),this.mode=dt.mode||this.mode||null,this.signal=dt.signal||this.signal||function(){if("AbortController"in _){var gt=new AbortController;return gt.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&bt)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(bt),(this.method==="GET"||this.method==="HEAD")&&(dt.cache==="no-store"||dt.cache==="no-cache")){var wt=/([?&])_=[^&]*/;if(wt.test(this.url))this.url=this.url.replace(wt,"$1_="+new Date().getTime());else{var St=/\?/;this.url+=(St.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}Nt.prototype.clone=function(){return new Nt(this,{body:this._bodyInit})};function At(ot){var dt=new FormData;return ot.trim().split("&").forEach(function(bt){if(bt){var wt=bt.split("="),St=wt.shift().replace(/\+/g," "),gt=wt.join("=").replace(/\+/g," ");dt.append(decodeURIComponent(St),decodeURIComponent(gt))}}),dt}function yt(ot){var dt=new st,bt=ot.replace(/\r?\n[\t ]+/g," ");return bt.split("\r").map(function(wt){return wt.indexOf(`
`)===0?wt.substr(1,wt.length):wt}).forEach(function(wt){var St=wt.split(":"),gt=St.shift().trim();if(gt){var $t=St.join(":").trim();try{dt.append(gt,$t)}catch(kt){console.warn("Response "+kt.message)}}}),dt}_t.call(Nt.prototype);function xt(ot,dt){if(!(this instanceof xt))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(dt||(dt={}),this.type="default",this.status=dt.status===void 0?200:dt.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=dt.statusText===void 0?"":""+dt.statusText,this.headers=new st(dt.headers),this.url=dt.url||"",this._initBody(ot)}_t.call(xt.prototype),xt.prototype.clone=function(){return new xt(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new st(this.headers),url:this.url})},xt.error=function(){var ot=new xt(null,{status:200,statusText:""});return ot.ok=!1,ot.status=0,ot.type="error",ot};var ht=[301,302,303,307,308];xt.redirect=function(ot,dt){if(ht.indexOf(dt)===-1)throw new RangeError("Invalid status code");return new xt(null,{status:dt,headers:{location:ot}})},b.DOMException=_.DOMException;try{new b.DOMException}catch{b.DOMException=function(dt,bt){this.message=dt,this.name=bt;var wt=Error(dt);this.stack=wt.stack},b.DOMException.prototype=Object.create(Error.prototype),b.DOMException.prototype.constructor=b.DOMException}function Et(ot,dt){return new Promise(function(bt,wt){var St=new Nt(ot,dt);if(St.signal&&St.signal.aborted)return wt(new b.DOMException("Aborted","AbortError"));var gt=new XMLHttpRequest;function $t(){gt.abort()}gt.onload=function(){var jt={statusText:gt.statusText,headers:yt(gt.getAllResponseHeaders()||"")};St.url.indexOf("file://")===0&&(gt.status<200||gt.status>599)?jt.status=200:jt.status=gt.status,jt.url="responseURL"in gt?gt.responseURL:jt.headers.get("X-Request-URL");var Dt="response"in gt?gt.response:gt.responseText;setTimeout(function(){bt(new xt(Dt,jt))},0)},gt.onerror=function(){setTimeout(function(){wt(new TypeError("Network request failed"))},0)},gt.ontimeout=function(){setTimeout(function(){wt(new TypeError("Network request timed out"))},0)},gt.onabort=function(){setTimeout(function(){wt(new b.DOMException("Aborted","AbortError"))},0)};function kt(jt){try{return jt===""&&_.location.href?_.location.href:jt}catch{return jt}}if(gt.open(St.method,kt(St.url),!0),St.credentials==="include"?gt.withCredentials=!0:St.credentials==="omit"&&(gt.withCredentials=!1),"responseType"in gt&&(j.blob?gt.responseType="blob":j.arrayBuffer&&(gt.responseType="arraybuffer")),dt&&typeof dt.headers=="object"&&!(dt.headers instanceof st||_.Headers&&dt.headers instanceof _.Headers)){var Pt=[];Object.getOwnPropertyNames(dt.headers).forEach(function(jt){Pt.push(nt(jt)),gt.setRequestHeader(jt,rt(dt.headers[jt]))}),St.headers.forEach(function(jt,Dt){Pt.indexOf(Dt)===-1&&gt.setRequestHeader(Dt,jt)})}else St.headers.forEach(function(jt,Dt){gt.setRequestHeader(Dt,jt)});St.signal&&(St.signal.addEventListener("abort",$t),gt.onreadystatechange=function(){gt.readyState===4&&St.signal.removeEventListener("abort",$t)}),gt.send(typeof St._bodyInit>"u"?null:St._bodyInit)})}return Et.polyfill=!0,_.fetch||(_.fetch=Et,_.Headers=st,_.Request=Nt,_.Response=xt),b.Headers=st,b.Request=Nt,b.Response=xt,b.fetch=Et,b})({})})(a),a.fetch.ponyfill=!0,delete a.fetch.polyfill;var c=o.fetch?o:a;e=c.fetch,e.default=c.fetch,e.fetch=c.fetch,e.Headers=c.Headers,e.Request=c.Request,e.Response=c.Response,s.exports=e})(browserPonyfill,browserPonyfill.exports);const USER_BLOSSOM_SERVER_LIST_KIND=10063,DEFAULT_SERVERS=[{name:"Satellite Earth",url:"https://cdn.satellite.earth",type:"blossom",requiresAuth:!0,sync:!1}];function parseServerTags(s){const e=new Set,o=[];for(const a of s.tags){if(a[0]!=="server")continue;const c=(a[1]||"").trim();if(!c)continue;const g=c.replace(/\/$/,"");if(e.has(g))continue;e.add(g);const b=a[2]||"blossom",_=a[3]||"",j=a[4],_e=_.includes("auth"),tt=_.includes("sync"),et=g.replace(/^https?:\/\//,"");o.push({url:g,name:et,type:b==="nip96"?"nip96":"blossom",requiresAuth:_e,note:j,sync:tt})}return o}const useServers=()=>{const{ndk:s}=useNdk(),e=useCurrentPubkey(),o=useQueryClient(),a=useQuery({queryKey:["servers",e],enabled:!!e,staleTime:1e3*60,queryFn:async()=>{if(!s||!e)return DEFAULT_SERVERS;const _e=await s.fetchEvents({authors:[e],kinds:[USER_BLOSSOM_SERVER_LIST_KIND]});if(_e.size===0)return DEFAULT_SERVERS;const tt=Array.from(_e).sort((nt,rt)=>(rt.created_at||0)-(nt.created_at||0))[0];if(!tt)return DEFAULT_SERVERS;const et=parseServerTags(tt);return et.length?et:DEFAULT_SERVERS},initialData:DEFAULT_SERVERS}),c=useMutation({mutationFn:async _e=>{if(!s||!e||!s.signer)throw new Error("Connect your Nostr signer first.");const tt=new NDKEvent(s);return tt.kind=USER_BLOSSOM_SERVER_LIST_KIND,tt.created_at=Math.floor(Date.now()/1e3),tt.pubkey=e,tt.content="",tt.tags=_e.map(et=>{const nt=[];et.requiresAuth&&nt.push("auth"),et.sync&&nt.push("sync");const rt=nt.join(",");return["server",et.url,et.type,rt,et.note||""]}),await tt.sign(),await tt.publish(),_e},onSuccess:(_e,tt)=>{o.setQueryData(["servers",e],tt)}}),{mutateAsync:g,isPending:b}=c,_=reactExports.useCallback(async _e=>{if(b)throw new Error("Server list update already in progress.");return g(_e)},[b,g]);return{servers:reactExports.useMemo(()=>a.data??DEFAULT_SERVERS,[a.data]),isLoading:a.isLoading,saveServers:_,saving:b,error:a.error||c.error}};function bind(s,e){return function(){return s.apply(e,arguments)}}const{toString}=Object.prototype,{getPrototypeOf}=Object,{iterator,toStringTag}=Symbol,kindOf=(s=>e=>{const o=toString.call(e);return s[o]||(s[o]=o.slice(8,-1).toLowerCase())})(Object.create(null)),kindOfTest=s=>(s=s.toLowerCase(),e=>kindOf(e)===s),typeOfTest=s=>e=>typeof e===s,{isArray}=Array,isUndefined=typeOfTest("undefined");function isBuffer(s){return s!==null&&!isUndefined(s)&&s.constructor!==null&&!isUndefined(s.constructor)&&isFunction$1(s.constructor.isBuffer)&&s.constructor.isBuffer(s)}const isArrayBuffer=kindOfTest("ArrayBuffer");function isArrayBufferView(s){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(s):e=s&&s.buffer&&isArrayBuffer(s.buffer),e}const isString=typeOfTest("string"),isFunction$1=typeOfTest("function"),isNumber=typeOfTest("number"),isObject=s=>s!==null&&typeof s=="object",isBoolean=s=>s===!0||s===!1,isPlainObject=s=>{if(kindOf(s)!=="object")return!1;const e=getPrototypeOf(s);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(toStringTag in s)&&!(iterator in s)},isEmptyObject=s=>{if(!isObject(s)||isBuffer(s))return!1;try{return Object.keys(s).length===0&&Object.getPrototypeOf(s)===Object.prototype}catch{return!1}},isDate=kindOfTest("Date"),isFile=kindOfTest("File"),isBlob=kindOfTest("Blob"),isFileList=kindOfTest("FileList"),isStream=s=>isObject(s)&&isFunction$1(s.pipe),isFormData=s=>{let e;return s&&(typeof FormData=="function"&&s instanceof FormData||isFunction$1(s.append)&&((e=kindOf(s))==="formdata"||e==="object"&&isFunction$1(s.toString)&&s.toString()==="[object FormData]"))},isURLSearchParams=kindOfTest("URLSearchParams"),[isReadableStream,isRequest,isResponse,isHeaders]=["ReadableStream","Request","Response","Headers"].map(kindOfTest),trim=s=>s.trim?s.trim():s.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function forEach(s,e,{allOwnKeys:o=!1}={}){if(s===null||typeof s>"u")return;let a,c;if(typeof s!="object"&&(s=[s]),isArray(s))for(a=0,c=s.length;a<c;a++)e.call(null,s[a],a,s);else{if(isBuffer(s))return;const g=o?Object.getOwnPropertyNames(s):Object.keys(s),b=g.length;let _;for(a=0;a<b;a++)_=g[a],e.call(null,s[_],_,s)}}function findKey(s,e){if(isBuffer(s))return null;e=e.toLowerCase();const o=Object.keys(s);let a=o.length,c;for(;a-- >0;)if(c=o[a],e===c.toLowerCase())return c;return null}const _global=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,isContextDefined=s=>!isUndefined(s)&&s!==_global;function merge(){const{caseless:s,skipUndefined:e}=isContextDefined(this)&&this||{},o={},a=(c,g)=>{const b=s&&findKey(o,g)||g;isPlainObject(o[b])&&isPlainObject(c)?o[b]=merge(o[b],c):isPlainObject(c)?o[b]=merge({},c):isArray(c)?o[b]=c.slice():(!e||!isUndefined(c))&&(o[b]=c)};for(let c=0,g=arguments.length;c<g;c++)arguments[c]&&forEach(arguments[c],a);return o}const extend=(s,e,o,{allOwnKeys:a}={})=>(forEach(e,(c,g)=>{o&&isFunction$1(c)?s[g]=bind(c,o):s[g]=c},{allOwnKeys:a}),s),stripBOM=s=>(s.charCodeAt(0)===65279&&(s=s.slice(1)),s),inherits=(s,e,o,a)=>{s.prototype=Object.create(e.prototype,a),s.prototype.constructor=s,Object.defineProperty(s,"super",{value:e.prototype}),o&&Object.assign(s.prototype,o)},toFlatObject=(s,e,o,a)=>{let c,g,b;const _={};if(e=e||{},s==null)return e;do{for(c=Object.getOwnPropertyNames(s),g=c.length;g-- >0;)b=c[g],(!a||a(b,s,e))&&!_[b]&&(e[b]=s[b],_[b]=!0);s=o!==!1&&getPrototypeOf(s)}while(s&&(!o||o(s,e))&&s!==Object.prototype);return e},endsWith=(s,e,o)=>{s=String(s),(o===void 0||o>s.length)&&(o=s.length),o-=e.length;const a=s.indexOf(e,o);return a!==-1&&a===o},toArray=s=>{if(!s)return null;if(isArray(s))return s;let e=s.length;if(!isNumber(e))return null;const o=new Array(e);for(;e-- >0;)o[e]=s[e];return o},isTypedArray=(s=>e=>s&&e instanceof s)(typeof Uint8Array<"u"&&getPrototypeOf(Uint8Array)),forEachEntry=(s,e)=>{const a=(s&&s[iterator]).call(s);let c;for(;(c=a.next())&&!c.done;){const g=c.value;e.call(s,g[0],g[1])}},matchAll=(s,e)=>{let o;const a=[];for(;(o=s.exec(e))!==null;)a.push(o);return a},isHTMLForm=kindOfTest("HTMLFormElement"),toCamelCase=s=>s.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(o,a,c){return a.toUpperCase()+c}),hasOwnProperty=(({hasOwnProperty:s})=>(e,o)=>s.call(e,o))(Object.prototype),isRegExp=kindOfTest("RegExp"),reduceDescriptors=(s,e)=>{const o=Object.getOwnPropertyDescriptors(s),a={};forEach(o,(c,g)=>{let b;(b=e(c,g,s))!==!1&&(a[g]=b||c)}),Object.defineProperties(s,a)},freezeMethods=s=>{reduceDescriptors(s,(e,o)=>{if(isFunction$1(s)&&["arguments","caller","callee"].indexOf(o)!==-1)return!1;const a=s[o];if(isFunction$1(a)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+o+"'")})}})},toObjectSet=(s,e)=>{const o={},a=c=>{c.forEach(g=>{o[g]=!0})};return isArray(s)?a(s):a(String(s).split(e)),o},noop=()=>{},toFiniteNumber=(s,e)=>s!=null&&Number.isFinite(s=+s)?s:e;function isSpecCompliantForm(s){return!!(s&&isFunction$1(s.append)&&s[toStringTag]==="FormData"&&s[iterator])}const toJSONObject=s=>{const e=new Array(10),o=(a,c)=>{if(isObject(a)){if(e.indexOf(a)>=0)return;if(isBuffer(a))return a;if(!("toJSON"in a)){e[c]=a;const g=isArray(a)?[]:{};return forEach(a,(b,_)=>{const j=o(b,c+1);!isUndefined(j)&&(g[_]=j)}),e[c]=void 0,g}}return a};return o(s,0)},isAsyncFn=kindOfTest("AsyncFunction"),isThenable=s=>s&&(isObject(s)||isFunction$1(s))&&isFunction$1(s.then)&&isFunction$1(s.catch),_setImmediate=((s,e)=>s?setImmediate:e?((o,a)=>(_global.addEventListener("message",({source:c,data:g})=>{c===_global&&g===o&&a.length&&a.shift()()},!1),c=>{a.push(c),_global.postMessage(o,"*")}))(`axios@${Math.random()}`,[]):o=>setTimeout(o))(typeof setImmediate=="function",isFunction$1(_global.postMessage)),asap=typeof queueMicrotask<"u"?queueMicrotask.bind(_global):typeof process<"u"&&process.nextTick||_setImmediate,isIterable=s=>s!=null&&isFunction$1(s[iterator]),utils$1={isArray,isArrayBuffer,isBuffer,isFormData,isArrayBufferView,isString,isNumber,isBoolean,isObject,isPlainObject,isEmptyObject,isReadableStream,isRequest,isResponse,isHeaders,isUndefined,isDate,isFile,isBlob,isRegExp,isFunction:isFunction$1,isStream,isURLSearchParams,isTypedArray,isFileList,forEach,merge,extend,trim,stripBOM,inherits,toFlatObject,kindOf,kindOfTest,endsWith,toArray,forEachEntry,matchAll,isHTMLForm,hasOwnProperty,hasOwnProp:hasOwnProperty,reduceDescriptors,freezeMethods,toObjectSet,toCamelCase,noop,toFiniteNumber,findKey,global:_global,isContextDefined,isSpecCompliantForm,toJSONObject,isAsyncFn,isThenable,setImmediate:_setImmediate,asap,isIterable};function AxiosError$1(s,e,o,a,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=s,this.name="AxiosError",e&&(this.code=e),o&&(this.config=o),a&&(this.request=a),c&&(this.response=c,this.status=c.status?c.status:null)}utils$1.inherits(AxiosError$1,Error,{toJSON:function s(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:utils$1.toJSONObject(this.config),code:this.code,status:this.status}}});const prototype$1=AxiosError$1.prototype,descriptors={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(s=>{descriptors[s]={value:s}});Object.defineProperties(AxiosError$1,descriptors);Object.defineProperty(prototype$1,"isAxiosError",{value:!0});AxiosError$1.from=(s,e,o,a,c,g)=>{const b=Object.create(prototype$1);utils$1.toFlatObject(s,b,function(tt){return tt!==Error.prototype},_e=>_e!=="isAxiosError");const _=s&&s.message?s.message:"Error",j=e==null&&s?s.code:e;return AxiosError$1.call(b,_,j,o,a,c),s&&b.cause==null&&Object.defineProperty(b,"cause",{value:s,configurable:!0}),b.name=s&&s.name||"Error",g&&Object.assign(b,g),b};const httpAdapter=null;function isVisitable(s){return utils$1.isPlainObject(s)||utils$1.isArray(s)}function removeBrackets(s){return utils$1.endsWith(s,"[]")?s.slice(0,-2):s}function renderKey(s,e,o){return s?s.concat(e).map(function(c,g){return c=removeBrackets(c),!o&&g?"["+c+"]":c}).join(o?".":""):e}function isFlatArray(s){return utils$1.isArray(s)&&!s.some(isVisitable)}const predicates=utils$1.toFlatObject(utils$1,{},null,function s(e){return/^is[A-Z]/.test(e)});function toFormData$1(s,e,o){if(!utils$1.isObject(s))throw new TypeError("target must be an object");e=e||new FormData,o=utils$1.toFlatObject(o,{metaTokens:!0,dots:!1,indexes:!1},!1,function(st,lt){return!utils$1.isUndefined(lt[st])});const a=o.metaTokens,c=o.visitor||tt,g=o.dots,b=o.indexes,j=(o.Blob||typeof Blob<"u"&&Blob)&&utils$1.isSpecCompliantForm(e);if(!utils$1.isFunction(c))throw new TypeError("visitor must be a function");function _e(it){if(it===null)return"";if(utils$1.isDate(it))return it.toISOString();if(utils$1.isBoolean(it))return it.toString();if(!j&&utils$1.isBlob(it))throw new AxiosError$1("Blob is not supported. Use a Buffer instead.");return utils$1.isArrayBuffer(it)||utils$1.isTypedArray(it)?j&&typeof Blob=="function"?new Blob([it]):Buffer.from(it):it}function tt(it,st,lt){let at=it;if(it&&!lt&&typeof it=="object"){if(utils$1.endsWith(st,"{}"))st=a?st:st.slice(0,-2),it=JSON.stringify(it);else if(utils$1.isArray(it)&&isFlatArray(it)||(utils$1.isFileList(it)||utils$1.endsWith(st,"[]"))&&(at=utils$1.toArray(it)))return st=removeBrackets(st),at.forEach(function(ft,vt){!(utils$1.isUndefined(ft)||ft===null)&&e.append(b===!0?renderKey([st],vt,g):b===null?st:st+"[]",_e(ft))}),!1}return isVisitable(it)?!0:(e.append(renderKey(lt,st,g),_e(it)),!1)}const et=[],nt=Object.assign(predicates,{defaultVisitor:tt,convertValue:_e,isVisitable});function rt(it,st){if(!utils$1.isUndefined(it)){if(et.indexOf(it)!==-1)throw Error("Circular reference detected in "+st.join("."));et.push(it),utils$1.forEach(it,function(at,ct){(!(utils$1.isUndefined(at)||at===null)&&c.call(e,at,utils$1.isString(ct)?ct.trim():ct,st,nt))===!0&&rt(at,st?st.concat(ct):[ct])}),et.pop()}}if(!utils$1.isObject(s))throw new TypeError("data must be an object");return rt(s),e}function encode$1(s){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(s).replace(/[!'()~]|%20|%00/g,function(a){return e[a]})}function AxiosURLSearchParams(s,e){this._pairs=[],s&&toFormData$1(s,this,e)}const prototype=AxiosURLSearchParams.prototype;prototype.append=function s(e,o){this._pairs.push([e,o])};prototype.toString=function s(e){const o=e?function(a){return e.call(this,a,encode$1)}:encode$1;return this._pairs.map(function(c){return o(c[0])+"="+o(c[1])},"").join("&")};function encode(s){return encodeURIComponent(s).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function buildURL(s,e,o){if(!e)return s;const a=o&&o.encode||encode;utils$1.isFunction(o)&&(o={serialize:o});const c=o&&o.serialize;let g;if(c?g=c(e,o):g=utils$1.isURLSearchParams(e)?e.toString():new AxiosURLSearchParams(e,o).toString(a),g){const b=s.indexOf("#");b!==-1&&(s=s.slice(0,b)),s+=(s.indexOf("?")===-1?"?":"&")+g}return s}class InterceptorManager{constructor(){this.handlers=[]}use(e,o,a){return this.handlers.push({fulfilled:e,rejected:o,synchronous:a?a.synchronous:!1,runWhen:a?a.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){utils$1.forEach(this.handlers,function(a){a!==null&&e(a)})}}const transitionalDefaults={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},URLSearchParams$1=typeof URLSearchParams<"u"?URLSearchParams:AxiosURLSearchParams,FormData$1=typeof FormData<"u"?FormData:null,Blob$1=typeof Blob<"u"?Blob:null,platform$1={isBrowser:!0,classes:{URLSearchParams:URLSearchParams$1,FormData:FormData$1,Blob:Blob$1},protocols:["http","https","file","blob","url","data"]},hasBrowserEnv=typeof window<"u"&&typeof document<"u",_navigator=typeof navigator=="object"&&navigator||void 0,hasStandardBrowserEnv=hasBrowserEnv&&(!_navigator||["ReactNative","NativeScript","NS"].indexOf(_navigator.product)<0),hasStandardBrowserWebWorkerEnv=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",origin=hasBrowserEnv&&window.location.href||"http://localhost",utils=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv,hasStandardBrowserEnv,hasStandardBrowserWebWorkerEnv,navigator:_navigator,origin},Symbol.toStringTag,{value:"Module"})),platform={...utils,...platform$1};function toURLEncodedForm(s,e){return toFormData$1(s,new platform.classes.URLSearchParams,{visitor:function(o,a,c,g){return platform.isNode&&utils$1.isBuffer(o)?(this.append(a,o.toString("base64")),!1):g.defaultVisitor.apply(this,arguments)},...e})}function parsePropPath(s){return utils$1.matchAll(/\w+|\[(\w*)]/g,s).map(e=>e[0]==="[]"?"":e[1]||e[0])}function arrayToObject(s){const e={},o=Object.keys(s);let a;const c=o.length;let g;for(a=0;a<c;a++)g=o[a],e[g]=s[g];return e}function formDataToJSON(s){function e(o,a,c,g){let b=o[g++];if(b==="__proto__")return!0;const _=Number.isFinite(+b),j=g>=o.length;return b=!b&&utils$1.isArray(c)?c.length:b,j?(utils$1.hasOwnProp(c,b)?c[b]=[c[b],a]:c[b]=a,!_):((!c[b]||!utils$1.isObject(c[b]))&&(c[b]=[]),e(o,a,c[b],g)&&utils$1.isArray(c[b])&&(c[b]=arrayToObject(c[b])),!_)}if(utils$1.isFormData(s)&&utils$1.isFunction(s.entries)){const o={};return utils$1.forEachEntry(s,(a,c)=>{e(parsePropPath(a),c,o,0)}),o}return null}function stringifySafely(s,e,o){if(utils$1.isString(s))try{return(e||JSON.parse)(s),utils$1.trim(s)}catch(a){if(a.name!=="SyntaxError")throw a}return(o||JSON.stringify)(s)}const defaults={transitional:transitionalDefaults,adapter:["xhr","http","fetch"],transformRequest:[function s(e,o){const a=o.getContentType()||"",c=a.indexOf("application/json")>-1,g=utils$1.isObject(e);if(g&&utils$1.isHTMLForm(e)&&(e=new FormData(e)),utils$1.isFormData(e))return c?JSON.stringify(formDataToJSON(e)):e;if(utils$1.isArrayBuffer(e)||utils$1.isBuffer(e)||utils$1.isStream(e)||utils$1.isFile(e)||utils$1.isBlob(e)||utils$1.isReadableStream(e))return e;if(utils$1.isArrayBufferView(e))return e.buffer;if(utils$1.isURLSearchParams(e))return o.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let _;if(g){if(a.indexOf("application/x-www-form-urlencoded")>-1)return toURLEncodedForm(e,this.formSerializer).toString();if((_=utils$1.isFileList(e))||a.indexOf("multipart/form-data")>-1){const j=this.env&&this.env.FormData;return toFormData$1(_?{"files[]":e}:e,j&&new j,this.formSerializer)}}return g||c?(o.setContentType("application/json",!1),stringifySafely(e)):e}],transformResponse:[function s(e){const o=this.transitional||defaults.transitional,a=o&&o.forcedJSONParsing,c=this.responseType==="json";if(utils$1.isResponse(e)||utils$1.isReadableStream(e))return e;if(e&&utils$1.isString(e)&&(a&&!this.responseType||c)){const b=!(o&&o.silentJSONParsing)&&c;try{return JSON.parse(e,this.parseReviver)}catch(_){if(b)throw _.name==="SyntaxError"?AxiosError$1.from(_,AxiosError$1.ERR_BAD_RESPONSE,this,null,this.response):_}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:platform.classes.FormData,Blob:platform.classes.Blob},validateStatus:function s(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};utils$1.forEach(["delete","get","head","post","put","patch"],s=>{defaults.headers[s]={}});const ignoreDuplicateOf=utils$1.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),parseHeaders=s=>{const e={};let o,a,c;return s&&s.split(`
`).forEach(function(b){c=b.indexOf(":"),o=b.substring(0,c).trim().toLowerCase(),a=b.substring(c+1).trim(),!(!o||e[o]&&ignoreDuplicateOf[o])&&(o==="set-cookie"?e[o]?e[o].push(a):e[o]=[a]:e[o]=e[o]?e[o]+", "+a:a)}),e},$internals=Symbol("internals");function normalizeHeader(s){return s&&String(s).trim().toLowerCase()}function normalizeValue(s){return s===!1||s==null?s:utils$1.isArray(s)?s.map(normalizeValue):String(s)}function parseTokens(s){const e=Object.create(null),o=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let a;for(;a=o.exec(s);)e[a[1]]=a[2];return e}const isValidHeaderName=s=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(s.trim());function matchHeaderValue(s,e,o,a,c){if(utils$1.isFunction(a))return a.call(this,e,o);if(c&&(e=o),!!utils$1.isString(e)){if(utils$1.isString(a))return e.indexOf(a)!==-1;if(utils$1.isRegExp(a))return a.test(e)}}function formatHeader(s){return s.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,o,a)=>o.toUpperCase()+a)}function buildAccessors(s,e){const o=utils$1.toCamelCase(" "+e);["get","set","has"].forEach(a=>{Object.defineProperty(s,a+o,{value:function(c,g,b){return this[a].call(this,e,c,g,b)},configurable:!0})})}let AxiosHeaders$1=class{constructor(e){e&&this.set(e)}set(e,o,a){const c=this;function g(_,j,_e){const tt=normalizeHeader(j);if(!tt)throw new Error("header name must be a non-empty string");const et=utils$1.findKey(c,tt);(!et||c[et]===void 0||_e===!0||_e===void 0&&c[et]!==!1)&&(c[et||j]=normalizeValue(_))}const b=(_,j)=>utils$1.forEach(_,(_e,tt)=>g(_e,tt,j));if(utils$1.isPlainObject(e)||e instanceof this.constructor)b(e,o);else if(utils$1.isString(e)&&(e=e.trim())&&!isValidHeaderName(e))b(parseHeaders(e),o);else if(utils$1.isObject(e)&&utils$1.isIterable(e)){let _={},j,_e;for(const tt of e){if(!utils$1.isArray(tt))throw TypeError("Object iterator must return a key-value pair");_[_e=tt[0]]=(j=_[_e])?utils$1.isArray(j)?[...j,tt[1]]:[j,tt[1]]:tt[1]}b(_,o)}else e!=null&&g(o,e,a);return this}get(e,o){if(e=normalizeHeader(e),e){const a=utils$1.findKey(this,e);if(a){const c=this[a];if(!o)return c;if(o===!0)return parseTokens(c);if(utils$1.isFunction(o))return o.call(this,c,a);if(utils$1.isRegExp(o))return o.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,o){if(e=normalizeHeader(e),e){const a=utils$1.findKey(this,e);return!!(a&&this[a]!==void 0&&(!o||matchHeaderValue(this,this[a],a,o)))}return!1}delete(e,o){const a=this;let c=!1;function g(b){if(b=normalizeHeader(b),b){const _=utils$1.findKey(a,b);_&&(!o||matchHeaderValue(a,a[_],_,o))&&(delete a[_],c=!0)}}return utils$1.isArray(e)?e.forEach(g):g(e),c}clear(e){const o=Object.keys(this);let a=o.length,c=!1;for(;a--;){const g=o[a];(!e||matchHeaderValue(this,this[g],g,e,!0))&&(delete this[g],c=!0)}return c}normalize(e){const o=this,a={};return utils$1.forEach(this,(c,g)=>{const b=utils$1.findKey(a,g);if(b){o[b]=normalizeValue(c),delete o[g];return}const _=e?formatHeader(g):String(g).trim();_!==g&&delete o[g],o[_]=normalizeValue(c),a[_]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const o=Object.create(null);return utils$1.forEach(this,(a,c)=>{a!=null&&a!==!1&&(o[c]=e&&utils$1.isArray(a)?a.join(", "):a)}),o}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,o])=>e+": "+o).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...o){const a=new this(e);return o.forEach(c=>a.set(c)),a}static accessor(e){const a=(this[$internals]=this[$internals]={accessors:{}}).accessors,c=this.prototype;function g(b){const _=normalizeHeader(b);a[_]||(buildAccessors(c,b),a[_]=!0)}return utils$1.isArray(e)?e.forEach(g):g(e),this}};AxiosHeaders$1.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);utils$1.reduceDescriptors(AxiosHeaders$1.prototype,({value:s},e)=>{let o=e[0].toUpperCase()+e.slice(1);return{get:()=>s,set(a){this[o]=a}}});utils$1.freezeMethods(AxiosHeaders$1);function transformData(s,e){const o=this||defaults,a=e||o,c=AxiosHeaders$1.from(a.headers);let g=a.data;return utils$1.forEach(s,function(_){g=_.call(o,g,c.normalize(),e?e.status:void 0)}),c.normalize(),g}function isCancel$1(s){return!!(s&&s.__CANCEL__)}function CanceledError$1(s,e,o){AxiosError$1.call(this,s??"canceled",AxiosError$1.ERR_CANCELED,e,o),this.name="CanceledError"}utils$1.inherits(CanceledError$1,AxiosError$1,{__CANCEL__:!0});function settle(s,e,o){const a=o.config.validateStatus;!o.status||!a||a(o.status)?s(o):e(new AxiosError$1("Request failed with status code "+o.status,[AxiosError$1.ERR_BAD_REQUEST,AxiosError$1.ERR_BAD_RESPONSE][Math.floor(o.status/100)-4],o.config,o.request,o))}function parseProtocol(s){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(s);return e&&e[1]||""}function speedometer(s,e){s=s||10;const o=new Array(s),a=new Array(s);let c=0,g=0,b;return e=e!==void 0?e:1e3,function(j){const _e=Date.now(),tt=a[g];b||(b=_e),o[c]=j,a[c]=_e;let et=g,nt=0;for(;et!==c;)nt+=o[et++],et=et%s;if(c=(c+1)%s,c===g&&(g=(g+1)%s),_e-b<e)return;const rt=tt&&_e-tt;return rt?Math.round(nt*1e3/rt):void 0}}function throttle(s,e){let o=0,a=1e3/e,c,g;const b=(_e,tt=Date.now())=>{o=tt,c=null,g&&(clearTimeout(g),g=null),s(..._e)};return[(..._e)=>{const tt=Date.now(),et=tt-o;et>=a?b(_e,tt):(c=_e,g||(g=setTimeout(()=>{g=null,b(c)},a-et)))},()=>c&&b(c)]}const progressEventReducer=(s,e,o=3)=>{let a=0;const c=speedometer(50,250);return throttle(g=>{const b=g.loaded,_=g.lengthComputable?g.total:void 0,j=b-a,_e=c(j),tt=b<=_;a=b;const et={loaded:b,total:_,progress:_?b/_:void 0,bytes:j,rate:_e||void 0,estimated:_e&&_&&tt?(_-b)/_e:void 0,event:g,lengthComputable:_!=null,[e?"download":"upload"]:!0};s(et)},o)},progressEventDecorator=(s,e)=>{const o=s!=null;return[a=>e[0]({lengthComputable:o,total:s,loaded:a}),e[1]]},asyncDecorator=s=>(...e)=>utils$1.asap(()=>s(...e)),isURLSameOrigin=platform.hasStandardBrowserEnv?((s,e)=>o=>(o=new URL(o,platform.origin),s.protocol===o.protocol&&s.host===o.host&&(e||s.port===o.port)))(new URL(platform.origin),platform.navigator&&/(msie|trident)/i.test(platform.navigator.userAgent)):()=>!0,cookies=platform.hasStandardBrowserEnv?{write(s,e,o,a,c,g){const b=[s+"="+encodeURIComponent(e)];utils$1.isNumber(o)&&b.push("expires="+new Date(o).toGMTString()),utils$1.isString(a)&&b.push("path="+a),utils$1.isString(c)&&b.push("domain="+c),g===!0&&b.push("secure"),document.cookie=b.join("; ")},read(s){const e=document.cookie.match(new RegExp("(^|;\\s*)("+s+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(s){this.write(s,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function isAbsoluteURL(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}function combineURLs(s,e){return e?s.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):s}function buildFullPath(s,e,o){let a=!isAbsoluteURL(e);return s&&(a||o==!1)?combineURLs(s,e):e}const headersToObject=s=>s instanceof AxiosHeaders$1?{...s}:s;function mergeConfig$1(s,e){e=e||{};const o={};function a(_e,tt,et,nt){return utils$1.isPlainObject(_e)&&utils$1.isPlainObject(tt)?utils$1.merge.call({caseless:nt},_e,tt):utils$1.isPlainObject(tt)?utils$1.merge({},tt):utils$1.isArray(tt)?tt.slice():tt}function c(_e,tt,et,nt){if(utils$1.isUndefined(tt)){if(!utils$1.isUndefined(_e))return a(void 0,_e,et,nt)}else return a(_e,tt,et,nt)}function g(_e,tt){if(!utils$1.isUndefined(tt))return a(void 0,tt)}function b(_e,tt){if(utils$1.isUndefined(tt)){if(!utils$1.isUndefined(_e))return a(void 0,_e)}else return a(void 0,tt)}function _(_e,tt,et){if(et in e)return a(_e,tt);if(et in s)return a(void 0,_e)}const j={url:g,method:g,data:g,baseURL:b,transformRequest:b,transformResponse:b,paramsSerializer:b,timeout:b,timeoutMessage:b,withCredentials:b,withXSRFToken:b,adapter:b,responseType:b,xsrfCookieName:b,xsrfHeaderName:b,onUploadProgress:b,onDownloadProgress:b,decompress:b,maxContentLength:b,maxBodyLength:b,beforeRedirect:b,transport:b,httpAgent:b,httpsAgent:b,cancelToken:b,socketPath:b,responseEncoding:b,validateStatus:_,headers:(_e,tt,et)=>c(headersToObject(_e),headersToObject(tt),et,!0)};return utils$1.forEach(Object.keys({...s,...e}),function(tt){const et=j[tt]||c,nt=et(s[tt],e[tt],tt);utils$1.isUndefined(nt)&&et!==_||(o[tt]=nt)}),o}const resolveConfig=s=>{const e=mergeConfig$1({},s);let{data:o,withXSRFToken:a,xsrfHeaderName:c,xsrfCookieName:g,headers:b,auth:_}=e;if(e.headers=b=AxiosHeaders$1.from(b),e.url=buildURL(buildFullPath(e.baseURL,e.url,e.allowAbsoluteUrls),s.params,s.paramsSerializer),_&&b.set("Authorization","Basic "+btoa((_.username||"")+":"+(_.password?unescape(encodeURIComponent(_.password)):""))),utils$1.isFormData(o)){if(platform.hasStandardBrowserEnv||platform.hasStandardBrowserWebWorkerEnv)b.setContentType(void 0);else if(utils$1.isFunction(o.getHeaders)){const j=o.getHeaders(),_e=["content-type","content-length"];Object.entries(j).forEach(([tt,et])=>{_e.includes(tt.toLowerCase())&&b.set(tt,et)})}}if(platform.hasStandardBrowserEnv&&(a&&utils$1.isFunction(a)&&(a=a(e)),a||a!==!1&&isURLSameOrigin(e.url))){const j=c&&g&&cookies.read(g);j&&b.set(c,j)}return e},isXHRAdapterSupported=typeof XMLHttpRequest<"u",xhrAdapter=isXHRAdapterSupported&&function(s){return new Promise(function(o,a){const c=resolveConfig(s);let g=c.data;const b=AxiosHeaders$1.from(c.headers).normalize();let{responseType:_,onUploadProgress:j,onDownloadProgress:_e}=c,tt,et,nt,rt,it;function st(){rt&&rt(),it&&it(),c.cancelToken&&c.cancelToken.unsubscribe(tt),c.signal&&c.signal.removeEventListener("abort",tt)}let lt=new XMLHttpRequest;lt.open(c.method.toUpperCase(),c.url,!0),lt.timeout=c.timeout;function at(){if(!lt)return;const ft=AxiosHeaders$1.from("getAllResponseHeaders"in lt&&lt.getAllResponseHeaders()),Rt={data:!_||_==="text"||_==="json"?lt.responseText:lt.response,status:lt.status,statusText:lt.statusText,headers:ft,config:s,request:lt};settle(function(Tt){o(Tt),st()},function(Tt){a(Tt),st()},Rt),lt=null}"onloadend"in lt?lt.onloadend=at:lt.onreadystatechange=function(){!lt||lt.readyState!==4||lt.status===0&&!(lt.responseURL&&lt.responseURL.indexOf("file:")===0)||setTimeout(at)},lt.onabort=function(){lt&&(a(new AxiosError$1("Request aborted",AxiosError$1.ECONNABORTED,s,lt)),lt=null)},lt.onerror=function(vt){const Rt=vt&&vt.message?vt.message:"Network Error",_t=new AxiosError$1(Rt,AxiosError$1.ERR_NETWORK,s,lt);_t.event=vt||null,a(_t),lt=null},lt.ontimeout=function(){let vt=c.timeout?"timeout of "+c.timeout+"ms exceeded":"timeout exceeded";const Rt=c.transitional||transitionalDefaults;c.timeoutErrorMessage&&(vt=c.timeoutErrorMessage),a(new AxiosError$1(vt,Rt.clarifyTimeoutError?AxiosError$1.ETIMEDOUT:AxiosError$1.ECONNABORTED,s,lt)),lt=null},g===void 0&&b.setContentType(null),"setRequestHeader"in lt&&utils$1.forEach(b.toJSON(),function(vt,Rt){lt.setRequestHeader(Rt,vt)}),utils$1.isUndefined(c.withCredentials)||(lt.withCredentials=!!c.withCredentials),_&&_!=="json"&&(lt.responseType=c.responseType),_e&&([nt,it]=progressEventReducer(_e,!0),lt.addEventListener("progress",nt)),j&&lt.upload&&([et,rt]=progressEventReducer(j),lt.upload.addEventListener("progress",et),lt.upload.addEventListener("loadend",rt)),(c.cancelToken||c.signal)&&(tt=ft=>{lt&&(a(!ft||ft.type?new CanceledError$1(null,s,lt):ft),lt.abort(),lt=null)},c.cancelToken&&c.cancelToken.subscribe(tt),c.signal&&(c.signal.aborted?tt():c.signal.addEventListener("abort",tt)));const ct=parseProtocol(c.url);if(ct&&platform.protocols.indexOf(ct)===-1){a(new AxiosError$1("Unsupported protocol "+ct+":",AxiosError$1.ERR_BAD_REQUEST,s));return}lt.send(g||null)})},composeSignals=(s,e)=>{const{length:o}=s=s?s.filter(Boolean):[];if(e||o){let a=new AbortController,c;const g=function(_e){if(!c){c=!0,_();const tt=_e instanceof Error?_e:this.reason;a.abort(tt instanceof AxiosError$1?tt:new CanceledError$1(tt instanceof Error?tt.message:tt))}};let b=e&&setTimeout(()=>{b=null,g(new AxiosError$1(`timeout ${e} of ms exceeded`,AxiosError$1.ETIMEDOUT))},e);const _=()=>{s&&(b&&clearTimeout(b),b=null,s.forEach(_e=>{_e.unsubscribe?_e.unsubscribe(g):_e.removeEventListener("abort",g)}),s=null)};s.forEach(_e=>_e.addEventListener("abort",g));const{signal:j}=a;return j.unsubscribe=()=>utils$1.asap(_),j}},streamChunk=function*(s,e){let o=s.byteLength;if(o<e){yield s;return}let a=0,c;for(;a<o;)c=a+e,yield s.slice(a,c),a=c},readBytes=async function*(s,e){for await(const o of readStream(s))yield*streamChunk(o,e)},readStream=async function*(s){if(s[Symbol.asyncIterator]){yield*s;return}const e=s.getReader();try{for(;;){const{done:o,value:a}=await e.read();if(o)break;yield a}}finally{await e.cancel()}},trackStream=(s,e,o,a)=>{const c=readBytes(s,e);let g=0,b,_=j=>{b||(b=!0,a&&a(j))};return new ReadableStream({async pull(j){try{const{done:_e,value:tt}=await c.next();if(_e){_(),j.close();return}let et=tt.byteLength;if(o){let nt=g+=et;o(nt)}j.enqueue(new Uint8Array(tt))}catch(_e){throw _(_e),_e}},cancel(j){return _(j),c.return()}},{highWaterMark:2})},DEFAULT_CHUNK_SIZE=64*1024,{isFunction}=utils$1,globalFetchAPI=(({Request:s,Response:e})=>({Request:s,Response:e}))(utils$1.global),{ReadableStream:ReadableStream$1,TextEncoder:TextEncoder$1}=utils$1.global,test=(s,...e)=>{try{return!!s(...e)}catch{return!1}},factory=s=>{s=utils$1.merge.call({skipUndefined:!0},globalFetchAPI,s);const{fetch:e,Request:o,Response:a}=s,c=e?isFunction(e):typeof fetch=="function",g=isFunction(o),b=isFunction(a);if(!c)return!1;const _=c&&isFunction(ReadableStream$1),j=c&&(typeof TextEncoder$1=="function"?(it=>st=>it.encode(st))(new TextEncoder$1):async it=>new Uint8Array(await new o(it).arrayBuffer())),_e=g&&_&&test(()=>{let it=!1;const st=new o(platform.origin,{body:new ReadableStream$1,method:"POST",get duplex(){return it=!0,"half"}}).headers.has("Content-Type");return it&&!st}),tt=b&&_&&test(()=>utils$1.isReadableStream(new a("").body)),et={stream:tt&&(it=>it.body)};c&&["text","arrayBuffer","blob","formData","stream"].forEach(it=>{!et[it]&&(et[it]=(st,lt)=>{let at=st&&st[it];if(at)return at.call(st);throw new AxiosError$1(`Response type '${it}' is not supported`,AxiosError$1.ERR_NOT_SUPPORT,lt)})});const nt=async it=>{if(it==null)return 0;if(utils$1.isBlob(it))return it.size;if(utils$1.isSpecCompliantForm(it))return(await new o(platform.origin,{method:"POST",body:it}).arrayBuffer()).byteLength;if(utils$1.isArrayBufferView(it)||utils$1.isArrayBuffer(it))return it.byteLength;if(utils$1.isURLSearchParams(it)&&(it=it+""),utils$1.isString(it))return(await j(it)).byteLength},rt=async(it,st)=>{const lt=utils$1.toFiniteNumber(it.getContentLength());return lt??nt(st)};return async it=>{let{url:st,method:lt,data:at,signal:ct,cancelToken:ft,timeout:vt,onDownloadProgress:Rt,onUploadProgress:_t,responseType:Tt,headers:Ct,withCredentials:Nt="same-origin",fetchOptions:At}=resolveConfig(it),yt=e||fetch;Tt=Tt?(Tt+"").toLowerCase():"text";let xt=composeSignals([ct,ft&&ft.toAbortSignal()],vt),ht=null;const Et=xt&&xt.unsubscribe&&(()=>{xt.unsubscribe()});let ot;try{if(_t&&_e&&lt!=="get"&&lt!=="head"&&(ot=await rt(Ct,at))!==0){let $t=new o(st,{method:"POST",body:at,duplex:"half"}),kt;if(utils$1.isFormData(at)&&(kt=$t.headers.get("content-type"))&&Ct.setContentType(kt),$t.body){const[Pt,jt]=progressEventDecorator(ot,progressEventReducer(asyncDecorator(_t)));at=trackStream($t.body,DEFAULT_CHUNK_SIZE,Pt,jt)}}utils$1.isString(Nt)||(Nt=Nt?"include":"omit");const dt=g&&"credentials"in o.prototype,bt={...At,signal:xt,method:lt.toUpperCase(),headers:Ct.normalize().toJSON(),body:at,duplex:"half",credentials:dt?Nt:void 0};ht=g&&new o(st,bt);let wt=await(g?yt(ht,At):yt(st,bt));const St=tt&&(Tt==="stream"||Tt==="response");if(tt&&(Rt||St&&Et)){const $t={};["status","statusText","headers"].forEach(Dt=>{$t[Dt]=wt[Dt]});const kt=utils$1.toFiniteNumber(wt.headers.get("content-length")),[Pt,jt]=Rt&&progressEventDecorator(kt,progressEventReducer(asyncDecorator(Rt),!0))||[];wt=new a(trackStream(wt.body,DEFAULT_CHUNK_SIZE,Pt,()=>{jt&&jt(),Et&&Et()}),$t)}Tt=Tt||"text";let gt=await et[utils$1.findKey(et,Tt)||"text"](wt,it);return!St&&Et&&Et(),await new Promise(($t,kt)=>{settle($t,kt,{data:gt,headers:AxiosHeaders$1.from(wt.headers),status:wt.status,statusText:wt.statusText,config:it,request:ht})})}catch(dt){throw Et&&Et(),dt&&dt.name==="TypeError"&&/Load failed|fetch/i.test(dt.message)?Object.assign(new AxiosError$1("Network Error",AxiosError$1.ERR_NETWORK,it,ht),{cause:dt.cause||dt}):AxiosError$1.from(dt,dt&&dt.code,it,ht)}}},seedCache=new Map,getFetch=s=>{let e=s?s.env:{};const{fetch:o,Request:a,Response:c}=e,g=[a,c,o];let b=g.length,_=b,j,_e,tt=seedCache;for(;_--;)j=g[_],_e=tt.get(j),_e===void 0&&tt.set(j,_e=_?new Map:factory(e)),tt=_e;return _e};getFetch();const knownAdapters={http:httpAdapter,xhr:xhrAdapter,fetch:{get:getFetch}};utils$1.forEach(knownAdapters,(s,e)=>{if(s){try{Object.defineProperty(s,"name",{value:e})}catch{}Object.defineProperty(s,"adapterName",{value:e})}});const renderReason=s=>`- ${s}`,isResolvedHandle=s=>utils$1.isFunction(s)||s===null||s===!1,adapters={getAdapter:(s,e)=>{s=utils$1.isArray(s)?s:[s];const{length:o}=s;let a,c;const g={};for(let b=0;b<o;b++){a=s[b];let _;if(c=a,!isResolvedHandle(a)&&(c=knownAdapters[(_=String(a)).toLowerCase()],c===void 0))throw new AxiosError$1(`Unknown adapter '${_}'`);if(c&&(utils$1.isFunction(c)||(c=c.get(e))))break;g[_||"#"+b]=c}if(!c){const b=Object.entries(g).map(([j,_e])=>`adapter ${j} `+(_e===!1?"is not supported by the environment":"is not available in the build"));let _=o?b.length>1?`since :
`+b.map(renderReason).join(`
`):" "+renderReason(b[0]):"as no adapter specified";throw new AxiosError$1("There is no suitable adapter to dispatch the request "+_,"ERR_NOT_SUPPORT")}return c},adapters:knownAdapters};function throwIfCancellationRequested(s){if(s.cancelToken&&s.cancelToken.throwIfRequested(),s.signal&&s.signal.aborted)throw new CanceledError$1(null,s)}function dispatchRequest(s){return throwIfCancellationRequested(s),s.headers=AxiosHeaders$1.from(s.headers),s.data=transformData.call(s,s.transformRequest),["post","put","patch"].indexOf(s.method)!==-1&&s.headers.setContentType("application/x-www-form-urlencoded",!1),adapters.getAdapter(s.adapter||defaults.adapter,s)(s).then(function(a){return throwIfCancellationRequested(s),a.data=transformData.call(s,s.transformResponse,a),a.headers=AxiosHeaders$1.from(a.headers),a},function(a){return isCancel$1(a)||(throwIfCancellationRequested(s),a&&a.response&&(a.response.data=transformData.call(s,s.transformResponse,a.response),a.response.headers=AxiosHeaders$1.from(a.response.headers))),Promise.reject(a)})}const VERSION$1="1.12.2",validators$1={};["object","boolean","number","function","string","symbol"].forEach((s,e)=>{validators$1[s]=function(a){return typeof a===s||"a"+(e<1?"n ":" ")+s}});const deprecatedWarnings={};validators$1.transitional=function s(e,o,a){function c(g,b){return"[Axios v"+VERSION$1+"] Transitional option '"+g+"'"+b+(a?". "+a:"")}return(g,b,_)=>{if(e===!1)throw new AxiosError$1(c(b," has been removed"+(o?" in "+o:"")),AxiosError$1.ERR_DEPRECATED);return o&&!deprecatedWarnings[b]&&(deprecatedWarnings[b]=!0,console.warn(c(b," has been deprecated since v"+o+" and will be removed in the near future"))),e?e(g,b,_):!0}};validators$1.spelling=function s(e){return(o,a)=>(console.warn(`${a} is likely a misspelling of ${e}`),!0)};function assertOptions(s,e,o){if(typeof s!="object")throw new AxiosError$1("options must be an object",AxiosError$1.ERR_BAD_OPTION_VALUE);const a=Object.keys(s);let c=a.length;for(;c-- >0;){const g=a[c],b=e[g];if(b){const _=s[g],j=_===void 0||b(_,g,s);if(j!==!0)throw new AxiosError$1("option "+g+" must be "+j,AxiosError$1.ERR_BAD_OPTION_VALUE);continue}if(o!==!0)throw new AxiosError$1("Unknown option "+g,AxiosError$1.ERR_BAD_OPTION)}}const validator={assertOptions,validators:validators$1},validators=validator.validators;let Axios$1=class{constructor(e){this.defaults=e||{},this.interceptors={request:new InterceptorManager,response:new InterceptorManager}}async request(e,o){try{return await this._request(e,o)}catch(a){if(a instanceof Error){let c={};Error.captureStackTrace?Error.captureStackTrace(c):c=new Error;const g=c.stack?c.stack.replace(/^.+\n/,""):"";try{a.stack?g&&!String(a.stack).endsWith(g.replace(/^.+\n.+\n/,""))&&(a.stack+=`
`+g):a.stack=g}catch{}}throw a}}_request(e,o){typeof e=="string"?(o=o||{},o.url=e):o=e||{},o=mergeConfig$1(this.defaults,o);const{transitional:a,paramsSerializer:c,headers:g}=o;a!==void 0&&validator.assertOptions(a,{silentJSONParsing:validators.transitional(validators.boolean),forcedJSONParsing:validators.transitional(validators.boolean),clarifyTimeoutError:validators.transitional(validators.boolean)},!1),c!=null&&(utils$1.isFunction(c)?o.paramsSerializer={serialize:c}:validator.assertOptions(c,{encode:validators.function,serialize:validators.function},!0)),o.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?o.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:o.allowAbsoluteUrls=!0),validator.assertOptions(o,{baseUrl:validators.spelling("baseURL"),withXsrfToken:validators.spelling("withXSRFToken")},!0),o.method=(o.method||this.defaults.method||"get").toLowerCase();let b=g&&utils$1.merge(g.common,g[o.method]);g&&utils$1.forEach(["delete","get","head","post","put","patch","common"],it=>{delete g[it]}),o.headers=AxiosHeaders$1.concat(b,g);const _=[];let j=!0;this.interceptors.request.forEach(function(st){typeof st.runWhen=="function"&&st.runWhen(o)===!1||(j=j&&st.synchronous,_.unshift(st.fulfilled,st.rejected))});const _e=[];this.interceptors.response.forEach(function(st){_e.push(st.fulfilled,st.rejected)});let tt,et=0,nt;if(!j){const it=[dispatchRequest.bind(this),void 0];for(it.unshift(..._),it.push(..._e),nt=it.length,tt=Promise.resolve(o);et<nt;)tt=tt.then(it[et++],it[et++]);return tt}nt=_.length;let rt=o;for(;et<nt;){const it=_[et++],st=_[et++];try{rt=it(rt)}catch(lt){st.call(this,lt);break}}try{tt=dispatchRequest.call(this,rt)}catch(it){return Promise.reject(it)}for(et=0,nt=_e.length;et<nt;)tt=tt.then(_e[et++],_e[et++]);return tt}getUri(e){e=mergeConfig$1(this.defaults,e);const o=buildFullPath(e.baseURL,e.url,e.allowAbsoluteUrls);return buildURL(o,e.params,e.paramsSerializer)}};utils$1.forEach(["delete","get","head","options"],function s(e){Axios$1.prototype[e]=function(o,a){return this.request(mergeConfig$1(a||{},{method:e,url:o,data:(a||{}).data}))}});utils$1.forEach(["post","put","patch"],function s(e){function o(a){return function(g,b,_){return this.request(mergeConfig$1(_||{},{method:e,headers:a?{"Content-Type":"multipart/form-data"}:{},url:g,data:b}))}}Axios$1.prototype[e]=o(),Axios$1.prototype[e+"Form"]=o(!0)});let CancelToken$1=class eo{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let o;this.promise=new Promise(function(g){o=g});const a=this;this.promise.then(c=>{if(!a._listeners)return;let g=a._listeners.length;for(;g-- >0;)a._listeners[g](c);a._listeners=null}),this.promise.then=c=>{let g;const b=new Promise(_=>{a.subscribe(_),g=_}).then(c);return b.cancel=function(){a.unsubscribe(g)},b},e(function(g,b,_){a.reason||(a.reason=new CanceledError$1(g,b,_),o(a.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const o=this._listeners.indexOf(e);o!==-1&&this._listeners.splice(o,1)}toAbortSignal(){const e=new AbortController,o=a=>{e.abort(a)};return this.subscribe(o),e.signal.unsubscribe=()=>this.unsubscribe(o),e.signal}static source(){let e;return{token:new eo(function(c){e=c}),cancel:e}}};function spread$1(s){return function(o){return s.apply(null,o)}}function isAxiosError$1(s){return utils$1.isObject(s)&&s.isAxiosError===!0}const HttpStatusCode$1={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(HttpStatusCode$1).forEach(([s,e])=>{HttpStatusCode$1[e]=s});function createInstance(s){const e=new Axios$1(s),o=bind(Axios$1.prototype.request,e);return utils$1.extend(o,Axios$1.prototype,e,{allOwnKeys:!0}),utils$1.extend(o,e,null,{allOwnKeys:!0}),o.create=function(c){return createInstance(mergeConfig$1(s,c))},o}const axios=createInstance(defaults);axios.Axios=Axios$1;axios.CanceledError=CanceledError$1;axios.CancelToken=CancelToken$1;axios.isCancel=isCancel$1;axios.VERSION=VERSION$1;axios.toFormData=toFormData$1;axios.AxiosError=AxiosError$1;axios.Cancel=axios.CanceledError;axios.all=function s(e){return Promise.all(e)};axios.spread=spread$1;axios.isAxiosError=isAxiosError$1;axios.mergeConfig=mergeConfig$1;axios.AxiosHeaders=AxiosHeaders$1;axios.formToJSON=s=>formDataToJSON(utils$1.isHTMLForm(s)?new FormData(s):s);axios.getAdapter=adapters.getAdapter;axios.HttpStatusCode=HttpStatusCode$1;axios.default=axios;const{Axios,AxiosError,CanceledError,isCancel,CancelToken,VERSION,all,Cancel,isAxiosError,spread,toFormData,AxiosHeaders,HttpStatusCode,formToJSON,getAdapter,mergeConfig}=axios,BLOSSOM_KIND_AUTH=24242;async function createAuthEvent(s,e,o){const a=Math.floor(Date.now()/1e3)+((o==null?void 0:o.expiresInSeconds)??300),c=[["t",e],["expiration",String(a)]];if(o!=null&&o.serverUrl){const b=o.serverUrl.replace(/\/$/,"");c.push(["server",b])}if(o!=null&&o.urlPath&&c.push(["url",o.urlPath]),e==="upload"&&(o!=null&&o.file)){if(c.push(["name",o.file.name]),o.skipSizeTag!==!0){const b=typeof o.sizeOverride=="number"?o.sizeOverride:o.file.size,_=Number.isFinite(b)?Math.max(0,Math.round(b)):void 0;typeof _=="number"&&c.push(["size",String(_)])}o.file.type&&c.push(["type",o.file.type])}(e==="delete"||e==="get")&&(o!=null&&o.hash)&&c.push(["x",o.hash]),e==="mirror"&&(o!=null&&o.sourceUrl)&&(c.push(["source",o.sourceUrl]),c.push(["url",o.sourceUrl]));const g={kind:BLOSSOM_KIND_AUTH,content:"",created_at:Math.floor(Date.now()/1e3),tags:c};return s(g)}function encodeAuthHeader$1(s){const e=JSON.stringify(s);return`Nostr ${btoa(unescape(encodeURIComponent(e)))}`}async function buildAuthorizationHeader(s,e,o){const a=await createAuthEvent(s,e,o);return encodeAuthHeader$1(a)}async function listUserBlobs(s,e,o){const a=new URL(`/list/${e}`,s).toString(),c={};if(o!=null&&o.requiresAuth){if(!o.signTemplate)throw new Error("Server requires auth. Connect your signer first.");const tt=await createAuthEvent(o.signTemplate,"list",{serverUrl:s,urlPath:`/list/${e}`});c.Authorization=encodeAuthHeader$1(tt)}const g=await fetch(a,{headers:c});if(!g.ok)throw new Error(`List failed with status ${g.status}`);const b=await g.json(),_=Array.isArray(b)?b:b.items??[],j=Math.floor(Date.now()/1e3),_e=s.replace(/\/$/,"");return _.map(tt=>{const et=tt==null?void 0:tt.size,nt=et==null?void 0:Number(et);return{...tt,size:Number.isFinite(nt)?nt:void 0,uploaded:tt.uploaded??j,url:tt.url||`${_e}/${tt.sha256}`,serverUrl:_e,requiresAuth:!!(o!=null&&o.requiresAuth),serverType:"blossom"}})}async function uploadBlobToServer(s,e,o,a,c,g){const b=new URL("/upload",s).toString(),_=s.replace(/\/$/,""),j=async tt=>{var rt;const et=new FormData;et.append("file",e);const nt={Accept:"application/json"};if(a){if(!o)throw new Error("Server requires auth. Connect your signer first.");const it=await createAuthEvent(o,"upload",{file:e,serverUrl:s,urlPath:"/upload",sizeOverride:g==null?void 0:g.sizeOverride,skipSizeTag:tt});et.append("event",JSON.stringify(it)),nt.Authorization=encodeAuthHeader$1(it)}try{const it=await axios.put(b,et,{headers:nt,onUploadProgress:c}),st=(rt=it.data)==null?void 0:rt.size,lt=st==null?void 0:Number(st);return{...it.data,size:Number.isFinite(lt)?lt:void 0,url:it.data.url||`${_}/${it.data.sha256}`,serverUrl:_,requiresAuth:!!a,serverType:"blossom"}}catch(it){if(axios.isAxiosError(it)){if(!it.response)throw it.request?new Error("Upload failed before the server responded. This often happens when CORS is misconfigured or the server blocks large uploads."):it;const st=it.response.status;if(st===413)throw new Error("Upload rejected: the server responded with 413 (payload too large). Reduce the file size or ask the server admin to raise the limit.");const lt=it.response.data,ct=(typeof lt=="string"?lt:lt&&typeof lt=="object"?lt.error||lt.message:void 0)||`Upload failed with status ${st}`;if(a&&!tt&&ct.toLowerCase().includes("size tag"))return j(!0);throw new Error(ct)}throw it}},_e=(g==null?void 0:g.skipSizeTag)===!0;return j(_e)}async function deleteUserBlob(s,e,o,a){const c=new URL(`/${e}`,s).toString(),g={};let b;if(a){if(!o)throw new Error("Server requires auth. Connect your signer first.");const _e=await createAuthEvent(o,"delete",{hash:e,serverUrl:s,urlPath:`/${e}`});g.Authorization=encodeAuthHeader$1(_e),g["content-type"]="application/json",b=JSON.stringify({event:_e})}const _=await fetch(c,{method:"DELETE",headers:g,body:b,mode:"cors"});if(!_.ok)throw new Error(`Delete failed with status ${_.status}`);if((_.headers.get("content-type")||"").includes("application/json"))return _.json().catch(()=>{})}async function mirrorBlobToServer(s,e,o,a){const c=new URL("/mirror",s).toString(),g={"content-type":"application/json"};let b=JSON.stringify({url:e});if(a){if(!o)throw new Error("Server requires auth. Connect your signer first.");const nt=await createAuthEvent(o,"mirror",{sourceUrl:e,serverUrl:s,urlPath:"/mirror"});g.Authorization=encodeAuthHeader$1(nt),b=JSON.stringify({url:e,event:nt})}const _=await fetch(c,{method:"PUT",headers:g,body:b});if(!_.ok)throw new Error(`Mirror failed with status ${_.status}`);const j=await _.json(),_e=s.replace(/\/$/,""),tt=j==null?void 0:j.size,et=tt==null?void 0:Number(tt);return{...j,size:Number.isFinite(et)?et:void 0,url:j.url||`${_e}/${j.sha256}`,serverUrl:_e,requiresAuth:!!a,serverType:"blossom"}}function encodeAuthHeader(s){const e=JSON.stringify(s);return`Nostr ${btoa(unescape(encodeURIComponent(e)))}`}async function buildNip98AuthHeader(s,e){const o=e.method.toUpperCase(),a=[["u",e.url],["method",o]];if(e.payloadHash&&a.push(["payload",e.payloadHash]),e.extraTags)for(const b of e.extraTags)Array.isArray(b)&&b.length>=2&&a.push(b);const c={kind:27235,content:"",created_at:Math.floor(Date.now()/1e3),tags:a},g=await s(c);return encodeAuthHeader(g)}const configCache=new Map;function normalizeBase(s){return s.replace(/\/$/,"")}function ensureTrailingSlash(s){return s.endsWith("/")?s:`${s}/`}function resolveAbsolute(s,e){if(!e)return s;try{return new URL(e,ensureTrailingSlash(s)).toString().replace(/\/$/,"")}catch{return e}}async function fetchConfig(s,e=0){if(e>4)throw new Error("Too many NIP-96 delegation redirects");const o=normalizeBase(s),a=new URL("/.well-known/nostr/nip96.json",ensureTrailingSlash(o)).toString(),c=await fetch(a,{headers:{Accept:"application/json"}});if(!c.ok)throw new Error(`Failed to load NIP-96 config from ${a} (${c.status})`);const g=await c.json();if(g&&typeof g=="object"){const b=typeof g.delegated_to_url=="string"?g.delegated_to_url.trim():"",_=typeof g.api_url=="string"?g.api_url.trim():"";if(!_&&b)return fetchConfig(b,e+1);if(!_)throw new Error(`Invalid NIP-96 config from ${a} (missing api_url)`);const j=resolveAbsolute(o,_),_e=resolveAbsolute(j,typeof g.download_url=="string"?g.download_url.trim():"");return{apiUrl:j,downloadUrl:_e,raw:g}}throw new Error(`Invalid response from ${a}`)}async function getNip96Config(s){const e=normalizeBase(s),o=configCache.get(e);if(o)return o;const a=fetchConfig(s).then(c=>(configCache.set(e,Promise.resolve(c)),c));configCache.set(e,a);try{return await a}catch(c){throw configCache.delete(e),c}}function tagsToMap(s=[]){const e=new Map;for(const o of s){if(!Array.isArray(o)||o.length<2)continue;const[a,c]=o;typeof a=="string"&&typeof c=="string"&&!e.has(a)&&e.set(a,c)}return e}function buildDefaultUrl(s,e,o){const a=s.downloadUrl||s.apiUrl,c=ensureTrailingSlash(a),g=o?`${e}.${o.replace(/^\./,"")}`:e;return`${c}${g}`}function nip94ToBlob(s,e,o,a){const c=tagsToMap(o.tags),g=c.get("ox")||c.get("x");if(!g)return null;const b=c.get("url"),_=c.get("m"),j=c.get("size"),_e=(()=>{const rt=(b||"").match(/\.([a-zA-Z0-9]+)(?:\?|$)/);if(rt)return rt[1];if(_){const[,it]=_.split("/");if(it)return it}})(),tt=b||buildDefaultUrl(s,g,_e);return{sha256:g,url:tt,type:_,size:j&&Number(j)||void 0,name:c.get("name")||o.content||void 0,uploaded:o.created_at,serverUrl:normalizeBase(e),requiresAuth:a,serverType:"nip96"}}async function listNip96Files(s,e={requiresAuth:!0}){const o=await getNip96Config(s),a=e.page??0,c=e.count??100,g=new URL(o.apiUrl);g.searchParams.set("page",String(a)),g.searchParams.set("count",String(c));const b={Accept:"application/json"};if(e.requiresAuth){if(!e.signTemplate)throw new Error("Server requires auth. Connect your signer first.");b.Authorization=await buildNip98AuthHeader(e.signTemplate,{url:g.toString(),method:"GET"})}const _=await fetch(g.toString(),{method:"GET",headers:b});if(!_.ok)throw new Error(`List failed with status ${_.status}`);const j=await _.json().catch(()=>{}),_e=Array.isArray(j==null?void 0:j.files)?j.files:[],tt=[];for(const et of _e){const nt=nip94ToBlob(o,s,et,e.requiresAuth);nt&&tt.push(nt)}return tt}async function uploadBlobToNip96(s,e,o,a,c){const g=await getNip96Config(s),b={Accept:"application/json"},_=g.apiUrl;if(a){if(!o)throw new Error("Server requires auth. Connect your signer first.");b.Authorization=await buildNip98AuthHeader(o,{url:_,method:"POST"})}const j=new FormData;j.append("file",e,e.name),j.append("size",String(e.size)),e.type&&j.append("content_type",e.type),j.append("caption",e.name);const tt=(await axios.post(_,j,{headers:b,onUploadProgress:c})).data;if(tt.status!=="success"||!tt.nip94_event)throw new Error(tt.message||"Upload failed");const et=nip94ToBlob(g,s,tt.nip94_event,a);if(!et)throw new Error("Upload succeeded but response missing file metadata");return et.name||(et.name=e.name),et.type||(et.type=e.type),et}async function deleteNip96File(s,e,o,a){const c=await getNip96Config(s),g=`${ensureTrailingSlash(c.apiUrl)}${e}`,b={Accept:"application/json"};if(a){if(!o)throw new Error("Server requires auth. Connect your signer first.");b.Authorization=await buildNip98AuthHeader(o,{url:g,method:"DELETE"})}const _=await fetch(g,{method:"DELETE",headers:b});if(!_.ok)throw new Error(`Delete failed with status ${_.status}`);if((_.headers.get("content-type")||"").includes("application/json"))return _.json().catch(()=>{})}const STORAGE_KEY="bloom:blob-metadata:v1";let cache=null;function normalizeServerKey(s){if(s)return s.replace(/\/+$/,"")}function readCache(){if(cache||(cache={},typeof window>"u"))return cache;try{const s=window.localStorage.getItem(STORAGE_KEY);if(!s)return cache;const e=JSON.parse(s);e&&typeof e=="object"&&(cache=e)}catch{cache={}}return cache}function persist(){if(!(typeof window>"u"||!cache))try{window.localStorage.setItem(STORAGE_KEY,JSON.stringify(cache))}catch{}}function getStoredBlobMetadata(s,e){var c;if(!e)return;const o=normalizeServerKey(s);return o?(c=readCache()[o])==null?void 0:c[e]:void 0}function setStoredBlobMetadata(s,e,o){if(!e)return;const a=normalizeServerKey(s);if(!a)return;const c=readCache(),g=c[a]??(c[a]={}),b=g[e]??{},_={name:o.name??b.name,type:o.type??b.type};if(_.name||delete _.name,_.type||delete _.type,!_.name&&!_.type){g[e]&&(delete g[e],Object.keys(g).length===0&&delete c[a],persist());return}b.name===_.name&&b.type===_.type||(g[e]=_,persist())}function mergeBlobWithStoredMetadata(s,e){const o=getStoredBlobMetadata(s,e.sha256),a={...e};return o!=null&&o.name&&!a.name&&(a.name=o.name),o!=null&&o.type&&!a.type&&(a.type=o.type),a.name&&a.name!==(o==null?void 0:o.name)&&setStoredBlobMetadata(s,e.sha256,{name:a.name}),a.type&&a.type!==(o==null?void 0:o.type)&&setStoredBlobMetadata(s,e.sha256,{type:a.type}),a}function mergeBlobsWithStoredMetadata(s,e){return e.map(o=>mergeBlobWithStoredMetadata(s,o))}function rememberBlobMetadata(s,e){e.sha256&&setStoredBlobMetadata(s,e.sha256,{name:e.name,type:e.type})}const useServerData=s=>{const e=useCurrentPubkey(),{signer:o,signEventTemplate:a}=useNdk(),c=useQueries({queries:s.map(j=>({queryKey:["server-blobs",j.url,e,j.type],enabled:!!e&&(!j.requiresAuth||!!o),queryFn:async()=>{if(!e)return[];if(j.type==="blossom"){const _e=await listUserBlobs(j.url,e,j.requiresAuth&&o?{requiresAuth:!0,signTemplate:a}:void 0);return mergeBlobsWithStoredMetadata(j.url,_e)}if(j.type==="nip96"){const _e=await listNip96Files(j.url,{requiresAuth:!!j.requiresAuth,signTemplate:j.requiresAuth?a:void 0});return mergeBlobsWithStoredMetadata(j.url,_e)}return[]},staleTime:1e3*60}))}),g=reactExports.useMemo(()=>s.map((j,_e)=>{var tt,et,nt;return{server:j,blobs:((tt=c[_e])==null?void 0:tt.data)??[],isLoading:((et=c[_e])==null?void 0:et.isLoading)??!1,isError:((nt=c[_e])==null?void 0:nt.isError)??!1}}),[s,c]),b=reactExports.useMemo(()=>{const j={};return g.forEach(_e=>{_e.blobs.forEach(tt=>{const et=j[tt.sha256]||{blob:tt,servers:[]};et.servers.includes(_e.server.url)||et.servers.push(_e.server.url),j[tt.sha256]=et})}),j},[g]),_=reactExports.useMemo(()=>{const j=Object.values(b).map(_e=>_e.blob);return{count:j.length,size:j.reduce((_e,tt)=>_e+(tt.size||0),0),lastChange:j.reduce((_e,tt)=>Math.max(_e,tt.uploaded||0),0),blobs:j}},[b]);return{snapshots:g,distribution:b,aggregated:_}};function createIcon(s){return({size:e=20,className:o="",...a})=>jsxRuntimeExports.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round",className:o,...a,children:s})}const GridIcon=createIcon(jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("rect",{x:"3",y:"3",width:"7",height:"7",rx:"1.5"}),jsxRuntimeExports.jsx("rect",{x:"14",y:"3",width:"7",height:"7",rx:"1.5"}),jsxRuntimeExports.jsx("rect",{x:"3",y:"14",width:"7",height:"7",rx:"1.5"}),jsxRuntimeExports.jsx("rect",{x:"14",y:"14",width:"7",height:"7",rx:"1.5"})]})),ListIcon=createIcon(jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("path",{d:"M4 6h16"}),jsxRuntimeExports.jsx("path",{d:"M4 12h16"}),jsxRuntimeExports.jsx("path",{d:"M4 18h16"}),jsxRuntimeExports.jsx("circle",{cx:"5",cy:"6",r:"1.5",fill:"currentColor"}),jsxRuntimeExports.jsx("circle",{cx:"5",cy:"12",r:"1.5",fill:"currentColor"}),jsxRuntimeExports.jsx("circle",{cx:"5",cy:"18",r:"1.5",fill:"currentColor"})]})),FolderIcon=createIcon(jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsx("path",{d:"M3.5 7.5v9a1.5 1.5 0 0 0 1.5 1.5h14a1.5 1.5 0 0 0 1.5-1.5v-7a1.5 1.5 0 0 0-1.5-1.5h-6l-1.5-2h-6c-.828 0-1.5.672-1.5 1.5Z"})})),ImageIcon=createIcon(jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("rect",{x:"3.5",y:"5",width:"17",height:"14",rx:"1.5"}),jsxRuntimeExports.jsx("circle",{cx:"9",cy:"10",r:"1.3"}),jsxRuntimeExports.jsx("path",{d:"M4.5 17.5 10 12l3 3 3-2.5 3.5 3"})]})),VideoIcon=createIcon(jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("rect",{x:"3.5",y:"6",width:"12",height:"12",rx:"1.5"}),jsxRuntimeExports.jsx("path",{d:"M17 9.5 21 8v8l-4-1.5Z",fill:"currentColor",stroke:"none"})]})),DocumentIcon=createIcon(jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("path",{d:"M6.5 4h7l4 4v10.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 6.5 19V5.5A1.5 1.5 0 0 1 8 4Z"}),jsxRuntimeExports.jsx("path",{d:"M13.5 4v4h4"}),jsxRuntimeExports.jsx("path",{d:"M9.5 12h5"}),jsxRuntimeExports.jsx("path",{d:"M9.5 16h5"})]})),DownloadIcon=createIcon(jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("path",{d:"M12 4v10"}),jsxRuntimeExports.jsx("path",{d:"m7.5 11 4.5 4.5L16.5 11"}),jsxRuntimeExports.jsx("path",{d:"M5 19h14"})]})),TrashIcon=createIcon(jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("path",{d:"M4 7h16"}),jsxRuntimeExports.jsx("path",{d:"M9 7V5.5A1.5 1.5 0 0 1 10.5 4h3A1.5 1.5 0 0 1 15 5.5V7"}),jsxRuntimeExports.jsx("path",{d:"M6.5 7v11A2.5 2.5 0 0 0 9 20.5h6a2.5 2.5 0 0 0 2.5-2.5V7"}),jsxRuntimeExports.jsx("path",{d:"M10 11.5v5"}),jsxRuntimeExports.jsx("path",{d:"M14 11.5v5"})]})),EditIcon=createIcon(jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("path",{d:"M4 20h3.8a1 1 0 0 0 .7-.29l9.7-9.7a1.5 1.5 0 0 0 0-2.12l-2.38-2.38a1.5 1.5 0 0 0-2.12 0l-9.7 9.7a1 1 0 0 0-.29.7Z"}),jsxRuntimeExports.jsx("path",{d:"m13.5 5.5 4 4"})]})),SaveIcon=createIcon(jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("path",{d:"M5.5 4h9.9a1.5 1.5 0 0 1 1.06.44l2.6 2.6a1.5 1.5 0 0 1 .44 1.06V18.5a1.5 1.5 0 0 1-1.5 1.5h-12a1.5 1.5 0 0 1-1.5-1.5V5.5A1.5 1.5 0 0 1 5.5 4Z"}),jsxRuntimeExports.jsx("path",{d:"M8 4v4.5h6V4"}),jsxRuntimeExports.jsx("path",{d:"m9.5 13.5 2.5 2.5 3.5-3.5"})]})),CancelIcon=createIcon(jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("circle",{cx:"12",cy:"12",r:"8"}),jsxRuntimeExports.jsx("path",{d:"m15 9-6 6"}),jsxRuntimeExports.jsx("path",{d:"m9 9 6 6"})]})),CopyIcon=createIcon(jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("rect",{x:"9",y:"9",width:"11",height:"11",rx:"2"}),jsxRuntimeExports.jsx("path",{d:"M6 15V5a2 2 0 0 1 2-2h10"})]})),BrowseIcon=createIcon(jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("circle",{cx:"11",cy:"11",r:"6"}),jsxRuntimeExports.jsx("path",{d:"m20 20-4.35-4.35"})]})),UploadIcon=createIcon(jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("path",{d:"M12 5v10"}),jsxRuntimeExports.jsx("path",{d:"m7.5 9.5 4.5-4.5 4.5 4.5"}),jsxRuntimeExports.jsx("path",{d:"M6 19h12"})]})),ServersIcon=createIcon(jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("rect",{x:"4",y:"4",width:"16",height:"6",rx:"2"}),jsxRuntimeExports.jsx("rect",{x:"4",y:"14",width:"16",height:"6",rx:"2"}),jsxRuntimeExports.jsx("path",{d:"M8 7h.01"}),jsxRuntimeExports.jsx("path",{d:"M8 17h.01"})]})),FileTypeIcon=({kind:s,size:e=20,className:o})=>{switch(s){case"folder":return jsxRuntimeExports.jsx(FolderIcon,{size:e,className:o});case"image":return jsxRuntimeExports.jsx(ImageIcon,{size:e,className:o});case"video":return jsxRuntimeExports.jsx(VideoIcon,{size:e,className:o});default:return jsxRuntimeExports.jsx(DocumentIcon,{size:e,className:o})}},deriveNameFromUrl=s=>s.replace(/^https?:\/\//,"").replace(/\/$/,""),createEmptyDraft=()=>({name:"",url:"https://",type:"blossom",requiresAuth:!0,sync:!1}),ServerList=({servers:s,selected:e,onSelect:o,onAdd:a,onUpdate:c,onSave:g,saving:b,disabled:_,onRemove:j,onToggleAuth:_e,onToggleSync:tt,validationError:et})=>{const[nt,rt]=reactExports.useState(!1),[it,st]=reactExports.useState(null),[lt,at]=reactExports.useState(createEmptyDraft),[ct,ft]=reactExports.useState(null),vt=reactExports.useRef(null),[Rt,_t]=reactExports.useState({}),Tt=!!(_||b),Ct=!!(b||_||et),Nt=b?"Saving…":_?"Save (connect signer)":"Save",At=gt=>{gt.key==="Enter"?(gt.preventDefault(),dt()):gt.key==="Escape"&&(gt.preventDefault(),ot()),gt.stopPropagation()};reactExports.useEffect(()=>{var gt;(nt||it)&&((gt=vt.current)==null||gt.focus({preventScroll:!0}))},[nt,it]),reactExports.useEffect(()=>{let gt=!0;const $t=new Map;_t(Pt=>{const jt={};return s.forEach(Dt=>{jt[Dt.url]=Pt[Dt.url]??{status:"checking"}}),jt});const kt=async Pt=>{const Dt=`${Pt.url.replace(/\/$/,"")}/`,Bt=new AbortController;$t.set(Pt.url,Bt);let Mt=!1;const Wt=window.setTimeout(()=>{Mt=!0,Bt.abort()},8e3);gt&&_t(Zt=>({...Zt,[Pt.url]:{...Zt[Pt.url],status:"checking"}}));const Kt=Zt=>{gt&&_t(cn=>({...cn,[Pt.url]:Zt}))},Qt=performance.now();try{let Zt=null;try{Zt=await fetch(Dt,{method:"HEAD",mode:"cors",cache:"no-store",signal:Bt.signal}),(Zt.status===405||Zt.status===501)&&(Zt=await fetch(Dt,{method:"GET",mode:"cors",cache:"no-store",signal:Bt.signal}))}catch(Yr){if(Yr instanceof DOMException&&Yr.name==="AbortError"){if(!gt)return;Mt&&Kt({status:"offline",checkedAt:Date.now(),error:"Timed out"});return}try{Zt=await fetch(Dt,{method:"GET",mode:"no-cors",cache:"no-store",signal:Bt.signal})}catch(mr){if(mr instanceof DOMException&&mr.name==="AbortError"){if(!gt)return;Mt&&Kt({status:"offline",checkedAt:Date.now(),error:"Timed out"});return}const fs=mr instanceof Error?mr.message:String(mr);Kt({status:"offline",checkedAt:Date.now(),error:fs});return}}if(!Zt)return;const cn=Math.max(0,Math.round(performance.now()-Qt)),nn=Date.now();if(Zt.type==="opaque"){Kt({status:"online",checkedAt:nn,latencyMs:cn});return}const xn=Zt.status,gr=xn===401||xn===403,Mn=Zt.ok||gr;Kt({status:gr?"auth":Mn?"online":"offline",checkedAt:nn,httpStatus:xn,latencyMs:cn,error:Mn?void 0:Zt.statusText})}finally{clearTimeout(Wt),$t.delete(Pt.url)}};return s.forEach(Pt=>{kt(Pt)}),()=>{gt=!1,$t.forEach(Pt=>Pt.abort())}},[s]);const yt=reactExports.useMemo(()=>({checking:{label:"Checking…",dot:"bg-slate-500 animate-pulse",text:"text-slate-400"},online:{label:"Reachable",dot:"bg-emerald-500",text:"text-emerald-300"},auth:{label:"Reachable (auth)",dot:"bg-amber-500",text:"text-amber-300"},offline:{label:"Unreachable",dot:"bg-red-500",text:"text-red-400"}}),[]),xt=(gt,$t=!1)=>{const kt=Rt[gt.url];if(!kt)return jsxRuntimeExports.jsx("span",{className:"text-xs text-slate-500",children:"Not checked"});const Pt=yt[kt.status],jt=typeof kt.latencyMs=="number"?`${kt.latencyMs}ms`:null;return jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-1",children:[jsxRuntimeExports.jsxs("span",{className:`inline-flex items-center gap-2 text-xs ${Pt.text}`,children:[jsxRuntimeExports.jsx("span",{className:`h-2 w-2 rounded-full ${Pt.dot}`,"aria-hidden":!0}),Pt.label,kt.status==="auth"&&kt.httpStatus?` (${kt.httpStatus})`:null,jt?jsxRuntimeExports.jsx("span",{className:"text-[11px] text-slate-400",children:jt}):null]}),$t?jsxRuntimeExports.jsx("span",{className:"text-[11px] text-slate-500",children:"Will refresh after saving"}):null]})},ht=()=>{st(null),at(createEmptyDraft()),ft(null),rt(!0)},Et=gt=>{rt(!1),ft(null),st(gt.url),at({name:gt.name,url:gt.url,type:gt.type,requiresAuth:!!gt.requiresAuth,sync:!!gt.sync})},ot=()=>{rt(!1),st(null),at(createEmptyDraft()),ft(null)},dt=()=>{it?wt():bt()},bt=()=>{const gt=lt.url.trim();if(!gt){ft("Enter a server URL");return}if(!/^https?:\/\//i.test(gt)){ft("URL must start with http:// or https://");return}const $t=gt.replace(/\/$/,"");if(s.some(Pt=>Pt.url===$t)){ft("Server already added");return}const kt=lt.name.trim()||deriveNameFromUrl($t);if(!kt){ft("Enter a server name");return}a({name:kt,url:$t,type:lt.type,requiresAuth:lt.requiresAuth,sync:lt.sync}),rt(!1),st(null),at(createEmptyDraft()),ft(null)},wt=()=>{if(!it)return;const gt=lt.url.trim();if(!gt){ft("Enter a server URL");return}if(!/^https?:\/\//i.test(gt)){ft("URL must start with http:// or https://");return}const $t=gt.replace(/\/$/,"");if(s.some(Pt=>Pt.url!==it&&Pt.url===$t)){ft("Server already added");return}const kt=lt.name.trim()||deriveNameFromUrl($t);if(!kt){ft("Enter a server name");return}c(it,{name:kt,url:$t,type:lt.type,requiresAuth:lt.requiresAuth,sync:lt.sync}),st(null),rt(!1),at(createEmptyDraft()),ft(null)},St=gt=>{e===gt.url?o(null):o(gt.url)};return jsxRuntimeExports.jsxs("section",{className:"rounded-2xl border border-slate-800 bg-slate-900/70 p-4",children:[jsxRuntimeExports.jsxs("header",{className:"flex items-center justify-between mb-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-slate-100",children:"Servers"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-400",children:"Select where your content lives. Please note that the NIP-96 server spec has been deprecated."})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:ht,className:"px-3 py-2 rounded-xl bg-slate-800 hover:bg-slate-700 text-sm disabled:opacity-40 disabled:cursor-not-allowed",disabled:b||nt||!!it,children:"Add server"}),jsxRuntimeExports.jsx("button",{onClick:g,className:"px-3 py-2 rounded-xl bg-slate-800 hover:bg-slate-700 text-sm disabled:opacity-40",disabled:Ct,children:Nt})]})]}),(et||b)&&jsxRuntimeExports.jsx("div",{className:`mb-3 rounded-xl border px-3 py-2 text-xs ${et?"border-amber-600/40 bg-amber-500/5 text-amber-200":"border-emerald-600/30 bg-emerald-500/5 text-emerald-200"}`,role:"alert",children:et||"Saving changes…"}),jsxRuntimeExports.jsx("div",{className:"overflow-x-auto",children:jsxRuntimeExports.jsxs("table",{className:"min-w-full table-fixed text-sm text-slate-300",children:[jsxRuntimeExports.jsx("thead",{className:"text-[11px] uppercase tracking-wide text-slate-500",children:jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("th",{scope:"col",className:"py-2 px-3 text-left font-semibold",children:"Server"}),jsxRuntimeExports.jsx("th",{scope:"col",className:"py-2 px-3 text-left font-semibold",children:"URL"}),jsxRuntimeExports.jsx("th",{scope:"col",className:"w-44 py-2 px-3 text-left font-semibold",children:"Status"}),jsxRuntimeExports.jsx("th",{scope:"col",className:"w-32 py-2 px-3 text-left font-semibold",children:"Type"}),jsxRuntimeExports.jsx("th",{scope:"col",className:"w-24 py-2 px-3 text-center font-semibold",children:"Auth"}),jsxRuntimeExports.jsx("th",{scope:"col",className:"w-24 py-2 px-3 text-center font-semibold",children:"Sync"}),jsxRuntimeExports.jsx("th",{scope:"col",className:"w-28 py-2 px-3 text-center font-semibold",children:"Actions"})]})}),jsxRuntimeExports.jsxs("tbody",{children:[nt&&jsxRuntimeExports.jsxs("tr",{className:"border-t border-slate-800 bg-slate-900/70",children:[jsxRuntimeExports.jsx("td",{className:"py-3 px-3",children:jsxRuntimeExports.jsx("input",{type:"text",value:lt.name,onChange:gt=>{at($t=>({...$t,name:gt.target.value})),ct&&ft(null)},className:"w-full rounded-lg border border-slate-700 bg-slate-900 px-3 py-2 text-sm text-slate-200 focus:border-emerald-500 focus:outline-none",placeholder:"Server name","aria-label":"Server name",onClick:gt=>gt.stopPropagation(),onKeyDown:At,autoComplete:"off"})}),jsxRuntimeExports.jsx("td",{className:"py-3 px-3",children:jsxRuntimeExports.jsx("input",{ref:vt,type:"url",value:lt.url,onChange:gt=>{const $t=gt.target.value;at(kt=>{const Pt={...kt,url:$t},jt=deriveNameFromUrl(kt.url.trim());if(!kt.name||kt.name===jt){const Dt=deriveNameFromUrl($t.trim());Dt&&(Pt.name=Dt)}return Pt}),ct&&ft(null)},className:"w-full rounded-lg border border-slate-700 bg-slate-900 px-3 py-2 text-sm text-slate-200 focus:border-emerald-500 focus:outline-none",placeholder:"https://example.com","aria-label":"Server URL",onClick:gt=>gt.stopPropagation(),onKeyDown:At,autoComplete:"off"})}),jsxRuntimeExports.jsx("td",{className:"py-3 px-3 text-xs text-slate-500",children:"Health check runs after saving"}),jsxRuntimeExports.jsx("td",{className:"py-3 px-3",children:jsxRuntimeExports.jsxs("select",{value:lt.type,onChange:gt=>{at($t=>({...$t,type:gt.target.value})),ct&&ft(null)},className:"w-full min-w-[8rem] rounded-lg border border-slate-700 bg-slate-900 px-3 py-2 text-sm text-slate-200 focus:border-emerald-500 focus:outline-none","aria-label":"Server type",onClick:gt=>gt.stopPropagation(),onKeyDown:At,children:[jsxRuntimeExports.jsx("option",{value:"blossom",children:"Blossom"}),jsxRuntimeExports.jsx("option",{value:"nip96",children:"NIP-96"})]})}),jsxRuntimeExports.jsx("td",{className:"py-3 px-3 text-center",children:jsxRuntimeExports.jsx("div",{className:"flex justify-center",children:jsxRuntimeExports.jsx("input",{type:"checkbox",checked:lt.requiresAuth,onChange:gt=>{at($t=>({...$t,requiresAuth:gt.target.checked})),ct&&ft(null)},"aria-label":"Requires auth",onClick:gt=>gt.stopPropagation(),onKeyDown:At,disabled:b})})}),jsxRuntimeExports.jsx("td",{className:"py-3 px-3 text-center",children:jsxRuntimeExports.jsx("div",{className:"flex justify-center",children:jsxRuntimeExports.jsx("input",{type:"checkbox",checked:lt.sync,onChange:gt=>{at($t=>({...$t,sync:gt.target.checked})),ct&&ft(null)},"aria-label":"Sync server",onClick:gt=>gt.stopPropagation(),onKeyDown:At,disabled:b})})}),jsxRuntimeExports.jsxs("td",{className:"py-3 px-3 text-right",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-end gap-2",children:[jsxRuntimeExports.jsx("button",{type:"button",className:"text-xs px-3 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-500",onClick:gt=>{gt.stopPropagation(),dt()},children:"Add"}),jsxRuntimeExports.jsx("button",{type:"button",className:"text-xs px-3 py-2 rounded-lg bg-slate-800 hover:bg-slate-700",onClick:gt=>{gt.stopPropagation(),ot()},children:"Cancel"})]}),ct&&jsxRuntimeExports.jsx("div",{className:"mt-2 text-xs text-red-400 text-right",children:ct})]})]}),s.map(gt=>it===gt.url?jsxRuntimeExports.jsxs("tr",{className:"border-t border-slate-800 bg-slate-900/70",children:[jsxRuntimeExports.jsx("td",{className:"py-3 px-3",children:jsxRuntimeExports.jsx("input",{type:"text",value:lt.name,onChange:kt=>{at(Pt=>({...Pt,name:kt.target.value})),ct&&ft(null)},className:"w-full rounded-lg border border-slate-700 bg-slate-900 px-3 py-2 text-sm text-slate-200 focus:border-emerald-500 focus:outline-none",placeholder:"Server name","aria-label":"Server name",onClick:kt=>kt.stopPropagation(),onKeyDown:At,autoComplete:"off"})}),jsxRuntimeExports.jsx("td",{className:"py-3 px-3",children:jsxRuntimeExports.jsx("input",{ref:vt,type:"url",value:lt.url,onChange:kt=>{const Pt=kt.target.value;at(jt=>{const Dt={...jt,url:Pt},Bt=deriveNameFromUrl(jt.url.trim());if(!jt.name||jt.name===Bt){const Mt=deriveNameFromUrl(Pt.trim());Mt&&(Dt.name=Mt)}return Dt}),ct&&ft(null)},className:"w-full rounded-lg border border-slate-700 bg-slate-900 px-3 py-2 text-sm text-slate-200 focus:border-emerald-500 focus:outline-none",placeholder:"https://example.com","aria-label":"Server URL",onClick:kt=>kt.stopPropagation(),onKeyDown:At,autoComplete:"off"})}),jsxRuntimeExports.jsx("td",{className:"py-3 px-3",children:xt(gt,!0)}),jsxRuntimeExports.jsx("td",{className:"py-3 px-3",children:jsxRuntimeExports.jsxs("select",{value:lt.type,onChange:kt=>{at(Pt=>({...Pt,type:kt.target.value})),ct&&ft(null)},className:"w-full min-w-[8rem] rounded-lg border border-slate-700 bg-slate-900 px-3 py-2 text-sm text-slate-200 focus:border-emerald-500 focus:outline-none","aria-label":"Server type",onClick:kt=>kt.stopPropagation(),onKeyDown:At,children:[jsxRuntimeExports.jsx("option",{value:"blossom",children:"Blossom"}),jsxRuntimeExports.jsx("option",{value:"nip96",children:"NIP-96"})]})}),jsxRuntimeExports.jsx("td",{className:"py-3 px-3 text-center",children:jsxRuntimeExports.jsx("div",{className:"flex justify-center",children:jsxRuntimeExports.jsx("input",{type:"checkbox",checked:lt.requiresAuth,onChange:kt=>{at(Pt=>({...Pt,requiresAuth:kt.target.checked})),ct&&ft(null)},"aria-label":"Requires auth",onClick:kt=>kt.stopPropagation(),onKeyDown:At,disabled:b})})}),jsxRuntimeExports.jsx("td",{className:"py-3 px-3 text-center",children:jsxRuntimeExports.jsx("div",{className:"flex justify-center",children:jsxRuntimeExports.jsx("input",{type:"checkbox",checked:lt.sync,onChange:kt=>{at(Pt=>({...Pt,sync:kt.target.checked})),ct&&ft(null)},"aria-label":"Sync server",onClick:kt=>kt.stopPropagation(),onKeyDown:At,disabled:b})})}),jsxRuntimeExports.jsxs("td",{className:"py-3 px-3 text-right",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-end gap-2",children:[jsxRuntimeExports.jsx("button",{type:"button",className:"flex items-center justify-center rounded-lg bg-emerald-600 p-2 text-slate-50 transition hover:bg-emerald-500",onClick:kt=>{kt.stopPropagation(),dt()},"aria-label":"Save server",title:"Save server",children:jsxRuntimeExports.jsx(SaveIcon,{size:16})}),jsxRuntimeExports.jsx("button",{type:"button",className:"flex items-center justify-center rounded-lg bg-slate-800 p-2 text-slate-200 transition hover:bg-slate-700",onClick:kt=>{kt.stopPropagation(),ot()},"aria-label":"Cancel editing",title:"Cancel editing",children:jsxRuntimeExports.jsx(CancelIcon,{size:16})})]}),ct&&jsxRuntimeExports.jsx("div",{className:"mt-2 text-xs text-red-400 text-right",children:ct})]})]},gt.url):jsxRuntimeExports.jsxs("tr",{role:"button",tabIndex:0,"aria-pressed":e===gt.url,onClick:()=>St(gt),onKeyDown:kt=>{(kt.key==="Enter"||kt.key===" ")&&(kt.preventDefault(),St(gt))},className:`border-t border-slate-800 first:border-t-0 cursor-pointer transition-colors focus:outline-none focus:ring-2 focus:ring-emerald-500/60 focus:ring-offset-2 focus:ring-offset-slate-900 ${e===gt.url?"bg-emerald-500/10":"hover:bg-slate-800/50"}`,children:[jsxRuntimeExports.jsx("td",{className:"py-3 px-3 font-medium text-slate-100",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(FolderIcon,{size:18,className:"text-slate-300"}),jsxRuntimeExports.jsx("span",{className:"truncate",children:gt.name})]})}),jsxRuntimeExports.jsx("td",{className:"py-3 px-3 text-xs text-slate-400",children:jsxRuntimeExports.jsx("span",{className:"break-all",children:gt.url})}),jsxRuntimeExports.jsx("td",{className:"py-3 px-3",children:xt(gt)}),jsxRuntimeExports.jsx("td",{className:"py-3 px-3 text-[11px] uppercase tracking-wide text-slate-500",children:gt.type}),jsxRuntimeExports.jsx("td",{className:"py-3 px-3 text-center",children:jsxRuntimeExports.jsxs("label",{className:"inline-flex items-center gap-2 text-xs text-slate-300",onClick:kt=>kt.stopPropagation(),onKeyDown:kt=>kt.stopPropagation(),children:[jsxRuntimeExports.jsx("input",{type:"checkbox",checked:!!gt.requiresAuth,onChange:kt=>_e(gt.url,kt.target.checked),disabled:Tt}),jsxRuntimeExports.jsx("span",{className:"sr-only",children:"Requires auth"})]})}),jsxRuntimeExports.jsx("td",{className:"py-3 px-3 text-center",children:jsxRuntimeExports.jsxs("label",{className:"inline-flex items-center gap-2 text-xs text-slate-300",onClick:kt=>kt.stopPropagation(),onKeyDown:kt=>kt.stopPropagation(),children:[jsxRuntimeExports.jsx("input",{type:"checkbox",checked:!!gt.sync,onChange:kt=>tt(gt.url,kt.target.checked),disabled:Tt}),jsxRuntimeExports.jsx("span",{className:"sr-only",children:"Sync server"})]})}),jsxRuntimeExports.jsx("td",{className:"py-3 px-3 text-right",children:jsxRuntimeExports.jsxs("div",{className:"flex justify-end gap-2",children:[jsxRuntimeExports.jsx("button",{type:"button",className:"text-xs px-2 py-1 rounded-lg bg-slate-800 hover:bg-slate-700",onClick:kt=>{kt.stopPropagation(),Et(gt)},children:jsxRuntimeExports.jsx(EditIcon,{size:16})}),jsxRuntimeExports.jsx("button",{type:"button",className:"text-xs px-2 py-1 rounded-lg bg-red-900/70 hover:bg-red-800",onClick:kt=>{kt.stopPropagation(),j(gt.url)},children:jsxRuntimeExports.jsx(TrashIcon,{size:16})})]})})]},gt.url)),s.length===0&&!nt&&!it&&jsxRuntimeExports.jsx("tr",{children:jsxRuntimeExports.jsx("td",{colSpan:7,className:"py-6 px-3 text-sm text-center text-slate-400",children:"No servers yet. Add your first Blossom or NIP-96 server."})})]})]})})]})},prettyBytes=s=>{if(!s||s<=0)return"0 B";const e=["B","KB","MB","GB","TB"],o=Math.floor(Math.log(s)/Math.log(1024));return`${(s/Math.pow(1024,o)).toFixed(o===0?0:1)} ${e[o]}`},prettyDate=s=>s?new Date(s*1e3).toLocaleString():"",BlobList=({blobs:s,baseUrl:e,requiresAuth:o=!1,signTemplate:a,serverType:c="blossom",selected:g,viewMode:b,onToggle:_,onDelete:j,onCopy:_e,onPlay:tt})=>{const[et,nt]=reactExports.useState({}),[rt,it]=reactExports.useState({}),[st,lt]=reactExports.useState(null),at=reactExports.useRef(new Set),ct=reactExports.useRef(new Set),ft=reactExports.useRef(new Map),vt=reactExports.useRef(!0);reactExports.useEffect(()=>()=>{vt.current=!1,ft.current.forEach(yt=>yt()),ft.current.clear()},[]);const Rt=reactExports.useCallback((yt,xt)=>{nt(ht=>ht[yt]===xt?ht:{...ht,[yt]:xt})},[]);reactExports.useEffect(()=>{nt(xt=>{const ht={};return s.forEach(Et=>{const ot=xt[Et.sha256];ot&&(ht[Et.sha256]=ot)}),ht}),it(xt=>{const ht={};return s.forEach(Et=>{const ot=xt[Et.sha256];ot&&(ht[Et.sha256]=ot)}),ht});const yt=new Set(s.map(xt=>xt.sha256));ct.current.forEach(xt=>{yt.has(xt)||ct.current.delete(xt)}),at.current.forEach(xt=>{yt.has(xt)||at.current.delete(xt)}),ft.current.forEach((xt,ht)=>{yt.has(ht)||(xt(),ft.current.delete(ht))})},[s]),reactExports.useEffect(()=>{const yt=async(ht,Et)=>{at.current.add(ht.sha256);try{const ot={},dt=ht.serverType??c,bt=async Dt=>{if(!o||!a)return;if(dt==="nip96")return buildNip98AuthHeader(a,{url:Et,method:Dt});let Bt=null;try{Bt=new URL(Et)}catch{Bt=null}return buildAuthorizationHeader(a,"get",{hash:ht.sha256,serverUrl:Bt?`${Bt.protocol}//${Bt.host}`:void 0,urlPath:Bt?Bt.pathname+(Bt.search||""):void 0,expiresInSeconds:120})};if(o){const Dt=await bt("HEAD");if(!Dt)return;ot.Authorization=Dt}let wt=await fetch(Et,{method:"HEAD",headers:ot,mode:"cors"});if(!wt.ok)if(wt.status===405||wt.status===501){const Dt={...ot};if(o){const Bt=await bt("GET");if(!Bt)return;Dt.Authorization=Bt}if(wt=await fetch(Et,{method:"GET",headers:Dt,mode:"cors"}),!wt.ok)return;if(wt.body)try{await wt.body.cancel()}catch{}}else return;const St=wt.headers.get("content-type")||void 0,gt=wt.headers.get("content-disposition")||void 0,$t=deriveFilename(gt),kt=St&&St!=="application/octet-stream"?St:void 0,Pt=$t||void 0,jt=ht.serverUrl??e;if((kt||Pt)&&jt&&setStoredBlobMetadata(jt,ht.sha256,{name:Pt,type:kt}),vt.current&&(kt!=null&&kt.startsWith("image/")?Rt(ht.sha256,"image"):kt!=null&&kt.startsWith("video/")&&Rt(ht.sha256,"video")),!kt&&!Pt||!vt.current)return;it(Dt=>{const Bt=Dt[ht.sha256]??{},Mt={type:kt??Bt.type,name:Pt??Bt.name};return Bt.type===Mt.type&&Bt.name===Mt.name?Dt:{...Dt,[ht.sha256]:Mt}})}catch{}finally{at.current.delete(ht.sha256)}},xt=(ht,Et)=>{if(o||ft.current.has(ht.sha256)||et[ht.sha256])return;const ot=new Image;ot.decoding="async";const dt=()=>{ot.onload=null,ot.onerror=null,ot.src="",ft.current.delete(ht.sha256)};ot.onload=()=>{vt.current&&Rt(ht.sha256,"image"),dt()},ot.onerror=()=>{dt()},ft.current.set(ht.sha256,dt),ot.src=Et};for(const ht of s){const Et=rt[ht.sha256],ot=(Et==null?void 0:Et.type)??ht.type,dt=(Et==null?void 0:Et.name)??ht.name,bt=!!(ot&&ot!=="application/octet-stream"),wt=!!(dt&&dt!==ht.sha256),St=ht.url||(()=>{const jt=ht.serverUrl??e;if(jt)return`${jt.replace(/\/$/,"")}/${ht.sha256}`})();if(!St)continue;const gt=isSameOrigin(St),$t=ct.current.has(ht.sha256),kt=at.current.has(ht.sha256);if((!bt||!wt)&&!(o||gt)){xt(ht,St);continue}bt&&wt||$t||kt||o&&!a||(ct.current.add(ht.sha256),yt(ht,St))}},[s,e,o,a,rt,et,Rt,c]);const _t=reactExports.useMemo(()=>s.map(yt=>{const xt=rt[yt.sha256],ht=yt.serverUrl??e,Et=ht?ht.replace(/\/$/,""):void 0;return{...yt,type:(xt==null?void 0:xt.type)??yt.type,name:(xt==null?void 0:xt.name)??yt.name,url:yt.url||(Et?`${Et}/${yt.sha256}`:void 0),serverUrl:Et??yt.serverUrl,requiresAuth:yt.requiresAuth??o,serverType:yt.serverType??c}}),[s,rt,e,o,c]),Tt=reactExports.useMemo(()=>{if(!st)return _t;const{key:yt,direction:xt}=st,ht=xt==="asc"?1:-1,Et=ot=>{var bt;const dt=(bt=ot.name)==null?void 0:bt.trim();if(dt)return dt.toLowerCase();if(ot.url){const wt=ot.url.split("/").pop();if(wt)return wt.toLowerCase()}return ot.sha256.toLowerCase()};return[..._t].sort((ot,dt)=>{if(yt==="size"){const wt=typeof ot.size=="number"?ot.size:-1,St=typeof dt.size=="number"?dt.size:-1,gt=wt-St;if(gt!==0)return gt*ht}else if(yt==="uploaded"){const wt=typeof ot.uploaded=="number"?ot.uploaded:0,St=typeof dt.uploaded=="number"?dt.uploaded:0,gt=wt-St;if(gt!==0)return gt*ht}else{const wt=yt==="name"?Et(ot):(ot.type??"").toLowerCase(),St=yt==="name"?Et(dt):(dt.type??"").toLowerCase(),gt=wt.localeCompare(St);if(gt!==0)return gt*ht}return Et(ot).localeCompare(Et(dt))*ht})},[_t,st]),Ct=reactExports.useCallback(yt=>{lt(xt=>!xt||xt.key!==yt?{key:yt,direction:"asc"}:xt.direction==="asc"?{key:yt,direction:"desc"}:null)},[]),Nt=reactExports.useCallback(async yt=>{if(!yt.url)return;let xt=null;try{const ht={};if(yt.requiresAuth){if(!a)throw new Error("Signer required to authorize this download.");if((yt.serverType??c)==="nip96")ht.Authorization=await buildNip98AuthHeader(a,{url:yt.url,method:"GET"});else{let jt=null;try{jt=new URL(yt.url)}catch{jt=null}ht.Authorization=await buildAuthorizationHeader(a,"get",{hash:yt.sha256,serverUrl:jt?`${jt.protocol}//${jt.host}`:yt.serverUrl,urlPath:jt?jt.pathname+(jt.search||""):void 0,expiresInSeconds:300})}}const Et=await fetch(yt.url,{headers:ht,mode:"cors"});if(!Et.ok)throw new Error(`Download failed with status ${Et.status}`);const ot=await Et.blob(),dt=Et.headers.get("content-disposition")||void 0,bt=deriveFilename(dt),wt=sanitizeFilename(bt||yt.name||yt.sha256),St=yt.type||ot.type,gt=inferExtensionFromType(St),$t=ensureExtension(wt,gt);xt=URL.createObjectURL(ot);const kt=document.createElement("a");kt.href=xt,kt.download=$t,document.body.appendChild(kt),kt.click(),kt.remove()}catch(ht){if(console.error("Failed to download blob",ht),typeof window<"u"){const Et=ht instanceof Error?ht.message:"Failed to download blob.";window.alert(Et)}}finally{xt&&URL.revokeObjectURL(xt)}},[a,c]),At=b==="list"?Tt:_t;return jsxRuntimeExports.jsx("div",{className:"",children:b==="list"?jsxRuntimeExports.jsx(ListLayout,{blobs:At,baseUrl:e,requiresAuth:o,signTemplate:a,serverType:c,selected:g,onToggle:_,onDelete:j,onDownload:Nt,onCopy:_e,onPlay:tt,detectedKinds:et,sortConfig:st,onSort:Ct}):jsxRuntimeExports.jsx(GridLayout,{blobs:_t,baseUrl:e,requiresAuth:o,signTemplate:a,serverType:c,selected:g,onToggle:_,onDelete:j,onDownload:Nt,onCopy:_e,onPlay:tt,detectedKinds:et,onDetect:Rt})})},GridLayout=({blobs:s,baseUrl:e,requiresAuth:o,signTemplate:a,serverType:c,selected:g,onToggle:b,onDelete:_,onDownload:j,onCopy:_e,onPlay:tt,detectedKinds:et,onDetect:nt})=>jsxRuntimeExports.jsxs("div",{className:"grid gap-3 p-4 md:grid-cols-2 xl:grid-cols-3",children:[s.map(rt=>{var Rt;const it=g.has(rt.sha256),st=(Rt=rt.type)==null?void 0:Rt.startsWith("audio/"),lt=rt.url,at=rt.requiresAuth??o,ct=buildDisplayName(rt),ft=()=>b(rt.sha256),vt=_t=>{(_t.key==="Enter"||_t.key===" ")&&(_t.preventDefault(),ft())};return jsxRuntimeExports.jsxs("div",{role:"button",tabIndex:0,"aria-pressed":it,onClick:ft,onKeyDown:vt,className:`rounded-xl border px-4 py-4 flex flex-col gap-3 focus:outline-none focus:ring-2 focus:ring-emerald-500/70 focus:ring-offset-2 focus:ring-offset-slate-900 cursor-pointer transition ${it?"border-emerald-500 bg-emerald-500/10":"border-slate-800 bg-slate-900/60"}`,children:[lt&&jsxRuntimeExports.jsx(BlobPreview,{sha:rt.sha256,url:lt,name:rt.name||rt.sha256,type:rt.type,requiresAuth:at,signTemplate:at?a:void 0,serverType:rt.serverType??c,onDetect:nt}),jsxRuntimeExports.jsx("div",{className:"text-sm font-medium text-slate-100 break-words",children:ct}),jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap gap-2 mt-auto pt-1",children:[rt.url&&jsxRuntimeExports.jsx("button",{className:"p-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-200",onClick:_t=>{_t.stopPropagation(),_e(rt)},"aria-label":"Copy blob URL",title:"Copy URL",children:jsxRuntimeExports.jsx(CopyIcon,{size:16})}),rt.url&&jsxRuntimeExports.jsx("button",{className:"p-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-200",onClick:_t=>{_t.stopPropagation(),j(rt)},"aria-label":"Download blob",title:"Download",children:jsxRuntimeExports.jsx(DownloadIcon,{size:16})}),jsxRuntimeExports.jsx("button",{className:"p-2 rounded-lg bg-red-900/80 hover:bg-red-800 text-slate-100",onClick:_t=>{_t.stopPropagation(),_(rt)},"aria-label":"Delete blob",title:"Delete",children:jsxRuntimeExports.jsx(TrashIcon,{size:16})}),st&&tt&&rt.url&&jsxRuntimeExports.jsx("button",{className:"px-2 py-1 text-xs rounded-lg bg-emerald-700/70 hover:bg-emerald-600",onClick:_t=>{_t.stopPropagation(),tt==null||tt(rt)},children:"Play"})]})]},rt.sha256)}),s.length===0&&jsxRuntimeExports.jsx("div",{className:"col-span-full text-center text-sm text-slate-400 py-8",children:"No content on this server yet."})]}),ListThumbnail=({blob:s,kind:e,baseUrl:o,requiresAuth:a,signTemplate:c,serverType:g="blossom"})=>{const[b,_]=reactExports.useState(!1),[j,_e]=reactExports.useState(null),tt=reactExports.useRef(null),et="flex h-12 w-12 flex-shrink-0 overflow-hidden rounded-lg border border-slate-800 bg-slate-950/80",nt=s.requiresAuth??a,rt=s.serverType??g,it=s.url||(()=>{const at=s.serverUrl??o;if(at)return`${at.replace(/\/$/,"")}/${s.sha256}`})(),st=e==="image"&&!!it;if(reactExports.useEffect(()=>{if(_(!1),_e(null),tt.current&&(URL.revokeObjectURL(tt.current),tt.current=null),!st||!it)return;if(!nt){_e(it);return}if(!c){_(!0);return}let at=!1;const ct=it.match(/[0-9a-f]{64}/i);return(async()=>{try{const vt={};if(nt)if(rt==="nip96")vt.Authorization=await buildNip98AuthHeader(c,{url:it,method:"GET"});else{let Ct;try{Ct=new URL(it)}catch{Ct=void 0}vt.Authorization=await buildAuthorizationHeader(c,"get",{hash:ct?ct[0]:void 0,serverUrl:Ct?`${Ct.protocol}//${Ct.host}`:void 0,urlPath:Ct?Ct.pathname+(Ct.search||""):void 0})}const Rt=await fetch(it,{headers:vt});if(!Rt.ok||Rt.type==="opaqueredirect"||Rt.type==="opaque")throw new Error(`Preview fetch failed (${Rt.status})`);const _t=await Rt.blob();if(at)return;const Tt=URL.createObjectURL(_t);tt.current=Tt,_e(Tt)}catch{at||_(!0)}})(),()=>{at=!0,tt.current&&(URL.revokeObjectURL(tt.current),tt.current=null)}},[st,it,nt,c,rt,s.sha256]),!st||!j||b)return jsxRuntimeExports.jsx("div",{className:`${et} items-center justify-center`,children:jsxRuntimeExports.jsx(FileTypeIcon,{kind:e,size:20,className:"text-slate-300"})});const lt=s.name||(it==null?void 0:it.split("/").pop())||s.sha256;return jsxRuntimeExports.jsx("div",{className:et,children:jsxRuntimeExports.jsx("img",{src:j,alt:lt,className:"h-full w-full object-cover",loading:"lazy",onError:()=>{tt.current&&(URL.revokeObjectURL(tt.current),tt.current=null),_(!0)}})})},ListLayout=({blobs:s,baseUrl:e,requiresAuth:o,signTemplate:a,serverType:c,selected:g,onToggle:b,onDelete:_,onDownload:j,onCopy:_e,onPlay:tt,detectedKinds:et,sortConfig:nt,onSort:rt})=>{const it=lt=>!nt||nt.key!==lt?null:nt.direction==="asc"?"^":"v",st=lt=>{if(!(!nt||nt.key!==lt))return nt.direction==="asc"?"ascending":"descending"};return jsxRuntimeExports.jsx("div",{className:"pb-1",children:jsxRuntimeExports.jsx("div",{className:"overflow-x-auto",children:jsxRuntimeExports.jsxs("table",{className:"min-w-full table-fixed text-sm text-slate-300",children:[jsxRuntimeExports.jsx("thead",{className:"text-[11px] uppercase tracking-wide text-slate-500",children:jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("th",{scope:"col",className:"py-2 px-3 text-left font-semibold","aria-sort":st("name"),children:jsxRuntimeExports.jsxs("button",{type:"button",className:"flex items-center gap-1 text-left uppercase tracking-wide text-slate-500 hover:text-slate-200",onClick:()=>rt("name"),"aria-pressed":(nt==null?void 0:nt.key)==="name",children:[jsxRuntimeExports.jsx("span",{children:"Name"}),jsxRuntimeExports.jsx("span",{"aria-hidden":"true",children:it("name")})]})}),jsxRuntimeExports.jsx("th",{scope:"col",className:"w-48 py-2 px-3 text-left font-semibold","aria-sort":st("type"),children:jsxRuntimeExports.jsxs("button",{type:"button",className:"flex items-center gap-1 text-left uppercase tracking-wide text-slate-500 hover:text-slate-200",onClick:()=>rt("type"),"aria-pressed":(nt==null?void 0:nt.key)==="type",children:[jsxRuntimeExports.jsx("span",{children:"Type"}),jsxRuntimeExports.jsx("span",{"aria-hidden":"true",children:it("type")})]})}),jsxRuntimeExports.jsx("th",{scope:"col",className:"w-24 py-2 px-3 text-left font-semibold","aria-sort":st("size"),children:jsxRuntimeExports.jsxs("button",{type:"button",className:"flex items-center gap-1 text-left uppercase tracking-wide text-slate-500 hover:text-slate-200",onClick:()=>rt("size"),"aria-pressed":(nt==null?void 0:nt.key)==="size",children:[jsxRuntimeExports.jsx("span",{children:"Size"}),jsxRuntimeExports.jsx("span",{"aria-hidden":"true",children:it("size")})]})}),jsxRuntimeExports.jsx("th",{scope:"col",className:"w-32 py-2 px-3 text-left font-semibold","aria-sort":st("uploaded"),children:jsxRuntimeExports.jsxs("button",{type:"button",className:"flex items-center gap-1 text-left uppercase tracking-wide text-slate-500 hover:text-slate-200",onClick:()=>rt("uploaded"),"aria-pressed":(nt==null?void 0:nt.key)==="uploaded",children:[jsxRuntimeExports.jsx("span",{children:"Updated"}),jsxRuntimeExports.jsx("span",{"aria-hidden":"true",children:it("uploaded")})]})}),jsxRuntimeExports.jsx("th",{scope:"col",className:"w-40 py-2 pl-3 pr-0 text-right font-semibold",children:"Actions"})]})}),jsxRuntimeExports.jsxs("tbody",{children:[s.map(lt=>{var vt;const at=decideFileKind(lt,et[lt.sha256]),ct=(vt=lt.type)==null?void 0:vt.startsWith("audio/"),ft=buildDisplayName(lt);return jsxRuntimeExports.jsxs("tr",{className:"border-t border-slate-800 first:border-t-0 transition-colors hover:bg-slate-800/50",children:[jsxRuntimeExports.jsx("td",{className:"py-3 px-3",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx(ListThumbnail,{blob:lt,kind:at,baseUrl:e,requiresAuth:o,signTemplate:a,serverType:c}),jsxRuntimeExports.jsx("div",{className:"min-w-0 flex-1",children:jsxRuntimeExports.jsx("div",{className:"font-medium text-slate-100 truncate",children:ft})})]})}),jsxRuntimeExports.jsx("td",{className:"w-48 py-3 px-3 truncate",children:lt.type||"application/octet-stream"}),jsxRuntimeExports.jsx("td",{className:"w-24 py-3 px-3 text-left whitespace-nowrap",children:prettyBytes(lt.size)}),jsxRuntimeExports.jsx("td",{className:"w-32 py-3 px-3 text-left whitespace-nowrap",children:prettyDate(lt.uploaded)}),jsxRuntimeExports.jsx("td",{className:"w-40 py-3 pl-3 pr-0",children:jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-2",children:[lt.url&&jsxRuntimeExports.jsx("button",{className:"p-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-200",onClick:Rt=>{Rt.stopPropagation(),_e(lt)},"aria-label":"Copy blob URL",title:"Copy URL",children:jsxRuntimeExports.jsx(CopyIcon,{size:16})}),lt.url&&jsxRuntimeExports.jsx("button",{className:"p-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-200",onClick:Rt=>{Rt.stopPropagation(),j(lt)},"aria-label":"Download blob",title:"Download",children:jsxRuntimeExports.jsx(DownloadIcon,{size:16})}),jsxRuntimeExports.jsx("button",{className:"p-2 rounded-lg bg-red-900/80 hover:bg-red-800 text-slate-100",onClick:Rt=>{Rt.stopPropagation(),_(lt)},"aria-label":"Delete blob",title:"Delete",children:jsxRuntimeExports.jsx(TrashIcon,{size:16})}),ct&&tt&&lt.url&&jsxRuntimeExports.jsx("button",{className:"px-2 py-1 text-xs rounded-lg bg-emerald-700/70 hover:bg-emerald-600",onClick:Rt=>{Rt.stopPropagation(),tt==null||tt(lt)},children:"Play"})]})})]},lt.sha256)}),s.length===0&&jsxRuntimeExports.jsx("tr",{children:jsxRuntimeExports.jsx("td",{colSpan:5,className:"py-6 px-3 text-sm text-center text-slate-400",children:"No content on this server yet."})})]})]})})})},BlobPreview=({sha:s,url:e,name:o,type:a,requiresAuth:c=!1,signTemplate:g,serverType:b="blossom",onDetect:_})=>{const[j,_e]=reactExports.useState(null),[tt,et]=reactExports.useState(!1),[nt,rt]=reactExports.useState(!1),[it,st]=reactExports.useState(()=>inferKind(a,e)??"unknown");return reactExports.useEffect(()=>{let lt=!1,at=null;const ct=e.match(/[0-9a-f]{64}/i);if(!c){const vt=inferKind(a,e);return vt&&(st(vt),_(s,vt)),_e(e),rt(!1),et(!1),()=>{at&&URL.revokeObjectURL(at)}}const ft=async()=>{rt(!0),et(!1);try{const vt={};if(c){if(!g)throw new Error("Auth required but no signer available");if(b==="nip96")vt.Authorization=await buildNip98AuthHeader(g,{url:e,method:"GET"});else{let Nt;try{Nt=new URL(e)}catch{Nt=void 0}vt.Authorization=await buildAuthorizationHeader(g,"get",{hash:ct?ct[0]:void 0,serverUrl:Nt?`${Nt.protocol}//${Nt.host}`:void 0,urlPath:Nt?Nt.pathname+(Nt.search||""):void 0})}}const Rt=await fetch(e,{headers:vt});if(!Rt.ok||Rt.type==="opaqueredirect"||Rt.type==="opaque")throw new Error(`Preview fetch failed (${Rt.status})`);const _t=await Rt.blob(),Tt=Rt.headers.get("content-type")||_t.type||a||"",Ct=Tt.startsWith("video/")?"video":Tt.startsWith("image/")?"image":it;at=URL.createObjectURL(_t),lt?at&&URL.revokeObjectURL(at):(_e(at),st(Ct),(Ct==="image"||Ct==="video")&&_(s,Ct),rt(!1))}catch{lt||(et(!0),_e(null),rt(!1))}};return c&&!g?(et(!0),rt(!1),_e(null),()=>{}):(ft(),()=>{lt=!0,at&&URL.revokeObjectURL(at)})},[s,e,a,c,g,b,_,it]),jsxRuntimeExports.jsx("div",{className:"h-40 w-full overflow-hidden rounded-lg border border-slate-800 bg-slate-950/80 flex items-center justify-center",children:j&&!tt?it==="video"?jsxRuntimeExports.jsx("video",{src:j,className:"max-h-full max-w-full",controls:!1,autoPlay:!0,muted:!0,loop:!0,playsInline:!0,onLoadedData:()=>{st("video"),_(s,"video")}}):jsxRuntimeExports.jsx("img",{src:j,alt:o,className:"max-h-full max-w-full object-contain",loading:"lazy",onLoad:()=>{st("image"),_(s,"image")},onError:()=>et(!0)}):nt?jsxRuntimeExports.jsx("span",{className:"text-xs text-slate-500",children:"Loading preview…"}):jsxRuntimeExports.jsx("span",{className:"text-xs text-slate-500",children:"Preview unavailable"})})};function deriveFilename(s){if(!s)return;const e=s.match(/filename\*\s*=\s*(?:UTF-8''|)([^;]+)/i);if(e!=null&&e[1]){const a=e[1].trim().replace(/^UTF-8''/i,"");try{return decodeURIComponent(a)}catch{return a}}const o=s.match(/filename="?([^";]+)"?/i);if(o!=null&&o[1])return o[1]}function isSameOrigin(s){try{return new URL(s,window.location.href).origin===window.location.origin}catch{return!1}}function decideFileKind(s,e){if(e)return e;const o=inferKind(s.type,s.name||s.url);return o||"document"}function inferKind(s,e){const o=(s==null?void 0:s.toLowerCase())??"",a=(e==null?void 0:e.toLowerCase())??"";if(o.startsWith("image/")||/\.(png|jpe?g|gif|webp|bmp|svg|heic)$/.test(a))return"image";if(o.startsWith("video/")||/\.(mp4|mov|webm|mkv|avi|hevc)$/.test(a))return"video"}function sanitizeFilename(s){const o=s.replace(/[\r\n]+/g," ").split(/[\\/]/);return o[o.length-1]||"download"}function inferExtensionFromType(s){if(!s)return;const[e]=s.split(";"),o={"image/png":"png","image/jpeg":"jpg","image/gif":"gif","image/webp":"webp","image/bmp":"bmp","image/svg+xml":"svg","image/heic":"heic","video/mp4":"mp4","video/quicktime":"mov","video/webm":"webm","video/x-matroska":"mkv","audio/mpeg":"mp3","audio/wav":"wav","audio/ogg":"ogg","application/pdf":"pdf","text/plain":"txt"};if(e)return o[e.trim().toLowerCase()]}function ensureExtension(s,e){return!e||s.toLowerCase().endsWith(`.${e.toLowerCase()}`)?s:`${s}.${e}`}function buildDisplayName(s){var _;const e=s.name||((_=s.url)==null?void 0:_.split("/").pop())||s.sha256,o=sanitizeFilename(e),{baseName:a,extension:c}=splitNameAndExtension(o),g=c||inferExtensionFromType(s.type),b=truncateMiddle(a,12,12);return g?`${b}.${g}`:b}function splitNameAndExtension(s){const e=s.trim(),o=e.lastIndexOf(".");if(o<=0||o===e.length-1)return{baseName:e,extension:void 0};const a=e.slice(0,o),c=e.slice(o+1);return{baseName:a,extension:c}}function truncateMiddle(s,e,o){if(s.length<=e+o)return s;const a=s.slice(0,e),c=s.slice(-o);return`${a}...${c}`}class Node{constructor(e){pt(this,"value");pt(this,"next");this.value=e}}var wn,Nr,jr;class Queue{constructor(){Lt(this,wn);Lt(this,Nr);Lt(this,jr);this.clear()}enqueue(e){const o=new Node(e);mt(this,wn)?(mt(this,Nr).next=o,Ot(this,Nr,o)):(Ot(this,wn,o),Ot(this,Nr,o)),Dr(this,jr)._++}dequeue(){const e=mt(this,wn);if(e)return Ot(this,wn,mt(this,wn).next),Dr(this,jr)._--,e.value}peek(){if(mt(this,wn))return mt(this,wn).value}clear(){Ot(this,wn,void 0),Ot(this,Nr,void 0),Ot(this,jr,0)}get size(){return mt(this,jr)}*[Symbol.iterator](){let e=mt(this,wn);for(;e;)yield e.value,e=e.next}*drain(){for(;mt(this,wn);)yield this.dequeue()}}wn=new WeakMap,Nr=new WeakMap,jr=new WeakMap;function pLimit(s){if(!((Number.isInteger(s)||s===Number.POSITIVE_INFINITY)&&s>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up");const e=new Queue;let o=0;const a=()=>{o--,e.size>0&&e.dequeue()()},c=async(_,j,_e)=>{o++;const tt=(async()=>_(..._e))();j(tt);try{await tt}catch{}a()},g=(_,j,_e)=>{e.enqueue(c.bind(void 0,_,j,_e)),(async()=>(await Promise.resolve(),o<s&&e.size>0&&e.dequeue()()))()},b=(_,...j)=>new Promise(_e=>{g(_,_e,j)});return Object.defineProperties(b,{activeCount:{get:()=>o},pendingCount:{get:()=>e.size},clearQueue:{value:()=>{e.clear()}}}),b}async function resizeImage(s,e,o){const a=await createImageBitmap(s),c=Math.min(e/a.width,o/a.height,1),g=Math.round(a.width*c),b=Math.round(a.height*c),_=document.createElement("canvas");_.width=g,_.height=b;const j=_.getContext("2d");if(!j)return s;j.drawImage(a,0,0,g,b);const _e=await new Promise(tt=>_.toBlob(tt,s.type||"image/jpeg",.9));return _e?new File([_e],s.name,{type:_e.type,lastModified:Date.now()}):s}async function stripImageMetadata(s){const e=await createImageBitmap(s),o=document.createElement("canvas");o.width=e.width,o.height=e.height;const a=o.getContext("2d");if(!a)return s;a.drawImage(e,0,0);const c=await new Promise(g=>o.toBlob(g,s.type||"image/jpeg",.9));return c?new File([c],s.name,{type:c.type,lastModified:Date.now()}):s}var q=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],p=(s,e)=>{var o="";for(let a=1;a<=e;a++){let c=Math.floor(s)/Math.pow(83,e-a)%83;o+=q[Math.floor(c)]}return o},f=s=>{let e=s/255;return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)},h=s=>{let e=Math.max(0,Math.min(1,s));return e<=.0031308?Math.trunc(e*12.92*255+.5):Math.trunc((1.055*Math.pow(e,.4166666666666667)-.055)*255+.5)},F=s=>s<0?-1:1,M=(s,e)=>F(s)*Math.pow(Math.abs(s),e),d=class extends Error{constructor(s){super(s),this.name="ValidationError",this.message=s}},A=4,D=(s,e,o,a)=>{let c=0,g=0,b=0,_=e*A;for(let _e=0;_e<e;_e++){let tt=A*_e;for(let et=0;et<o;et++){let nt=tt+et*_,rt=a(_e,et);c+=rt*f(s[nt]),g+=rt*f(s[nt+1]),b+=rt*f(s[nt+2])}}let j=1/(e*o);return[c*j,g*j,b*j]},$=s=>{let e=h(s[0]),o=h(s[1]),a=h(s[2]);return(e<<16)+(o<<8)+a},H=(s,e)=>{let o=Math.floor(Math.max(0,Math.min(18,Math.floor(M(s[0]/e,.5)*9+9.5)))),a=Math.floor(Math.max(0,Math.min(18,Math.floor(M(s[1]/e,.5)*9+9.5)))),c=Math.floor(Math.max(0,Math.min(18,Math.floor(M(s[2]/e,.5)*9+9.5))));return o*19*19+a*19+c},O=(s,e,o,a,c)=>{if(a<1||a>9||c<1||c>9)throw new d("BlurHash must have between 1 and 9 components");if(e*o*4!==s.length)throw new d("Width and height must match the pixels array");let g=[];for(let et=0;et<c;et++)for(let nt=0;nt<a;nt++){let rt=nt==0&&et==0?1:2,it=D(s,e,o,(st,lt)=>rt*Math.cos(Math.PI*nt*st/e)*Math.cos(Math.PI*et*lt/o));g.push(it)}let b=g[0],_=g.slice(1),j="",_e=a-1+(c-1)*9;j+=p(_e,1);let tt;if(_.length>0){let et=Math.max(..._.map(rt=>Math.max(...rt))),nt=Math.floor(Math.max(0,Math.min(82,Math.floor(et*166-.5))));tt=(nt+1)/166,j+=p(nt,1)}else tt=1,j+=p(0,1);return j+=p($(b),4),_.forEach(et=>{j+=p(H(et,tt),2)}),j},S=O;async function computeBlurhash(s){try{const e=await createImageBitmap(s),o=document.createElement("canvas"),a=Math.min(e.width,128),c=Math.min(e.height,128);o.width=a,o.height=c;const g=o.getContext("2d");if(!g)throw new Error("Unable to get canvas context");g.drawImage(e,0,0,a,c);const b=g.getImageData(0,0,a,c);return{hash:S(b.data,b.width,b.height,4,4),width:e.width,height:e.height}}catch(e){console.warn("Failed to compute blurhash",e);return}}const RESIZE_OPTIONS=[{id:0,label:"Original"},{id:1,label:"Large (2048px)",size:2048},{id:2,label:"Medium (1280px)",size:1280},{id:3,label:"Small (720px)",size:720}],buildFileEvent=(s,e)=>{const o=[["url",s.url||""],["m",s.type||""]];return s.size&&o.push(["size",String(s.size)]),e&&(o.push(["blurhash",e.hash]),o.push(["dim",`${e.width}x${e.height}`])),{kind:1063,content:s.name||"",tags:o}},UploadPanel=({servers:s,onUploaded:e,syncTransfers:o=[]})=>{const[a,c]=reactExports.useState(()=>s.slice(0,1).map(yt=>yt.url)),[g,b]=reactExports.useState([]),[_,j]=reactExports.useState(!0),[_e,tt]=reactExports.useState(0),[et,nt]=reactExports.useState(!1),[rt,it]=reactExports.useState([]),st=reactExports.useRef(null),lt=useQueryClient(),{signEventTemplate:at,ndk:ct}=useNdk(),ft=useCurrentPubkey(),vt=reactExports.useMemo(()=>new Map(s.map(yt=>[yt.url,yt])),[s]),Rt=reactExports.useMemo(()=>a.some(yt=>{var xt;return(xt=vt.get(yt))==null?void 0:xt.requiresAuth}),[a,vt]),_t=Rt?!!(ct!=null&&ct.signer):!0;React.useEffect(()=>{c(yt=>{const xt=s.map(Et=>Et.url),ht=yt.filter(Et=>xt.includes(Et));if(ht.length===0){const Et=xt[0];if(Et)return[Et]}return ht})},[s]);const Tt=yt=>{c(xt=>xt.includes(yt)?xt.filter(ht=>ht!==yt):[...xt,yt])},Ct=()=>{b([]),it([]),st.current&&(st.current.value="")},Nt=async(yt,xt)=>{if(!ct||!ct.signer)return;const ht=buildFileEvent(yt,xt),Et=new NDKEvent(ct,ht);await Et.sign(),await Et.publish().catch(()=>{})},At=async()=>{if(!g.length||!a.length)return;if(Rt&&!(ct!=null&&ct.signer)){alert("Connect your NIP-07 signer to upload to servers that require auth.");return}nt(!0);const yt=pLimit(2),xt=[];for(const ot of g){let dt=ot;_&&ot.type.startsWith("image/")&&(dt=await stripImageMetadata(dt));const bt=RESIZE_OPTIONS.find(wt=>wt.id===_e&&wt.size);bt&&ot.type.startsWith("image/")&&(dt=await resizeImage(dt,bt.size,bt.size)),xt.push(dt)}const ht=new Map;let Et=!1;await Promise.all(xt.map((ot,dt)=>Promise.all(a.map(bt=>yt(async()=>{const wt=vt.get(bt);if(!wt)return;const St=`${bt}-${ot.name}`;it(gt=>[...gt.filter($t=>$t.id!==St),{id:St,serverUrl:bt,fileName:ot.name,transferred:0,total:ot.size,status:"uploading",kind:"manual"}]);try{const gt=ot.type.startsWith("image/")?ht.get(ot.name)??await computeBlurhash(ot):void 0;ht.has(ot.name)||ht.set(ot.name,gt);const kt=await(wt.type==="nip96"?uploadBlobToNip96:uploadBlobToServer)(wt.url,ot,wt.requiresAuth?at:void 0,!!wt.requiresAuth,jt=>{it(Dt=>Dt.map(Bt=>Bt.id===St?{...Bt,transferred:jt.loaded,total:jt.total||ot.size}:Bt))}),Pt={...kt,name:kt.name||ot.name,type:kt.type||ot.type};rememberBlobMetadata(wt.url,Pt),ft&&lt.setQueryData(["server-blobs",wt.url,ft,wt.type],jt=>{if(!jt)return[Pt];const Dt=jt.findIndex(Bt=>Bt.sha256===Pt.sha256);if(Dt>=0){const Bt=[...jt];return Bt[Dt]={...jt[Dt],...Pt},Bt}return[...jt,Pt]}),it(jt=>jt.map(Dt=>Dt.id===St?{...Dt,transferred:Dt.total,status:"success"}:Dt)),await Nt(Pt,gt),lt.invalidateQueries({queryKey:["server-blobs",wt.url,ft,wt.type]})}catch(gt){Et=!0,it($t=>$t.map(kt=>kt.id===St?{...kt,status:"error",message:(gt==null?void 0:gt.message)||"Upload failed"}:kt))}}))))),nt(!1),e(!Et)};return jsxRuntimeExports.jsxs("section",{className:"rounded-2xl border border-slate-800 bg-slate-900/70 p-4 space-y-4",children:[jsxRuntimeExports.jsxs("header",{children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-slate-100",children:"Upload"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-400",children:"Optimise images, keep track of uploads and publish metadata events automatically."})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-sm text-slate-300",children:"Choose files"}),jsxRuntimeExports.jsx("input",{type:"file",multiple:!0,ref:st,onChange:yt=>b(yt.target.files?Array.from(yt.target.files):[]),className:"mt-1 w-full"}),!_t&&jsxRuntimeExports.jsx("div",{className:"mt-2 text-xs text-red-400",children:"Connect your NIP-07 signer to upload."}),g.length>0&&jsxRuntimeExports.jsxs("div",{className:"mt-2 text-xs text-slate-400",children:[g.length," file(s), total ",prettyBytes(g.reduce((yt,xt)=>yt+xt.size,0))]})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-slate-300",children:[jsxRuntimeExports.jsxs("label",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("input",{type:"checkbox",checked:_,onChange:yt=>j(yt.target.checked)}),"Remove metadata from images"]}),jsxRuntimeExports.jsxs("label",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{children:"Resize:"}),jsxRuntimeExports.jsx("select",{value:_e,onChange:yt=>tt(Number(yt.target.value)),className:"bg-slate-900 border border-slate-700 rounded-lg px-2 py-1 text-sm",children:RESIZE_OPTIONS.map(yt=>jsxRuntimeExports.jsx("option",{value:yt.id,children:yt.label},yt.id))})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-slate-300",children:"Upload to"}),jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap gap-3",children:[s.map(yt=>jsxRuntimeExports.jsxs("label",{className:`px-3 py-2 rounded-xl border text-sm cursor-pointer ${a.includes(yt.url)?"border-emerald-500 bg-emerald-500/10":"border-slate-800 bg-slate-900/60"}`,children:[jsxRuntimeExports.jsx("input",{type:"checkbox",className:"mr-2",checked:a.includes(yt.url),onChange:()=>Tt(yt.url)}),yt.name]},yt.url)),s.length===0&&jsxRuntimeExports.jsx("span",{className:"text-xs text-slate-400",children:"Add a server first."})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:At,disabled:!g.length||!a.length||et||!_t,className:"px-4 py-2 rounded-xl bg-emerald-600 hover:bg-emerald-500 disabled:cursor-not-allowed disabled:opacity-40",children:et?"Uploading…":"Upload"}),jsxRuntimeExports.jsx("button",{onClick:Ct,className:"px-4 py-2 rounded-xl bg-slate-800 hover:bg-slate-700",disabled:et,children:"Reset"})]})]}),rt.length+o.length>0&&jsxRuntimeExports.jsx("div",{className:"rounded-xl border border-slate-800 bg-slate-950/60 p-3 space-y-2 text-xs text-slate-300",children:Array.from(new Map([...o,...rt].map(yt=>[yt.id,yt])).values()).map(yt=>{var ot;const xt=((ot=vt.get(yt.serverUrl))==null?void 0:ot.name)||yt.serverUrl,ht=yt.total?yt.transferred/yt.total*100:yt.status==="success"?100:0,Et=Math.min(100,Math.max(0,Math.round(ht)));return jsxRuntimeExports.jsxs("div",{className:"space-y-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{children:yt.fileName}),jsxRuntimeExports.jsxs("span",{children:[yt.status==="uploading"&&`${Et}%`,yt.status==="success"&&"done",yt.status==="error"&&(yt.message||"error")]})]}),jsxRuntimeExports.jsx("div",{className:"h-1.5 rounded bg-slate-800 overflow-hidden",children:jsxRuntimeExports.jsx("div",{className:`h-full ${yt.status==="error"?"bg-red-500":"bg-emerald-500"}`,style:{width:`${Et}%`}})}),jsxRuntimeExports.jsx("div",{className:"text-slate-500",children:xt})]},yt.id)})})]})},AudioCtx=reactExports.createContext(void 0),AudioProvider=({children:s})=>{const e=reactExports.useRef(null),[o,a]=reactExports.useState(),c=reactExports.useCallback(()=>{if(!e.current){const j=new Audio;j.controls=!1,e.current=j}return e.current},[]),g=reactExports.useCallback(j=>{const _e=c();a(j),_e.src=j.url,_e.play().catch(()=>{})},[c]),b=reactExports.useCallback(()=>{c().pause(),a(void 0)},[c]),_=reactExports.useMemo(()=>({current:o,play:g,stop:b}),[o,g,b]);return jsxRuntimeExports.jsx(AudioCtx.Provider,{value:_,children:s})},useAudio=()=>{const s=reactExports.useContext(AudioCtx);if(!s)throw new Error("useAudio must be used inside AudioProvider");return s},TABS=[{id:"browse",label:"Browse",icon:BrowseIcon},{id:"upload",label:"Upload",icon:UploadIcon},{id:"servers",label:"Servers",icon:ServersIcon}],ALL_SERVERS_VALUE="__all__",normalizeManagedServer=s=>{const o=(s.url||"").trim().replace(/\/$/,""),a=o.replace(/^https?:\/\//,""),c=(s.name||"").trim()||a;return{...s,url:o,name:c,requiresAuth:!!s.requiresAuth,sync:!!s.sync}},validateManagedServers=s=>{const e=new Set;for(const o of s){const a=(o.url||"").trim();if(!a)return"Enter a server URL for every entry.";if(!/^https?:\/\//i.test(a))return"Server URLs must start with http:// or https://.";const c=a.replace(/\/$/,"").toLowerCase();if(e.has(c))return"Server URLs must be unique.";if(e.add(c),!(o.name||"").trim())return"Enter a server name for every entry."}return null};function App(){var Ps,Bs;const{connect:s,disconnect:e,user:o,signer:a,signEventTemplate:c,ndk:g}=useNdk(),b=useCurrentPubkey(),_=useQueryClient(),{servers:j,saveServers:_e,saving:tt}=useServers(),[et,nt]=reactExports.useState(j),[rt,it]=reactExports.useState(((Ps=j[0])==null?void 0:Ps.url)??null),[st,lt]=reactExports.useState("browse"),[at,ct]=reactExports.useState(null),[ft,vt]=reactExports.useState(new Set),[Rt,_t]=reactExports.useState("list"),[Tt,Ct]=reactExports.useState(null),[Nt,At]=reactExports.useState(null),yt=reactExports.useRef(null),xt=reactExports.useRef(new Set),ht=reactExports.useRef(new Map),Et=reactExports.useRef(new Set),ot=reactExports.useRef(new Set),[dt,bt]=reactExports.useState([]),[wt,St]=reactExports.useState({state:"idle",progress:0}),gt=reactExports.useMemo(()=>et.filter(Ut=>Ut.sync),[et]),$t=reactExports.useMemo(()=>validateManagedServers(et),[et]);reactExports.useEffect(()=>{var Ut;nt(j),rt&&!j.find(Ht=>Ht.url===rt)&&it(((Ut=j[0])==null?void 0:Ut.url)??null)},[j,rt]),reactExports.useEffect(()=>{vt(new Set)},[rt]),reactExports.useEffect(()=>()=>{yt.current&&clearTimeout(yt.current)},[]);const kt=reactExports.useCallback(async(Ut,Ht)=>{if(!Ut.url)return null;const zt=c;if(Ht.requiresAuth&&!zt)return null;const It=an=>{if(!an)return;const[Gt]=an.split(";");if(!Gt)return;const hn={"image/png":"png","image/jpeg":"jpg","image/jpg":"jpg","image/gif":"gif","image/webp":"webp","image/bmp":"bmp","image/svg+xml":"svg","image/avif":"avif","image/heic":"heic","video/mp4":"mp4","video/quicktime":"mov","video/webm":"webm","video/x-matroska":"mkv","audio/mpeg":"mp3","audio/wav":"wav","audio/ogg":"ogg","application/pdf":"pdf"},Rn=Gt.trim().toLowerCase();return hn[Rn]},sn=an=>{const Gt=an.match(/\.([a-zA-Z0-9]+)(?:\?|$)/);return Gt?Gt[1]:void 0},gn=an=>{var $n;const Gt=($n=Ut.name)==null?void 0:$n.trim();if(Gt&&/\.[a-zA-Z0-9]{1,8}$/.test(Gt))return Gt.replace(/[\\/]/g,"_");if(Gt){const en=Gt.replace(/[\\/]/g,"_"),tn=It(Ut.type);return tn?`${en}.${tn}`:en}let hn=an;const Rn=Ut.url;try{const tn=new URL(Rn).pathname.split("/").pop();tn&&(hn=tn)}catch{const tn=Rn.split("/").pop();tn&&(hn=tn)}if(hn=hn.replace(/[?#].*$/,""),!/\.[a-zA-Z0-9]{1,8}$/.test(hn)){const en=sn(Rn),tn=It(Ut.type),ls=en||tn;if(ls)return`${hn}.${ls}`.replace(/[\\/]/g,"_")}return hn.replace(/[\\/]/g,"_")},on={};try{const an=Ut.url;if(Ht.requiresAuth&&zt){if(Ht.type==="blossom"){const en=new URL(an),tn=await buildAuthorizationHeader(zt,"get",{hash:Ut.sha256,serverUrl:Ht.url,urlPath:en.pathname||`/${Ut.sha256}`});on.Authorization=tn}else if(Ht.type==="nip96"){const en=await buildNip98AuthHeader(zt,{url:an,method:"GET"});on.Authorization=en}}const Gt=await fetch(an,{headers:on});if(!Gt.ok)return null;const hn=await Gt.blob(),Rn=Ut.type||hn.type||"application/octet-stream",$n=gn(Ut.sha256);return new File([hn],$n,{type:Rn})}catch(an){return console.error("Failed to fetch blob for sync",an),null}},[c]),{snapshots:Pt,distribution:jt,aggregated:Dt}=useServerData(et);reactExports.useEffect(()=>{a&&ot.current.clear()},[a]),reactExports.useEffect(()=>{if(gt.length<2){St({state:"idle",progress:0});return}const Ut=dt.filter(zt=>zt.status==="uploading"||zt.status==="success");if(dt.some(zt=>zt.status==="uploading")&&Ut.length>0){const zt=Ut.reduce((sn,gn)=>{const on=gn.total||0,an=gn.status==="success"?on:Math.min(on,gn.transferred);return{transferred:sn.transferred+an,total:sn.total+on}},{transferred:0,total:0}),It=zt.total>0?zt.transferred/zt.total:0;St({state:"syncing",progress:It});return}if(dt.some(zt=>zt.status==="error")){St({state:"error",progress:0});return}St({state:"synced",progress:1})},[gt.length,dt]),reactExports.useEffect(()=>{if(gt.length<2)return;let Ut=!1;const Ht=new Set(gt.map(It=>It.url));return(async()=>{for(const It of gt){if(Ut)break;const sn=Pt.find(on=>on.server.url===It.url);if(!sn||sn.isLoading)continue;const gn=new Set(sn.blobs.map(on=>on.sha256));for(const[on,an]of Object.entries(jt)){if(Ut)break;if(gn.has(on)||!an.servers.some(Yt=>Ht.has(Yt)&&Yt!==It.url))continue;const Gt=`${It.url}::${on}`,hn=ht.current.get(Gt)??0;if(Date.now()<hn||xt.current.has(Gt))continue;const Rn=an.servers.find(Yt=>Yt!==It.url&&Ht.has(Yt));if(!Rn)continue;const $n=Pt.find(Yt=>Yt.server.url===Rn);if(!$n||$n.isLoading)continue;const en=$n.blobs.find(Yt=>Yt.sha256===on);if(!en||!en.url||It.requiresAuth&&!a||It.requiresAuth&&!c||It.type!=="blossom"&&It.type!=="nip96")continue;const tn=`sync-${It.url}-${on}`,ls=en.name||on,Xr=en.size&&en.size>0?en.size:1,Ds={id:tn,serverUrl:It.url,fileName:ls,transferred:0,total:Xr,status:"uploading",kind:"sync"};if(ot.current.has(It.url)){bt(Yt=>[...Yt.filter(Fn=>Fn.id!==tn),{...Ds,status:"error",message:"Sync auth failed"}]),ht.current.set(Gt,Date.now()+30*60*1e3);continue}xt.current.add(Gt),bt(Yt=>[...Yt.filter(Xt=>Xt.id!==tn),Ds].slice(-40));try{let Yt=!1;const Pr=Et.current.has(It.url),Fn=async()=>{const Xt=await kt(en,$n.server);if(!Xt)throw ht.current.set(Gt,Date.now()+30*60*1e3),new Error("Unable to fetch blob content for sync");const ln=Xt.size>0?Xt.size:Xr,mn=en.size,zn=mn==null?void 0:Number(mn),Br=typeof zn=="number"&&Number.isFinite(zn)?Math.round(zn):void 0,hs=typeof Br=="number"&&Br>0&&Br!==Xt.size;return await uploadBlobToServer(It.url,Xt,It.requiresAuth?c:void 0,!!It.requiresAuth,Nn=>{const Os=Nn.total&&Nn.total>0?Nn.total:ln,ao=typeof Nn.loaded=="number"?Nn.loaded:0,lo=Math.min(Os,ao);bt(uo=>uo.map(ps=>ps.id===tn?{...ps,transferred:lo,total:Os}:ps))},hs?{skipSizeTag:!0}:void 0),ln};if(It.type==="blossom"){if(!Pr)try{await mirrorBlobToServer(It.url,en.url,It.requiresAuth?c:void 0,!!It.requiresAuth),Yt=!0}catch(Xt){const mn=(Xt instanceof Error?Xt.message:String(Xt)).match(/status\s*(\d{3})/i),zn=mn?Number(mn[1]):void 0;if(!(zn===405||zn===404))throw ht.current.set(Gt,Date.now()+15*60*1e3),Xt;Et.current.add(It.url),await Fn(),Yt=!0}Yt||(await Fn(),Yt=!0)}else{const Xt=await kt(en,$n.server);if(!Xt)throw ht.current.set(Gt,Date.now()+15*60*1e3),new Error("Unable to fetch blob content for sync");await uploadBlobToNip96(It.url,Xt,It.requiresAuth?c:void 0,!!It.requiresAuth,ln=>{const mn=ln.total&&ln.total>0?ln.total:Xr,zn=typeof ln.loaded=="number"?ln.loaded:0,Br=Math.min(mn,zn);bt(hs=>hs.map(Nn=>Nn.id===tn?{...Nn,transferred:Br,total:mn}:Nn))}),Yt=!0}if(!Yt)throw new Error("Unknown sync completion state");ht.current.set(Gt,Date.now()+60*1e3),bt(Xt=>Xt.map(ln=>ln.id===tn?{...ln,transferred:ln.total||Xr,total:ln.total||Xr,status:"success"}:ln)),Ut||_.invalidateQueries({queryKey:["server-blobs",It.url,b,It.type]})}catch(Yt){console.error("Auto-sync failed",Yt);const Pr=Yt instanceof Error?Yt.message:String(Yt),Fn=Pr.match(/status\s*(\d{3})/i),Xt=Fn?Number(Fn[1]):void 0;Xt===404||Xt===405?(Et.current.add(It.url),ht.current.set(Gt,Date.now()+30*60*1e3)):Xt===401?(ot.current.add(It.url),ht.current.set(Gt,Date.now()+30*60*1e3),yt.current&&clearTimeout(yt.current),At("Sync auth failed – reconnect your signer."),yt.current=setTimeout(()=>{At(null)},6e3)):ht.current.set(Gt,Date.now()+15*60*1e3),bt(ln=>ln.map(mn=>mn.id===tn?{...mn,status:"error",message:Xt===404||Xt===405?"Sync unsupported: target blocks mirroring":Xt===401?"Sync auth failed":Pr||"Sync failed"}:mn))}finally{xt.current.delete(Gt)}}}})(),()=>{Ut=!0}},[jt,kt,b,_,c,a,Pt,gt]);const Bt=reactExports.useMemo(()=>Pt.find(Ut=>Ut.server.url===rt),[Pt,rt]),Mt=rt===null,Wt=useAudio(),{play:Kt}=Wt;reactExports.useEffect(()=>{let Ut=!1;async function Ht(){if(!g||!(o!=null&&o.pubkey)){Ct(null);return}try{const zt=await g.fetchEvent({kinds:[0],authors:[o.pubkey]});if(zt!=null&&zt.content&&!Ut)try{const It=JSON.parse(zt.content);Ct(It.picture||null)}catch{Ut||Ct(null)}}catch{Ut||Ct(null)}}return Ht(),()=>{Ut=!0}},[g,o==null?void 0:o.pubkey]);const Qt=Ut=>{const Ht=normalizeManagedServer(Ut),zt=Ht.url;zt&&(nt(It=>It.find(sn=>sn.url===zt)?It:[...It,Ht]),it(zt))},Zt=(Ut,Ht)=>{const zt=normalizeManagedServer(Ht),It=zt.url;It&&(nt(sn=>sn.some(gn=>gn.url!==Ut&&gn.url===It)?sn:sn.map(gn=>gn.url===Ut?zt:gn)),it(sn=>sn===Ut?It:sn))},cn=Ut=>{nt(Ht=>Ht.filter(zt=>zt.url!==Ut)),rt===Ut&&it(null)},nn=(Ut,Ht)=>{nt(zt=>zt.map(It=>It.url===Ut?{...It,requiresAuth:Ht}:It))},xn=(Ut,Ht)=>{nt(zt=>zt.map(It=>It.url===Ut?{...It,sync:Ht}:It))},gr=async()=>{if(!a){ct("Connect your signer to save servers");return}if(tt){ct("Server list update already in progress."),setTimeout(()=>ct(null),2e3);return}if($t){ct($t),setTimeout(()=>ct(null),3e3);return}const Ut=et.map(normalizeManagedServer);nt(Ut);try{await _e(Ut),ct("Server list updated"),setTimeout(()=>ct(null),2500)}catch(Ht){ct((Ht==null?void 0:Ht.message)||"Failed to save servers")}},Mn=Ut=>{vt(Ht=>{const zt=new Set(Ht);return zt.has(Ut)?zt.delete(Ut):zt.add(Ut),zt})},ds=async Ut=>{if(!Bt){ct("Select a specific server to delete files."),setTimeout(()=>ct(null),2e3);return}if(window.confirm(`Delete ${Ut.sha256.slice(0,10)}… from ${Bt.server.name}?`)){if(Bt.server.requiresAuth&&!a){ct("Connect your signer to delete from this server."),setTimeout(()=>ct(null),2e3);return}try{Bt.server.type==="nip96"?await deleteNip96File(Bt.server.url,Ut.sha256,Bt.server.requiresAuth?c:void 0,!!Bt.server.requiresAuth):await deleteUserBlob(Bt.server.url,Ut.sha256,Bt.server.requiresAuth?c:void 0,!!Bt.server.requiresAuth),_.invalidateQueries({queryKey:["server-blobs",Bt.server.url,b,Bt.server.type]}),vt(zt=>{const It=new Set(zt);return It.delete(Ut.sha256),It}),ct("Blob deleted"),setTimeout(()=>ct(null),2e3)}catch(zt){ct((zt==null?void 0:zt.message)||"Delete failed")}}},Yr=Ut=>{Ut.url&&(navigator.clipboard.writeText(Ut.url).catch(()=>{}),ct("URL copied to clipboard"),setTimeout(()=>ct(null),1500))},mr=Ut=>{Ut&&(j.forEach(Ht=>_.invalidateQueries({queryKey:["server-blobs",Ht.url]})),lt("browse"),yt.current&&clearTimeout(yt.current),At("All files uploaded successfully"),yt.current=setTimeout(()=>{At(null)},5e3))},fs=Ut=>{const Ht=Ut.target.value;it(Ht===ALL_SERVERS_VALUE?null:Ht),lt("browse")},to=reactExports.useMemo(()=>Bt?Bt.blobs.reduce((Ut,Ht)=>Ut+(Ht.size||0),0):0,[Bt]),js=(Bt==null?void 0:Bt.blobs.length)??Dt.count,no=Bt?to:Dt.size,ro=rt??ALL_SERVERS_VALUE,so=reactExports.useMemo(()=>gt.length<2?null:wt.state==="syncing"?`Syncing servers - ${Math.min(100,Math.max(0,Math.round((wt.progress||0)*100)))}%`:wt.state==="synced"?"Synced":wt.state==="error"?"Sync issue":null,[gt.length,wt]),io=Nt??so,oo=Nt||wt.state==="syncing"?"text-emerald-300":wt.state==="synced"?"text-emerald-200":wt.state==="error"?"text-red-400":"text-slate-500";return jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-slate-950 text-slate-100",children:jsxRuntimeExports.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-8 space-y-6",children:[jsxRuntimeExports.jsxs("header",{className:"flex flex-wrap items-center gap-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"text-2xl font-semibold",children:"Bloom"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-400",children:"Manage your content, upload media, and mirror files across servers."})]}),jsxRuntimeExports.jsx("div",{className:"ml-auto flex flex-wrap items-center gap-1 text-sm",children:o?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"flex items-center px-2 py-2 rounded-xl",children:Tt?jsxRuntimeExports.jsx("img",{src:Tt,alt:"User avatar",className:"h-8 w-8 rounded-full object-cover",onError:()=>Ct(null)}):jsxRuntimeExports.jsx("div",{className:"h-8 w-8 rounded-full bg-slate-700 flex items-center justify-center text-xs text-slate-200",children:(Bs=o.npub)==null?void 0:Bs.slice(0,2).toUpperCase()})}),jsxRuntimeExports.jsx("button",{onClick:e,className:"px-3 py-2 rounded-xl bg-slate-800 hover:bg-slate-700",children:"Disconnect"})]}):jsxRuntimeExports.jsx("button",{onClick:s,className:"px-3 py-2 rounded-xl bg-emerald-600 hover:bg-emerald-500",children:"Connect (NIP-07)"})})]}),at&&jsxRuntimeExports.jsx("div",{className:"rounded-xl border border-emerald-500 bg-emerald-500/10 px-4 py-2 text-sm",children:at}),jsxRuntimeExports.jsxs("div",{className:"rounded-2xl border border-slate-800 bg-slate-900/70",children:[jsxRuntimeExports.jsxs("nav",{className:"flex flex-wrap items-center gap-3 px-4 py-3 border-b border-slate-800",children:[jsxRuntimeExports.jsx("div",{className:"flex gap-3",children:TABS.map(Ut=>{const Ht=Ut.icon;return jsxRuntimeExports.jsxs("button",{onClick:()=>lt(Ut.id),className:`px-3 py-2 text-sm rounded-xl border flex items-center gap-2 transition ${st===Ut.id?"border-emerald-500 bg-emerald-500/10 text-emerald-200":"border-slate-800 bg-slate-900/70 text-slate-300 hover:border-slate-700"}`,children:[jsxRuntimeExports.jsx(Ht,{size:16}),jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-2",children:[Ut.label,Ut.id==="servers"&&jsxRuntimeExports.jsx("span",{className:"rounded-full bg-slate-800 px-2 py-0.5 text-[10px] font-medium text-slate-200",children:j.length})]})]},Ut.id)})}),st==="browse"&&jsxRuntimeExports.jsxs("div",{className:"ml-auto flex gap-2",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>_t("grid"),className:`rounded-xl border px-3 py-2 text-sm flex items-center gap-2 ${Rt==="grid"?"border-emerald-500 bg-emerald-500/10 text-emerald-200":"border-slate-800 bg-slate-900/70 text-slate-300 hover:border-slate-700"}`,title:"Icon view",children:[jsxRuntimeExports.jsx(GridIcon,{size:18}),jsxRuntimeExports.jsx("span",{className:"hidden sm:inline",children:"Icons"})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>_t("list"),className:`rounded-xl border px-3 py-2 text-sm flex items-center gap-2 ${Rt==="list"?"border-emerald-500 bg-emerald-500/10 text-emerald-200":"border-slate-800 bg-slate-900/70 text-slate-300 hover:border-slate-700"}`,title:"List view",children:[jsxRuntimeExports.jsx(ListIcon,{size:18}),jsxRuntimeExports.jsx("span",{className:"hidden sm:inline",children:"List"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"p-4",children:[st==="browse"&&jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:Mt?jsxRuntimeExports.jsx(BlobList,{blobs:Dt.blobs,signTemplate:c,selected:ft,viewMode:Rt,onToggle:Mn,onDelete:ds,onCopy:Yr,onPlay:Ut=>Ut.url&&Kt({url:Ut.url,title:Ut.name})}):Bt?jsxRuntimeExports.jsx(BlobList,{blobs:Bt.blobs,baseUrl:Bt.server.url,requiresAuth:Bt.server.requiresAuth,signTemplate:Bt.server.requiresAuth?c:void 0,serverType:Bt.server.type,selected:ft,viewMode:Rt,onToggle:Mn,onDelete:ds,onCopy:Yr,onPlay:Ut=>Ut.url&&Kt({url:Ut.url,title:Ut.name})}):jsxRuntimeExports.jsx("div",{className:"text-sm text-slate-400",children:"Select a server to browse its contents."})}),st==="upload"&&jsxRuntimeExports.jsx(UploadPanel,{servers:j,onUploaded:mr,syncTransfers:dt}),st==="servers"&&jsxRuntimeExports.jsx(ServerList,{servers:et,selected:rt,onSelect:it,onAdd:Qt,onUpdate:Zt,onSave:gr,saving:tt,disabled:!a,onRemove:cn,onToggleAuth:nn,onToggleSync:xn,validationError:$t})]}),jsxRuntimeExports.jsxs("footer",{className:"border-t border-slate-800 bg-slate-900/70 px-4 py-3 text-xs text-slate-300 flex flex-wrap items-center gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("label",{htmlFor:"status-server",className:"text-[11px] uppercase tracking-wide text-slate-500",children:"Server"}),jsxRuntimeExports.jsxs("select",{id:"status-server",value:ro,onChange:fs,className:"rounded-lg border border-slate-700 bg-slate-900 px-2 py-1 text-xs text-slate-200 focus:border-emerald-500 focus:outline-none focus:ring-1 focus:ring-emerald-500",children:[jsxRuntimeExports.jsx("option",{value:ALL_SERVERS_VALUE,children:"All servers"}),j.map(Ut=>jsxRuntimeExports.jsx("option",{value:Ut.url,children:Ut.name},Ut.url))]})]}),jsxRuntimeExports.jsx("div",{className:`flex-1 text-center ${oo}`,children:io??""}),jsxRuntimeExports.jsxs("div",{className:"ml-auto flex gap-4",children:[jsxRuntimeExports.jsxs("span",{children:[js," item",js===1?"":"s"]}),jsxRuntimeExports.jsx("span",{children:prettyBytes(no)})]})]})]}),Wt.current&&jsxRuntimeExports.jsxs("div",{className:"fixed bottom-4 right-4 bg-slate-900/80 border border-slate-800 rounded-xl px-4 py-3 text-sm text-slate-200 shadow-lg",children:[jsxRuntimeExports.jsx("div",{className:"font-medium",children:"Now playing"}),jsxRuntimeExports.jsx("div",{className:"text-xs text-slate-400",children:Wt.current.title||Wt.current.url}),jsxRuntimeExports.jsx("div",{className:"flex gap-2 mt-2",children:jsxRuntimeExports.jsx("button",{onClick:Wt.stop,className:"px-3 py-1 rounded-lg bg-slate-800 hover:bg-slate-700 text-xs",children:"Stop"})})]})]})})}const client=new QueryClient({defaultOptions:{queries:{refetchOnWindowFocus:!1,staleTime:1e3*60}}}),AppProviders=({children:s})=>jsxRuntimeExports.jsx(QueryClientProvider,{client,children:jsxRuntimeExports.jsx(NdkProvider,{children:jsxRuntimeExports.jsx(AudioProvider,{children:s})})}),el=document.getElementById("root"),root=createRoot(el);root.render(jsxRuntimeExports.jsx(React.StrictMode,{children:jsxRuntimeExports.jsx(AppProviders,{children:jsxRuntimeExports.jsx(App,{})})}));
